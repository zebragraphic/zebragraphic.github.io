var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};
$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var g=e[f];if(!(g in d))return;d=d[g]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+c+"$"+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(a){if(a)return a;var b=function(f,g){this.$jscomp$symbol$id_=f;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:g})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var c="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",d=0,e=function(f){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new b(c+(f||"")+"_"+d++,f)};return e},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=$jscomp.global[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&$jscomp.defineProperty(d.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var e=d.length,f=b.length;c=Math.max(0,Math.min(c|0,d.length));for(var g=0;g<f&&c<e;)if(d[c++]!=b[g++])return!1;return g>=f}},"es6","es3");$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).v}},"es6","es3");$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(b,c,d){var e=this.length||0;0>c&&(c=Math.max(0,e+c));if(null==d||d>e)d=e;d=Number(d);0>d&&(d=Math.max(0,e+d));for(c=Number(c||0);c<d;c++)this[c]=b;return this}},"es6","es3");$jscomp.typedArrayFill=function(a){return a?a:Array.prototype.fill};
$jscomp.polyfill("Int8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint8ClampedArray.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("Uint32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Float32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Float64Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(b){var c=$jscomp.checkStringArgs(this,null,"repeat");if(0>b||1342177279<b)throw new RangeError("Invalid count value");b|=0;for(var d="";b;)if(b&1&&(d+=c),b>>>=1)c+=c;return d}},"es6","es3");
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,b,"endsWith");b+="";void 0===c&&(c=d.length);c=Math.max(0,Math.min(c|0,d.length));for(var e=b.length;0<e&&0<c;)if(d[--c]!=b[--e])return!1;return 0>=e}},"es6","es3");var global=function(){return this||(0,eval)("(this)")}(),virtual_function=function(){};
function getPackageByName(a){if(void 0==a||""==a)return global;var b=global;a=a.split(".");for(var c=0;c<a.length;c++){var d=a[c];b[d]||(b[d]={IS_PACKAGE_OBJECT:!0});b=b[d]}return b}function getClassByFullName(a){if(-1==a.indexOf("."))return global[a];var b=a.split(".");a=b.pop();b=b.join(".");return getPackageByName(b)[a]}
function classof(a,b){if(!a)return"";b||(b=global);"string"==typeof b&&(b=getPackageByName(b));var c=["webkitStorageInfo","webkitIndexedDB"],d;for(d in b)try{if(!(-1<c.indexOf(d))&&b[d]instanceof Function)try{if(a instanceof b[d])return d}catch(f){}}catch(f){}for(d in b)try{if("object"==typeof b[d]&&b[d].IS_PACKAGE_OBJECT){var e=classof(a,b[d]);if(""!=e)return d+"."+e}}catch(f){}return""}
function nameof(a,b){if(!a)return"";b||(b=global);"string"==typeof b&&(b=getPackageByName(b));var c=["webkitStorageInfo","webkitIndexedDB"],d;for(d in b)try{if(!(-1<c.indexOf(d))&&b[d]==a)return d}catch(f){}for(d in b)try{if("object"==typeof b[d]&&b[d].IS_PACKAGE_OBJECT){var e=nameof(a,b[d]);if(""!=e)return d+"."+e}}catch(f){}return""}
function Class(a,b){if("string"===typeof a){var c=getPackageByName(b.Package);c[a]=Class(b);return c[a]}var d=function(){if(this.Import){"string"==typeof this.Import&&(this.Import=[this.Import]);for(var f=0;f<this.Import.length;f++){var g=this.Import[f],h=getPackageByName(g);if(h instanceof Function)this[g.split(".").pop()]=h;else for(var k in h)h[k]instanceof Function&&(this[k]=h[k])}}h=getPackageByName(this.Package);if(h!=global)for(k in h)this.getClassName()!=k&&h[k]instanceof Function&&(this[k]=
h[k]);this.create&&this.create instanceof Function&&this.create.apply(this,arguments)};d.prototype=a||{};var e;d.prototype.getClassName=function(){e||(e=nameof(d,this.Package));return e};d.prototype.getClass=function(){return d};a=d.prototype.statics;if(void 0!=a){for(c in a)void 0==d[c]&&(d[c]=a[c]);delete d.prototype.statics}return d}
Function.prototype.extend=function(a){if(!a)return this;if("string"==typeof a)if(-1<a.indexOf(".")){if(a=getClassByFullName(a),!a)return this}else{var b=this.prototype.Package,c=a;b&&""!=b&&(a=b+"."+c);a=getClassByFullName(a);if(!a&&(a=getClassByFullName(c),!a))return this}if(a instanceof Function){for(var d in a)void 0==this[d]&&(this[d]=a[d]);for(d in a.prototype)void 0==this.prototype[d]?a.prototype[d]==virtual_function?console&&console.error&&console.error("virtual function [%s] must be override.",
d):this.prototype[d]=a.prototype[d]:(c=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,this.prototype[d]instanceof Function&&a.prototype[d]instanceof Function&&c.test(this.prototype[d])&&(this.prototype[d]=function(e,f){return function(){var g=this._super;this._super=e;var h=f.apply(this,arguments);this._super=g;return h}}(a.prototype[d],this.prototype[d])));return this}return"object"!==typeof a?this:this.extend(Class(a))};
Function.prototype.expand=function(a,b){if("object"===typeof a){void 0==b&&(b=!1);var c=a.statics;if(c&&"object"==typeof c){for(var d in c)if(b||void 0==this[d])this[d]=c[d];delete a.statics}for(d in a)if(b||void 0==this.prototype[d])this.prototype[d]=a[d];return this}};
var Instance={copy:function(a){if(!a||"object"!==typeof a)return a;var b={};a instanceof Array&&(b=[]);for(property in a)b[property]="object"==typeof a[property]?Instance.copy(a[property]):a[property];return b},create:function(a,b){b||(b=[]);var c=a;"string"==typeof a&&(c=getClassByFullName(c));if(!c)return null;a=c.prototype.create;c.prototype.create=function(){};var d=new c;c.prototype.create=a;d.create&&d.create instanceof Function&&d.create.apply(d,b);return d},JSON:function(a){if(void 0===a)return"undefined";
if(null===a)return"null";if(a instanceof Array){var b=[];b.push("[");for(var c=0;c<a.length;c++)b.push(Instance.JSON(a[c])),b.push(", ");1<b.length&&b.pop();b.push("]");return b.join("")}if(a instanceof Function)return a;if("string"===typeof a)return a=a.toString(),a=a.replaceAll("\\","\\\\",!0),a=a.replaceAll('"','\\"',!0),'"'+a+'"';if("number"===typeof a)return Number(a).toString();if("boolean"===typeof a)return(!!a).toString();if("object"===typeof a){b=[];b.push("{");for(c in a){var d='"'+c+'":'+
Instance.JSON(a[c]);b.push(d);b.push(", ")}1<b.length&&b.pop();b.push("}");return b.join("")}},parse:function(a,b){return a&&"undefined"!=a&&"null"!=a&&""!=a?eval("("+a+")"):b}};Object.create=Object.create||function(){function a(){}return function(b){if(1!=arguments.length)throw Error("Object.create implementation only accepts one parameter.");a.prototype=b;return new a}}();
Object.keys=Object.keys||function(a){if(a!==Object(a))throw new TypeError("Object.keys called on a non-object");var b=[],c;for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b};
Class("TextFormatAnalyzer",{create:function(a){this.$textForAnalysis=$("<div></div>");this.analysisResult=[];if(a&&HTMLString.isHTML(a)){var b=$(a);a.toLowerCase().startsWith("<textformat")?this.$textForAnalysis.append(b):(a=$("<textformat></textformat>"),this.$textForAnalysis.append(a),a.append(b));this.analysis()}else this.initFromText(a)},initFromText:function(a){a||(a=" ");var b={leading:0,leftMargin:0,rightMargin:0,paragraphs:[]};a={align:"LEFT",font:{},text:a};a.font.family="Arial";a.font.size=
12;a.font.color="#000000";a.font.letterSpacing=0;a.font.kerning=0;a.font.bold=!1;a.font.italic=!1;a.font.underline=!1;b.paragraphs.push(a);this.analysisResult.push(b)},analysis:function(){for(var a=this.$textForAnalysis.children(),b=0;b<a.length;b++){var c={leading:0,leftMargin:0,rightMargin:0,paragraphs:[]},d=$(a[b]);c.leading=d.attr("LEADING")?parseInt(d.attr("LEADING")):0;_agent_.system.name!=_agent_.system.IOS&&(c.leading+=5);c.leftMargin=d.attr("LEFTMARGIN")?parseInt(d.attr("LEFTMARGIN")):0;
c.rightMargin=d.attr("RIGHTMARGIN")?parseInt(d.attr("RIGHTMARGIN")):0;d=d.children();for(var e=0;e<d.length;e++){var f=$(d[e]),g={align:"LEFT",font:null,text:""};g.align=f.attr("ALIGN")?f.attr("ALIGN"):"LEFT";var h=$(f.children()[0]);f={};f.family=h.attr("FACE")?h.attr("FACE"):"Arial";f.size=h.attr("SIZE")?parseInt(h.attr("SIZE")):12;f.color=h.attr("COLOR")?h.attr("COLOR"):"#000000";f.kerning=h.attr("KERNING")?parseInt(h.attr("KERNING")):0;_agent_.system.name!=_agent_.system.IOS&&(f.leading=c.leading);
f.lineHeight=f.size+c.leading;f.bold=0<h.find("B").length;g.font=f;h=h.html();h=this.changeXmlToHtml(h,f.leading);g.text=h;/<a\b[^>]+\bhref="([^"]*)"[^>]*>([\s\S]*?)<\/a>/.test(g.text)&&(this.hasATag=!0);c.paragraphs.push(g)}this.analysisResult.push(c)}},changeXmlToHtml:function(a,b){var c=a.match(/<font[ ="A-Za-z0-9_#,]*>/),d=[];for(null!=c&&(a=a.replace(/<\/font/g,"</span"));null!=c;){var e=c[0],f='style="',g=e.match(/color="[A-Za-z0-9#]*"/),h=e.match(/size="[0-9]*"/),k=e.match(/face="[A-Za-z0-9_# ,]*"/),
l=e.match(/letterspacing="[0-9]*"/);null!=g&&(e=e.replace(g[0],""),d=this.changeTag(d,g[0]));null!=h&&(e=e.replace(h[0],""),d=this.changeTag(d,h[0].replace("size","font-size")),d=this.changeTag(d,h[0].replace("size","line-height"),b));null!=k&&(e=e.replace(k[0],""),d=this.changeTag(d,k[0].replace("face","font-family")));null!=l&&(e=e.replace(l,""),d=this.changeTag(d,l[0].replace("letterspacing","letter-spacing")));for(g=0;g<d.length;g++)f+=d[g][0]+":"+d[g][1]+";";e=e.replace(/ /g,"");e=e.replace("font",
"span ");e=e.replace(">",f+'">');a=a.replace(c[0],e);a=a.replaceAll("  ","&nbsp;&nbsp;");d=[];c=a.match(/<font[ ="A-Za-z0-9_#,]*>/)}0<=a.indexOf("<i>")&&(a=a.replaceAll("<i>",'<i style="font-style: italic;text-decoration:inherit;">'));0<=a.indexOf("<u>")&&(a=a.replaceAll("<u>",'<u style="font-style: inherit;text-decoration: underline">'));return a},changeTag:function(a,b,c){b=b.replace(/"/g,"");b=b.split("=");c&&(b[1]=Number(b[1])+Number(c));if("font-size"==b[0]||"letter-spacing"==b[0]||"line-height"==
b[0])b[1]+="px";a.push(b);return a},getLeftMargin:function(){return 0==this.analysisResult.length?0:this.analysisResult[0].leftMargin},getRightMargin:function(){return 0==this.analysisResult.length?0:this.analysisResult[0].rightMargin},getAlign:function(){if(0==this.analysisResult.length)return"LEFT";var a=this.analysisResult[0];return 0==a.paragraphs.length?"LEFT":a.paragraphs[0].align},getFontFamily:function(){var a=this.getFont();return a?a.family:"Arial"},getFontColor:function(){var a=this.getFont();
return a?a.color:"#000000"},getFontSize:function(){var a=this.getFont();return a?a.size:12},getLetterSpace:function(){var a=this.getFont();return a?a.letterSpacing:0},getWordSpace:function(){var a=this.getFont();return a?a.kerning:"0"},getLeading:function(){var a=this.getFont();return a?a.leading:"0"},getLineHeight:function(){var a=this.getFont(),b=a.lineHeight;if(!a)return"0";_agent_.system.name!=_agent_.system.IOS&&(b-=5);return b},getFont:function(){if(0==this.analysisResult.length)return null;
var a=this.analysisResult[0];return 0==a.paragraphs.length?null:a.paragraphs[0].font},initFont:function(a){var b=this.getFontCSS(this.getFont());a.css(b)},getMaxFontSize:function(){for(var a=0,b=0;b<this.analysisResult.length;b++)for(var c=this.analysisResult[b],d=0;d<c.paragraphs.length;d++)a=Math.max(a,c.paragraphs[d].font.size);return a},getMinFontSize:function(){for(var a=1E4,b=0;b<this.analysisResult.length;b++)for(var c=this.analysisResult[b],d=0;d<c.paragraphs.length;d++)a=Math.min(a,c.paragraphs[d].font.size);
return a},getText:function(){for(var a=this.getTextLines(),b="",c=0;c<a.length;c++)b=b+a[c]+"\r\n";return b},getTextLines:function(){return this.getLines()},getLines:function(){for(var a=[],b=0;b<this.analysisResult.length;b++)for(var c=this.analysisResult[b],d=0;d<c.paragraphs.length;d++)a.push(c.paragraphs[d].text.replace(/  /g,"&nbsp;&nbsp;"));return a},htmlHasATag:function(){return this.hasATag},getHTML:function(a){for(var b=$("<div style='word-wrap:break-word;cursor:default;'></div>"),c=0;c<
this.analysisResult.length;c++){var d=this.analysisResult[c],e=$("<div></div>");0<d.leftMargin&&e.css("margin-left",d.leftMargin+"px");0<d.rightMargin&&e.css("margin-right",d.rightMargin+"px");for(var f=0;f<d.paragraphs.length;f++){var g=d.paragraphs[f],h=$("<p></p>");a?h.css(a):h.css("text-align",g.align);var k=$("<span></span>");k.css(this.getFontCSS(g.font));g=g.text;g=g.replaceAll("&lt;br&gt;","<br>");(g=g.replaceAll("&lt;br/&gt;","<br/>"))||(g="&nbsp;");g=g.replaceAll("  ","&nbsp;&nbsp;");-1<
g.indexOf("<u>")&&(g=g.replaceAll("<u>",'<u style="text-decoration:underline">'));k.append(g);h.append(k);e.append(h)}b.append(e)}return b},getFontCSS:function(a){return a?{"font-family":a.family,color:a.color,"font-size":a.size+"px","letter-spacing":a.letterSpacing+"px","word-spacing":a.kerning+"px","font-style":a.italic?"italic":"normal","text-decoration":a.underline?"underline":"none"}:{}}});
Class("Item",{Package:"PageItem",create:function(a,b,c,d){this.parent=a;this.config=this.parseConfig(b);this.pageWidth=c;this.pageHeight=d;this.pw=c;this.ph=d;this.type=this.config.annotype},parseConfig:function(a){return a},animateConfig:function(){this.config.animation&&this.config.animation.name&&(this.config.animation.duration||(this.config.animation.duration=1),this.config.animation.timeFun||(this.config.animation.timeFun="ease"),this.config.animation.delay||(this.config.animation.delay=0),this.config.animation.count||
(this.config.animation.count=1),this.config.animation.direction||(this.config.animation.direction="normal"))},getOssUrl:function(a,b,c,d){return a=0<a.lastIndexOf("?")?a+("&x-oss-process=image/resize,m_"+d+",w_"+parseInt(b)+",h_"+parseInt(c)):a+("?x-oss-process=image/resize,m_"+d+",w_"+parseInt(b)+",h_"+parseInt(c))},destroy:function(){},onResize:virtual_function,onResizePopup:function(a,b){if(this.popup&&this.popup.visible&&this.popup.onResize)this.popup.onResize(a,b)},setContainerSize:function(a,
b,c,d,e){void 0==d&&(d=1024);void 0==e&&(e=1024);b=getCoverSize(b,c,d,e);$(a).css({width:b.width+"px",height:b.height+"px","-webkit-transform-origin":"0 0","transform-origin":"0 0","-webkit-transform":"scale("+b.scale+")",transform:"scale("+b.scale+")"})},resizeHint:function(){this.hintBody&&"block"==this.hintBody.css("display")&&("2"==this.config.hint.hintShapeType?this.normalHint(this.hintBody):this.bubbleHint(this.hintBody))},initLinkHint:function(a){if(this.config.hint&&this.config.hint.text&&
this.config.hint.text.length&&"null"!=this.config.hint.text.toLowerCase()){var b=null;b="2"==this.config.hint.hintShapeType?new NormalLinkHint:new BubbleLinkHint;var c=b.build(this.config);this.hintBody=c;c.css({"z-index":"100"});c&&(this.parent.append(c),c.hide(),a.bind(isTouch?_event._down:_event._enter,function(d){this.hintWidth=this.hintWidth||c.width();this.hintHeight=this.hintHeight||c.height();c.show();c.find("div").css({left:this.hintWidth/2+"px"});"2"==this.config.hint.hintShapeType?this.normalHint(c):
this.bubbleHint(c)}.bind(this)),a.bind(isTouch?_event._up:_event._leave,function(d){c.hide()}.bind(this)))}},normalHint:function(a){var b=this.left+(this.width-this.hintWidth-10)/2;0>=b&&(b=0);this.top+this.hintHeight>this.pageHeight/2?a.css({left:b+"px",top:Math.max(2,this.top-this.hintHeight-15)+"px"}):a.css({left:b+"px",top:Math.max(2,this.top+this.height+5)+"px"})},bubbleHint:function(a){var b=this.left+(this.width-this.hintWidth-10)/2;0>=b&&(b=0);this.top+this.hintHeight+this.height>this.pageHeight/
2?a.css({left:b+"px",top:Math.max(2,this.top-this.hintHeight-15)+"px"}):(a.css({left:b+"px",top:Math.max(2,this.top+this.height+5)+"px"}),a.find("#text_hint")[0]&&a.find("#text_hint").css({position:"absolute",bottom:"auto",top:"-10px",left:this.hintWidth/2-6+"px",border:"10px solid transparent","border-top-width":0,"border-left-width":"5px","border-right-width":"5px","border-bottom-color":Color(this.config.hint.hintShapeColor).rgba(this.config.hint.hintShapeAlpha)}))},addActionEvent:function(a){a=
new this.ActionManager(this,a,this.config);a.prepareAction();a.addAction()},addEffectEvent:function(a,b){(new this.EffectManager(this,a,b,this.config)).addEffect()},addHighLightEvent:function(a,b){a=new this.HighLightManager(this,a,b,this.config);if(a=a.addHighLight())return a},imageReflection:function(a){1==supports("boxReflect")&&this.addCSSReflection(a)},addCSSReflection:function(a){var b=this.config.pageW/this.pageWidth;this.config.pageW||(b=1.2);var c=this.config.reflectionAlpha?Number(this.config.reflectionAlpha):
0;"1"==this.config.reflectionType&&(c?a.css({"-webkit-box-reflect":"below "+10*b+"px -webkit-gradient(linear, 0 0, 0 100%, from(rgba(255,255,255,"+c/2+")),color-stop(0.5,rgba(255,255,255,"+c+")), to(white))","-o-box-reflect":"below "+10*b+"px -webkit-gradient(linear, 0 0, 0 100%, from(rgba(255,255,255,"+c/2+")),color-stop(0.5,rgba(255,255,255,"+c+")), to(white))"}):a.css({"-webkit-box-reflect":"below "+10*b+"px -webkit-gradient(linear, 0 0, 0 100%, from(transparent), color-stop(0.7, transparent), to(white))",
"-o-box-reflect":"below "+10*b+"px -webkit-gradient(linear, 0 0, 0 100%, from(transparent), color-stop(0.7, transparent), to(white))"}));"6"==this.config.reflectionType&&(c?a.css({"-webkit-box-reflect":"below 0px -webkit-gradient(linear, 0 0, 0 100%, from(rgba(255,255,255,"+c/2+")),color-stop(0.5,rgba(255,255,255,"+c+")), to(white))","-o-box-reflect":"below 0px -webkit-gradient(linear, 0 0, 0 100%, from(rgba(255,255,255,"+c/2+")),color-stop(0.5,rgba(255,255,255,"+c+")), to(white))"}):a.css({"-webkit-box-reflect":"below 0px -webkit-gradient(linear, 0 0, 0 100%, from(transparent), color-stop(0.5, transparent), to(white))",
"-o-box-reflect":"below 0px -webkit-gradient(linear, 0 0, 0 100%, from(transparent), color-stop(0.5, transparent), to(white))"}));"3"==this.config.reflectionType&&(c?a.css({"-webkit-box-reflect":"below "+10*b+"px -webkit-gradient(linear, 0 0, 0 100%, from(rgba(255,255,255,"+c/2+")),color-stop(0.5,rgba(255,255,255,"+c+")), to(white))","-o-box-reflect":"below "+10*b+"px -webkit-gradient(linear, 0 0, 0 100%, from(rgba(255,255,255,"+c/2+")),color-stop(0.5,rgba(255,255,255,"+c+")), to(white))"}):a.css({"-webkit-box-reflect":"below "+
10*b+"px -webkit-gradient(linear, 0 0, 0 100%, from(transparent), color-stop(0.5, transparent), to(white))","-o-box-reflect":"below "+10*b+"px -webkit-gradient(linear, 0 0, 0 100%, from(transparent), color-stop(0.5, transparent), to(white))"}));"4"==this.config.reflectionType&&(c?a.css({"-webkit-box-reflect":"below 0 -webkit-gradient(linear, 0 0, 0 100%, from(rgba(255,255,255,"+c/2+")),color-stop(0.5,rgba(255,255,255,"+c+")), to(white))","-o-box-reflect":"below 0 -webkit-gradient(linear, 0 0, 0 100%, from(rgba(255,255,255,"+
c/2+")),color-stop(0.5,rgba(255,255,255,"+c+")), to(white))"}):a.css({"-webkit-box-reflect":"below 0 -webkit-gradient(linear, 0 0, 0 100%, from(transparent), color-stop(0.7, transparent), to(white))","-o-box-reflect":"below 0 -webkit-gradient(linear, 0 0, 0 100%, from(transparent), color-stop(0.7, transparent), to(white))"}));"5"==this.config.reflectionType&&(c?a.css({"-webkit-box-reflect":"below 0 -webkit-gradient(linear, 0 0, 0 100%, from(rgba(255,255,255,"+c/2+")),color-stop(0.5,rgba(255,255,255,"+
c+")), to(white))","-o-box-reflect":"below 0 -webkit-gradient(linear, 0 0, 0 100%, from(rgba(255,255,255,"+c/2+")),color-stop(0.5,rgba(255,255,255,"+c+")), to(white))"}):a.css({"-webkit-box-reflect":"below 0 -webkit-gradient(linear, 0 0, 0 100%, from(transparent), color-stop(0.6, transparent), to(white))","-o-box-reflect":"below 0 -webkit-gradient(linear, 0 0, 0 100%, from(transparent), color-stop(0.6, transparent), to(white))"}))},setShapeShadow:function(a){switch(Number(this.config.sa)){case 90:offx=
0;offy=4;break;case 180:offx=-4;offy=0;break;case 270:offx=0;offy=-4;break;case 360:offx=4,offy=0}a.shadowOffsetX=offx;a.shadowOffsetY=offy;a.shadowBlur=this.config.sx;a.shadowColor=Color(this.config.sr).toString()},addShadow:function(a){if(this.config.hasShadow){var b=0,c=0,d=this.config.shadow,e=Color(d.shadowColor).rgba(d.shadowAlpha);switch(Number(d.shadowAngle)){case 90:b=0;c=4;break;case 180:b=-4;c=0;break;case 270:b=0;c=-4;break;case 360:b=4,c=0}a.css({"box-shadow":b+"px "+c+"px "+d.shadowBlurX+
"px "+e,"-moz-box-shadow":b+"px "+c+"px "+d.shadowBlurX+"px "+e,"-webkit-box-shadow":b+"px "+c+"px "+d.shadowBlurX+"px "+e,"-ms-box-shadow":b+"px "+c+"px "+d.shadowBlurX+"px "+e,"-o-box-shadow":b+"px "+c+"px "+d.shadowBlurX+"px "+e})}},setRotation:function(a,b){0!=parseInt(b)&&(isNaN(b)||a.css({transform:"rotate("+b+"deg)","-webkit-transform":"rotate("+b+"deg)","-ms-transform":"rotate("+b+"deg)","-o-transform":"rotate("+b+"deg)","-moz-transform":"rotate("+b+"deg)","transform-origin":"0% 0%","-webkit-transform-origin":"0% 0%",
"-ms-transform-origin":"0% 0%","-o-transform-origin":"0% 0%","-moz-transform-origin":"0% 0%"}))},fixRelativePath:function(a){return a?"string"!==typeof a?fixURLValue(a):1==bookConfig.isFlipPdf?a.startsWith("../")?fixURLValue(a):a.startsWith("./")?fixURLValue("."+a):a.startsWith("files")?fixURLValue("../"+a):a.isUrl()?fixURLValue(a):fixURLValue("../"+a):fixURLValue(a):a},nameIs:function(){if(0==arguments.length)return!1;for(var a=this.getClassName(),b=0;b<arguments.length;b++)if("string"==typeof arguments[b]&&
a==arguments[b])return!0;return!1},nameLike:function(){if(0==arguments.length)return!1;for(var a=this.getClassName().toLowerCase(),b=0;b<arguments.length;b++)if("string"==typeof arguments[b]){var c=arguments[b].toLowerCase();if(-1<a.indexOf(c))return!0}return!1}});
Class("NormalLinkHint",{build:function(a,b,c){c=new TextFormatAnalyzer(a.hint.text);var d=c.getHTML();b=$("<div></div>");b.html(d);c.initFont(b);c=Color(a.hint.hintShapeColor);parseBool(a.hint.hintAuto)?b.css({padding:"5px","border-radius":"2px"}):b.css({width:a.hint.hintW+"px",height:a.hint.hintH+"px","line-height":a.hint.hintH+"px"});b.css({position:"absolute",background:c.rgba(a.hint.hintShapeAlpha),"border-radius":"2px",color:"white"});return b}});
Class("BubbleLinkHint",{build:function(a,b,c){var d=new TextFormatAnalyzer(a.hint.text),e=d.getHTML();b=$("<div></div>");c=$("<div id='text_hint'></div>");b.html(e);b.append(c);d.initFont(b);d=Color(a.hint.hintShapeColor);e=Color(a.hint.hintShapeColor2);parseBool(a.hint.hintAuto)?b.css({padding:"5px","border-radius":"2px"}):b.css({width:a.hint.hintW+"px",height:a.hint.hintH+"px","line-height":a.hint.hintH+"px"});c.css({position:"absolute",bottom:"-10px",border:"10px solid transparent","border-bottom-width":0,
"border-left-width":"5px","border-right-width":"5px","border-top-color":e.rgba(a.hint.hintShapeAlpha)});b.css({position:"absolute","text-align":"center",background:"-moz-linear-gradient(top,"+d.rgba(a.hint.hintShapeAlpha)+","+e.rgba(a.hint.hintShapeAlpha)+")",background:"-o-linear-gradient(top,"+d.rgba(a.hint.hintShapeAlpha)+","+e.rgba(a.hint.hintShapeAlpha)+")",background:"-ms-linear-gradient(top,"+d.rgba(a.hint.hintShapeAlpha)+","+e.rgba(a.hint.hintShapeAlpha)+")",background:"-webkit-linear-gradient(top,"+
d.rgba(a.hint.hintShapeAlpha)+","+e.rgba(a.hint.hintShapeAlpha)+")",background:"linear-gradient("+d.rgba(a.hint.hintShapeAlpha)+","+e.rgba(a.hint.hintShapeAlpha)+")","border-radius":"2px",color:"white"});return b}}).extend("NormalLinkHint");
Class("ActionManager",{Package:"PageItem",create:function(a,b,c){this.item=a;this.element=b;this.config=c;this.action=c.action;this.initAction();this.initActionEvent()},initAction:function(){if(this.action){if(this.action instanceof Array){if(0==this.action.length){this.action=null;return}this.action=this.action[0]}this.eventType=null;this.action.triggerEventType&&(this.eventType=this.action.triggerEventType);_agent_.system.name==_agent_.system.IOS&&(this.eventType==PageEditor.TriggerEventType.MouseDown&&
(void 0==this.action.linkTarget&&(this.action.linkTarget="_self"),"_blank"==this.action.linkTarget&&(this.eventType=PageEditor.TriggerEventType.MouseUp),"Blank"==this.action.linkTarget&&(this.eventType=PageEditor.TriggerEventType.MouseUp)),this.action.url&&"tel:"==this.action.url.toLowerCase().substr(0,4)&&(this.eventType=PageEditor.TriggerEventType.MouseUp))}},initActionEvent:function(){if(this.action)switch(this.eventName="",this.eventType){case PageEditor.TriggerEventType.MouseDown:this.eventName=
_event._click;break;case PageEditor.TriggerEventType.MouseOver:this.eventName=_event._over;if(isPad()||isPhone())this.eventName=_event._click;break;case PageEditor.TriggerEventType.MouseOut:this.eventName=_event._out;if(isPad()||isPhone())this.eventName=_event._click;break;case PageEditor.TriggerEventType.MouseUp:this.eventName=_event._click;break;case PageEditor.TriggerEventType.MouseMove:this.eventName=_event._move;break;case PageEditor.TriggerEventType.MouseLeave:if(this.eventName=_event._leave,
isPad()||isPhone())this.eventName=_event._click}},prepareAction:function(){this.action&&this.element&&(this.executor=this.getActionExecutor())&&this.executor.prepare&&this.executor.prepare(this.item,this.element,this.config)},addAction:function(){this.action&&this.element&&""!=this.eventName&&(!isPhone()&&!isPad()||this.eventName!=_event._click&&this.eventName!=_event._down&&this.eventName!=_event._end&&this.eventName!=_event._over&&this.eventName!=_event._move?(this.element.css({cursor:"pointer"}),
this.element.bind("mousedown touchstart pointerdown",function(a){this.config.isInverse||a.stopPropagation()}.bind(this)),this.element.bind(this.eventName,function(a){this.onAction();this.config.isInverse||a.stopPropagation();if(!this.config.isInverse)return!1}.bind(this))):this.addPhoneAction())},addPhoneAction:function(){var a=null;this.element.onTap(function(b){a&&(clearTimeout(a),a=null);a=setTimeout(function(){this.onAction();a=null}.bind(this),100)}.bind(this))},onAction:function(){this.executor||
(this.executor=this.getActionExecutor());if(this.executor)return this.executor.execute(this.item,this.element,this.config)},getActionExecutor:function(){if(this.action.actionType==PageEditor.ActionType.GOTO_PAGE)return new PageItem.Action.GotoPageAction;if(this.action.actionType==PageEditor.ActionType.OPEN_URL)return new PageItem.Action.OpenUrlAction;if(this.action.actionType==PageEditor.ActionType.OPEN_WINDOW)return new PageItem.Action.OpenWindowAction;if(this.action.actionType==PageEditor.ActionType.SLIDE_SHOW)return new PageItem.Action.OpenSlideshowAction;
if(this.action.actionType==PageEditor.ActionType.PLAY_AUDIO)return new PageItem.Action.PlayAudioAction;if(this.action.actionType==PageEditor.ActionType.ACTION_JS)return new PageItem.Action.ExecuteJavascriptAction;if(this.action.actionType==PageEditor.ActionType.WINDOW_HTML)return new PageItem.Action.HTMLWindowAction;if(this.action.actionType==PageEditor.ActionType.PLAY_VIDEO)return new PageItem.Action.PlayVideoAction;if(this.action.actionType==PageEditor.ActionType.SHOW_INFORMATION)return new PageItem.Action.ShowInformationAction;
if(this.action.actionType==PageEditor.ActionType.QUIZ)return new PageItem.Action.OpenQuizAction;if(this.action.actionType==PageEditor.ActionType.SWF_SLIDE)return new PageItem.Action.OpenSwfSlideAction;if(this.action.actionType==PageEditor.ActionType.SHOW_ARTICLE)return new PageItem.Action.ShowArticleAction}});
Class("GotoPageAction",{Package:"PageItem.Action",execute:function(a,b,c){this.initPageIndex(c.action);gotoPageFun(this.linkPageIndex,!1,"action");b.addClass("slider-action")},initPageIndex:function(a){this.linkPageIndex=a.pageIndex;this.linkPageIndex||(this.linkPageIndex=1)}});
Class("OpenUrlAction",{Package:"PageItem.Action",execute:function(a,b,c){this.initLink(c.action);if("tel:"==this.linkUrl.substr(0,4))window.open(this.linkUrl),BookEvent.trigger("jumpLink",["telePhoneNumber",BookInfo.getCurrentPages().join("-"),this.linkUrl]);else{if(this.isTargetMatch("self"))return window.location=this.linkUrl,BookEvent.trigger("jumpLink",["openUrl",BookInfo.getCurrentPages().join("-"),this.linkUrl]),!1;if(this.isTargetMatch("blank"))return-1<navigator.userAgent.toLowerCase().indexOf("dingtalk")?
window.location.href=this.linkUrl:window.open(this.linkUrl),BookEvent.trigger("jumpLink",["openUrl",BookInfo.getCurrentPages().join("-"),this.linkUrl]),!1;if(this.isTargetMatch("parent"))return parent.location=this.linkUrl,BookEvent.trigger("jumpLink",["openUrl",BookInfo.getCurrentPages().join("-"),this.linkUrl]),!1;if(this.isTargetMatch("top")){for(b=window;b.parent!=b;)b=b.parent;b.location=this.linkUrl;BookEvent.trigger("jumpLink",["openUrl",BookInfo.getCurrentPages().join("-"),this.linkUrl]);
return!1}(a=window.frames[this.linkTarget])?a.location=this.linkUrl:window.location=this.linkUrl;BookEvent.trigger("jumpLink",["openUrl",BookInfo.getCurrentPages().join("-"),this.linkUrl])}b.addClass("slider-action")},initLink:function(a){this.initLinkUrl(a);this.initLinkTarget(a)},initLinkUrl:function(a){this.linkUrl=a.url;this.linkUrl||(this.linkUrl="");this.linkUrl=this.linkUrl.trim();a=this.linkUrl.toLowerCase();a.isUrl()&&a.startsWith("www")&&(this.linkUrl="http://"+this.linkUrl);a.isEmail()&&
!a.startsWith("mailto:")&&(this.linkUrl="mailto:"+this.linkUrl);this.fixLikeFileLinkUrl()},fixLikeFileLinkUrl:function(){var a=this.linkUrl.toLowerCase();-1<a.startsWith("http")||-1<a.startsWith("ftp")||-1<a.startsWith("www.")||-1<a.startsWith("tel:")||-1<a.startsWith("mailto:")||a.contains("@")||1<a.extract(".").length||(this.linkUrl="www."+this.linkUrl)},initLinkTarget:function(a){this.linkTarget=(this.linkTarget=a.linkTarget)?this.linkTarget:bookConfig.OpenWindow?bookConfig.OpenWindow:"_blank"},
isTargetMatch:function(a){return a?0<=this.linkTarget.trim().toLowerCase().indexOf(a):!1}});Class("PlayAudioAction",{Package:"PageItem.Action",execute:function(a,b,c){this.prepare(a,b,c);0==a.audio.isPlaying()?a.audio.play():a.audio.pause();b.addClass("slider-action")},prepare:function(a,b,c){a.audio||(b=c.action,c=tmpContainer,bookContainer.width(),bookContainer.height(),a.audio=new AudioEditor(c,b.audioURL,b.autoPlay,b.autoPlayAgain,b.H5PlaybackNumber,b.H5Replay))}});
Class("PlayVideoAction",{Package:"PageItem.Action",execute:function(a,b,c){c=c.action;c.windowType==PageEditor.WindowType.OPEN_YOUTUBE&&(isPhone()||isPad()?a.popup=new PopUpPhoneVideo(c,"youtube"):a.popup=new PopUpVideo(c,"youtube"));c.windowType==PageEditor.WindowType.OPEN_VIMEO&&(isPhone()||isPad()?a.popup=new PopUpPhoneVideo(c,"vimeo"):a.popup=new PopUpVideo(c,"vimeo"));c.windowType==PageEditor.WindowType.OPEN_DAILYMOTION&&(isPhone()||isPad()?a.popup=new PopUpPhoneVideo(c,"dailymotion"):a.popup=
new PopUpVideo(c,"dailymotion"));c.windowType==PageEditor.WindowType.OPEN_TYPE_WISTIA&&(isPhone()||isPad()?a.popup=new PopUpPhoneVideo(c,"wistia"):a.popup=new PopUpVideo(c,"wistia"));c.windowType==PageEditor.WindowType.OPEN_TYPE_YOUKU&&(isPhone()||isPad()?a.popup=new PopUpPhoneVideo(c,"youku"):a.popup=new PopUpVideo(c,"youku"));c.windowType==PageEditor.WindowType.OPEN_TYPE_QQ&&(isPhone()||isPad()?a.popup=new PopUpPhoneVideo(c,"qq"):a.popup=new PopUpVideo(c,"qq"));b.addClass("slider-action")}});
Class("OpenSlideshowAction",{Package:"PageItem.Action",execute:function(a,b,c){var d=c.action;d.popUpImage=parseBool(c.popUpImage);d.url=c.src;c=tmpContainer;var e=bookContainer.width(),f=bookContainer.height();a.popup=new PageItem.Popup.SlideShow(c,d,e,f);b.addClass("slider-action")}});Class("ExecuteJavascriptAction",{Package:"PageItem.Action",execute:function(a,b,c){a=c.action;a.scriptFun&&eval(a.scriptFun);b.addClass("slider-action")}});
Class("OpenWindowAction",{Package:"PageItem.Action",execute:function(a,b,c){c=c.action;var d={width:c.windowWidth,height:c.windowHeight,src:c.resourceContent,caption:c.caption,languageLayout:c.languageLayout};c.H5PlaybackNumber&&(d.H5PlaybackNumber=parseInt(c.H5PlaybackNumber));c.H5Replay&&(d.H5Replay=parseBool(c.H5Replay));c.hideTitle&&(d.hideTitle=parseBool(c.hideTitle));c.drag&&(d.drag=parseBool(c.drag));var e=tmpContainer,f=windowWidth,g=windowHeight;c.windowType==PageEditor.WindowType.OPEN_VIDEO&&
(_agent_.browser.device==_agent_.browser.DEVICE_PHONE||isPhone()||isPad()?a.video=new MobileVideo(e,d,f,g,"video"):a.video=new PageItem.VideoForm(e,d,f,g,"video"));c.windowType==PageEditor.WindowType.OPEN_FLASH&&(a.video=new PageItem.VideoForm(e,d,f,g,"flash"));c.windowType==PageEditor.WindowType.OPEN_SHOW_TEXT&&(_agent_.browser.device==_agent_.browser.DEVICE_PHONE||isPhone()||isPad()?a.video=new TextLightBox(e,d,f,g,"text"):a.video=new PageItem.VideoForm(e,d,f,g,"text"));b.addClass("slider-action")}});
Class("HTMLWindowAction",{Package:"PageItem.Action",execute:function(a,b,c){a.popup=new PageItem.Popup.WindowHtml(tmpContainer,c.action);b.addClass("slider-action")}});
Class("ShowInformationAction",{Package:"PageItem.Action",execute:function(a,b,c){_agent_.browser.device==_agent_.browser.DEVICE_PHONE||isPhone()||isPad()?a.popup&&a.popup.visible||(a.popup=new PageItem.Popup.ShowInformationMobile(tmpContainer,c)):a.popup=new PageItem.Popup.ShowInformation(tmpContainer,c);a.popup.visible||a.popup.show();b.addClass("slider-action")}});
Class("OpenQuizAction",{Package:"PageItem.Action",execute:function(a,b,c){_agent_.browser.device==_agent_.browser.DEVICE_PHONE||isPhone()||isPad()?a.popup=new PageItem.Popup.QuizPanelMobile(tmpContainer,c):a.popup=new PageItem.Popup.QuizPanelPC(tmpContainer,c);a.popup.show();b.addClass("slider-action")}});
Class("OpenSwfSlideAction",{Package:"PageItem.Action",execute:function(a,b,c){if(!BookInfo.getBook().flipping){"IMG"==b[0].tagName.toUpperCase()&&(b=b.parent());var d=b.parent();c.elemConfig={element:b,elementParent:d,offsetX:d.offset().left,offsetY:d.offset().top,parentWidth:d.width(),parentHeight:d.height(),sideWidth:BookInfo.getBook().pageWidth,sideHeight:BookInfo.getBook().pageHeight};d=tmpContainer;"Text"==c.action.targetType&&!c.action.targetText||"SWF"==c.action.targetType&&!c.action.swfURL||
(a.popup||(a.popup=new PageItem.Popup.SwfSlide(d,c,windowWidth,windowHeight)),a.popup.show(),b.addClass("slider-action"))}}});Class("ShowArticleAction",{Package:"PageItem.Action",execute:function(a,b,c){a=c.action;window.showArticleById&&window.showArticleById(a.articleConfig.articleId)}});
Class("EffectManager",{Package:"PageItem",create:function(a,b,c,d){b&&d&&d.effect&&(c||(c=""),this.elementConfig=c,this.item=a,this.element=b,this.config=d,this.effect=d.effect)},addEffect:function(){if(this.element&&this.config&&this.effect&&this.effect.effectType){var a=this.getActionExecutor();a&&(this.item.imgEffect=a)}},getActionExecutor:function(){if(this.effect.effectType==PageEditor.Effect.FADEIN)return new PageItem.Effect.FadeIn(this.item,this.element,this.elementConfig,this.config);if(this.effect.effectType==
PageEditor.Effect.CUTTING)return new PageItem.Effect.Cutting(this.item,this.element,this.elementConfig,this.config);if(this.effect.effectType==PageEditor.Effect.FLY_IN)return new PageItem.Effect.FlyIn(this.item,this.element,this.elementConfig,this.config);if(this.effect.effectType==PageEditor.Effect.INDENTATION)return new PageItem.Effect.Indentation(this.item,this.element,this.elementConfig,this.config)}});
Class("FadeIn",{Package:"PageItem.Effect",create:function(a,b,c,d){b&&d&&(this.item=a,this.element=b,this.config=d,this.effect=d.effect)},hide:function(){this.element.css({display:"none"})},show:function(){this.element.fadeIn(1E3*this.effect.duration)}});
Class("FlyIn",{Package:"PageItem.Effect",create:function(a,b,c,d){b&&d&&c&&(this.item=a,this.elementConfig=c,this.element=b,this.elemWidth=this.elementConfig.elemWidth,this.elemHeight=this.elementConfig.elemHeight,this.parentWidth=this.elementConfig.parentWidth,this.parentHeight=this.elementConfig.parentHeight,this.config=d,this.effect=d.effect,this.hide())},setPosition:function(){switch(this.effect.position){case "left":this.element.css({left:-this.elementConfig.x-this.elementConfig.elemWidth+"px"});
break;case "top":this.element.css({top:-this.elementConfig.y-this.elementConfig.elemHeight+"px"});break;case "bottom":this.element.css({top:this.elementConfig.pageHeight-this.elementConfig.y+"px"});break;case "right":this.element.css({left:this.elementConfig.pageWidth-this.elementConfig.x+"px"})}},hide:function(){this.setPosition()},show:function(){setTimeout(function(){"left"==this.effect.position||"right"==this.effect.position?this.element.animate({left:(this.elementConfig.parentWidth-this.elementConfig.elemWidth)/
2+"px"},1E3*this.effect.duration,"easeOutBack"):this.element.animate({top:(this.elementConfig.parentHeight-this.elementConfig.elemHeight)/2+"px"},1E3*this.effect.duration,"easeOutBack")}.bind(this),1E3*bookConfig.flippingTime)}});
Class("Indentation",{Package:"PageItem.Effect",create:function(a,b,c,d){b&&d&&c&&(this.item=a,this.elementConfig=c,this.element=b,this.config=d,this.effect=d.effect,this.hide())},setPosition:function(){this.element.css({margin:""});this.element.parent().css({overflow:"hidden"});this.elementConfig.parentWidth/this.elementConfig.parentHeight>this.elementConfig.elemWidth/this.elementConfig.elemHeight?(this.startLeft=(this.elementConfig.parentWidth-this.elementConfig.elemWidth)/2,this.startTop=0):(this.startLeft=
0,this.startTop=(this.elementConfig.parentHeight-this.elementConfig.elemHeight)/2);switch(this.effect.position){case "left":var a=this.elementConfig.parentWidth-this.elementConfig.elemWidth;this.element.css({left:-(this.elementConfig.elemWidth+a)+"px",top:this.startTop+"px"});break;case "top":a=this.elementConfig.parentHeight-this.elementConfig.elemHeight;this.element.css({top:-(this.elementConfig.elemHeight+a)+"px",left:this.startLeft+"px"});break;case "bottom":a=this.elementConfig.parentHeight-
this.elementConfig.elemHeight;this.element.css({top:this.elementConfig.elemHeight+a+"px",left:this.startLeft+"px"});break;case "right":a=this.elementConfig.parentWidth-this.elementConfig.elemWidth,this.element.css({left:this.elementConfig.elemWidth+a+"px",top:this.startTop+"px"})}},hide:function(){this.setPosition()},show:function(){setTimeout(function(){"left"==this.effect.position||"right"==this.effect.position?this.element.animate({left:this.startLeft},1E3*this.effect.duration,"easeOutBack"):this.element.animate({top:this.startTop},
1E3*this.effect.duration,"easeOutBack")}.bind(this),1E3*bookConfig.flippingTime)}});
Class("Cutting",{Package:"PageItem.Effect",create:function(a,b,c,d){b&&c&&d&&(this.elementConfig=c,this.element=b,this.elemParent=this.element.parent(),this.config=d,this.showTime=0,this.effect=d.effect,this.initCss())},initCss:function(){isPhone()||isPad()||(this.element.addClass("clip"),this.element.parent().addClass("active"),this.element.css({transform:""}))},resetClass:function(){isPhone()||isPad()||(this.element.removeClass("clip"),this.element.parent().removeClass("active"))},cutting:function(a){if(!a)return!1;
this.initCss();a.removeAttribute("id");var b=this.elementConfig.elemHeight,c=this.elementConfig.elemWidth,d=this.elementConfig.elemWidth/10,e=a.outerHTML;if(window.getComputedStyle(document.body).webkitClipPath){for(var f="",g=0;g<c;g+=d)for(var h=0;h<b;h+=d)[[[g,h],[g,h+d],[g+d,h+d],[g+d,h]]].forEach(function(k,l){k=k.map(function(m){return m.map(function(n){return n+"px"}).join(" ")}).join();k="-webkit-clip-path: polygon("+k+");clip-path: polygon("+k+");";l=.5>Math.random()?-1:1;l="translate("+
[c*(.5-Math.random()),b*(.5-Math.random())].map(function(m){return m+"px"}).join()+") rotate("+Math.round(360*l*Math.random())+"deg)";f+=e.replace('style="',' style="-webkit-transform:'+(l+";-o-transform:"+l+";-moz-transform:"+l+";-ms-transform:"+l+";transform:"+l+";")+k);this.element.css({visibility:"hidden"})}.bind(this));$(a).parent().append(f);setTimeout(function(){this.elemParent.find("img").css({background:"transparent",visibility:"visible"});this.elemParent.find("img").not(":first").remove();
this.resetClass()}.bind(this),1100);return!0}a.className+=" no-clippath";return!1},hide:function(){isPhone()||isPad()?this.element.fadeOut(0):this.element.css({display:"none"})},show:function(){isPhone()||isPad()?this.element.fadeIn(1E3):(this.element.css({display:"block"}),this.cutting(this.element[0]))}});
Class("HighLightManager",{Package:"PageItem",create:function(a,b,c,d){b&&d&&c&&(this.elementConfig=c,this.item=a,this.element=b,this.highlightsLabel=d.highlightsLabel)},addHighLight:function(){if(this.element&&this.highlightsLabel){var a=this.getHighLightType();if(a)return a}},getHighLightType:function(){if(this.highlightsLabel==PageEditor.HighLight.GREENBOXSTOP)return new PageItem.HighLight.GreenBoxStop(this.element,this.elementConfig);if(this.highlightsLabel==PageEditor.HighLight.GREENBOX)return new PageItem.HighLight.GreenBox(this.element,
this.elementConfig);if(this.highlightsLabel==PageEditor.HighLight.ORIGINCIRCLE)return new PageItem.HighLight.OriginCircle(this.element,this.elementConfig);if(this.highlightsLabel==PageEditor.HighLight.REDBOX)return new PageItem.HighLight.RedBox(this.element,this.elementConfig);if(this.highlightsLabel==PageEditor.HighLight.REDCIRCLE)return new PageItem.HighLight.RedCircle(this.element,this.elementConfig);if(this.highlightsLabel==PageEditor.HighLight.BLUESQUARE)return new PageItem.HighLight.BlueSquare(this.element,
this.elementConfig);if(this.highlightsLabel==PageEditor.HighLight.GREENCIRCLEROTATE)return new PageItem.HighLight.GreenCircleRotate(this.element,this.elementConfig);if(this.highlightsLabel==PageEditor.HighLight.GREENLINELTOR)return new PageItem.HighLight.GreenLineLToR(this.element,this.elementConfig);if(this.highlightsLabel==PageEditor.HighLight.GREENLINERTOL)return new PageItem.HighLight.GreenLineRToL(this.element,this.elementConfig);if(this.highlightsLabel==PageEditor.HighLight.GREENSQUARE)return new PageItem.HighLight.GreenSquare(this.element,
this.elementConfig);if(this.highlightsLabel==PageEditor.HighLight.LINESQUARE)return new PageItem.HighLight.LineSquare(this.element,this.elementConfig);if(this.highlightsLabel==PageEditor.HighLight.ORANGEHIGHLIGHT)return new PageItem.HighLight.OrangeHighLight(this.element,this.elementConfig);if(this.highlightsLabel==PageEditor.HighLight.ORANGECIRCLELIGHT)return new PageItem.HighLight.OrangeCircleLight(this.element,this.elementConfig);if(this.highlightsLabel==PageEditor.HighLight.PUSHSQUARE)return new PageItem.HighLight.PushSquare(this.element,
this.elementConfig);if(this.highlightsLabel==PageEditor.HighLight.REDHIGHLIGHT)return new PageItem.HighLight.RedHighLight(this.element,this.elementConfig);if(this.highlightsLabel==PageEditor.HighLight.REDBOXBLINK)return new PageItem.HighLight.RedBoxBlink(this.element,this.elementConfig);if(this.highlightsLabel==PageEditor.HighLight.REDLINEBLINK)return new PageItem.HighLight.RedLineBlink(this.element,this.elementConfig);if(this.highlightsLabel==PageEditor.HighLight.REDLINELTOR)return new PageItem.HighLight.RedLineLToR(this.element,
this.elementConfig);if(this.highlightsLabel==PageEditor.HighLight.REDLINERTOL)return new PageItem.HighLight.RedLineRToL(this.element,this.elementConfig);if(this.highlightsLabel==PageEditor.HighLight.SPINSQUARE)return new PageItem.HighLight.SpinSquare(this.element,this.elementConfig)}});
Class("HighLightHtml",{Package:"PageItem.HighLight",create:function(a,b){a&&b&&(this.config=b,this.width=b.width,this.height=b.height,this.element=a,this.initConfig(),this.cvs=$("<canvas width="+this.width+" height="+this.height+"></canvas>"),this.ctx=this.cvs[0].getContext("2d"),this.initCss(),this.element.append(this.cvs),this.element.bind("mouseenter",this.animate.bind(this)),this.element.bind("mouseleave",function(){this.stopAnimate();this.clearCvs()}.bind(this)))},initConfig:function(){},animate:function(){},
stopAnimate:function(){},ellipse:function(a,b,c,d,e,f,g,h){a.save();var k=d>e?d:e;d/=k;e/=k;a.lineJoin="round";a.scale(d,e);a.beginPath();a.arc(b/d,c/e,k,f,g,h);a.stroke();a.closePath();a.restore()},clearCvs:function(){this.ctx.clearRect(0,0,this.width,this.height)},onResize:function(a,b){this.width=a;this.height=b;this.cvs[0].width=a;this.cvs[0].height=b;this.initConfig()},initCss:function(){this.cvs.css({position:"absolute","pointer-events":"none",left:0,top:0,"z-index":0})},hide:function(){},show:function(){}});
Class("GreenBoxStop",{Package:"PageItem.HighLight",create:function(a,b){this._super(a,b)},initConfig:function(){this.gradientWidth=this.width;this.overSize=this.height-this.width;this.height<this.width&&(this.gradientWidth=this.height,this.overSize=this.width-this.height);this.x=.05*this.width;this.y=.05*this.height;this.drawW=.9*this.width;this.drawH=.9*this.height},animate:function(){this.line1=this.line1Animate.animation(this,500)},stopAnimate:function(){this.line1&&this.line1.stop();this.line2&&
this.line2.stop();this.flash&&this.flash.stop();this.boxFlash&&this.boxFlash.stop()},drawRect:function(){this.ctx.beginPath();this.ctx.strokeStyle="#009900";this.ctx.lineJoin="round";this.ctx.lineWidth=1;this.ctx.strokeRect(this.x,this.y,this.drawW,this.drawH);this.ctx.closePath()},line1Animate:function(a,b){this.ctx.clearRect(0,0,this.width,this.height);this.ctx.strokeStyle="#009900";this.ctx.lineJoin="round";this.ctx.lineWidth=1;var c=this.x+this.drawW,d=this.y;this.ctx.beginPath();this.ctx.moveTo(c,
d);this.ctx.lineTo(c-this.drawW/b*a,d);this.ctx.moveTo(c,d);this.ctx.lineTo(c,d+this.drawH/b*a);this.ctx.stroke();this.ctx.closePath();a==b&&(this.line2=this.line2Animate.animation(this,500))},line2Animate:function(a,b){this.ctx.clearRect(0,0,this.width,this.height);this.ctx.strokeStyle="#009900";this.ctx.lineWidth=1;this.origin1={x:.05*this.width,y:.05*this.height};this.origin2={x:.95*this.width,y:.95*this.height};this.ctx.beginPath();this.ctx.moveTo(.95*this.width,.05*this.height);this.ctx.lineTo(.05*
this.width,.05*this.height);this.ctx.moveTo(.95*this.width,.05*this.height);this.ctx.lineTo(.95*this.width,.95*this.height);this.ctx.stroke();this.ctx.closePath();this.ctx.beginPath();this.ctx.moveTo(this.origin1.x,this.origin1.y);this.ctx.lineTo(this.origin1.x,this.origin1.y+this.drawH/b*a);this.ctx.moveTo(this.origin2.x,this.origin2.y);this.ctx.lineTo(this.origin2.x-this.drawW/b*a,this.origin2.y);this.ctx.stroke();this.ctx.closePath();a==b&&(this.flash=this.flashAnimate.animation(this,300))},flashAnimate:function(a,
b){var c=a/b,d=.2+.6*c,e=d-.2,f=d+.2;this.ctx.beginPath();this.ctx.clearRect(0,0,this.width,this.height);var g=this.ctx.createLinearGradient(0,.95*this.height-this.overSize*c,this.gradientWidth,.95*this.height-this.gradientWidth-this.overSize*c);this.width>this.height&&(g=this.ctx.createLinearGradient(this.overSize*c,this.gradientWidth,this.gradientWidth+this.overSize*c,0));g.addColorStop(0,"transparent");g.addColorStop(e,"transparent");g.addColorStop(d,Color("#009900").rgba(.5-.4*c));g.addColorStop(f,
"transparent");g.addColorStop(1,"transparent");this.ctx.fillStyle=g;this.ctx.fillRect(.05*this.width,.05*this.height,this.drawW,this.drawH);this.ctx.closePath();this.drawRect();a==b&&(this.ctx.clearRect(0,0,this.width,this.height),this.drawRect(),this.boxFlashAnimate&&(this.boxFlash=this.boxFlashAnimate.animation(this,800)))}}).extend("HighLightHtml");
Class("GreenBox",{Package:"PageItem.HighLight",create:function(a,b){this._super(a,b);this.color=Color("#009900")},boxFlashAnimate:function(a,b){this.clearCvs();this.ctx.beginPath();this.ctx.strokeStyle=this.color.rgba(a<=b/2?1-a/b*2:a/b*2-1);this.ctx.lineJoin="round";this.ctx.lineWidth=1;this.ctx.strokeRect(this.x,this.y,this.drawW,this.drawH);this.ctx.closePath();a==b&&(this.boxFlash&&this.boxFlash.stop(),this.boxFlash=this.boxFlashAnimate.animation(this,800))}}).extend("GreenBoxStop");
Class("OriginCircle",{Package:"PageItem.HighLight",create:function(a,b){this._super(a,b)},initConfig:function(){this.color=Color("#F7771E");this.x=this.width/2;this.y=this.height/2;this.drawW=.72*this.width/2;this.drawH=.72*this.height/2;this.gradientWidth=2*this.drawW;this.overSize=2*(this.drawH-this.drawW);this.drawW>this.drawH&&(this.gradientWidth=2*this.drawH,this.overSize=2*(this.drawW-this.drawH))},animate:function(){this.drawRound=this.ellipse1Anime.animation(this,500)},stopAnimate:function(){this.drawRound&&
this.drawRound.stop();this.flash&&this.flash.stop();this.ellipseFlash&&this.ellipseFlash.stop()},ellipse1Anime:function(a,b){var c=a/b;this.clearCvs();this.ctx.beginPath();this.ctx.strokeStyle=this.color.toString();this.ctx.lineJoin="round";this.ctx.lineWidth=1;this.ellipse(this.ctx,this.x,this.y,this.drawW,this.drawH,.25*-Math.PI,.75*Math.PI*c);this.ctx.closePath();this.ctx.beginPath();this.ellipse(this.ctx,this.x,this.y,this.drawW,this.drawH,-.25*Math.PI,-.25*Math.PI-1*Math.PI*c,!0);this.ctx.closePath();
a==b&&(this.flash=this.flashAnimate.animation(this,300))},flashAnimate:function(a,b){var c=a/b,d=.2+.4*c,e=d-.2,f=d+.2,g=.14*this.width,h=.14*this.height;this.clearCvs();var k=this.ctx.createLinearGradient(g,.86*this.height-this.overSize*c,this.gradientWidth+g,.86*this.height-this.gradientWidth-this.overSize*c*.9);this.width>this.height&&(k=this.ctx.createLinearGradient(g+this.overSize*c,this.gradientWidth+h,g+this.gradientWidth+this.overSize*c,h));k.addColorStop(0,"transparent");k.addColorStop(e,
"transparent");k.addColorStop(d,this.color.rgba(.5-.4*c));k.addColorStop(f,"transparent");k.addColorStop(1,"transparent");this.ctx.beginPath();this.ctx.fillStyle=k;this.ctx.strokeStyle=this.color.toString();this.ellipse(this.ctx,this.x,this.y,this.drawW,this.drawH,0,2*Math.PI,!0);this.ctx.fill();this.ctx.closePath();a==b&&(this.ellipseFlash=this.flashRound.animation(this,800))},flashRound:function(a,b){var c=a<=b/2?1-a/b*2:a/b*2-1;this.clearCvs();this.ctx.beginPath();this.ctx.strokeStyle=this.color.rgba(c);
this.ellipse(this.ctx,this.x,this.y,this.drawW,this.drawH,0,2*Math.PI,!0);this.ctx.closePath();a==b&&(this.ellipseFlash&&this.ellipseFlash.stop(),this.ellipseFlash=this.flashRound.animation(this,800))}}).extend("HighLightHtml");
Class("RedBox",{Package:"PageItem.HighLight",create:function(a,b){this._super(a,b)},initConfig:function(){this.direct=1;this.gradientWidth=this.width;this.height<this.width&&(this.gradientWidth=this.height);this.x=.05*this.width;this.y=.05*this.height;this.arrowRate=Math.sin(Math.PI/4);this.arrowW=.05*this.gradientWidth;this.drawW=.9*this.width;this.drawH=.9*this.height;this.rectArr=[{x:this.x,y:this.y},{x:this.x,y:this.y+this.drawH},{x:this.x+this.drawW,y:this.y+this.drawH},{x:this.x+this.drawW,
y:this.y}]},animate:function(){this.line=this.lineAnimate.animation(this,500)},stopAnimate:function(){this.line&&this.line.stop();this.rect&&this.rect.stop()},drawRect:function(a,b){this.ctx.beginPath();this.ctx.strokeStyle="#FF0000";this.ctx.lineJoin="round";this.ctx.lineWidth=1;this.ctx.moveTo(a.x,a.y);this.ctx.lineTo(b.x,b.y);this.ctx.stroke();this.ctx.closePath()},rectFlash:function(a,b){this.clearCvs();var c=a/b,d=this.x-.25*this.drawW*c,e=this.y-.25*this.drawH*c;this.ctx.strokeStyle="#FF0000";
this.ctx.strokeRect(this.x,this.y,this.drawW,this.drawH);this.ctx.strokeRect(d,e,this.drawW+.5*this.drawW*c,this.drawH+.5*this.drawH*c);a==b&&(this.rect.stop(),this.clearCvs(),this.ctx.strokeRect(this.x,this.y,this.drawW,this.drawH))},lineAnimate:function(a,b){this.clearCvs();this.ctx.strokeStyle="#FF0000";this.ctx.lineJoin="round";this.ctx.lineWidth=1;var c=this.getPos(a/b);this.ctx.beginPath();this.ctx.moveTo(c.start.x,c.start.y);this.ctx.lineTo(c.end.x,c.end.y);this.ctx.stroke();this.drawArrow(c.end,
c.pos1,c.pos2);this.ctx.closePath();if(1<this.direct)for(c=1;c<this.direct;c++)this.drawRect(this.rectArr[c-1],this.rectArr[c]);a==b&&(this.line.stop(),this.direct+=1,5<=this.direct?(this.direct=1,this.rect=this.rectFlash.animation(this,1E3)):this.line=this.lineAnimate.animation(this,500))},getPos:function(a){var b={};switch(this.direct){case 1:b.start={x:this.x,y:this.y};b.end={x:this.x,y:b.start.y+this.drawH*a};b.pos1={x:b.end.x-this.arrowW*this.arrowRate,y:b.end.y-this.arrowW*this.arrowRate};b.pos2=
{x:b.end.x+this.arrowW*this.arrowRate,y:b.end.y-this.arrowW*this.arrowRate};break;case 2:b.start={x:this.x,y:this.y+this.drawH};b.end={x:this.x+this.drawW*a,y:b.start.y};b.pos1={x:b.end.x-this.arrowW*this.arrowRate,y:b.end.y+this.arrowW*this.arrowRate};b.pos2={x:b.end.x-this.arrowW*this.arrowRate,y:b.end.y-this.arrowW*this.arrowRate};break;case 3:b.start={x:this.x+this.drawW,y:this.y+this.drawH};b.end={x:this.x+this.drawW,y:b.start.y-this.drawH*a};b.pos1={x:b.end.x-this.arrowW*this.arrowRate,y:b.end.y+
this.arrowW*this.arrowRate};b.pos2={x:b.end.x+this.arrowW*this.arrowRate,y:b.end.y+this.arrowW*this.arrowRate};break;case 4:b.start={x:this.x+this.drawW,y:this.y},b.end={x:b.start.x-this.drawW*a,y:this.y},b.pos1={x:b.end.x+this.arrowW*this.arrowRate,y:b.end.y+this.arrowW*this.arrowRate},b.pos2={x:b.end.x+this.arrowW*this.arrowRate,y:b.end.y-this.arrowW*this.arrowRate}}return b},drawArrow:function(a,b,c){this.ctx.beginPath();this.ctx.fillStyle="#FF0000";this.ctx.moveTo(a.x,a.y);this.ctx.lineTo(b.x,
b.y);this.ctx.lineTo(c.x,c.y);this.ctx.fill();this.ctx.closePath()}}).extend("HighLightHtml");
Class("RedCircle",{Package:"PageItem.HighLight",create:function(a,b){this._super(a,b)},initConfig:function(){this.color=Color("#ff0000");this.x=this.width/2;this.y=this.height/2;this.drawW=.72*this.width/2;this.drawH=.72*this.height/2},animate:function(){this.drawRound=this.ellipse1Anime.animation(this,800)},stopAnimate:function(){this.drawRound&&this.drawRound.stop();this.scaleRound&&this.scaleRound.stop()},ellipse1Anime:function(a,b){var c=a/b;this.clearCvs();this.ctx.strokeStyle=this.color.toString();
this.ctx.lineJoin="round";this.ctx.lineWidth=1;this.ellipse(this.ctx,this.x,this.y,this.drawW,this.drawH,-.5*Math.PI,-.5*Math.PI-2*Math.PI*c,!0);a==b&&(this.scaleRound=this.scaleRoundAnimate.animation(this,400))},scaleRoundAnimate:function(a,b){var c=a/b;this.clearCvs();this.ctx.strokeStyle=this.color.toString();this.ellipse(this.ctx,this.x,this.y,this.drawW,this.drawH,0,2*Math.PI,!0);this.ctx.strokeStyle=this.color.rgba(1-c/3*2);this.ellipse(this.ctx,this.x,this.y,this.drawW+.4*this.drawW*c,this.drawH+
.4*this.drawH*c,0,2*Math.PI,!0);a==b&&(this.drawRound&&this.drawRound.stop(),this.clearCvs(),this.ctx.strokeStyle=this.color.toString(),this.ellipse(this.ctx,this.x,this.y,this.drawW,this.drawH,0,2*Math.PI,!0))}}).extend("HighLightHtml");
Class("BlueSquare",{Package:"PageItem.HighLight",create:function(a,b){this._super(a,b)},initConfig:function(){this.direct=1;this.gradientWidth=this.width;this.height<this.width&&(this.gradientWidth=this.height);this.lineWidth=Math.ceil(.015*this.gradientWidth);1>this.lineWidth&&(this.lineWidth=1);this.x=.14*this.width;this.y=.14*this.height;this.drawW=.72*this.width;this.drawH=.72*this.height;this.overW=this.width-this.drawW;this.overH=this.height-this.drawH},animate:function(){this.rect=this.rectFlash.animation(this,
600)},stopAnimate:function(){this.rect&&this.rect.stop();this.timer&&clearTimeout(this.timer)},drawRect:function(a,b){this.ctx.beginPath();this.ctx.strokeStyle="#52A0E9";this.ctx.lineJoin="round";this.ctx.lineWidth=this.lineWidth;this.ctx.moveTo(a.x,a.y);this.ctx.lineTo(b.x,b.y);this.ctx.stroke();this.ctx.closePath()},rectFlash:function(a,b){this.clearCvs();var c=a/b,d=0>a/b*2-1?0:a/b*2-1,e=this.x*c,f=this.y*c,g=this.x*d,h=this.y*d;this.ctx.lineWidth=this.lineWidth;this.ctx.strokeStyle="#52A0E9";
this.ctx.strokeRect(e,f,this.width-this.overW*c,this.height-this.overH*c);this.ctx.strokeRect(g,h,this.width-this.overW*d,this.height-this.overH*d);a==b&&(this.rect.stop(),this.clearCvs(),this.ctx.strokeRect(this.x,this.y,this.drawW,this.drawH),this.timer=setTimeout(function(){this.rect=this.rectFlash.animation(this,600)}.bind(this),1E3))}}).extend("HighLightHtml");
Class("GreenCircleRotate",{Package:"PageItem.HighLight",create:function(a,b){this._super(a,b)},initConfig:function(){this.color=Color("#009933");this.x=this.width/2;this.y=this.height/2;this.drawW=.72*this.width/2;this.drawH=.72*this.height/2;this.r=this.drawW>this.drawH?this.drawW:this.drawH;this.ratioX=this.drawW/this.r;this.ratioY=this.drawH/this.r;this.arrowRate=Math.sin(Math.PI/4);this.cos=.87;this.sin=.5;this.arrowW=.1*this.r},animate:function(){this.round=this.ellipseAnime.animation(this,2E3)},
stopAnimate:function(){this.round&&this.round.stop()},getPos:function(a){var b={};a=1*Math.PI+2*Math.PI*a;b.end={x:this.x+this.ratioX*this.r*Math.cos(a),y:this.y+this.ratioY*this.r*Math.sin(a)};return b},ellipseAnime:function(a,b){a/=b;b=this.getPos(a);this.clearCvs();this.ctx.strokeStyle=this.color.toString();this.ctx.lineJoin="round";this.ctx.lineWidth=1;this.ellipse(this.ctx,this.x,this.y,this.drawW,this.drawH,1.1*Math.PI+2*Math.PI*a,3*Math.PI+2*Math.PI*a);this.drawArrow1(b.end,1*Math.PI+2*Math.PI*
a)},drawArrow1:function(a,b){var c=b-Math.PI/3;b=this.x+this.ratioX*this.r*Math.cos(c);c=this.y+this.ratioY*this.r*Math.sin(c);this.ctx.beginPath();this.ctx.fillStyle="#009933";this.ctx.save();this.ctx.translate(a.x,a.y);this.ctx.rotate(Math.PI/3.2);this.ctx.scale(.15,.15);this.ctx.moveTo(this.x-a.x,this.y-a.y);this.ctx.lineTo(a.x-a.x,a.y-a.y);this.ctx.lineTo(b-a.x,c-a.y);this.ctx.closePath();this.ctx.fill();this.ctx.restore()}}).extend("HighLightHtml");
Class("GreenLineLToR",{Package:"PageItem.HighLight",create:function(a,b){this._super(a,b)},initConfig:function(){this.color=Color("#009933");this.x=0;this.y=this.height/2;this.endX=this.width;this.endY=this.height/2;this.lineWidth=1},animate:function(){this.line=this.drawLine.animation(this,2E3)},stopAnimate:function(){this.line&&this.line.stop()},drawLine:function(a,b){var c=a/b;this.ctx.beginPath();this.clearCvs();this.ctx.strokeStyle=this.color.toString();this.ctx.lineJoin="round";this.ctx.lineWidth=
this.lineWidth;this.ctx.moveTo(this.x,this.y);this.ctx.lineTo(this.x+this.endX*c,this.endY);this.ctx.stroke();this.ctx.closePath();a==b&&this.line.stop()}}).extend("HighLightHtml");Class("GreenLineRToL",{Package:"PageItem.HighLight",create:function(a,b){this._super(a,b)},initConfig:function(){this.color=Color("#009933");this.x=this.width;this.y=this.height/2;this.endX=-this.width;this.endY=this.height/2;this.lineWidth=1}}).extend("GreenLineLToR");
Class("GreenSquare",{Package:"PageItem.HighLight",create:function(a,b){this._super(a,b);this.color=Color("#26E20C")},initConfig:function(){this.freshTime=this.time=1;this.gradientWidth=this.width;this.height<this.width&&(this.gradientWidth=this.height);this.lineWidth=Math.ceil(.015*this.gradientWidth);1>this.lineWidth&&(this.lineWidth=1);this.x=.14*this.width;this.y=.14*this.height;this.showX=.14*this.width;this.showY=1.5*this.height;this.drawW=.72*this.width;this.drawH=.72*this.height},animate:function(){this.rect=
this.rectAnime.animation(this,300)},stopAnimate:function(){this.timer&&clearTimeout(this.timer);this.rect&&this.rect.stop();this.fresh&&this.fresh.stop();this.freshTime=this.time=1},drawRect:function(a,b){this.ctx.beginPath();this.ctx.lineJoin="round";this.ctx.lineWidth=this.lineWidth;this.ctx.moveTo(a.x,a.y);this.ctx.lineTo(b.x,b.y);this.ctx.stroke();this.ctx.closePath()},rectAnime:function(a,b){this.clearCvs();var c=a/b;this.ctx.lineWidth=this.lineWidth;this.ctx.strokeStyle=this.color.toString();
1<this.time&&this.ctx.strokeRect(this.x,this.y,this.drawW,this.drawH);this.ctx.strokeRect(this.showX,this.showY-1.36*this.height*c,this.drawW,this.drawH);a==b&&(this.rect.stop(),this.time+=1,a=100>=300/this.time?100:300/this.time,6<=this.time?this.timer=setTimeout(function(){this.fresh=this.rectFlash.animation(this,300)}.bind(this),500):this.rect=this.rectAnime.animation(this,a))},rectFlash:function(a,b){this.clearCvs();this.ctx.save();var c=a/b,d=this.x-.15*this.drawW*c,e=this.y-.15*this.drawH*c;
this.ctx.strokeStyle=this.color.toString();this.ctx.strokeRect(this.x,this.y,this.drawW,this.drawH);this.ctx.strokeStyle=this.color.rgba(1-c);this.ctx.strokeRect(d,e,this.drawW+.3*this.drawW*c,this.drawH+.3*this.drawH*c);this.ctx.restore();a==b&&(this.rect.stop(),2>this.freshTime?(this.timer=setTimeout(function(){this.fresh=this.rectFlash.animation(this,300)}.bind(this),300),this.freshTime+=1):(this.clearCvs(),this.ctx.strokeRect(.14*this.width,.14*this.height,this.drawW,this.drawH)))}}).extend("GreenBoxStop");
Class("LineSquare",{Package:"PageItem.HighLight",create:function(a,b){this._super(a,b)},initConfig:function(){this.animateCase=1;this.color=Color("#0099CC");this.gradientWidth=this.width;this.height<this.width&&(this.gradientWidth=this.height);this.lineWidth=Math.ceil(.015*this.gradientWidth);1>=this.lineWidth&&(this.lineWidth=1);this.x=.14*this.width;this.y=.14*this.height;this.drawW=.72*this.width;this.drawH=.72*this.height},animate:function(){this.line=this.lineAnimate.animation(this,500)},getLeavePos:function(){var a=
[];pos1={x:this.x,y:this.y,width:.86*this.width,height:0};pos2={x:.86*this.width,y:this.y,width:0,height:.86*this.height};pos3={x:.86*this.width,y:.86*this.height,width:.86*-this.width,height:0};pos4={x:this.x,y:.86*this.height,width:0,height:0,height:.86*-this.height};a.push(pos1);a.push(pos2);a.push(pos3);a.push(pos4);return a},getPos:function(a){var b=[];pos1={x:this.width-.86*this.width*a,y:this.y,width:.5*this.drawW,height:0};pos2={x:this.x+this.drawW,y:this.height-.86*this.height*a,width:0,
height:.5*this.drawH};pos3={x:.86*this.width*a,y:.86*this.height,width:.5*-this.drawW,height:0};pos4={x:this.x,y:.86*this.height*a,width:0,height:0,height:.5*-this.drawH};b.push(pos1);b.push(pos2);b.push(pos3);b.push(pos4);return b},stopAnimate:function(){this.line&&this.line.stop();this.timer&&(clearTimeout(this.timer),this.time=null);this.animateCase=1},drawRect:function(a){this.ctx.save();this.ctx.beginPath();this.ctx.strokeStyle=this.color.rgba(.2);this.ctx.lineJoin="round";this.ctx.lineWidth=
this.lineWidth;a&&this.ctx.setLineDash([this.drawW/14]);this.ctx.strokeRect(this.x,this.y,this.drawW,this.drawH);this.ctx.closePath();this.ctx.restore()},lineAnimate:function(a,b){var c=a/b;this.ctx.clearRect(0,0,this.width,this.height);this.drawRect(!0);this.ctx.beginPath();this.ctx.strokeStyle=this.color.rgba(c);this.ctx.lineWidth=this.lineWidth;if(1==this.animateCase)var d=this.getPos(c);else 2==this.animateCase?(d=this.getPos(1),this.ctx.strokeStyle=this.color.rgba(1)):(d=this.getLeavePos(),this.ctx.strokeStyle=
this.color.rgba(1-c));for(var e=0;e<d.length;e++)1==this.animateCase?(this.ctx.moveTo(d[e].x,d[e].y),this.ctx.lineTo(d[e].x+d[e].width,d[e].y+d[e].height)):2==this.animateCase?(this.ctx.moveTo(d[e].x,d[e].y),this.ctx.lineTo(d[e].x+d[e].width+d[e].width*c,d[e].y+d[e].height+d[e].height*c)):(this.ctx.moveTo(d[e].x+d[e].width*c,d[e].y+d[e].height*c),this.ctx.lineTo(d[e].x+d[e].width*c+.84*d[e].width,d[e].y+d[e].height*c+.84*d[e].height));this.ctx.stroke();this.ctx.closePath();a==b&&(this.animateCase+=
1,4<=this.animateCase?(this.animateCase=1,this.timer=setTimeout(function(){this.line=this.lineAnimate.animation(this,500)}.bind(this),1E3)):3==this.animateCase?this.timer=setTimeout(function(){this.line=this.lineAnimate.animation(this,500)}.bind(this),1E3):this.line=this.lineAnimate.animation(this,500))}}).extend("HighLightHtml");
Class("OrangeHighLight",{Package:"PageItem.HighLight",create:function(a,b){this._super(a,b)},initConfig:function(){this.color=Color("#FFCE6A");this.x=this.width/2;this.y=this.height/2;this.drawW=.92*this.width/2;this.drawH=.92*this.height/2;this.gradientWidth=2*this.drawW;this.drawW>this.drawH&&(this.gradientWidth=2*this.drawH);this.lineWidth=Math.ceil(.04*this.gradientWidth);1>=this.lineWidth&&(this.lineWidth=1)},animate:function(){this.ellipseFlash=this.flashRound.animation(this,1E3)},stopAnimate:function(){this.ellipseFlash&&
this.ellipseFlash.stop()},flashRound:function(a,b){var c=a<=b/2?1-a/b*2:a/b*2-1;this.clearCvs();this.ctx.beginPath();this.ctx.strokeStyle=this.color.rgba(c);this.ctx.lineWidth=this.lineWidth;this.ellipse(this.ctx,this.x,this.y,this.drawW,this.drawH,0,2*Math.PI,!0);this.ctx.closePath();a==b&&(this.ellipseFlash&&this.ellipseFlash.stop(),this.ellipseFlash=this.flashRound.animation(this,1E3))}}).extend("HighLightHtml");
Class("OrangeCircleLight",{Package:"PageItem.HighLight",create:function(a,b){this._super(a,b)},initConfig:function(){this.color=Color("#FF6600");this.x=this.width/2;this.y=this.height/2;this.drawW=.8*this.width/2;this.drawH=.8*this.height/2;this.gradientWidth=2*this.drawW;this.drawW>this.drawH&&(this.gradientWidth=2*this.drawH);this.lineWidth=Math.ceil(.03*this.gradientWidth);1>=this.lineWidth&&(this.lineWidth=1)},animate:function(){this.drawRound=this.ellipseAnime.animation(this,400)},stopAnimate:function(){this.timer&&
(clearTimeout(this.timer),this.time=null);this.drawRound&&this.drawRound.stop();this.scaleRound&&this.scaleRound.stop()},ellipseAnime:function(a,b){var c=a/b;this.clearCvs();this.ctx.lineJoin="round";this.ctx.lineWidth=this.lineWidth;if(.5>c){var d=1-2*c;c=1-c}else d=2*c-1;this.ctx.strokeStyle=this.color.rgba(d);this.ellipse(this.ctx,this.x,this.y,this.drawW*c,this.drawH*c,0,2*Math.PI,!0);a==b&&(this.scaleRound=this.scaleRoundAnimate.animation(this,400))},scaleRoundAnimate:function(a,b){var c=a/b;
this.clearCvs();this.ctx.strokeStyle=this.color.toString();this.ellipse(this.ctx,this.x,this.y,this.drawW,this.drawH,0,2*Math.PI,!0);this.ctx.save();this.ctx.strokeStyle=this.color.rgba(1-c/3*2);this.ctx.lineWidth=1>this.lineWidth/2?1:this.lineWidth/2;this.ellipse(this.ctx,this.x,this.y,this.drawW+.3*this.drawW*c,this.drawH+.3*this.drawH*c,0,2*Math.PI,!0);this.ellipse(this.ctx,this.x,this.y,this.drawW+.25*this.drawW*c,this.drawH+.25*this.drawH*c,0,2*Math.PI,!0);this.ctx.restore();a==b&&(this.clearCvs(),
this.ellipse(this.ctx,this.x,this.y,this.drawW,this.drawH,0,2*Math.PI,!0),this.timer=setTimeout(function(){this.drawRound=this.ellipseAnime.animation(this,400)}.bind(this),1E3))}}).extend("HighLightHtml");
Class("PushSquare",{Package:"PageItem.HighLight",create:function(a,b){this._super(a,b)},initConfig:function(){this.animateCase=1;this.color=Color("#FF6600");this.gradientWidth=this.width;this.height<this.width&&(this.gradientWidth=this.height);this.lineWidth=Math.ceil(.015*this.gradientWidth);1>=this.lineWidth&&(this.lineWidth=1);this.x=.14*this.width;this.y=.14*this.height;this.drawW=.72*this.width;this.drawH=.72*this.height},animate:function(){this.line=this.lineAnimate.animation(this,400)},stopAnimate:function(){this.line&&
this.line.stop();this.timer&&(clearTimeout(this.timer),this.time=null);this.animateCase=1},drawDashRect:function(a,b){this.ctx.save();this.ctx.beginPath();this.ctx.strokeStyle=this.color.rgba(a);this.ctx.lineJoin="round";this.ctx.lineWidth=this.lineWidth;b&&this.ctx.setLineDash([this.drawW/14]);this.ctx.strokeRect(this.x+this.drawW/2-this.drawW/2*a,this.y+this.drawH/2-this.drawH/2*a,this.drawW*a,this.drawH*a);this.ctx.closePath();this.ctx.restore()},drawHalfRect:function(a,b){0!=b%2?(b=this.x*a,this.ctx.moveTo(b+
this.drawW/4,this.y),this.ctx.lineTo(b,this.y),this.ctx.lineTo(b,this.y+this.drawH),this.ctx.lineTo(b+this.drawW/4,this.y+this.drawH),this.ctx.stroke(),b=this.width-this.x*a,this.ctx.moveTo(b-this.drawW/4,this.y),this.ctx.lineTo(b,this.y),this.ctx.lineTo(b,this.y+this.drawH),this.ctx.lineTo(b-this.drawW/4,this.y+this.drawH)):(b=this.y*a,this.ctx.moveTo(this.x,b+this.drawH/4),this.ctx.lineTo(this.x,b),this.ctx.lineTo(this.x+this.drawW,b),this.ctx.lineTo(this.x+this.drawW,b+this.drawH/4),this.ctx.stroke(),
b=this.height-this.y*a,this.ctx.moveTo(this.x,b-this.drawH/4),this.ctx.lineTo(this.x,b),this.ctx.lineTo(this.x+this.drawW,b),this.ctx.lineTo(this.x+this.drawW,b-this.drawH/4));this.ctx.stroke()},lineAnimate:function(a,b){var c=a/b;this.ctx.clearRect(0,0,this.width,this.height);this.ctx.beginPath();this.ctx.strokeStyle=this.color.rgba(c);this.ctx.lineWidth=this.lineWidth;4==this.animateCase&&this.drawDashRect(c,!0);this.drawHalfRect(c,this.animateCase);a==b&&(this.animateCase+=1,5<=this.animateCase?
(this.drawDashRect(1),this.animateCase=1,this.timer=setTimeout(function(){this.line=this.lineAnimate.animation(this,400)}.bind(this),1E3)):this.line=this.lineAnimate.animation(this,400))}}).extend("HighLightHtml");
Class("RedBoxBlink",{Package:"PageItem.HighLight",create:function(a,b){this._super(a,b)},initConfig:function(){this.gradientWidth=this.width;this.overSize=this.height-this.width;this.height<this.width&&(this.gradientWidth=this.height,this.overSize=this.width-this.height);this.x=.05*this.width;this.y=.05*this.height;this.drawW=.9*this.width;this.drawH=.9*this.height;this.color=Color("#FF0000")},animate:function(){this.drawBox(1);this.timer=setTimeout(function(){this.boxFlash=this.boxFlashAnimate.animation(this,
600)}.bind(this),800)},stopAnimate:function(){this.boxFlash&&this.boxFlash.stop();this.timer&&(clearTimeout(this.timer),this.time=null)},drawBox:function(a){this.ctx.beginPath();this.ctx.strokeStyle=this.color.rgba(a);this.ctx.lineJoin="round";this.ctx.lineWidth=1;this.ctx.strokeRect(this.x,this.y,this.drawW,this.drawH);this.ctx.closePath()},boxFlashAnimate:function(a,b){this.clearCvs();this.drawBox(a<=b/2?1-a/b*2:a/b*2-1);a==b&&(this.boxFlash&&this.boxFlash.stop(),this.timer=setTimeout(function(){this.boxFlash=
this.boxFlashAnimate.animation(this,600)}.bind(this),800))}}).extend("GreenBoxStop");Class("RedHighLight",{Package:"PageItem.HighLight",create:function(a,b){this._super(a,b)},initConfig:function(){this._super();this.color=Color("#FF0000")}}).extend("OrangeHighLight");
Class("RedLineBlink",{Package:"PageItem.HighLight",create:function(a,b){this._super(a,b)},initConfig:function(){this.color=Color("#ff0000");this.x=0;this.y=this.height/2;this.endX=this.width;this.endY=this.height/2;this.lineWidth=1},animate:function(){this.drawLine(1);this.timer=setTimeout(function(){this.line=this.drawLineAnimate.animation(this,600)}.bind(this),800)},stopAnimate:function(){this.line&&this.line.stop();this.timer&&(clearTimeout(this.timer),this.timer=null)},drawLine:function(a){this.clearCvs();
this.ctx.beginPath();this.ctx.strokeStyle=this.color.rgba(a);this.ctx.lineJoin="round";this.ctx.lineWidth=1;this.ctx.moveTo(this.x,this.y);this.ctx.lineTo(this.endX,this.endY);this.ctx.stroke();this.ctx.closePath()},drawLineAnimate:function(a,b){this.drawLine(a/b);a==b&&(this.timer=setTimeout(function(){this.line=this.drawLineAnimate.animation(this,600)}.bind(this),800))}}).extend("HighLightHtml");
Class("RedLineLToR",{Package:"PageItem.HighLight",create:function(a,b){this._super(a,b)},initConfig:function(){this.color=Color("#FF0000");this.x=0;this.y=this.height/2;this.endX=this.width;this.endY=this.height/2;this.lineWidth=1}}).extend("GreenLineLToR");Class("RedLineRToL",{Package:"PageItem.HighLight",create:function(a,b){this._super(a,b)},initConfig:function(){this.color=Color("#FF0000");this.x=this.width;this.y=this.height/2;this.endX=-this.width;this.endY=this.height/2;this.lineWidth=1}}).extend("GreenLineLToR");
Class("SpinSquare",{Package:"PageItem.HighLight",create:function(a,b){this._super(a,b);this.color=Color("#52A0E9")},initConfig:function(){this.freshTime=this.time=1;this.gradientWidth=this.width;this.height<this.width&&(this.gradientWidth=this.height);this.lineWidth=Math.ceil(.015*this.gradientWidth);1>this.lineWidth&&(this.lineWidth=1);this.x=.14*this.width;this.y=.14*this.height;this.drawW=.72*this.width;this.drawH=.72*this.height},animate:function(){this.rect=this.rectAnime.animation(this,400)},
stopAnimate:function(){this.timer&&clearTimeout(this.timer);this.rect&&this.rect.stop();this.fresh&&this.fresh.stop();this.freshTime=this.time=1},drawRect:function(a,b){this.ctx.beginPath();this.ctx.lineJoin="round";this.ctx.lineWidth=this.lineWidth;this.ctx.moveTo(a.x,a.y);this.ctx.lineTo(b.x,b.y);this.ctx.stroke();this.ctx.closePath()},rectAnime:function(a,b){this.clearCvs();var c=1-a/b;this.ctx.lineWidth=this.lineWidth;this.ctx.strokeStyle=this.color.toString();1<this.time&&this.ctx.strokeRect(this.x,
this.y,this.drawW,this.drawH);0<this.time?(this.ctx.save(),this.ctx.translate(this.width/2,this.height/2),this.ctx.rotate(Math.PI/2*c)):(c=a/b,this.ctx.save(),this.ctx.strokeStyle=this.color.rgba(1-c),this.ctx.translate(this.width/2,this.height/2),this.ctx.rotate(Math.PI/2*c),this.ctx.strokeRect(this.x-this.width/2,this.y-this.height/2,this.drawW,this.drawH),this.ctx.restore(),this.ctx.save(),this.ctx.strokeStyle=this.color.rgba(1-c),this.ctx.translate(this.width/2,this.height/2),this.ctx.rotate(-Math.PI/
2*c));this.ctx.strokeRect(this.x-this.width/2,this.y-this.height/2,this.drawW,this.drawH);this.ctx.restore();a==b&&(0==this.time?(this.time+=1,this.timer=setTimeout(function(){this.rect=this.rectAnime.animation(this,500)}.bind(this),800)):(this.time+=1,a=250>=400/this.time?250:400/this.time,4<=this.time?(this.time=0,this.timer=setTimeout(function(){this.rect=this.rectAnime.animation(this,400)}.bind(this),800)):this.rect=this.rectAnime.animation(this,a)))}}).extend("GreenBoxStop");
Class("Youtube",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b,c,d);null!=this.config.id&&(this.firstTime=!0,this.animateConfig(),this.width=Number(this.config.width)*this.pageWidth,this.height=Number(this.config.height)*this.pageHeight,this.x=this.config.x*this.pageWidth,this.y=this.config.y*this.pageHeight,this.sVideoId=this.config.id,-1<this.sVideoId.indexOf("/")&&(a=-1<this.sVideoId.indexOf("?v=")?this.sVideoId.lastIndexOf("?v=")+3:this.sVideoId.lastIndexOf("/")+1,this.sVideoId=
this.sVideoId.substring(a,this.sVideoId.length)),this.prefix="https"==(window.location.href?window.location.href.toLowerCase():"http:").substring(0,5)?"https":"http",this.youtubeFrame=new Media($("<iframe id='player' class='youtube-player flip-action' type='text/html' width='"+this.width+"' height='"+this.height+"' src='"+this.prefix+"://www.youtube.com/embed/"+this.sVideoId+"?enablejsapi=1&rel=0' frameborder='0' allowfullscreen='1' style='position: absolute; opacity: "+this.config.alpha+"; left:"+
this.x+"px; top:"+this.y+"px;'></iframe>"),"youtube"),this.config.rotation&&this.setRotation(this.youtubeFrame.$media,this.config.rotation),this.parent.append(this.youtubeFrame.$media))},setTransOrigin:function(a,b){this.youtubeFrame.setCss({"-webkit-transform-origin":a+"px "+b+"px","-o-transform-origin":a+"px "+b+"px","-moz-transform-origin":a+"px "+b+"px","-ms-transform-origin":a+"px "+b+"px","transform-origin":a+"px "+b+"px"})},parseConfig:function(a){return{width:a.location.width,height:a.location.height,
x:a.location.x,y:a.location.y,alpha:a.alpha,id:a.videoId?a.videoId:a.videoID,moviePlayTriggerEvt:a.moviePlayTriggerEvt,playerParameters:a.playerParameters,movieStopTriggerEvt:a.movieStopTriggerEvt,rotation:a.location.rotation,animation:a.animation}},initCss:function(){this.youtubeFrame.setCss({width:this.width+"px",height:this.height+"px",top:this.y+"px",left:this.x+"px"})},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.config.width*this.pageWidth;this.height=this.config.height*
this.pageHeight;this.youtubeFrame.setCss({width:this.width+"px",height:this.height+"px"});this.setPosition()},setPosition:function(){this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.youtubeFrame.setCss({top:this.y+"px",left:this.x+"px"})},getPlayEvt:function(){return this.config.moviePlayTriggerEvt},getStopEvt:function(){return this.config.movieStopTriggerEvt},pauseVideo:function(){this.youtubeFrame&&(BookEvent.trigger("playMedia",["pauseYoutube",BookInfo.getCurrentPageIndex(),
this.prefix+"://www.youtube.com/embed/"+this.sVideoId,"Youtube"]),this.youtubeFrame.pause())},playVideo:function(){this.youtubeFrame&&(BookEvent.trigger("playMedia",["playYoutube",BookInfo.getCurrentPageIndex(),this.prefix+"://www.youtube.com/embed/"+this.sVideoId,"Youtube"]),this.firstTime?(this.youtubeFrame.$media.on("load",function(){this.youtubeFrame.play()}.bind(this)),this.firstTime=!1):this.youtubeFrame.play())},hide:function(){this.youtubeFrame&&(this.youtubeFrame.setCss({width:"0px",height:"0px"}),
this.youtubeFrame.setCss({display:"none"}))},show:function(){this.youtubeFrame&&(this.youtubeFrame.setCss({width:this.width+"px",height:this.height+"px"}),this.youtubeFrame.setCss({display:"block"}))},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.youtubeFrame.setCss({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.youtubeFrame.$media.one(a,function(){this.youtubeFrame.setCss({animation:""})}.bind(this))}}}).extend("Item");
Class("Video",{Package:"PageItem",create:function(a,b,c,d,e){this.config=this.parseConfig(b);this.animateConfig();this.parent=a;this.pageWidth=c;this.pageHeight=d;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.playCount=0;this.content=$("<div class='flip-action'></div>");this.content.css({position:"absolute",overflow:"hidden",left:this.x+"px",top:this.y+"px",width:this.width+"px",
height:this.height+"px",opacity:this.config.alpha});this.setRotation(this.content,this.config.rotation);this.parent.append(this.content);"string"==typeof this.config.previewSrc&&""!=this.config.previewSrc&&null!=this.config.previewSrc&&void 0!=this.config.previewSrc&&(this.config.previewSrc=this.fixRelativePath(this.config.previewSrc),bookConfig.useTheAliCloudChart&&(this.config.previewSrc=this.getOssUrl(this.config.previewSrc,this.width,this.height,"fixed")));if("string"==typeof this.config.src){if(a=
this.config.src.match(/(.mp4|.flv|.f4v)\b/),null==this.config.src||null==a)return}else if(this.config.src=={})return;this.config.src=this.fixRelativePath(this.config.src);this.video=null;this.video=new Media($('<video controls controlslist="nodownload" preload="metadata" webkit-playsinline="true" playsinline="true" ><source src="'+this.config.src+'"/></video>'),"video");this.video.setCss({position:"absolute","z-index":1,left:"0px","object-fit":"fill",top:"0px",width:"100%",height:"100%"});this.config.previewSrc&&
(this.video.$media.attr("poster",this.config.previewSrc),this.video.$media.css({"object-fit":"fill"}));this.content.append(this.video.$media);void 0!=this.video.$media[0].play&&(this.videoSkin=this.content.addVideoSkin(e,this.video),this.video.$media.removeAttr("controls"));this.content.bind(_event._down,function(f){f.stopPropagation()});this.video.$media.bind(_event._down,function(f){f.stopPropagation()});this.video.$media.keydown(function(f){f.preventDefault();f.stopPropagation()}.bind(this));this.video.$media.keyup(function(f){f.preventDefault();
f.stopPropagation()}.bind(this));this.video.$media.on("loadstart",function(){this.resizeCss()}.bind(this));parseBool(this.config.reflection)&&this.imageReflection(this.content,this.width,this.height);parseBool(this.config.shadow.hasDropShadow)&&this.addShadow(this.content);this.video.$media.bind("click mousedown mouseup DOMMouseScroll mousewheel",function(f){f.stopPropagation()}.bind(this));this.initLoopEvent();this.config.prompt&&this.config.promptTime&&this.video.$media.bind("loadedmetadata",function(f){f=
[];for(var g=this.config.prompt.split("|"),h=this.config.promptTime.split("|"),k=0;k<g.length;k++)g[k]&&f.push({time:h[k],text:g[k]});this.videoSkin.initPrompt(f)}.bind(this));this.resizeCss()},initLoopEvent:function(){0>this.config.H5PlaybackNumber&&this.video.$media.attr("loop","loop");0<this.config.H5PlaybackNumber&&this.video.$media.bind("ended",function(){this.playCount++;0<this.config.H5PlaybackNumber&&this.playCount<=this.config.H5PlaybackNumber&&this.playVideo()}.bind(this));this.video.$media.bind("play",
function(){this.playCount>this.config.H5PlaybackNumber&&(this.playCount=0)}.bind(this))},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.content.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.content.one(a,function(){this.content.css({animation:""})}.bind(this))}},parseConfig:function(a){var b={width:a.location.width,height:a.location.height,rotation:a.location.rotation,
x:a.location.x,y:a.location.y,alpha:a.alpha,shadow:a.shadow,reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,previewSrc:a.previewUrl,prompt:a.prompt,promptTime:a.promptTime,moviePlayTriggerEvt:a.moviePlayTriggerEvt?a.moviePlayTriggerEvt:a.PlayTriggerEvt,movieStopTriggerEvt:a.movieStopTriggerEvt?a.movieStopTriggerEvt:a.StopTriggerEvt,replayWhenPlayEventTrigger:a.replayWhenPlayEventTrigger,animation:a.animation};a.H5PlaybackNumber&&
(b.H5PlaybackNumber=parseInt(a.H5PlaybackNumber));a.H5Replay&&(b.H5Replay=parseBool(a.H5Replay));a.componentData&&(b.moviePlayTriggerEvt=a.componentData.playEvt,b.movieStopTriggerEvt=a.componentData.stopEvt,a.componentData.previewURL&&(b.previewSrc=a.componentData.previewURL),a.componentData.imgURL&&(b.previewSrc=a.componentData.imgURL));a.imgIcon&&(b.previewSrc=a.imgIcon);a.previewURL&&(b.previewSrc=a.previewURL);void 0!=a.videoURL&&(b.src=a.videoURL);void 0!=a.url&&(b.src=a.url);a.componentData&&
(b.src=a.componentData.videoURL);parseBool(a.shadow.hasDropShadow)&&(b.hasShadow=!0);return b},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.resizeCss()},resizeCss:function(){this.content.css({width:this.width+"px",height:this.height+"px"});this.content.css({"background-size":this.width+"px "+this.height+"px"});if(this.videoSkin)this.videoSkin.onResize();this.setPosition()},setPosition:function(){this.x=
this.pageWidth*this.config.x;this.y=this.pageHeight*this.config.y;this.content.css({left:this.x+"px",top:this.y+"px"})},playVideo:function(){if(null!=this.video)try{this.video.play(),this.videoSkin.play()}catch(a){}},stopVideo:function(){if(null!=this.video)try{this.video.pause(),this.videoSkin.stop()}catch(a){}},pauseVideo:function(){if(null!=this.video)try{this.video.pause(),this.videoSkin.pause()}catch(a){}},backTime:function(){this.playCount=0;if(this.video.$media[0])if(isIE())try{this.video.$media[0].currentTime=
0}catch(a){}else this.video.$media[0].currentTime=0},isReplay:function(){return this.config.H5Replay},getPlayEvt:function(){return this.config.moviePlayTriggerEvt},getStopEvt:function(){return this.config.movieStopTriggerEvt},getPlayStatuEnded:function(){return this.video.$media[0].ended},getReplayWhenPlayEvent:function(){return this.config.replayWhenPlayEventTrigger},getTotalTime:function(){return this.video.$media[0].duration},getCurrentTime:function(){return this.video.$media[0].currentTime},setCurrentTime:function(a){this.video.$media[0].currentTime=
a}}).extend(PageItem.Item);
Class("Vimeo",{Package:"PageItem",create:function(a,b,c,d,e){this.config=this.parseConfig(b);this.vimeoFrame=null;null!=this.config.id&&(this.animateConfig(),this.pageWidth=c,this.pageHeight=d,this.width=this.config.width*this.pageWidth,this.height=this.config.height*this.pageHeight,this.x=this.config.x*this.pageWidth,this.y=this.config.y*this.pageHeight,this.config.id+="",b=this.config.id.lastIndexOf("/"),this.fixstr=this.config.id.substring(b+1),this.prefix="https"==(window.location.href?window.location.href.toLowerCase():
"http:").substring(0,5)?"https":"http",b=$("<iframe id = vimeoPlay width='"+this.width+"' height='"+this.height+"' src='"+this.prefix+"://player.vimeo.com/video/"+this.fixstr+"'  frameborder='0' class='flip-action' style='position: absolute;opacity:"+this.config.alpha+"; left:"+this.x+"px; top:"+this.y+"px;'  webkitAllowFullScreen='true' mozallowfullscreen='true' allowFullScreen='true'></iframe>"),this.vimeoFrame=new Media(b,"vimeo",this.getPlayEvt()),a.append(this.vimeoFrame.$media))},parseConfig:function(a){return{width:a.location.width,
height:a.location.height,x:a.location.x,y:a.location.y,alpha:a.alpha,id:a.videoID?a.videoID:a.videoId,moviePlayTriggerEvt:a.moviePlayTriggerEvt,movieStopTriggerEvt:a.movieStopTriggerEvt,playerParameters:a.playerParameters,animation:a.animation}},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.vimeoFrame.setCss({width:this.pageWidth*this.config.width+"px",height:this.pageHeight*this.config.height+"px"});this.setPosition(this.config.x*this.pageWidth,this.config.y*this.pageHeight)},playVideo:function(){this.vimeoFrame&&
(BookEvent.trigger("playMedia",["play",BookInfo.getCurrentPageIndex(),this.prefix+"://player.vimeo.com/video/"+this.fixstr,"vimeo",0]),this.vimeoFrame.play())},pauseVideo:function(){this.vimeoFrame&&(BookEvent.trigger("playMedia",["pause",BookInfo.getCurrentPageIndex(),this.prefix+"://player.vimeo.com/video/"+this.fixstr,"vimeo",0]),this.vimeoFrame.pause())},setPosition:function(a,b){this.vimeoFrame.setCss({top:b+"px",left:a+"px"})},getPlayEvt:function(){return this.config.moviePlayTriggerEvt},getStopEvt:function(){return this.config.movieStopTriggerEvt},
showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.vimeoFrame.setCss({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.vimeoFrame.$media.one(a,function(){this.vimeoFrame.setCss({animation:""})}.bind(this))}},hide:function(){this.vimeoFrame.setCss({display:"none"})},show:function(){this.vimeoFrame.setCss({display:"block"})}}).extend("Item");
Class("PopUpVimeo",{Package:"PageItem",create:function(a,b,c,d,e){this.config=this.parseConfig(b);this.type=e;this.parent=a;this.vimeoFrame=null;if(null!=this.config.id){this.pageWidth=c;this.pageHeight=d;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.vimeoDiv=$("<div class='flip-action'></div>");this.vimeoDiv.css({width:this.width+"px",height:this.height+"px",left:this.x+"px",
top:this.y+"px",opacity:this.config.alpha,position:"absolute",cursor:"pointer","background-color":"rgba(0,0,0,0.9)"});this.url=this.config.url;this.url||(this.url=phoneBaseURL+e+".png");bookConfig.isFlipPdf&&(this.config.url=this.fixRelativePath(this.config.url));"vimeo"==e||"youtube"==e?(this.url=phoneBaseURL+e+"Logo.png",this.vimeoImage=$("<div style='position: absolute;background:#fff;cursor:pointer;width:"+this.width+"px;height:"+this.height+"px;z-index:100'><img src='"+this.url+"'style='position: absolute;width:45px;left:10px;top:10px;'/></div>")):
this.vimeoImage=$("<img src='"+this.url+"'style='position: absolute;cursor:pointer;width:"+this.width+"px;height:"+this.height+"px;z-index:100'/>");this.url&&"null"!=this.url||this.vimeoImage.css({display:"none"});if(isPhone()||isPad())a=Math.min(Math.min(48,.36*this.width),Math.min(48,.36*this.height)),this.vimeoDiv.css({background:"#333333",border:"1px solid #bbb"}),b="play","vimeo"==e&&(b="vimeoplay"),"youtube"==e&&(b="youtubeplay"),b=this.fixRelativePath(phoneBaseURL+b+".png"),this.playImg=$("<img src='"+
b+"' style='position:absolute;z-index:101;margin:auto;left:0px;top:0px;bottom:0px;right:0px;width:"+a+"px;height:"+a+"px'/>"),this.vimeoDiv.append(this.playImg);this.parent.append(this.vimeoDiv);this.vimeoDiv.append(this.vimeoImage);this.vimeoDiv.onTap(function(f){this.popupVideo=new PopUpPhoneVideo(this.config,e);this.popupVideo.background.show()}.bind(this))}},parseConfig:function(a){return{width:a.location.width,height:a.location.height,x:a.location.x,y:a.location.y,alpha:a.alpha,id:a.videoId?
a.videoId:a.videoID,moviePlayTriggerEvt:a.moviePlayTriggerEvt,movieStopTriggerEvt:a.movieStopTriggerEvt,playerParameters:a.playerParameters,url:a.url,autoPlay:a.autoPlay}},destroy:function(){this.popupVideo&&this.popupVideo.destroy();this.vimeoDiv.empty();this.vimeoDiv.remove()},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;if(this.popupVideo)this.popupVideo.onResize(this.pageWidth,this.pageHeight);
this.url&&"null"!=this.url&&this.vimeoImage.css({width:this.width+"px",height:this.height+"px"});this.vimeoDiv&&(this.vimeoDiv.css({width:this.pageWidth*this.config.width+"px",height:this.pageHeight*this.config.height+"px"}),this.setPosition(this.config.x*this.pageWidth,this.config.y*this.pageHeight))},setPosition:function(a,b){this.vimeoDiv.css({top:b+"px",left:a+"px"})}}).extend("Item");
var PopUpVideo=Class({create:function(a,b){this.config=$.extend({id:null,alpha:1},a);this.config.id+="";this.type=b;this.videoWidth=this.config.windowWidth||480;this.videoHeight=this.config.windowHeight||320;this.background=$("<div id='popup' class='flip-action' ></div>");this.vimeoBac=$("<div></div>");this.vimeoBorder=$("<div></div>");this.title=$("<div></div>");this.config.caption&&this.title.html(this.config.caption);"right"==this.config.languageLayout&&this.title.css({"text-align":"right",direction:"rtl"});
this.initVideo(b);tmpContainer.append(this.background);this.background.append(this.vimeoBac);this.vimeoBac.append(this.vimeoBorder);this.vimeoBorder.append(this.vimeoFrame.$media);this.closeButton=$("<img src='"+uiBaseURL+"close_form.png'/>");this.vimeoBorder.append(this.closeButton).append(this.title);this.initStyle();this.initEvents();this.onResize();this.vimeoFrame.play();this.resizeTimer=this.onResize.interval(this,500);this.visible=!0;BookEvent.trigger("playMedia",["play",BookInfo.getCurrentPageIndex(),
this.getURL(b),b,0])},initVideo:function(a){var b="https"==(window.location.href?window.location.href.toLowerCase():"http:").substring(0,5)?"https":"http";if("vimeo"==a){var c=this.config.id.lastIndexOf("/");c=this.config.id.substring(c+1);var d="";"true"==this.config.autoPlay&&(d="?autoplay=1&autopause=0");c=$("<iframe width='"+this.videoWidth+"' height='"+this.videoHeight+"' src='"+b+"://player.vimeo.com/video/"+c+d+"' frameborder='0' style='position: absolute;background:#000000;' allow = 'autoplay'  webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>");
this.vimeoFrame=new Media(c,"vimeo")}"youtube"==a&&(c=this.config.id,-1<c.indexOf("/")&&(d=-1<c.indexOf("?v=")?c.lastIndexOf("?v=")+3:c.lastIndexOf("/")+1,c=c.substring(d,c.length)),c=$("<iframe class='youtube-player' type='text/html' width='"+this.videoWidth+"' height='"+this.videoHeight+"' src='"+b+"://www.youtube.com/embed/"+c+"?autoplay=1' frameborder='0' allowfullscreen='1' style='position: absolute; opacity: "+this.config.alpha+"'></iframe>"),this.vimeoFrame=new Media(c,"youtube"));"dailymotion"==
a&&(c=$("<iframe id=woiframe width='"+this.videoWidth+"' height='"+this.videoHeight+"' src='"+b+"://www.dailymotion.com/embed/video/"+this.config.id+"' frameborder='0' allowFullScreen style='position: absolute; opacity: "+this.config.alpha+"'></iframe>"),this.vimeoFrame=new Media(c,"dailymotion"));"wistia"==a&&(c=$("<iframe width='"+this.videoWidth+"' height='"+this.videoHeight+"' src='"+b+"://fast.wistia.net/embed/iframe/"+this.config.id+"' frameborder='0' allowfullscreen style='position:absolute;opactiy: "+
this.config.alpha+"'></iframe>"),this.vimeoFrame=new Media(c,"wistia"));"youku"==a&&(c=$("<iframe width='"+this.videoWidth+"' height='"+this.videoHeight+"' src='"+b+"://player.youku.com/embed/"+this.config.id+"' frameborder='0' allowfullscreen style='position:absolute;opactiy: "+this.config.alpha+"'></iframe>"),this.vimeoFrame=new Media(c,"youku"));"qq"==a&&(c=$("<iframe width='"+this.videoWidth+"' height='"+this.videoHeight+"' src='"+b+"://v.qq.com/iframe/player.html?vid="+this.config.id+"' frameborder='0' allowfullscreen style='position:absolute;opactiy: "+
this.config.alpha+"'></iframe>"),this.vimeoFrame=new Media(c,"qq"))},getURL:function(a){var b=this.config.id,c="https"==(window.location.href?window.location.href.toLowerCase():"http:").substring(0,5)?"https":"http",d="";if("vimeo"==a){var e=b.lastIndexOf("/");b=b.substring(e+1)}"youtube"==a&&-1<b.indexOf("/")&&(e=-1<b.indexOf("?v=")?b.lastIndexOf("?v=")+3:b.lastIndexOf("/")+1,b=b.substring(e,b.length));switch(a){case "vimeo":d=c+"://player.vimeo.com/video/"+b;break;case "youtube":d=c+"://www.youtube.com/embed/"+
b;break;case "dailymotion":d=c+"://www.dailymotion.com/embed/video/"+b;break;case "wistia":d=c+"://fast.wistia.net/embed/iframe/"+b;break;case "youku":d=c+"://player.youku.com/embed/"+b;break;case "qq":d=c+"://v.qq.com/iframe/player.html?vid="+b}return d},initStyle:function(){this.background.css({position:"absolute",width:"100%",height:"100%","z-index":100});this.vimeoBac.css({width:"100%",height:"100%","background-color":"rgba(0,0,0,0.5)"});this.vimeoBorder.css({position:"absolute","z-index":"11",
"background-color":"#F0F0F0","border-radius":"3px",margin:"auto",left:"0",top:"0",bottom:"0",right:"0"});this.closeButton.css({position:"absolute","z-index":"1",width:"32px",height:"32px",cursor:"pointer",right:"5px",top:"0px"});this.vimeoFrame.setCss({background:"#F0F0F0",position:"relative","margin-left":"5px","margin-top":"32px"});this.title.css({position:"absolute","font-size":"16px",top:"5px",left:"5px"});"right"==this.config.languageLayout&&(this.title.css({left:"auto",right:"5px"}),this.closeButton.css({right:"auto",
left:"5px"}))},initEvents:function(){this.vimeoBac.bind(_event._down,function(a){this.destroy();a.stopPropagation();return!1}.bind(this));this.vimeoBorder.bind(_event._down,function(a){a.stopPropagation();return!1}.bind(this));this.closeButton.asButton();this.closeButton.onTap(function(a){BookEvent.trigger("playMedia",["pause",BookInfo.getCurrentPageIndex(),this.getURL(this.type),this.type,0]);this.destroy();return!1}.bind(this))},destroy:function(){this.visible&&(this.vimeoFrame.pause(),this.visible=
!1,this.vimeoFrame.$media.attr("src",""),this.background.empty(),this.background.remove(),this.resizeTimer&&this.resizeTimer.stop())},showOrHide:function(){!1===this.visible?this.show():this.hide()},hide:function(){this.visible=!1;this.background.css({display:"none"})},show:function(){this.visible=!0;this.vimeoFrame.play();this.background.css({display:"block"})},onResize:function(){if(this.windowWidth!=windowWidth||this.windowHeight!=windowHeight){this.windowWidth=windowWidth;this.windowHeight=windowHeight;
var a=windowWidth-10,b=windowHeight-10,c=this.videoWidth,d=this.videoHeight;isPhone()?(c=d/c,b/a>c?b=a*c:a=b/c):(a=Math.min(c,a),b=Math.min(d,b));this.vimeoBorder.css({width:a+"px",height:b+"px"});b-=37;this.vimeoFrame&&(this.vimeoFrame.$media.attr("width",a-10+"px"),this.vimeoFrame.$media.attr("height",b+"px"))}},getPlayEvt:function(){return this.config.moviePlayTriggerEvt},getStopEvt:function(){return this.config.movieStopTriggerEvt}}),PopUpPhoneVideo=Class({create:function(a,b){this.config=$.extend({id:null,
alpha:1},a);this.config.id+="";this.type=b;this.initVideoSize();this.staticWidth=this.videoWidth;this.staticHeight=this.videoHeight;this.background=$("<div id='popup' class='flip-action' ></div>");this.vimeoBac=$("<div></div>");this.vimeoBorder=$("<div></div>");"right"==this.config.languageLayout&&this.title.css({"text-align":"right",direction:"rtl"});this.initVideo(b);tmpContainer.append(this.background);this.background.append(this.vimeoBac);this.vimeoBac.append(this.vimeoBorder);this.vimeoBorder.append(this.vimeoFrame.$media);
this.closeButton=$("<img src='"+phoneBaseURL+"close.png'/>");this.background.append(this.closeButton);this.initStyle();this.initEvents();this.onResize();this.vimeoFrame.play();this.resizeTimer=this.onResize.interval(this,500);this.visible=!0;BookEvent.trigger("playMedia",["play",BookInfo.getCurrentPageIndex(),this.getURL(b),b,0])},initVideo:function(a){var b="https"==(window.location.href?window.location.href.toLowerCase():"http:").substring(0,5)?"https":"http";if("vimeo"==a){var c=this.config.id.lastIndexOf("/");
c=this.config.id.substring(c+1);var d="";"true"==this.config.autoPlay&&(d="?autoplay=1&autopause=0");c=$("<iframe width='"+this.videoWidth+"' height='"+this.videoHeight+"' src='"+b+"://player.vimeo.com/video/"+c+d+"' frameborder='0' style='position: absolute;background:#000000;' allow='autoplay'  webkitAllowFullScreen='true' mozallowfullscreen='true' allowfullscreen='true'></iframe>");this.vimeoFrame=new Media(c,"vimeo")}"youtube"==a&&(c=this.config.id,-1<c.indexOf("/")&&(d=-1<c.indexOf("?v=")?c.lastIndexOf("?v=")+
3:c.lastIndexOf("/")+1,c=c.substring(d,c.length)),c=$("<iframe class='youtube-player' type='text/html' width='"+this.videoWidth+"' height='"+this.videoHeight+"' src='"+b+"://www.youtube.com/embed/"+c+"?autoplay=1' frameborder='0' allowfullscreen='true' style='position: absolute; opacity: "+this.config.alpha+"'></iframe>"),this.vimeoFrame=new Media(c,"youtube"));"dailymotion"==a&&(c=$("<iframe id=woiframe width='"+this.videoWidth+"' height='"+this.videoHeight+"' src='"+b+"://www.dailymotion.com/embed/video/"+
this.config.id+"?autoplay=1' frameborder='0' allowfullscreen='true' style='position: absolute; opacity: "+this.config.alpha+"'></iframe>"),this.vimeoFrame=new Media(c,"dailymotion"));"wistia"==a&&(c=$("<iframe width='"+this.videoWidth+"' height='"+this.videoHeight+"' src='"+b+"://fast.wistia.net/embed/iframe/"+this.config.id+"?autoplay=11' frameborder='0' allowfullscreen='true' style='position:absolute;opactiy: "+this.config.alpha+"'></iframe>"),this.vimeoFrame=new Media(c,"wistia"));"youku"==a&&
(c=$("<iframe width='"+this.videoWidth+"' height='"+this.videoHeight+"' src='"+b+"://player.youku.com/embed/"+this.config.id+"?rel=0&autoplay=1'  allow='autoplay' frameborder='0' allowfullscreen='true' style='position:absolute;left:50%;top:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);opactiy: "+this.config.alpha+"'></iframe>"),this.vimeoFrame=new Media(c,"youku"));"qq"==a&&(c=$("<iframe width='"+this.videoWidth+"' height='"+this.videoHeight+"' src='"+b+"://v.qq.com/iframe/player.html?vid="+
this.config.id+"' frameborder='0' allowfullscreen='true' style='position:absolute;opactiy: "+this.config.alpha+"'></iframe>"),this.vimeoFrame=new Media(c,"qq"))},getURL:function(a){var b=this.config.id,c="https"==(window.location.href?window.location.href.toLowerCase():"http:").substring(0,5)?"https":"http",d="";if("vimeo"==a){var e=b.lastIndexOf("/");b=b.substring(e+1)}"youtube"==a&&-1<b.indexOf("/")&&(e=-1<b.indexOf("?v=")?b.lastIndexOf("?v=")+3:b.lastIndexOf("/")+1,b=b.substring(e,b.length));switch(a){case "vimeo":d=
c+"://player.vimeo.com/video/"+b;break;case "youtube":d=c+"://www.youtube.com/embed/"+b;break;case "dailymotion":d=c+"://www.dailymotion.com/embed/video/"+b;break;case "wistia":d=c+"://fast.wistia.net/embed/iframe/"+b;break;case "youku":d=c+"://player.youku.com/embed/"+b;break;case "qq":d=c+"://v.qq.com/iframe/player.html?vid="+b}return d},initStyle:function(){this.background.css({position:"absolute",width:"100%",height:"100%","z-index":100});this.vimeoBac.css({width:"100%",height:"100%","background-color":"rgba(0,0,0,0.9)"});
this.vimeoBorder.css({position:"absolute","z-index":"11",margin:"auto",left:"0",top:"0",bottom:"0",right:"0"});this.closeButton.css({position:"absolute","z-index":"1111",width:"20px",height:"20px",padding:"5px",cursor:"pointer",right:"5px",top:"5px"})},initEvents:function(){this.vimeoBac.onTap(function(a){this.destroy();return!1}.bind(this));this.vimeoBorder.bind(_event._down,function(a){a.stopPropagation();return!1}.bind(this));this.closeButton.asButton();this.closeButton.onTap(function(a){BookEvent.trigger("playMedia",
["pause",BookInfo.getCurrentPageIndex(),this.getURL(this.type),this.type,0]);this.destroy();return!1}.bind(this))},destroy:function(){this.visible&&(this.vimeoFrame.pause(),this.visible=!1,this.vimeoFrame.$media.attr("src",""),this.background.empty(),this.background.remove(),this.resizeTimer&&this.resizeTimer.stop())},showOrHide:function(){!1===this.visible?this.show():this.hide()},hide:function(){this.visible=!1;this.background.css({display:"none"})},show:function(){this.visible=!0;this.vimeoFrame.play();
this.background.css({display:"block"})},initVideoSize:function(){windowWidth>windowHeight?(this.videoHeight=windowHeight,this.videoWidth=16*this.videoHeight/9,this.videoWidth=Math.min(this.videoWidth,windowWidth)):(this.videoWidth=windowWidth,this.videoHeight=9*this.videoWidth/16,this.videoHeight=Math.min(this.videoHeight,windowHeight))},onResize:function(){if(this.windowWidth!=windowWidth||this.windowHeight!=windowHeight){this.initVideoSize();var a=this.videoWidth/this.staticWidth;this.windowWidth=
windowWidth;this.windowHeight=windowHeight;"youku"!=this.type?(this.vimeoBorder.css({width:this.videoWidth+"px",height:this.videoHeight+"px"}),this.vimeoFrame&&(this.vimeoFrame.$media.attr("width","100%"),this.vimeoFrame.$media.attr("height",this.videoHeight+"px"))):this.staticWidth>this.staticHeight&&1>a?this.vimeoFrame.$media.css({transform:"translate(-50%,-50%) scale("+a+")"}):this.vimeoFrame.$media.css({transform:"translate(-50%,-50%)"})}},getPlayEvt:function(){return this.config.moviePlayTriggerEvt},
getStopEvt:function(){return this.config.movieStopTriggerEvt}}).extend("PopUpVideo");
Class("HtmlVideo",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b,c,d);this.animateConfig();this.container=$("<div class='flip-action'></div>");this.initVideoFrame();this.config.rotation&&this.setRotation(this.container,this.config.rotation);this.parent.append(this.container);this.initCss();this.setPosition()},initVideoFrame:function(){if(this.config.generalCode){this.iframeSrc=this.config.generalCode;if(this.config.generalCode.startsWith("www")){var a="http://"+this.config.generalCode;
try{$.ajax({url:a,type:"GET",dataType:"jsonp",timeout:3E3,complete:function(c){200!=c.status&&(a="https://"+this.config.generalCode)}})}catch(c){}this.config.generalCode=a}if(this.config.generalCode.startsWith("http")||this.config.generalCode.startsWith("https")||this.config.generalCode.startsWith("//"))this.videoFrame=$("<iframe id='player' type='text/html' width='"+this.width+"' height='"+this.height+"' src='"+this.config.generalCode+"' frameborder='0' allowfullscreen='1' style='position: absolute; '></iframe>");
else if(/^(<iframe|<embed).*(iframe>|embed>)/.test(this.config.generalCode)){var b=this.config.generalCode.match(/src=\S*[$'|$"]/);b[0]&&(this.iframeSrc=b[0].replace("src=",""));if("http:"==window.location.protocol||"https:"==window.location.protocol)this.config.generalCode=this.config.generalCode.replace("http:","").replace("https:","");"file:"==window.location.protocol&&(-1<b[0].indexOf('src="//')||-1<b[0].indexOf("src='//"))&&(this.config.generalCode=this.config.generalCode.replace('src="//','src="http://').replace("src='//",
"src='http://"));-1<this.config.generalCode.indexOf("style=")?this.config.generalCode=this.config.generalCode.replace("style=","style=width:100%;height:100%;"):this.config.generalCode=this.config.generalCode.replace(">"," width=100% height=100%; >");this.videoFrame=$(this.config.generalCode)}}},parseConfig:function(a){return{width:a.location.width,height:a.location.height,x:a.location.x,y:a.location.y,alpha:a.alpha,rotation:a.location.rotation,generalCode:a.generalCode,imgIcon:a.imgIcon,animation:a.animation}},
initCss:function(){this.config.generalCode&&this.videoFrame&&(this.width=this.config.width*this.pageWidth,this.height=this.config.height*this.pageHeight,this.container.css({background:"#f8f8f8",position:"absolute",opacity:this.config.opacity,width:this.width+"px",height:this.height+"px"}),this.videoFrame.css({width:this.width+"px",height:this.height+"px"}),this.container.css({width:this.width+"px",height:this.height+"px"}),this.setPosition())},onResize:function(a,b){this.config.generalCode&&this.videoFrame&&
(this.pageWidth=a,this.pageHeight=b,this.initCss())},setPosition:function(){this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.container.css({top:this.y+"px",left:this.x+"px"})},hide:function(){this.videoFrame&&(this.container.css({display:"none"}),this.videoFrame.remove())},show:function(){this.videoFrame&&(this.container.find(this.videoFrame)&&this.container.append(this.videoFrame),this.container.css({display:"block"}))},showAnimate:function(){if(this.videoFrame&&this.config.animation&&
this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.container.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.videoFrame.$media.one(a,function(){this.container.css({animation:""})}.bind(this))}}}).extend("Item");
Class("PhoneHtmlVideo",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b,c,d);this.config.generalCode&&(this.videoWidth=windowWidth,this.videoHeight=9*this.videoWidth/16,this.videoHeight=Math.min(this.videoHeight,windowHeight),this.videoLeft=(windowWidth-this.videoWidth)/2,this.videoTop=(windowHeight-this.videoHeight)/2,a=Math.min(Math.min(48,.36*this.width),Math.min(48,.36*this.height)),this.playImg=$("<img src='"+phoneBaseURL+"play.png' style='position:absolute;margin:auto;left:0px;top:0px;bottom:0px;right:0px;width:"+
a+"px;height:"+a+"px'/>"),this.close=$("<img src='"+phoneBaseURL+"close.png' />"),this.popContainer=$("<div class='popContainer'></div>"),this.initPopCss(),this.container.append(this.playImg),this.initEvent())},initEvent:function(){this.container.onTap(function(){this.popIframe()}.bind(this));this.popContainer.bind("click touchstart",function(a){a.stopPropagation()}.bind(this));this.popContainer.onTap(function(a){this.destroy()}.bind(this))},initVideoFrame:function(){if(this.config.generalCode){this.iframeSrc=
this.config.generalCode;if(this.config.generalCode.startsWith("www")){var a="http://"+this.config.generalCode;try{$.ajax({url:a,type:"GET",dataType:"jsonp",timeout:3E3,complete:function(c){200!=c.status&&(a="https://"+this.config.generalCode)}})}catch(c){}this.config.generalCode=a}if(this.config.generalCode.startsWith("http")||this.config.generalCode.startsWith("https")||this.config.generalCode.startsWith("//"))this.videoFrame=new Media($("<iframe id='player' type='text/html' src='"+this.config.generalCode+
"?autoplay=1' frameborder='0' allowfullscreen='1' style='position: absolute;width:100%;height:100%; '></iframe>"),"popVideo");else if(/^(<iframe|<embed).*(iframe>|embed>)/.test(this.config.generalCode)){var b=this.config.generalCode.match(/src=\S*[$'|$"]/);b[0]&&(this.iframeSrc=b[0].replace("src=",""));if("http:"==window.location.protocol||"https:"==window.location.protocol)this.config.generalCode=this.config.generalCode.replace("http:","").replace("https:",""),this.config.generalCode.replace("width",
"").replace("height","");"file:"==window.location.protocol&&(-1<b[0].indexOf('src="//')||-1<b[0].indexOf("src='//"))&&(this.config.generalCode=this.config.generalCode.replace('src="//','src="http://').replace("src='//","src='http://"));this.videoFrame=new Media($(this.config.generalCode),"popVideo")}}},getImgIcon:function(){return this.config.imgIcon?this.fixRelativePath(this.config.imgIcon):-1<this.config.generalCode.indexOf("youku")?phoneBaseURL+"youku.png":-1<this.config.generalCode.indexOf("qq")?
phoneBaseURL+"vQQ.png":-1<this.config.generalCode.indexOf("bilibili")?phoneBaseURL+"bilibili.png":phoneBaseURL+"movie.png"},initCss:function(){this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.container.css({background:"#333 url('"+this.getImgIcon()+"') center center no-repeat","background-size":"contain",position:"absolute",opacity:this.config.opacity,width:this.width+"px",height:this.height+"px"});this.setPosition()},initPopCss:function(){this.popContainer.css({position:"absolute",
display:"none",background:"rgba(0,0,0,0.9)",width:"100%",height:"100%",left:"0",top:"0",right:"0",bottom:"0","z-index":"1001"});this.close.css({position:"absolute",right:"5px",top:"5px",width:"20px",height:"20px",padding:"5px","z-index":"1111"});this.videoFrame.$media.css({width:this.videoWidth+"px",height:this.videoHeight+"px",top:"50%",left:"50%",position:"absolute",transform:"translate(-50%,-50%)"})},popIframe:function(){this.videoFrame&&this.videoFrame.$media&&(this.popContainer.append(this.videoFrame.$media),
this.popContainer.append(this.close),tmpContainer.append(this.popContainer),BookEvent.trigger("playMedia",["play",BookInfo.getCurrentPageIndex(),this.iframeSrc,"htmlVideo",0]),this.popContainer.fadeIn(300,function(){this.initPopEvent()}.bind(this)),this.videoFrame.play())},popDestroy:function(){this.popContainer.fadeOut(300,function(){this.videoFrame.$media.remove();this.videoFrame.pause()}.bind(this))},initPopEvent:function(){this.close.onTap(function(a){BookEvent.trigger("playMedia",["pause",BookInfo.getCurrentPageIndex(),
this.iframeSrc,"htmlVideo",0]);this.popDestroy()}.bind(this))},initVideoSize:function(){windowWidth>windowHeight?(this.videoHeight=windowHeight,this.videoWidth=16*this.videoHeight/9,this.videoWidth=Math.min(this.videoWidth,windowWidth)):(this.videoWidth=windowWidth,this.videoHeight=9*this.videoWidth/16,this.videoHeight=Math.min(this.videoHeight,windowHeight))},onResize:function(a,b){this.config.generalCode&&this.videoFrame&&this.videoFrame.$media&&(this._super(a,b),this.initVideoSize(),this.videoFrame.$media.css({width:this.videoWidth+
"px",height:this.videoHeight+"px",top:"50%",left:"50%",position:"absolute","-webkit-transform":"translate(-50%,-50%)",transform:"translate(-50%,-50%)"}))},hide:function(){},show:function(){}}).extend("HtmlVideo");
Class("Audio",{Package:"PageItem",background:!1,create:function(a,b,c,d,e){this._super(a,b,c,d);this.config.src&&(this.animateConfig(),this.audio=null,this.defaultWidth=c,this.themeName=e,this.resizeThemes={"default":"",wave:""},this.type="com.mobiano.flipbook.sound.TAnnoBackgroundSound",this.playCount=0,this.pageWidth=c,this.pageHeight=d,this.width=this.config.width*this.pageWidth,this.height=this.config.height*this.pageHeight,this.x=this.config.x*this.pageWidth,this.y=this.config.y*this.pageHeight,
this.config.mainColor&&(this.mainColor=Color(this.config.mainColor).toString()),this.initUI(),this.setRotation(this.content,this.config.rotation),this.setAudioSrc(),this.setAudioSkin(),this.initLoopEvent(),this.onResize(this.pageWidth,this.pageHeight))},initUI:function(){this.content=$("<div class='audioContent flip-action'></div>");this.content.css({position:"absolute",left:this.x+"px",top:this.y+"px","background-color":this.mainColor,opacity:this.config.alpha});this.parent.append(this.content);
this.audio=new Media($("<audio controls ></audio>"),"audio");this.audio.setCss({position:"absolute",width:"0px",height:"0px",left:"0px",top:"0px"});this.config.shadow&&parseBool(this.config.shadow.hasDropShadow)&&this.addShadow(this.content)},setAudioSrc:function(){var a=this.config.key;this.content.audioResources=[];if(void 0==a)this.config.src=this.fixRelativePath(this.config.src),this.audio.$media.attr("src",this.config.src),this.content.audioResources.push(this.config.src);else if(a in this.config.src)c=
this.config.src[a],c=this.fixRelativePath(c),this.content.audioResources.push(c),this.audio.$media.attr("src",c);else for(var b=0;b<this.config.src.length;b++){var c=this.config.src[b][a];c=this.fixRelativePath(c);this.content.audioResources.push(c);var d=$("<source src='"+c+"'>");this.audio.$media.append(d);0==b&&this.audio.$media.attr("src",c)}this.content.append(this.audio.$media)},setAudioSkin:function(){void 0!=this.audio.$media[0]&&"background0"!=this.themeName&&(this.audioSkin=this.content.addAudioSkin(this.themeName,
this.audio),this.audio.$media.removeAttr("controls"));this.audioSkin&&"BackgroundAudioSkin"==this.audioSkin.getClassName()&&(this.config.soundPlayTriggerEvt=PageEditor.PlayEvt.EVT_PLAY,this.config.soundStopTriggerEvt=PageEditor.PlayEvt.EVT_STOP);this.resizeThemes={"default":"",wave:"",skin1:"",skin2:""};this.themeName in this.resizeThemes||void 0==this.themeName?(this.content.css({width:this.width+"px",height:this.height+"px"}),this.audioSkin.onResize(),"skin1"!=this.themeName&&"skin2"!=this.themeName||
this.content.find(".volume-seek.slider-action").css({height:"26px"})):this.resizeAudio(this.pageWidth,this.pageHeight)},initLoopEvent:function(){0>this.config.H5PlaybackNumber&&this.audio.$media.attr("loop","loop");0<this.config.H5PlaybackNumber&&this.audio.$media.bind("ended",function(){this.playCount++;0<this.config.H5PlaybackNumber&&this.playCount<=this.config.H5PlaybackNumber&&this.playAudio()}.bind(this));this.audio.$media.bind("play",function(){this.playCount>this.config.H5PlaybackNumber&&(this.playCount=
0)}.bind(this))},parseConfig:function(a){function b(e){if("object"!=typeof e)return!1;if(e instanceof Array)return 0==e.length;var f=0,g;for(g in e)f++;return 0==f}function c(e){return e.componentData&&e&&!b(e.componentData.songs)&&void 0!=e.componentData.songs?e.componentData.songs.song?e.componentData.songs.song:e.componentData.songs.url?e.componentData.songs.url:e.componentData.songs:{}}var d={rotation:a.location.rotation,width:a.location.width,height:a.location.height,x:a.location.x,y:a.location.y,
alpha:a.alpha,src:a.soundURL,shadow:a.shadow,className:a.className,mainColor:a.mainColor,soundPlayTriggerEvt:a.soundPlayTriggerEvt,soundStopTriggerEvt:a.soundStopTriggerEvt,animation:a.animation,H5PlaybackNumber:0};a.annotype==PageEditor.AnnoType.ANNO_AUDIO1&&(d.key="path",d.src=b(a.soundList)?"":a.soundList,d.src.sound&&(d.src=d.src.sound));a.annotype==PageEditor.AnnoType.ANNO_AUDIO2&&(d.key="fname",d.src=b(a.data)?"":a.data,d.src.item&&(d.src=d.src.item));a.annotype==PageEditor.AnnoType.ANNO_PLUGIN&&
a.className in audioThemeNames&&(d.key="url",d.src=c(a),d.soundPlayTriggerEvt=a.soundPlayTriggerEvt,d.soundStopTriggerEvt=a.soundStopTriggerEvt,a.componentData&&a.componentData.playEvt&&(d.soundPlayTriggerEvt=a.componentData.playEvt,d.soundStopTriggerEvt=a.componentData.stopEvt));a.shadow&&parseBool(a.shadow.hasDropShadow)&&(d.hasShadow=!0);return d},onResize:function(a,b){if(this.content){this.pageWidth=a;this.pageHeight=b;this.width=this.config.width*this.pageWidth;this.height=this.config.height*
this.pageHeight;if(this.themeName in this.resizeThemes||void 0==this.themeName){if("skin1"==this.themeName||"skin2"==this.themeName){this.resizeSkin1_2();this.setPosition();return}this.content.css({width:this.width+"px",height:this.height+"px"});this.audioSkin.onResize();this.backgroundDiv&&this.backgroundDiv.css({width:this.width+"px",height:this.height+"px"})}else this.resizeAudio(a,b);this.setPosition()}},resizeSkin1_2:function(){var a=this.pageWidth/this.defaultWidth;this.content.css({height:"26px"});
this.content.find(".volume-seek.slider-action").css({height:"26px"});this.content.css({"transform-origin":"0 0","-o-transform-origin":"0 0","-moz-transform-origin":"0 0","-ms-transform-origin":"0 0","-webkit-transform-origin":"0 0",transform:"scale("+a+")","-webkit-transform":"scale("+a+")","-ms-transform":"scale("+a+")","-o-transform":"scale("+a+")","-moz-transform":"scale("+a+")"})},resizeAudio:function(a,b){this.audioContentWidth||(this.audioContentWidth=this.content.width());this.audioContentHeight||
(this.audioContentHeight=this.content.height());this.audioContentWidth?(a=Math.min(this.config.width*a/this.audioContentWidth,this.config.height*b/this.audioContentHeight),this.content.css({"-webkit-transform-origin":"0% 0%","-moz-transform-origin":"0% 0%","-ms-transform-origin":"0% 0%","-o-transform-origin":"0% 0%","transform-origin":"0% 0%","-webkit-transform":"scale("+a+") rotate("+this.config.rotation+"deg)","-moz-transform":"scale("+a+") rotate("+this.config.rotation+"deg)","-ms-transform":"scale("+
a+") rotate("+this.config.rotation+"deg)","-o-transform":"scale("+a+") rotate("+this.config.rotation+"deg)",transform:"scale("+a+") rotate("+this.config.rotation+"deg)"}),this.audioSkin.refreshSeek(),this.audioSkin.onResize()):this.resizeAudio.delay(this,100,[a,b])},setPosition:function(){this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.content.css({left:this.x+"px",top:this.y+"px"});this.backgroundDiv&&this.backgroundDiv.css({left:this.x+"px",top:this.y+"px"})},showAnimate:function(){if(this.config.animation&&
this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.content.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.content.one(a,function(){this.content.css({animation:""})}.bind(this))}},playAudio:function(){if(null!=this.audio)try{this.audio.play()}catch(a){}},pauseAudio:function(){if(null!=this.audio)try{this.audio.pause()}catch(a){}},stopAudio:function(){if(null!=this.audio)try{this.audio.pause(),this.audio.setCurrentTime(0)}catch(a){}},
backTime:function(){this.playCount=0;this.audio.setCurrentTime(0)},isReplay:function(){return this.config.H5Replay},getPlayEvt:function(){return this.config.soundPlayTriggerEvt},getStopEvt:function(){return this.config.soundStopTriggerEvt},isBackgroundAudio:function(){return this.background}}).extend("Item");
Class("AudioEditor",{create:function(a,b,c,d,e,f){this.parent=a;this.enterPlay=parseBool(c);this.autoPlayAgain=parseBool(d);e&&(this.H5PlaybackNumber=parseInt(e));f&&(this.H5Replay=parseBool(f));this.playCount=0;this.background=$("<div class='printBar'></div>");this.contentBox=$("<div class='printBG'></div>");this.closeButton=$("<div></div>");this.showing=!1;this.width=windowWidth;this.height=windowHeight;bookConfig.isFlipPdf&&(b.startsWith("./")?b="."+b:b.isUrl()||(b="../"+b));this.audioSrc=b;this.contentWidth=
350;this.contentHeight=63;this.themeName="enjoy";isPhone()&&(this.themeName="background",this.contentHeight=this.contentWidth=100);this.audio=new Media($("<audio controls ></audio>"),"audio");this.contentBox.audioResources=[];this.audio.$media.attr("src",this.audioSrc);this.contentBox.audioResources.push(this.audioSrc);this.contentBox.append(this.audio.$media);void 0!=this.audio.$media[0].play&&"background0"!=this.themeName&&(this.contentBox.addAudioSkin(this.themeName,this.audio),this.audio.$media.removeAttr("controls"));
this.parent.append(this.background);this.parent.append(this.contentBox);this.parent.append(this.closeButton);this.closeButton.append($("<img src='"+uiBaseURL+"close.png'/>").asImageButton());this.initCss();this.initEvent()},initCss:function(){this.background.css({height:this.height+"px",bottom:"0px"});this.contentBox.css({top:(this.height-this.contentHeight)/2+"px","border-radius":"0px",height:this.contentHeight+"px",width:this.contentWidth+"px",left:(this.width-this.contentWidth)/2+"px"});this.audio.setCss({position:"absolute",
width:this.contentWidth+"px",height:this.contentHeight+"px",left:"0px",top:"0px"});this.closeButton.css({top:"30px",right:"30px",position:"absolute","z-index":"103"});this.background.css("display","none");this.contentBox.css("display","none");this.closeButton.css("display","none")},onResize:function(a,b){this.background.css({height:windowHeight+"px",bottom:"0px"});this.contentBox.css({height:this.contentHeight+"px",width:this.contentWidth+"px",left:(windowWidth-this.contentWidth)/2+"px"});this.contentBox.css({top:(windowHeight-
this.contentHeight)/2+"px"});this.closeButton.css({top:"30px",right:"30px"});void 0!=this.themeName&&(this.contentBox.css({width:this.contentWidth+"px",height:this.contentHeight+"px"}),this.audioSkin.onResize())},setPosition:function(a,b,c){void 0==c&&(c=["left","top"]);$(this.background).css(c[0],a+"px");$(this.background).css(c[1],b+"px")},getShowStatu:function(){return this.showing},setShowStatu:function(a){this.showing=a},show:function(){$(this.background).css({display:"block"});$(this.contentBox).fadeIn(500);
$(this.closeButton).fadeIn(500);this.showing=!0;global.flipShotButton&&flipShotButton.hide()},hide:function(){var a=this;$(this.background).fadeOut(500,function(){a.pause();a.contentBox.remove();a.closeButton.remove();a.background.remove()});this.showing=!1},initEvent:function(){var a=this;this.background.bind(_event._down,function(b){a.hide();a.showing=!1});this.closeButton.bind(_event._end,function(b){a.hide();a.showing=!1});this.closeButton.bind("mouseover",function(b){a.closeButton.css({cursor:"pointer"})});
this.initLoopEvent()},initLoopEvent:function(){0>this.H5PlaybackNumber&&this.audio.$media.attr("loop","loop");0<this.H5PlaybackNumber&&this.audio.bind("ended",function(){this.playCount++;0<this.H5PlaybackNumber&&this.playCount<=this.H5PlaybackNumber&&this.play()}.bind(this));this.audio.$media.bind("play",function(){this.playCount>this.H5PlaybackNumber&&(this.playCount=0)}.bind(this))},play:function(){if(null!=this.audio)try{this.autoPlayAgain&&this.audio.setCurrentTime(0),this.audio.play()}catch(a){}},
pause:function(){if(null!=this.audio)try{this.audio.pause()}catch(a){}},stop:function(){if(null!=this.audio)try{this.audio.pause(),this.audio.setCurrentTime(0)}catch(a){}},isPlaying:function(){return this.audio&&this.audio.$media[0]?!this.audio.$media[0].paused:!1},getPlayEvt:function(){return this.config.soundPlayTriggerEvt},getStopEvt:function(){return this.config.soundStopTriggerEvt}}).extend("Item");
Class("Image",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b,c,d);this.animateConfig();this.config.imageScaleType||(this.config.imageScaleType=!1);this.pageWidth=c;this.pageHeight=d;this.left=this.pageWidth*this.config.x;this.top=this.pageHeight*this.config.y;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.scaleWidth=this.width;this.pageScale=this.pageWidth/this.config.pageW;this.isFirst=!0;this.config.src&&(this.imageEnd=this.config.src.slice(this.config.src.lastIndexOf(".")+
1));parseBool(this.config.shadow.hasDropShadow)&&(this.config.hasShadow=!0);this.initImage();this.initImageResource();this.initImageLoadEvents();this.initEvents();this.config.hasShadow&&this.addShadow(this.image);this.onResize(this.pageWidth,this.pageHeight)},initImage:function(){this.container=$("<div style='position: absolute;'></div>");this.image=$("<img style='position: absolute'/>");this.imageBorder=$("<div class = 'bubble expose-square-solid' style='position: absolute;width: 100%;height: 100%;'></div>");
this.container.append(this.image);this.parent.append(this.container);this.container.append(this.imageBorder);this.container.css({opacity:this.config.alpha});parseBool(this.config.popUpImage)||"0"!=this.config.mouseover||this.config.action||this.container.css({"pointer-events":"none"});this.setRotation(this.container,this.config.rotation);this.image.css({"z-index":"0",top:0,bottom:0,left:0,right:0,position:"absolute"});if(isPhone()||isPad())bookConfig.isStopMouseMenu?(this.imageBorder.css({"pointer-events":"none"}),
this.image.css({"-webkit-touch-callout":"none"})):(this.imageBorder.css({"pointer-events":"none"}),this.image.css({"-webkit-touch-callout":"default"}));this.imageBorder.css({"z-index":"1",margin:"auto",top:0,bottom:0,left:0,right:0,position:"absolute",display:"none"});parseBool(this.config.reflection)&&(1==supports("boxReflect")?this.imageReflection(this.image):this.addCanvasReflection());this.config.mouseOver==PageEditor.MouseOverType.AddBorder?this.initLinkHint(this.imageBorder):this.initLinkHint(this.image)},
removeImgSrc:function(){"gif"==this.imageEnd&&(this.container.css({display:"none"}),this.image.attr("src",""))},resetImgSrc:function(){"gif"==this.imageEnd&&(this.container.css({display:"block"}),this.image.attr("src",this.config.src))},initImageResource:function(){if(this.config.src){"gif"==this.imageEnd&&this.container.css({display:"none"});this.config.src=this.fixRelativePath(this.config.src);if(bookConfig.useTheAliCloudChart){var a=getCoverSize(this.width,this.height,1024,1024);isPhone()||isPad()?
this.config.src=this.config.imgOriginalProportions?this.getOssUrl(this.config.src,a.width,a.height,"lfit"):this.getOssUrl(this.config.src,a.width,a.height,"fixed"):this.config.src=this.config.imgOriginalProportions?this.getOssUrl(this.config.src,this.width,this.height,"lfit"):this.getOssUrl(this.config.src,this.width,this.height,"fixed")}this.image.attr("src",this.config.src)}},parseConfig:function(a){return{width:a.location.width,height:a.location.height,rotation:a.location.rotation,reflection:a.location.reflection,
reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,x:a.location.x,y:a.location.y,alpha:a.alpha,src:a.url,imgScale:a.imgScale,imgRotation:a.imgRotation,imgContX:a.imgContX,imgContY:a.imgContY,highlightsBool:parseBool(a.highlightsBool),highlightsLabel:a.highlightsLabel,originalURL:a.originalURL,action:a.action,mouseOver:a.mouseOverEffect,borderColor:a.borderColor,imgOriginalProportions:parseBool(a.imgOriginalProportions),popUpImage:parseBool(a.popUpImage),hint:a.hint,
pageW:a.location.pageWidth,pageH:a.location.pageHeight,effect:a.effect,imageScaleType:parseBool(a.imgScaleType),shadow:a.shadow,animation:a.animation}},initImageLoadEvents:function(){this.image.on("load",function(){var a=this.adjustImageSize(this.image[0]);this.imageWidth=a.width;this.imageHeight=a.height;this.image.css({width:this.imageWidth+"px",height:this.imageHeight+"px",left:(this.width-this.imageWidth)/2+"px",top:(this.height-this.imageHeight)/2+"px"});this.imageBorder.css({"border-color":Color(this.config.borderColor).toString(),
width:this.width+"px",height:this.height+"px"});this.container.css({left:this.left+"px",top:this.top+"px",width:this.width+"px",height:this.height+"px"});(isIphone()||isIpad())&&this.setContainerSize(this.image,this.imageWidth,this.imageHeight);this.elementConfig={elemWidth:this.imageWidth,elemHeight:this.imageHeight,x:this.left,y:this.top,pageWidth:this.pageWidth,pageHeight:this.pageHeight}}.bind(this));void 0==this.config.action&&(this.image[0].onerror=function(){this.container.css("display","none")}.bind(this))},
adjustImageSize:function(a){if(!a.naturalWidth||!a.naturalHeight)return{width:0,height:0};var b=a.naturalWidth;a=a.naturalHeight;if(0==this.config.imgOriginalProportions)return{width:this.width,height:this.height,imgNaturalWidth:parseInt(b),imgNaturalHeight:parseInt(a)};var c=Math.min(this.width/b,this.height/a);return{width:Math.floor(b*c),height:Math.floor(a*c),imgNaturalWidth:parseInt(b),imgNaturalHeight:parseInt(a)}},initEvents:function(){this.zoomImg=null;this.config.mouseOver==PageEditor.MouseOverType.AddBorder&&
(this.container.bind(isPhone()||isPad()?_event._down:_event._enter,function(a){this.imageBorder.css({display:"block"});this.visible=!0;this.image.animate({opacity:"0.8"},300)}.bind(this)),this.container.bind(isPhone()||isPad()?_event._up:_event._leave,function(a){this.imageBorder.css({display:"none"});this.image.animate({opacity:"1"},300);this.visible=!1}.bind(this)));this.config.mouseOver!=PageEditor.MouseOverType.Zoom||isPhone()||isPad()||this.image.mouseEnterZoom();(isPhone()||isPad()?this.image:
this.imageBorder).on(_event._click,function(a){BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),"Image",this.config.x,this.config.y,this.config.width,this.config.height]);bookConfig.googleAnalyticsID&&gtag("event","click",{event_category:"image",event_label:"Page"+BookInfo.getCurrentPages()[0]})}.bind(this));this.addActionEvent(this.container);this.addEffect();this.addHighLight()},resetUrl:function(){this.isResize=!0;var a=this.config.src.lastIndexOf("?");0<=a&&(this.config.src=this.config.src.slice(0,
a),this.config.src=this.fixRelativePath(this.config.src),bookConfig.useTheAliCloudChart&&(isPhone()||isPad()?(a=getCoverSize(this.width,this.height,1024,1024),this.config.src=this.config.imgOriginalProportions?this.getOssUrl(this.config.src,a.width,a.height,"lfit"):this.getOssUrl(this.config.src,a.width,a.height,"fixed")):this.config.src=this.config.imgOriginalProportions?this.getOssUrl(this.config.src,this.width,this.height,"lfit"):this.getOssUrl(this.config.src,this.width,this.height,"fixed")),
this.image.attr("src",this.config.src))},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.left=this.pageWidth*this.config.x;this.top=this.pageHeight*this.config.y;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.resetUrl();if(this.highLight)this.highLight.onResize(this.width,this.height);a=this.adjustImageSize(this.image[0]);this.imageWidth=a.width;this.imageHeight=a.height;this.image.css({width:this.imageWidth+"px",height:this.imageHeight+
"px",left:(this.width-this.imageWidth)/2+"px",top:(this.height-this.imageHeight)/2+"px"});this.imageBorder.css({width:this.width+"px",height:this.height+"px"});this.container.css({left:this.left+"px",top:this.top+"px",width:this.width+"px",height:this.height+"px"});this.resizeHint();(isIphone()||isIpad())&&this.setContainerSize(this.image,this.imageWidth,this.imageHeight)},showAnimate:function(){if((!this.config.effect||"null"===this.config.effect.effectType)&&this.config.animation&&this.config.animation.name){var a=
getAnimationEnd(),b=this.config.animation;this.container.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.container.one(a,function(){this.container.css({animation:""})}.bind(this))}},addHighLight:function(){this.config.highlightsBool&&(this.elementConfig={width:this.width,height:this.height},this.highLight=this.addHighLightEvent(this.container,this.elementConfig))},addEffect:function(){this.config.effect&&this.config.effect.effectType==PageEditor.Effect.FADEIN&&
this.image.css({display:"none"});this.image.on("load",function(){this.isResize&&!this.isFirst?this.isResize=!1:(this.isResize=this.isFirst=!1,this.elementConfig={elemWidth:this.imageWidth,elemHeight:this.imageHeight,parentWidth:this.width,parentHeight:this.height,x:this.left,y:this.top,pageWidth:this.pageWidth,pageHeight:this.pageHeight},this.addEffectEvent(this.image,this.elementConfig))}.bind(this))},hideEffect:function(){this.config.effect&&"null"!==this.config.effect.effectType&&this.imgEffect&&
this.imgEffect.hide()},showEffect:function(){if(this.config.effect&&"null"!==this.config.effect.effectType)if(this.image[0].complete&&this.imgEffect)this.imgEffect.show();else var a=setInterval(function(){this.image[0].complete&&(this.imgEffect&&this.imgEffect.show(),clearInterval(a),a=null)}.bind(this),200)},addCanvasReflection:function(){var a=new Image;a.src=this.config.src;$(a).on("load",function(){var b=document.createElement("canvas"),c=b.getContext("2d");this.container.append(b);var d=this.adjustImageSize(a[0]),
e=d.width;d=d.height;b.style.width=e+"px";b.style.height=d+"px";b.width=e;b.height=d;b.className="reflect";$(b).css({transform:"translateY("+d+"px)",margin:"auto",top:0,bottom:0,left:0,right:0,position:"absolute"});c.save();c.translate(0,d);c.scale(1,-1);c.drawImage(a,0,0,e,d);c.restore();c.globalCompositeOperation="destination-out";b=c.createLinearGradient(0,0,0,d);b.addColorStop(1,"rgba(255, 0, 0, 1.0)");b.addColorStop(0,"rgba(255, 0, 0, 0)");c.fillStyle=b;c.rect(0,0,e,2*d);c.fill()}.bind(this))}}).extend(PageItem.Item);
var HTML5ZoomImg=Class({create:function(a,b){var c=this;this.$container=$(b);b=this.$container.width();var d=this.$container.height();this.limitWidth=b;this.limitHeight=d;this.innerLimitWidth=606;this.innerLimitHeight=404;this.dragDivFalg=!0;this.dragImgFalg=!1;this.address=uiBaseURL;this.isFullFalg=!1;this.isOneToOneFalg=!0;this.scale=100;this.isMapShowFalg=!1;this.boxImgBG=$("<div style='position: absolute;margin: 0px;padding: 0px;border: 0px;left: 0px;top: 0px;background-color: #000000;opacity: 0;z-index: 99999;'></div>").css({width:b,
height:d}).appendTo(this.$container);this.outerBoxImg=$("<div class='fliphtml5-loading' style='position: absolute;margin: 0px;padding: 0px;border: 0px;left: 0px;top: 0px;overflow: hidden;z-index: 99999;'></div>").css({width:b,height:d}).appendTo(this.$container);this.innerBoxImg=$("<div style='position: absolute;overflow: hidden;cursor: pointer;background-color: rgba(0,0,0, 0.6);'></div>").css({boxShadow:"0px 0px 4px #000000"}).hide().appendTo(this.outerBoxImg);window.box=this.innerBoxImg;this.boxImgDiv=
$("<div class='fliphtml5-boxDiv' style='position: absolute;'></div>").appendTo(this.innerBoxImg);this.boxImg=$("<img style='position: absolute;width: 100%;height: 100%;padding: 0px;margin: 0px;'/>").appendTo(this.boxImgDiv);this.closeBox=$("<div style='position: absolute;left: auto;top: 0px;right: 0px;'></div>").append($("<img>",{src:this.address+"closeForm.png"})).appendTo(this.innerBoxImg);this.bindCloseBoxEvent();this.createControlBar(this.innerBoxImg);this.createImgMap(this.innerBoxImg);this.loadImg(a);
this.dragDiv();this.dragImage();isTouch||(this.innerBoxImg.transition3D(),this.boxImgDiv.transition3D(),this.mapPoint.transition3D());$(window).on("resize",function(){c.resize()});return this},bindCloseBoxEvent:function(){var a=this;a.closeBox.bind("mouseover",function(){a.closeBox.children("img").attr("src",a.address+"closeForm_down.png")});a.closeBox.bind("mouseout",function(){a.closeBox.children("img").attr("src",a.address+"closeForm.png")});a.closeBox.bind("click",function(){a.destroy()})},createControlBar:function(a){this.controlBar=
$("<div class='control' style='position: absolute;width: 106px;height: 48px;overflow: hidden;bottom: -50px;top: auto;left: 50%;margin-left: -53px;border-top-left-radius: 10px;border-top-right-radius: 10px;background-color: rgba(0,0,0,0.6)'></div>").css({boxShadow:"0px 0px 4px #000000"}).appendTo(a);this.oneToOne=$("<span class='one-to-one' style='position: absolute;'></span>").css({width:40,height:30,left:10,top:9,fontFamily:"serif",fontSize:28,lineHeight:"30px",color:"#7F8383",letterSpacing:"-5px",
textAlign:"center"}).html("1:1").appendTo(this.controlBar);this.fullScreen=$("<div class='FullScreen' style='position: absolute'></div>").css({width:40,height:30,left:56,top:9}).append($("<img>",{src:this.address+"enterFull.png",css:{marginLeft:6,marginTop:1}})).appendTo(this.controlBar);this.bindControlEvents()},bindControlEvents:function(){var a=this;isTouch?a.controlBar.css({bottom:2}).show():(this.innerBoxImg.bind("mouseover",function(){a.controlBar.stop(!1,!1).animate({bottom:2},400,"linear")}),
this.innerBoxImg.bind("mouseout",function(){a.controlBar.stop(!1,!1).animate({bottom:-50},400,"linear")}));this.oneToOne.bind("click",function(){a.boxImgDiv.css({width:a.originalSize.width,height:a.originalSize.height,left:(a.innerBoxImg.width()-a.originalSize.width)/2,top:(a.innerBoxImg.height()-a.originalSize.height)/2});a.innerBoxImg.width()>=a.boxImgDiv.width()&&a.innerBoxImg.height()>=a.boxImgDiv.height()?a.dragImgFalg=!1:a.dragImgFalg=!0;a.isFullFalg?a.dragDivFalg=!1:a.innerBoxImg.width()>=
a.boxImgDiv.width()&&a.innerBoxImg.height()>=a.boxImgDiv.height()?a.dragDivFalg=!0:a.dragDivFalg=!1;a.scale=100;a.isOneToOneFalg=a.isOneToOne();a.isMapShowFalg=a.isShowMap();a.setMapPoint()});this.oneToOne.bind("mouseover",function(){a.isOneToOneFalg||a.oneToOne.css({color:"#32B9EB"})});this.oneToOne.bind("mouseout",function(){a.isOneToOneFalg||a.oneToOne.css({color:"#ffffff"})});this.fullScreen.bind("click",function(){var b=parseInt(a.boxImgDiv.css("left")),c=parseInt(a.boxImgDiv.css("top")),d=a.boxImgDiv.width(),
e=a.boxImgDiv.height(),f=a.innerBoxImg.width(),g=a.innerBoxImg.height();a.isFullFalg?(a.innerBoxImg.css({width:Math.max(a.innerLimitWidth,a.result.width),height:Math.max(a.innerLimitHeight,a.result.height),left:Math.max(0,(a.outerBoxImg.width()-Math.max(a.innerLimitWidth,a.result.width))/2),top:Math.max(0,(a.outerBoxImg.height()-Math.max(a.innerLimitHeight,a.result.height))/2)}),a.boxImgDiv.css({left:a.innerBoxImg.width()>=d?(a.innerBoxImg.width()-d)/2:Math.max(a.innerBoxImg.width()-d,b+(a.innerBoxImg.width()-
f)/2),top:a.innerBoxImg.height()>=e?(a.innerBoxImg.height()-e)/2:Math.max(a.innerBoxImg.height()-e,c+(a.innerBoxImg.height()-g)/2)}),a.innerBoxImg.width()>=a.boxImgDiv.width()&&a.innerBoxImg.height()>=a.boxImgDiv.height()?a.dragDivFalg=!0:a.dragDivFalg=!1,a.isFullFalg=!1,a.fullScreen.children("img").attr("src",a.address+"enterFull.png")):(a.innerBoxImg.css({width:a.$container.width(),height:a.$container.height(),left:0,top:0}),a.boxImgDiv.css({left:a.innerBoxImg.width()>=d?(a.innerBoxImg.width()-
d)/2:Math.max(a.innerBoxImg.width()-d,b+(f-a.innerBoxImg.width())/2),top:a.innerBoxImg.height()>=e?(a.innerBoxImg.height()-e)/2:Math.max(a.innerBoxImg.height()-e,c+(g-a.innerBoxImg.height())/2)}),a.isFullFalg=!0,a.dragDivFalg=!1,a.fullScreen.children("img").attr("src",a.address+"exitFull.png"));a.innerBoxImg.width()>=a.boxImgDiv.width()&&a.innerBoxImg.height()>=a.boxImgDiv.height()?a.dragImgFalg=!1:a.dragImgFalg=!0;a.isShowMap();a.setMapPoint()});this.fullScreen.bind("mouseover",function(){a.isFullFalg?
a.fullScreen.children("img").attr("src",a.address+"exitFull_over.png"):a.fullScreen.children("img").attr("src",a.address+"enterFull_over.png")});this.fullScreen.bind("mouseout",function(){a.fullScreen.children("img").attr("src",a.address+"exitFull.png")})},isOneToOne:function(){if(this.originalSize.width==this.boxImgDiv.width()&&this.originalSize.height==this.boxImgDiv.height())return this.oneToOne.css({color:"#7F8383"}),!0;this.oneToOne.css({color:"#ffffff"});return!1},loadImg:function(a){var b=
this,c=new Image;c.onload=function(){c.onload=c.onerror=null;var d=this.width,e=this.height,f=b.selectWidthAdHeight(d,e);b.outerBoxImg.removeClass("fliphtml5-loading");b.boxImgDiv.css({width:f.width,height:f.height});b.innerBoxImg.css({width:Math.max(b.innerLimitWidth,f.width),height:Math.max(b.innerLimitHeight,f.height),left:Math.max(0,(b.outerBoxImg.width()-Math.max(b.innerLimitWidth,f.width))/2),top:-Math.max(b.innerLimitHeight,f.height)-240});b.innerBoxImg.show().animate({top:Math.max(0,(b.outerBoxImg.height()-
Math.max(b.innerLimitHeight,f.height))/2)},{duration:500,easing:"linear"});b.boxImgDiv.css({width:f.width,height:f.height,left:Math.max(0,(b.innerBoxImg.width()-f.width)/2),top:Math.max(0,(b.innerBoxImg.height()-f.height)/2)});b.originalSize={width:d,height:e};b.result=f;b.isOneToOneFalg=b.isOneToOne();isTouch?b.zoomInPad():b.mouseZoom();b.setMapImg(d,e)};c.onerror=function(){c.onload=c.onerror=null;b.outerBoxImg.removeClass("fliphtml5-loading");var d=b.selectWidthAdHeight(18,20);b.boxImgDiv.css({width:d.width,
height:d.height});b.innerBoxImg.css({width:Math.max(b.innerLimitWidth,d.width),height:Math.max(b.innerLimitHeight,d.height),left:Math.max(0,(b.outerBoxImg.width()-Math.max(b.innerLimitWidth,d.width))/2),top:-Math.max(b.innerLimitHeight,d.height)-240});b.innerBoxImg.show().animate({top:Math.max(0,(b.outerBoxImg.height()-Math.max(b.innerLimitHeight,d.height))/2)},{duration:500,easing:"linear"});b.boxImgDiv.css({width:d.width,height:d.height,left:Math.max(0,(b.innerBoxImg.width()-d.width)/2),top:Math.max(0,
(b.innerBoxImg.height()-d.height)/2)});b.originalSize={width:18,height:20};b.result=d;b.isOneToOneFalg=b.isOneToOne();isTouch?b.zoomInPad():b.mouseZoom();b.setMapImg(18,20)};c.src=a;b.boxImg.attr("src",a);b.mapImg.attr("src",a)},selectWidthAdHeight:function(a,b){var c={},d=a/b,e=this.limitWidth,f=this.limitHeight;e>=a&&f<b?(c.width=d*f,c.height=f):e<a&&f>=b?(c.width=e,c.height=e/d):e<a&&f<b?e/d<=f?(c.width=e,c.height=e/d):d*f<=e?(c.width=d*f,c.height=f):console&&console.log("Do not be so wonderful picture of uncle!"):
(c.width=a,c.height=b);return c},dragDiv:function(){var a=this,b=a.innerBoxImg,c=$(document),d=!0,e,f,g,h;a.innerBoxImg.bind(_event._down,function(k){k=isTouch?k.originalEvent.touches:[k];1==k.length?d=!0:2<=k.length&&(d=!1);stopEvent(k[0])});b.bind(_event._down,function(k){a.dragDivFalg&&(k=isTouch?k.originalEvent.touches[0]:k,isTouch||(k.preventDefault(),k.stopPropagation()),e=b[0].offsetLeft,f=b[0].offsetTop,g=k.clientX,h=k.clientY,c.bind(_event._move,function(l){d&&(l=isTouch?l.originalEvent.touches[0]:
l,isTouch||(l.preventDefault(),l.stopPropagation()),b.css({left:e+l.clientX-g,top:f+l.clientY-h}))}),c.bind(_event._end,function(l){l=isTouch?l.originalEvent.touches[0]:l;isTouch||(l.preventDefault(),l.stopPropagation());d=!0;c.unbind(_event._move)}))})},mouseZoom:function(){var a=this,b=a.scale,c=a.result,d=c.width,e=c.height;a.innerBoxImg.bind(_agent_.browser.mozilla?"DOMMouseScroll":"mousewheel",function(f){b=a.scale;f=f.originalEvent;f=f.wheelDelta||-f.detail;0<f?b+=.2*b:0>f&&(b-=.17*b);5>b?b=
5:1600<b&&(b=1600);var g=a.boxImgDiv.width();var h=a.boxImgDiv.height();f=d*b/100;var k=e*b/100;if(f<a.innerBoxImg.width())var l=(a.innerBoxImg.width()-d*b/100)/2;else l=parseInt(a.boxImgDiv.css("left")),l+=(g-f)/2,0<=l?l=0:l<=a.innerBoxImg.width()-f&&(l=a.innerBoxImg.width()-f);k<a.innerBoxImg.height()?h=(a.innerBoxImg.height()-e*b/100)/2:(g=parseInt(a.boxImgDiv.css("top")),h=g+(h-k)/2,0<=h?h=0:h<=a.innerBoxImg.height()-k&&(h=a.innerBoxImg.height()-k));a.scale=b;a.boxImgDiv.animate({width:f,height:k,
left:l,top:h},{duration:100,easing:"linear",complete:function(){a.isOneToOneFalg=a.isOneToOne();a.isMapShowFalg=a.isShowMap();a.setMapPoint();a.isFullFalg?(a.dragDivFalg=!1,a.boxImgDiv.width()>a.innerBoxImg.width()||a.boxImgDiv.height()>a.innerBoxImg.height()?a.dragImgFalg=!0:a.dragImgFalg=!1):a.boxImgDiv.width()>a.innerBoxImg.width()||a.boxImgDiv.height()>a.innerBoxImg.height()?(a.dragDivFalg=!1,a.dragImgFalg=!0):(a.dragDivFalg=!0,a.dragImgFalg=!1)}})})},zoomInPad:function(){var a=this,b=a.result,
c=b.width,d=b.height,e,f,g,h,k,l=!1;a.boxImgDiv[0].addEventListener("touchstart",function(m){if(2<=m.touches.length){l=!0;var n=m.touches[0].pageX,q=m.touches[0].pageY,p=m.touches[1].pageX;m=m.touches[1].pageY;e=a.boxImgDiv.position().left;f=a.boxImgDiv.position().top;g=a.boxImgDiv.width();h=a.boxImgDiv.height();k=Math.sqrt(Math.pow(p-n,2)+Math.pow(m-q,2))}},!1);document.addEventListener("touchmove",function(m){if(l){if(2<=m.touches.length){var n=Math.sqrt(Math.pow(m.touches[1].pageX-m.touches[0].pageX,
2)+Math.pow(m.touches[1].pageY-m.touches[0].pageY,2))/k;m=g*n;n*=h;var q=(g-m)/2+e,p=(h-n)/2+f;m<a.innerBoxImg.width()?q=(a.innerBoxImg.width()-m)/2:0<=q?q=0:q<=a.innerBoxImg.width()-m&&(q=a.innerBoxImg.width()-m);n<a.innerBoxImg.height()?p=(a.innerBoxImg.height()-n)/2:0<=p?p=0:p<=a.innerBoxImg.height()-n&&(p=a.innerBoxImg.height()-n);a.boxImgDiv.width(m).height(n).css({left:q,top:p});a.isOneToOneFalg=a.isOneToOne();a.isMapShowFalg=a.isShowMap();a.setMapPoint();a.boxImgDiv.width()>c||a.boxImgDiv.height()>
d?(a.dragDivFalg=!1,a.dragImgFalg=!0):(a.dragDivFalg=!0,a.dragImgFalg=!1)}}else m.preventDefault()},!1);document.addEventListener("touchend",function(m){l=!1},!1);document.body.addEventListener("touchmove",function(m){m.preventDefault()},!1)},dragImage:function(){var a=this,b=a.boxImgDiv,c=$(document),d=!0,e,f,g,h;a.innerBoxImg.bind(_event._down,function(k){k=isTouch?k.originalEvent.touches:[k];1==k.length?d=!0:2<=k.length&&(d=!1);stopEvent(k[0])});b.bind(_event._down,function(k){a.dragImgFalg&&(k=
isTouch?k.originalEvent.touches[0]:k,b.addClass("dragging"),e=b[0].offsetLeft,f=b[0].offsetTop,g=k.clientX,h=k.clientY,c.bind(_event._move,function(l){l=isTouch?l.originalEvent.touches[0]:l;if(d){var m=e+l.clientX-g;l=f+l.clientY-h;0<=m?m=0:m<=a.innerBoxImg.width()-a.boxImgDiv.width()&&(m=a.innerBoxImg.width()-a.boxImgDiv.width());0<=l?l=0:l<=a.innerBoxImg.height()-a.boxImgDiv.height()&&(l=a.innerBoxImg.height()-a.boxImgDiv.height());b.width()>a.innerBoxImg.width()&&(b.css({left:m}),a.mapPoint.css({left:-m/
(a.boxImgDiv.width()-a.innerBoxImg.width())*(a.mapDiv.width()-a.mapPoint.outerWidth())}));b.height()>a.innerBoxImg.height()&&(b.css({top:l}),a.mapPoint.css({top:-l/(a.boxImgDiv.height()-a.innerBoxImg.height())*(a.mapDiv.height()-a.mapPoint.outerHeight())}))}}),c.bind(_event._end,function(l){c.unbind(_event._move);b.removeClass("dragging");d=!0}))})},resize:function(){var a=this.$container.width(),b=this.$container.height();this.boxImgBG.css({width:a,height:b});this.outerBoxImg.css({width:a,height:b});
this.isFullFalg?(this.innerBoxImg.css({width:a,height:b}),this.boxImgDiv.css({left:(a-this.boxImgDiv.width())/2,top:(b-this.boxImgDiv.height())/2}),this.setMapPoint()):this.innerBoxImg.css({left:(a-this.innerBoxImg.width())/2,top:(b-this.innerBoxImg.height())/2})},destroy:function(){var a=this;parseInt(a.innerBoxImg.css("left"));parseInt(a.innerBoxImg.css("top"));var b=a.innerBoxImg.width(),c=a.innerBoxImg.height(),d,e,f,g,h;$({k:100}).animate({k:0},{duration:400,easing:"linear",step:function(k,l){h=
k/100;d=(c-h*c)/2;g=(b-h*b)/2;e=b-g;f=c-d;a.innerBoxImg[0].style.clip="rect("+d+"px, "+e+"px, "+f+"px, "+g+"px)"},complete:function(){a.boxImgBG.remove();a.outerBoxImg.remove()}})},createImgMap:function(a){this.map=$("<div class='ImageMap' style='position: absolute;left: auto;top: auto;right: 2px;bottom: 2px;width: 210px;height: 130px;overflow: hidden;border-radius: 4px;'></div>").css({boxShadow:"inset 1px 1px 0 rgba(0,0,0,.1),inset 0 -1px 0 rgba(0,0,0,.07)",backgroundColor:"rgba(0,0,0,.6)"}).hide().appendTo(a);
this.mapDiv=$("<div style='position: absolute;margin: 0px;padding: 0px;border: 0px;overflow: hidden;'></div>").appendTo(this.map);this.mapImg=$("<img style='position: absolute;width: 100%;height: 100%;left: 0px;top: 0px;padding: 0px;margin: 0px;border: 0px;'/>").appendTo(this.mapDiv);this.mapPoint=$("<div style='position: absolute;margin: 0px;padding: 0px;border: 2px solid #58AA38;width: 100%;height: 100%;'></div>").css({boxShadow:"inset 1px 1px 0 #ffffff,inset 0 -1px 0 #ffffff,inset -1px 0px 0 #ffffff"}).appendTo(this.mapDiv);
this.closeMap=$("<div style='position: absolute;left: auto;top: 0px;right: 0px;'></div>").append($("<img>",{src:this.address+"closeForm.png"})).appendTo(this.map);this.bindCloseMapEvent();this.dragMapPoint()},bindCloseMapEvent:function(){var a=this;a.closeMap.bind("mouseover",function(){a.closeMap.children("img").attr("src",a.address+"closeForm_down.png")});a.closeMap.bind("mouseout",function(){a.closeMap.children("img").attr("src",a.address+"closeForm.png")});a.closeMap.bind("click",function(){a.destroyMap()})},
setMapImg:function(a,b){var c=this.map.width(),d=this.map.height();a/=b;b=d*a;var e=c/a;if(b>c){var f=c;var g=e;var h=0;var k=(d-e)/2}else e>d?(f=b,g=d,h=(c-b)/2,k=0):b/e==a&&(f=b,g=e,k=h=0);this.mapDiv.css({width:f,height:g,left:h,top:k})},setMapPoint:function(){var a=Math.min(this.mapDiv.width(),this.innerBoxImg.width()*this.mapDiv.width()/this.boxImgDiv.width())-4,b=Math.min(this.mapDiv.height(),this.innerBoxImg.height()*this.mapDiv.height()/this.boxImgDiv.height())-4,c=-parseInt(this.boxImgDiv.css("left"))/
(this.boxImgDiv.width()-this.innerBoxImg.width())*(this.mapDiv.width()-(a+4)),d=-parseInt(this.boxImgDiv.css("top"))/(this.boxImgDiv.height()-this.innerBoxImg.height())*(this.mapDiv.height()-(b+4));this.mapPoint.css({left:c,top:d,width:a,height:b})},isShowMap:function(){if(this.innerBoxImg.width()>=this.boxImgDiv.width()&&this.innerBoxImg.height()>=this.boxImgDiv.height())return this.map.hide(),!0;this.map.show();return!1},dragMapPoint:function(){var a=this,b=a.mapPoint,c=$(document),d,e,f,g;b.bind(_event._down,
function(h){h=isTouch?h.originalEvent.touches[0]:h;d=b[0].offsetLeft;e=b[0].offsetTop;f=h.clientX;g=h.clientY;c.bind(_event._move,function(k){k=isTouch?k.originalEvent.touches[0]:k;var l=d+k.clientX-f;k=e+k.clientY-g;0>=l?l=0:l>=a.mapDiv.width()-a.mapPoint.outerWidth()&&(l=a.mapDiv.width()-a.mapPoint.outerWidth());0>=k?k=0:k>=a.mapDiv.height()-a.mapPoint.outerHeight()&&(k=a.mapDiv.height()-a.mapPoint.outerHeight());b.width()<a.mapDiv.width()&&(b.css({left:l}),a.boxImgDiv.css({left:-l/(a.mapDiv.width()-
a.mapPoint.outerWidth())*(a.boxImgDiv.width()-a.innerBoxImg.width())}));b.height()<a.mapDiv.height()&&(b.css({top:k}),a.boxImgDiv.css({top:-k/(a.mapDiv.height()-a.mapPoint.outerHeight())*(a.boxImgDiv.height()-a.innerBoxImg.height())}))});c.bind(_event._end,function(k){c.unbind(_event._move)})})},destroyMap:function(){var a=this;parseInt(a.map.css("right"));parseInt(a.map.css("bottom"));var b=a.map.width(),c=a.map.height(),d,e,f,g,h;$({k:100}).animate({k:0},{duration:400,easing:"linear",step:function(k,
l){h=k/100;d=(c-h*c)/2;g=(b-h*b)/2;e=b-g;f=c-d;a.map[0].style.clip="rect("+d+"px, "+e+"px, "+f+"px, "+g+"px)"},complete:function(){a.map.remove()}})}});
Class("Line",{Package:"PageItem",SOLID:"Solid line",DOTTED:"Dotted line",create:function(a,b,c,d,e){this._super(a,b,c,d);this.id="line"+e;this.animateConfig();this.initConfig();this.initCanvas();parseBool(this.config.reflection)&&this.imageReflection(this.line);this.onResize(c,d)},initConfig:function(){this.color=Color(this.config.color);this.lineWidth=Number(this.config.lineWidth);this.lineType=this.config.lineType;this.config.originWidth||(this.config.originWidth=this.pageWidth);this.config.originHeight||
(this.config.originHeight=this.pageHeight);var a=this.config.originWidth*this.config.width,b=this.config.originHeight*this.config.height;this.config.startX/=a;this.config.startY/=b;this.config.endX/=a;this.config.endY/=b;this.dotWidth=Number(this.config.dotWidthRation*this.config.originWidth);this.dashGap=Number(this.config.dotGrapRation*this.config.originWidth);this.dotWidth&&this.dashGap||(this.lineType=this.SOLID);this.extraWidth=this.lineWidth},initCanvas:function(){this.line=$("<canvas id="+
this.id+"></canvas>");this.line.css({opacity:this.config.lineAlpha,position:"absolute"});this.setRotation(this.line,this.config.rotation);this.parent.append(this.line)},parseConfig:function(a){return{originWidth:a.location.pageWidth,originHeight:a.location.pageHeight,startX:a.lineStartPX,startY:a.lineStartPY,rotation:a.location.rotation,endX:a.lineEndPX,endY:a.lineEndPY,x:a.location.x,y:a.location.y,width:0>=parseFloat(a.location.width)?.01:parseFloat(a.location.width),height:0>=parseFloat(a.location.height)?
.01:parseFloat(a.location.height),lineAlpha:a.lineAlpha,alpha:a.alpha,lineWidth:a.lineWidth,reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,lineType:a.lineType,dotWidth:a.dotWidth,dotWidthRation:a.dotWidthRation,dotGrapRation:a.dotGrapRation,color:a.color,sh:parseBool(a.shadow.hasDropShadow),sa:a.shadow.shadowAngle,sx:a.shadow.shadowBlurX,sy:a.shadow.shadowBlurY,se:a.shadow.shadowDistance,sr:a.shadow.shadowColor,animation:a.animation}},
onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.config.width*this.pageWidth+this.extraWidth;this.height=this.config.height*this.pageHeight+this.extraWidth;this.left=this.config.x*this.pageWidth-this.extraWidth/2;this.top=this.config.y*this.pageHeight-this.extraWidth/2;this.line.attr("width",this.width+"px");this.line.attr("height",this.height+"px");this.line.css({left:this.left+"px",top:this.top+"px"});this.draw()},draw:function(){this.initParams();var a=this.getContext();
a&&(a.clearRect(0,0,this.width,this.height),a.beginPath(),this.lineType==this.SOLID&&this.drawLine(a),this.lineType==this.DOTTED&&this.drawDotLine(a),this.config.sh&&this.setShapeShadow(a),a.stroke())},initParams:function(){function a(c,d){return Number.between(c*d,b,d-b)}var b=this.extraWidth/2;this.startX=a(this.config.startX,this.width);this.startY=a(this.config.startY,this.height);this.endX=a(this.config.endX,this.width);this.endY=a(this.config.endY,this.height)},getContext:function(){var a=this.line[0];
try{var b=a.getContext("2d");b.fillStyle="#00000000";b.lineCap="round";b.lineJoin="round";b.lineWidth=this.lineWidth;b.globalAlpha=this.config.alpha;b.strokeStyle=this.color.toString();return b}catch(c){return null}},drawLine:function(a){a.moveTo(this.startX,this.startY);a.lineTo(this.endX,this.endY)},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.line.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+
"s "+b.count+" "+b.direction});this.line.one(a,function(){this.line.css({animation:""})}.bind(this))}},drawDotLine:function(a){var b=this.endX-this.startX,c=this.endY-this.startY,d=Math.sqrt(b*b+c*c),e=b/d;d=c/d;for(var f=this.startX,g=this.startY;;){a.moveTo(f,g);var h=this.dotWidth*e,k=this.dotWidth*d;f+=h;g+=k;f=0<b?Math.min(f,this.endX):Math.max(f,this.endX);g=0<c?Math.min(g,this.endY):Math.max(g,this.endY);a.lineTo(f,g);h=this.dashGap*e;k=this.dashGap*d;f+=h;g+=k;if(0<=b){if(f>this.endX)break}else if(f<
this.endX)break;if(0<=c){if(g>this.endY)break}else if(g<this.endY)break}}}).extend("Item");
Class("Arrow",{Package:"PageItem",SINGLE:"Single Arrow",DOUBLE:"Double Arrow",create:function(a,b,c,d,e){this._super(a,b,c,d);this.id="arrow"+e;this.line.attr("id",this.id)},initConfig:function(){this._super();this.arrowType=this.config.arrowType;this.extraWidth=4*this.lineWidth},parseConfig:function(a){return{originWidth:a.location.pageWidth,originHeight:a.location.pageHeight,startX:a.lineStartPX,startY:a.lineStartPY,rotation:a.location.rotation,endX:a.lineEndPX,endY:a.lineEndPY,x:a.location.x,y:a.location.y,
width:a.location.width,height:a.location.height,arrowType:a.arrowType,alpha:a.alpha,lineAlpha:a.lineAlpha,lineWidth:a.lineWidth,reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,lineType:a.lineType,dotWidth:a.dotWidth,dotWidthRation:a.dotWidthRation,dotGrapRation:a.dotGrapRation,color:a.color,sh:parseBool(a.shadow.hasDropShadow),sa:a.shadow.shadowAngle,sx:a.shadow.shadowBlurX,sy:a.shadow.shadowBlurY,se:a.shadow.shadowDistance,sr:a.shadow.shadowColor,
animation:a.animation}},draw:function(){this._super();var a=this.getContext();a&&this.drawArrow(a)},drawArrow:function(a){var b=this.endX-this.startX,c=this.endY-this.startY,d=Math.sqrt(b*b+c*c),e=2.5*this.lineWidth;b=b/d*e;c=c/d*e;this.drawArrowOnPoint(a,Point(this.endX,this.endY),-b,-c);this.arrowType==this.DOUBLE&&this.drawArrowOnPoint(a,Point(this.startX,this.startY),b,c)},drawArrowOnPoint:function(a,b,c,d){this.drawArrowLine(a,b,c,d,35);this.drawArrowLine(a,b,c,d,-35)},drawArrowLine:function(a,
b,c,d,e){a.save();a.translate(b.getX(),b.getY());a.rotate(e*Math.PI/180);a.beginPath();a.moveTo(0,0);a.lineTo(c,d);this.config.sh&&this.setShapeShadow(a);a.stroke();a.restore()}}).extend("Line");
Class("Link",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b,c,d);this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.initLinkColor();this.initLink();this.initEvents();this.initLinkHint(this.link);this.onResize(this.pageWidth,this.pageHeight)},initLinkColor:function(){void 0==this.config.downColor?(this.config.downColor=bookConfig.LinkDownColor?Color(bookConfig.LinkDownColor):Color("#808080"),this.config.downAlpha=bookConfig.LinkAlpha?bookConfig.LinkAlpha:
.6,this.config.overColor=this.config.downColor,this.config.outColor=this.config.downColor,this.config.overAlpha=this.config.downAlpha/2,this.config.outAlpha=0):(this.config.downColor=Color(this.config.downColor),this.config.overColor=Color(this.config.overColor),this.config.outColor=Color(this.config.outColor),parseBool(this.config.hint)&&(this.config.hint.hintShapeColor=Color(this.config.hint.hintShapeColor),this.config.hint.hintShapeColor2=Color(this.config.hint.hintShapeColor2)))},initLink:function(){this.container=
$("<div class='expose-square-solid' style='position:absolute;'></div>");this.link=$("<div class='expose-square-solid' style='position: absolute;'></div>");this.link.css({"border-color":"rgba(0,0,0,0)","background-color":this.config.outColor.rgba(this.config.outAlpha)});this.config.alpha&&this.link.css({opacity:this.config.alpha});this.config.ellipseW&&this.link.css({"border-radius":this.config.ellipseW+"px"});this.setRotation(this.link,this.config.rotation);this.container.append(this.link);this.parent.append(this.container)},
flash:function(){"false"!=this.config.pageViewedBool&&(this.flashTimer&&this.flashTimer.stop(),this.flashTimer=function(a,b){if(a==b)this.link.css({"background-color":this.config.outColor.rgba(this.config.outAlpha)});else{b=Math.ceil(b/2);var c=a%b,d=Math.min(this.config.outAlpha,this.config.overAlpha),e=Math.max(this.config.outAlpha,this.config.overAlpha),f=e-d;fAlpha=a<b?d+c*f/b:e-c*f/b;this.link.css({"background-color":this.config.overColor.rgba(fAlpha)})}}.animation(this,1E3))},stopFlash:function(){this.flashTimer&&
(this.flashTimer.stop(),this.link.css({"background-color":this.config.outColor.rgba(this.config.outAlpha)}))},parseConfig:function(a){return{isInverse:a.isInverse,type:"link",width:0>a.location.width?-a.location.width:a.location.width,height:0>a.location.height?-a.location.height:a.location.height,rotation:a.location.rotation,x:0>a.location.width?parseFloat(a.location.x)+parseFloat(a.location.width):a.location.x,y:0>a.location.height?parseFloat(a.location.y)+parseFloat(a.location.height):a.location.y,
alpha:a.alpha,ellipseH:a.ellipseH,ellipseW:a.ellipseW,downColor:a.downColor,downAlpha:a.downAlpha,overColor:a.overColor,overAlpha:a.overAlpha,outColor:a.outColor,outAlpha:a.outAlpha,action:a.action,hint:a.hint,borderColor:a.borderColor,mouseOver:a.mouseOver,highlightsBool:parseBool(a.highlightsBool),highlightsLabel:a.highlightsLabel,pageViewedBool:a.pageViewedBool}},initEvents:function(){function a(){this.stopFlash();this.link.css({"background-color":d.rgba(this.config.outAlpha)})}var b=this.config.overColor,
c=this.config.downColor,d=this.config.outColor,e="";this.config.action&&this.config.action.actionType==PageEditor.ActionType.OPEN_URL&&(e=" url:"+this.config.action.url);this.link.bind(_event._down,function(f){this.stopFlash();bookConfig.googleAnalyticsID&&gtag("event","click",{event_category:"Link",event_label:"Page"+BookInfo.getCurrentPages()[0]+" "+e});BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),"Link",this.config.x,this.config.y,this.config.width,this.config.height]);this.link.css({"background-color":c.rgba(this.config.downAlpha)})}.bind(this));
this.link.bind(_event._up,function(f){this.stopFlash();this.link.css({"background-color":b.rgba(this.config.overAlpha)})}.bind(this));this.link.bind("mouseenter",function(f){this.stopFlash();parseBool(this.config.mouseOver)&&(this.link.css({"-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box",border:"2px solid "+Color(this.config.borderColor).toString()}),this.link.animate({borderWidth:"5px"},function(){this.link.animate({borderWidth:"2px"})}.bind(this)));this.link.css({"background-color":b.rgba(this.config.overAlpha)})}.bind(this));
this.link.bind(isTouch?_event._end:"mouseleave",function(f){_agent_.browser.device==_agent_.browser.DEVICE_PC?a.apply(this):a.delay(this,200)}.bind(this));this.addActionEvent(this.container);this.addHighLight()},addHighLight:function(){this.config.highlightsBool&&(this.elementConfig={width:this.width,height:this.height},this.highLight=this.addHighLightEvent(this.container,this.elementConfig))},setPageBgImage:function(a,b,c){this.bgImageWidth=a;this.bgImageHeight=b;(this.pageIsStrech=c)||this.initLinkCss()},
initLinkCss:function(){var a=this.bgImageWidth/this.bgImageHeight;if(.1<=Math.abs(a-this.pageWidth/this.pageHeight)){var b=this.pageWidth;a=b/a;this.left=b*this.config.x;this.top=(this.pageHeight-a)/2+a*this.config.y}else b=this.pageWidth,a=this.pageHeight,this.left=this.pageWidth*this.config.x,this.top=this.pageHeight*this.config.y;this.width=b*this.config.width;this.height=a*this.config.height;2>this.width&&(this.width=2);2>this.height&&(this.height=2);this.link.css({width:this.width+"px",height:this.height+
"px"});this.container.css({width:this.width+"px",height:this.height+"px"})},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;!this.pageIsStrech&&this.bgImageWidth&&this.bgImageHeight?this.initLinkCss():(this.left=a*this.config.x,this.top=b*this.config.y,this.width=a*this.config.width,this.height=b*this.config.height,2>this.width&&(this.width=2),2>this.height&&(this.height=2));if(this.highLight)this.highLight.onResize(this.width,this.height);this.setPosition(this.left,this.top);this.link.css({width:this.width+
"px",height:this.height+"px"});this.container.css({width:this.width+"px",height:this.height+"px"});this.resizeHint()},setPosition:function(a,b){this.container.css({left:a+"px",top:b+"px"})}}).extend(PageItem.Item);
Class("Rectangle",{Package:"PageItem",create:function(a,b,c,d,e){this._super(a,b,c,d);this.animateConfig();this.id="rectangle"+e;this.color=Color(this.config.color).toString();this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.width=Number(this.config.width*this.pageWidth);this.height=Number(this.config.height*this.pageHeight);this.config.borderWidth=Number(this.config.borderWidth);this.colorA=Color(this.config.ColorA).toString();this.colorB=Color(this.config.ColorB).toString();
this.borderColor=Color(this.config.borderColor).toString();this.Re=$("<canvas width='"+this.width+"' height='"+this.height+"' id='"+this.id+"'></canvas>");this.Re.css({position:"absolute",opacity:this.config.alpha,left:this.x+"px",top:this.y+"px"});this.setRotation(this.Re,this.config.rotation);this.parent.append(this.Re);this.draw();this.initEvents();parseBool(this.config.reflection)&&this.imageReflection(this.Re)},parseConfig:function(a){return{width:a.location.width,height:a.location.height,x:a.location.x,
y:a.location.y,rotation:a.location.rotation,alpha:a.alpha,color:a.color,fillStyle:a.fillStyle,ColorA:a.gradientColorA,ColorB:a.gradientColorB,angle:a.angle,spalpha:a.spalpha,reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,borderWidth:a.borderWidth,borderColor:a.borderColor,borderAlpha:a.borderAlpha,sh:parseBool(a.shadow.hasDropShadow),sa:a.shadow.shadowAngle,sx:a.shadow.shadowBlurX,sy:a.shadow.shadowBlurY,se:a.shadow.shadowDistance,
sr:a.shadow.shadowColor,arrowType:a.arrowType,action:a.action,animation:a.animation}},draw:function(){var a=this.Re[0].getContext("2d");a.clearRect(0,0,this.Re[0].width,this.Re[0].height);a.beginPath();a.strokeStyle=Color(this.config.borderColor).toString();a.lineWidth=this.config.borderWidth;a.globalAlpha=this.config.spalpha;a.lineCap="round";a.lineJoin="round";var b=this.width-2*this.config.borderWidth-4,c=this.height-2*this.config.borderWidth-4;a.moveTo(4+this.config.borderWidth,4+this.config.borderWidth);
a.lineTo(b,4+this.config.borderWidth);a.lineTo(b,c);a.lineTo(4+this.config.borderWidth,c);a.lineTo(4+this.config.borderWidth,4+this.config.borderWidth);1==parseBool(this.config.sh)&&this.setShapeShadow(a);"gradient"==this.config.fillStyle?(b=a.createLinearGradient(this.config.borderWidth,this.config.borderWidth,this.config.borderWidth,this.height),b.addColorStop(0,this.colorA),b.addColorStop(1,this.colorB),a.fillStyle=b,a.fill()):"Pure"==this.config.fillStyle&&(a.fillStyle=this.color,a.fill());0!=
this.config.borderWidth&&a.stroke();a.closePath()},initEvents:function(){this.Re.onTap(function(a){BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),"Rectangle",this.config.x,this.config.y,this.config.width,this.config.height]);bookConfig.googleAnalyticsID&&gtag("event","click",{event_category:"Rectangle",event_label:"Page"+BookInfo.getCurrentPages()[0]})}.bind(this));this.addActionEvent(this.Re)},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.config.width*
this.pageWidth;this.height=this.config.height*this.pageHeight;this.Re.css({width:this.width+"px",height:this.height+"px"});this.setPosition()},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.Re.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.Re.one(a,function(){this.Re.css({animation:""})}.bind(this))}},setPosition:function(){this.left=this.config.x*this.pageWidth;
this.top=this.config.y*this.pageHeight;this.Re.css({left:this.left+"px",top:this.top+"px"})}}).extend(PageItem.Item);
Class("Round",{Package:"PageItem",create:function(a,b,c,d,e){this._super(a,b,c,d);this.animateConfig();this.parent=a;this.color=Color(this.config.color).toString();this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.id="round"+e;this.x1=this.x-10;this.y1=this.y-10;0>this.x-10&&(this.x1=0);0>this.y-10&&(this.y1=0);this.rounds=$("<canvas id="+this.id+" width="+(this.width+20)+" height="+
(this.height+20)+" style='opacity:"+this.config.alpha+";position: absolute;top:"+this.y1+"px;left:"+this.x1+"px'></canvas>");this.setRotation(this.rounds,this.config.rotation);this.initEvent();this.parent.append(this.rounds);this.roundcan(this.x,this.y,this.width,this.height,this.color,this.config.fillStyle,this.config.ColorA,this.config.ColorB,this.config.alpha,this.config.borderWidth,this.config.spalpha,this.config.borderColor,this.config.borderAlpha,this.config.sx,this.config.sy,this.config.se,
this.config.sr,this.config.sh,360-Number(this.config.angle));this.imageReflection(this.rounds)},parseConfig:function(a){return{x:a.location.x,y:a.location.y,rotation:a.location.rotation,width:a.location.width,height:a.location.height,alpha:a.alpha,fillStyle:a.fillStyle,color:a.color,ColorA:a.gradientColorA,ColorB:a.gradientColorB,angle:a.angle,spalpha:a.spalpha,reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,borderWidth:a.borderWidth,
borderColor:a.borderColor,borderAlpha:a.borderAlpha,sh:parseBool(a.shadow.hasDropShadow),sa:a.shadow.shadowAngle,sx:a.shadow.shadowBlurX,sy:a.shadow.shadowBlurY,se:a.shadow.shadowDistance,sr:a.shadow.shadowColor,action:a.action,animation:a.animation}},initEvent:function(){this.flag=0;this.linkURL="";if(null!=this.config.action){try{void 0!=this.config.action.length&&(this.config.action=this.config.action[0]),this.linkURL=this.config.action.url}catch(a){}null!=this.linkURL&&"www"==this.linkURL.substr(0,
3).toLowerCase()&&(this.linkURL="http://"+this.linkURL);this.rounds.onTap(function(a){BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),"Round",this.config.x,this.config.y,this.config.width,this.config.height]);bookConfig.googleAnalyticsID&&gtag("event","click",{event_category:"Round",event_label:"Page"+BookInfo.getCurrentPages()[0]})}.bind(this));this.addActionEvent(this.rounds)}},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.config.width*a;this.height=
this.config.height*b;this.rounds[0].width=this.width+20;this.rounds[0].height=this.height+20;this.setPosition();this.roundcan(this.width,this.height,this.width,this.height,this.color,this.config.fillStyle,this.config.ColorA,this.config.ColorB,this.config.alpha,this.config.borderWidth,this.config.spalpha,this.config.borderColor,this.config.borderAlpha,this.config.sx,this.config.sy,this.config.se,this.config.sr,this.config.sh,360-Number(this.config.angle))},showAnimate:function(){if(this.config.animation&&
this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.rounds.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.rounds.one(a,function(){this.rounds.css({animation:""})}.bind(this))}},setPosition:function(){this.x=this.config.x*this.pageWidth-10;this.y=this.config.y*this.pageHeight-10;this.rounds.css({left:this.x+"px",top:this.y+"px"})},roundcan:function(a,b,c,d,e,f,g,h,k,l,m,n,q,p,t,v,x,w,u){try{var r=this.rounds[0].getContext("2d")}catch(y){return}a=
[c/2+10,d/2+10];c/=2;d/=2;r.clearRect(0,0,this.width+20,this.height+20);r.save();r.beginPath();r.strokeStyle=Color(n).toString();r.lineWidth=l;r.globalAlpha=m;!0===parseBool(w)&&this.setShapeShadow(r);r.closePath();r.stroke();DrawEllipse(r,a,c,d);"gradient"==f&&(m=u*Math.PI/180,u=(u+180)*Math.PI/180,u=r.createLinearGradient(a[0]+c*Math.cos(m),a[1]+d*Math.sin(m),a[0]+c*Math.cos(u),a[1]+d*Math.sin(u)),u.addColorStop(0,Color(g).toString()),u.addColorStop(1,Color(h).toString()),r.fillStyle=u,r.fill());
"Pure"==f&&(r.fillStyle=e,r.fill());0!=l&&r.stroke();r.closePath()}}).extend(PageItem.Item);function DrawEllipse(a,b,c,d){var e=b[0]+c,f=b[1];a.moveTo(e,f);for(var g=0;360>=g;g++)f=g*Math.PI/180,e=b[0]+c*Math.cos(f),f=b[1]-d*Math.sin(f),a.lineTo(e,f)}
Class("Text",{Package:"PageItem",create:function(a,b,c,d,e){this._super(a,b,c,d);this.animateConfig();this.color=this.config.color?Color(this.config.color):Color("#000000");this.originWidth=this.config.pageW;this.originHeight=this.config.pageH;this.id="text"+e;this.initText();this.initEvents();this.initLinkHint(this.text);parseBool(this.config.reflection)&&this.imageReflection(this.textdiv);this.onResize(this.pageWidth,this.pageHeight)},initText:function(){this.alignCss="";"right"==this.config.languageLayout&&
(this.alignCss={"text-align":"right",direction:"rtl"});var a=new TextFormatAnalyzer(this.config.textStr);this.fontSize=a.getMinFontSize();this.adjustFontSize=_agent_.browser.chrome?Math.max(1,12/this.fontSize):1;this.width=this.config.width*this.originWidth*this.adjustFontSize;this.height=this.config.height*this.originHeight*this.adjustFontSize;this.container=$("<div id="+this.id+" class='flip-action textContainer'></div>");this.textdiv=$("<div></div>");this.container.css({position:"absolute",width:this.width+
"px",height:this.height+"px"});this.textdiv.css({overflow:"hidden",position:"absolute",width:this.width+"px",height:this.height+"px"});this.config.action||this.config.hint||this.config.hint.text||a.htmlHasATag()||this.container.css({"pointer-events":"none"});this.text=a.getHTML(this.alignCss);!0===parseBool(this.config.fillBg)&&null!=this.config.bgcolor?(a=Color(this.config.bgcolor),this.textdiv.css({"background-color":a.rgba(this.config.bgalpha)})):this.textdiv.css({background:""});this.config.alpha&&
this.textdiv.css({opacity:this.config.alpha});!0===parseBool(this.config.tbold)&&this.text.css({"font-weight":"bold"});!0===parseBool(this.config.italic)&&this.text.css({"font-style":"italic"});!0===parseBool(this.config.selectable)&&this.text.css({"-webkit-user-select":"text","-moz-user-select":"text","-ms-user-select":"text","user-select":"text"});this.addShadow(this.text);this.textdiv.append(this.text);this.container.append(this.textdiv);this.parent.append(this.container);this.trimingFontSize(this.height)},
trimingFontSize:function(a){function b(d,e){if(d.css){var f=d.css(e);f&&(f=parseInt(f.replace("px","")),f--,d.css(e,f+"px"))}}function c(d){if((d=d.children())&&0!=d.length)for(var e=0;e<d.length;e++){var f=$(d[e]);f.is("span")&&(b(f,"font-size"),b(f,"line-height"));c(f)}}for(;this.text.height()>a&&_agent_.system.name!=_agent_.system.IOS&&!(_agent_.browser.chrome&&12>=this.fontSize)&&!(c(this.text),this.fontSize--,0>=this.fontSize););},parseConfig:function(a){return{x:a.location.x,y:a.location.y,
width:a.location.width,height:a.location.height,rotation:a.location.rotation,alpha:a.alpha,pageWidth:a.pageWidth,pageHeight:a.pageHeight,reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,selectable:a.selectable,highlightsBool:a.highlightsBool,highlightsURL:a.highlightsURL,highlightsLabel:a.highlightsLabel,hint:a.hint,textStr:a.textStr?a.textStr:a.formats.defaultFormat.htmlText,lineH:a.lineHeightRation,fontName:a.formats.defaultFormat.fontName,
fontSize:a.formats.defaultFormat.fontSize,color:a.formats.defaultFormat.color,tbold:a.formats.defaultFormat.bold,italic:a.formats.defaultFormat.italic,pageH:a.formats.defaultFormat.pageH,pageW:a.formats.defaultFormat.pageW,bgalpha:a.background.alpha,fillBg:a.background.fillBg,bgcolor:a.background.color,hasShadow:parseBool(a.shadow.hasDropShadow),shadow:a.shadow,action:a.action,languageLayout:a.languageLayout,animation:a.animation}},initEvents:function(){this.addActionEvent(this.container);this.container.onTap(function(a){BookEvent.trigger("clickPageItem",
[BookInfo.getCurrentPageIndex(),"Text",this.config.x,this.config.y,this.config.width,this.config.height])}.bind(this))},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.setPosition(a,b);this.resizeText(b)},resizeText:function(a){a=a/this.originHeight/this.adjustFontSize;this.textdiv.css({"-webkit-transform-origin":"0% 0%","-moz-transform-origin":"0% 0%","-ms-transform-origin":"0% 0%","-o-transform-origin":"0% 0%","transform-origin":"0% 0%","-webkit-transform":"scale("+a+") rotate("+
this.config.rotation+"deg)","-moz-transform":"scale("+a+") rotate("+this.config.rotation+"deg)","-ms-transform":"scale("+a+") rotate("+this.config.rotation+"deg)","-o-transform":"scale("+a+") rotate("+this.config.rotation+"deg)",transform:"scale("+a+") rotate("+this.config.rotation+"deg)"});this.container.css({width:this.width*a+"px",height:this.height*a+"px"})},setPosition:function(a,b){this.left=this.config.x*a;this.top=this.config.y*b;this.container.css({left:this.left+"px",top:this.top+"px"})},
showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.container.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.container.one(a,function(){this.container.css({animation:""})}.bind(this))}}}).extend(PageItem.Item);
Class("Button",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b,c,d);this.animateConfig();this.fScale=c/this.config.pageWidth;this.width=this.pageWidth*this.config.width;this.height=this.pageHeight*this.config.height;this.button=null;this.left=this.pageWidth*this.config.x;this.top=this.pageHeight*this.config.y;this.config.hint&&(this.config.hint.hintShapeColor=Color(this.config.hint.hintShapeColor).toString(),this.config.hint.hintShapeColor2=this.config.hint.hintShapeColor2?Color(this.config.hint.hintShapeColor2).toString():
Color(this.config.hint.hintShapeColor).toString(),"null"==this.config.hint.text&&(this.config.hint.text=""));this.config.Format&&(this.config.Format.color=Color(this.config.Format.color).toString());this.initHtml();this.initEvt();this.initLinkHint(this.button);parseBool(this.config.reflection)&&this.imageReflection(this.button);if(bookConfig.googleAnalyticsID)this.button.onTap(function(e){gtag("event","click",{event_category:"button",event_label:"Page"+BookInfo.getCurrentPages()[0]})}.bind(this))},
initDrawButton:function(){this.drawConfig={width:this.width,height:this.height,id:this.id,fillStyle:this.config.fillStyle,isThreeDimensional:this.config.isThreeDimensional,threeDimensionalNormalColor:this.config.threeDimensionalNormalColor,threeDimensionalOverColor:this.config.threeDimensionalOverColor,overColorA:this.config.overColorA,overColorB:this.config.overColorB,normalColorA:this.config.normalColorA,normalColorB:this.config.normalColorB,downColor:this.config.downColor,overAlpha:this.config.overAlpha,
downAlpha:this.config.downAlpha,normalAlpha:this.config.normalAlpha,buttonRoundW:this.config.buttonRoundW,buttonRoundH:this.config.buttonRoundH,downTextColor:this.config.downTextColor,sh:this.config.sh,sa:this.config.sa,sx:this.config.sx,sy:this.config.sy,se:this.config.se,sr:this.config.sr,fScale:this.pageWidth/this.config.pageWidth};this.config.Format&&(this.drawConfig.normalTextColor=this.config.Format.color);"shape"==this.config.buttonType&&(this.canvasButton=new FlattenButton(this.drawConfig,
this.button));"button_watermark"==this.buttonName&&(this.canvasButton=new WaterButton(this.drawConfig,this.button));"button_glossy"==this.buttonName&&(this.canvasButton=new GlossyButton(this.drawConfig,this.button));"button_push"==this.buttonName&&(this.canvasButton=new PushButton(this.drawConfig,this.button));"button_lineLight"==this.buttonName&&(this.canvasButton=new LineLightButton(this.drawConfig,this.button));"button_star"==this.buttonName&&(this.canvasButton=new StarButton(this.drawConfig,this.button));
"button_glitter"==this.buttonName&&(this.canvasButton=new GlitterButton(this.drawConfig,this.button));"button_shadow"==this.buttonName&&(this.canvasButton=new ShadowButton(this.drawConfig,this.button));"button_bottomLight"==this.buttonName&&(this.canvasButton=new BottomLightButton(this.drawConfig,this.button));"button_other"==this.buttonName&&(this.canvasButton=new OtherButton(this.drawConfig,this.button))},stopAnimation:function(){this.canvasButton&&this.canvasButton.stopAnimation&&this.canvasButton.stopAnimation()},
runAnimation:function(){this.canvasButton&&this.canvasButton.runAnimation&&this.canvasButton.runAnimation()},initHtml:function(){if("shape"==this.config.buttonType)this.swfButton=!0,this.button=$("<div class='flip-action'></div>"),this.createCaption(),this.initDrawButton(),this.buttonEvt=$("<div></div>"),this.initCss(),this.button.append(this.buttonEvt);else if(null==this.config.src||""==this.config.src)this.button=$("<button type = 'button' class='flip-action'></button>"),this.button.css({display:"none"}),
this.config.alpha=0;else{var a=this.config.src.substring(this.config.src.lastIndexOf("/")+1,this.config.src.length-4),b=this.config.src.substring(this.config.src.lastIndexOf(".")+1,this.config.src.length);this.config.src=this.fixRelativePath(this.config.src);"swf"==b.toLowerCase()?(this.buttonName=a.slice(0,-2),this.id=parseInt(a.slice(-2)),this.buttonName&&!isNaN(1*this.id)?(this.swfButton=!0,this.button=$("<div class='flip-action'></div>"),this.createCaption(),this.initDrawButton()):(this.button=
$("<div class='flip-action'><embed style='width:100%;height:100%;' src='"+this.config.src+"' ;> </embed></div>"),this.createCaption())):(this.bgButton=!0,this.button=$("<div class='flip-action'></div>"),a=this.config.src,bookConfig.useTheAliCloudChart&&(a=this.getOssUrl(a,this.width,this.height,"fixed")),this.button.css({background:"url("+a+") center center no-repeat","background-size":"100% 100%"}),this.createCaption());this.buttonEvt=$("<div></div>");this.initCss();this.button.append(this.buttonEvt)}this.setRotation(this.button,
this.config.rotation);this.parent.append(this.button)},initCss:function(){parseBool(this.config.isThreeDimensional)&&this.button.css({height:1.2*this.height+"px"});this.buttonEvt.css({display:"none",width:this.width+"px",height:this.height+"px"});this.button.css({position:"absolute",cursor:"pointer",width:this.width+"px",height:this.height+"px",left:this.left+"px",top:this.top+"px",opacity:this.config.alpha})},createCaption:function(){this.buttonCaption&&this.buttonCaption.labelBox.remove();this.buttonCaption=
new label(this.config.buttonCaption,this.button);var a=transformCSS({origin:{x:0,y:0},tran:{x:10,y:0},scale:this.fScale});this.buttonCaption.labelBox.css(a);this.config.Format&&(this.buttonCaption.setFont(this.config.Format.size+"px",this.config.Format.color,this.config.Format.font),this.buttonCaption.onResize((this.width-20)/this.fScale,parseInt(this.config.Format.size)+6),"shape"!=this.config.buttonType&&this.buttonCaption.labelBox.css({"text-shadow":"0 4px 6px #000"}),parseBool(this.config.Format.bold)&&
this.buttonCaption.labelBox.css({"font-weight":"bold"}),parseBool(this.config.Format.italic)&&this.buttonCaption.labelBox.css({"font-style":"italic"}),this.buttonCaption.labelBox.css({"text-overflow":"ellipsis","white-space":"nowrap","z-index":"10","text-align":"center","pointer-events":"none","line-height":parseInt(this.config.Format.size)+6+"px",overflow:"hidden",left:"0px",top:this.config.captionY+"%"}));this.buttonCaption.labelBox.addClass("button_text");this.config.languageLayout&&this.buttonCaption.labelBox.css({direction:"rtl"})},
parseConfig:function(a){return{width:a.location.width,height:a.location.height,pageWidth:a.location.pageWidth,pageHeight:a.location.pageHeight,rotation:a.location.rotation,reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,x:a.location.x,y:a.location.y,alpha:a.alpha,src:a.url,action:a.action,hint:a.hint,buttonCaption:a.buttonCaption,captionY:a.captionY,HRate:a.HRate,Format:a.Format,buttonType:a.buttonType,fillStyle:a.fillStyle,isThreeDimensional:a.isThreeDimensional,
threeDimensionalNormalColor:a.threeDimensionalNormalColor,threeDimensionalOverColor:a.threeDimensionalOverColor,overColorA:a.overColorA,overColorB:a.overColorB,normalColorA:a.normalColorA,normalColorB:a.normalColorB,downColor:a.downColor,overAlpha:a.overAlpha,downAlpha:a.downAlpha,normalAlpha:a.normalAlpha,buttonRoundW:a.buttonRoundW,buttonRoundH:a.buttonRoundH,sh:parseBool(a.shadow.hasDropShadow),sa:a.shadow.shadowAngle,sx:a.shadow.shadowBlurX,sy:a.shadow.shadowBlurY,se:a.shadow.shadowDistance,sr:a.shadow.shadowColor,
downTextColor:a.downTextColor,languageLayout:a.languageLayout,animation:a.animation}},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.fScale=this.pageWidth/this.config.pageWidth;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.left=this.config.x*this.pageWidth;this.top=this.config.y*this.pageHeight;this.button.css({width:this.width+"px",height:this.height+"px"});parseBool(this.config.isThreeDimensional)&&this.button.css({height:1.2*this.height+
"px"});if(this.canvasButton)this.canvasButton.onResize(this.width,this.height,this.fScale);if(this.swfButton||this.bgButton)isTouchDevice()?(this.createCaption(),this.buttonEvt.css({width:this.width+"px",height:this.height+"px"})):this.show();this.setPosition(this.left,this.top)},show:function(){isTouchDevice()||!this.swfButton&&!this.bgButton||(this.buttonEvt||(this.buttonEvt=$("<div></div>")),this.buttonCaption&&this.buttonCaption.labelBox.remove(),this.buttonEvt.css({display:"none",width:this.width+
"px",height:this.height+"px"}),this.createCaption(),this.button.append(this.buttonEvt))},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.button.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.button.one(a,function(){this.button.css({animation:""})}.bind(this))}},setPosition:function(a,b){this.button.css({left:a+"px",top:b+"px"})},initEvt:function(){this.addActionEvent(this.button);
"shape"!=this.config.buttonType&&(this.button.bind(_event._down,function(){BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),"Button",this.config.x,this.config.y,this.config.width,this.config.height]);this.buttonEvt.css({display:"block"});animateOnce(this.button,transformCSS({tran:{x:0,y:3}}),100)}.bind(this)),this.button.bind(_event._end,function(){this.buttonEvt.css({display:"none"});animateOnce(this.button,transformCSS({tran:{x:0,y:0}}),100)}.bind(this)));this.button.bind("mouseleave",
function(){this.buttonEvt.css({display:"none"})}.bind(this))}}).extend(PageItem.Item);
Class("FlattenButton",{create:function(a,b){a&&b&&(this.config=a,this.parent=b,this.initConfig(),this.initHtml(),this.initCss(),this.initEvent())},initConfig:function(){this.config.normalAlpha||(this.config.normalAlpha=1);this.config.downAlpha||(this.config.normalAlpha=1);this.config.overAlpha||(this.config.normalAlpha=1);this.config.normalColorA=this.config.normalColorA?Color(this.config.normalColorA).rgba(this.config.normalAlpha):Color("#808080").rgba(this.config.normalAlpha);this.config.normalColorB=
this.config.normalColorB?Color(this.config.normalColorB).rgba(this.config.normalAlpha):Color("#808080").rgba(this.config.normalAlpha);this.config.overColorA=this.config.overColorA?Color(this.config.overColorA).rgba(this.config.overAlpha):Color("#808080").rgba(this.config.overAlpha);this.config.overColorB=this.config.overColorB?Color(this.config.overColorB).rgba(this.config.overAlpha):Color("#808080").rgba(this.config.overAlpha);this.config.downColor=this.config.downColor?Color(this.config.downColor).rgba(this.config.downAlpha):
Color("#808080").rgba(this.config.downAlpha);this.config.downTextColor=this.config.downTextColor?Color(this.config.downTextColor).toString():"#ffffff";this.config.normalTextColor=this.config.normalTextColor?Color(this.config.normalTextColor).toString():"#ffffff";parseBool(this.config.isThreeDimensional)&&(this.config.threeDimensionalNormalColor=this.config.threeDimensionalNormalColor?Color(this.config.threeDimensionalNormalColor).toString():"#808080",this.config.threeDimensionalOverColor=this.config.threeDimensionalOverColor?
Color(this.config.threeDimensionalOverColor).toString():"#808080")},initHtml:function(){this.coverButton=$("<div class='flip-action'></div>");this.parent.append(this.coverButton)},initCss:function(){this.coverButton.css({transition:"all .3s",position:"absolute","z-index":"2",width:this.config.width+"px",height:this.config.height+"px","border-radius":this.config.buttonRoundW*this.config.fScale+"px"});this.normalCss()},overCss:function(){this.config.overColorA==this.config.overColorB?this.coverButton.css({background:this.config.overColorA}):
this.setGradient(this.config.overColorA,this.config.overColorB);parseBool(this.config.isThreeDimensional)?this.set3DShadow(this.config.threeDimensionalOverColor,.15*this.config.height,.16*this.config.height):this.clearShadow();this.config.normalTextColor!=this.config.downTextColor&&this.normalText()},downCss:function(){this.coverButton.css({background:this.config.downColor});parseBool(this.config.isThreeDimensional)?this.set3DShadow(this.config.threeDimensionalNormalColor,.05*this.config.height,.06*
this.config.height):this.setInsetShadow();this.config.normalTextColor!=this.config.downTextColor&&this.downText()},normalCss:function(){this.config.normalColorA==this.config.normalColorB?this.coverButton.css({background:this.config.normalColorA}):this.setGradient(this.config.normalColorA,this.config.normalColorB);parseBool(this.config.isThreeDimensional)?this.set3DShadow(this.config.threeDimensionalNormalColor,.15*this.config.height,.16*this.config.height):this.clearShadow();this.config.normalTextColor!=
this.config.downTextColor&&this.normalText()},normalText:function(){this.parent.find(".button_text").css({color:this.config.normalTextColor})},downText:function(){this.parent.find(".button_text").css({color:this.config.downTextColor})},setGradient:function(a,b){this.coverButton.css({background:"-webkit-linear-gradient(to bottom,"+a+","+b+")",background:"-moz-linear-gradient(to bottom,"+a+","+b+")",background:"-o-linear-gradient(to bottom,"+a+","+b+")",background:"linear-gradient(to bottom,"+a+","+
b+")"})},set3DShadow:function(a,b,c){this.coverButton.css({"-moz-box-shadow":"0 "+b+"px 0 "+a+", 0 "+c+"px 3px rgba(0, 0, 0, 0.1)","-o-box-shadow":"0 "+b+"px 0 "+a+", 0 "+c+"px 3px rgba(0, 0, 0, 0.1)","-webkit-box-shadow":"0 "+b+"px 0 "+a+", 0 "+c+"px 3px rgba(0, 0, 0, 0.1)","-ms-box-shadow":"0 "+b+"px 0 "+a+", 0 "+c+"px 3px rgba(0, 0, 0, 0.1)","box-shadow":"0 "+b+"px 0 "+a+", 0 "+c+"px 3px rgba(0, 0, 0, 0.1)"})},clearShadow:function(){this.coverButton.css({"-moz-box-shadow":"none","-o-box-shadow":"none",
"-webkit-box-shadow":"none","-ms-box-shadow":"none","box-shadow":"none"})},setInsetShadow:function(){this.coverButton.css({"-moz-box-shadow":"inset 0 1px 4px rgba(0, 0, 0, 0.2)","-o-box-shadow":"inset 0 1px 4px rgba(0, 0, 0, 0.2)","-webkit-box-shadow":"inset 0 1px 4px rgba(0, 0, 0, 0.2)","-ms-box-shadow":"inset 0 1px 4px rgba(0, 0, 0, 0.2)","box-shadow":"inset 0 1px 4px rgba(0, 0, 0, 0.2)"})},onResize:function(a,b,c){this.parent.css({transition:""});this.coverButton.css({transition:""});this.config.width=
a;this.config.height=b;this.coverButton.css({"border-radius":this.config.buttonRoundW*c+"px",width:a+"px",height:b+"px"});this.normalCss();(function(){this.parent.css({transition:"all 0.3s"});this.coverButton.css({transition:"all 0.3s"})}).delay(this,50)},initEvent:function(){this.parent.bind(_event._over,function(){this.mouseOn=!0;this.overCss()}.bind(this));this.parent.bind(_event._out,function(){this.mouseOn=!1;this.normalCss()}.bind(this));this.parent.bind(_event._down,function(){parseBool(this.config.isThreeDimensional)&&
this.parent.css({transition:"all .3s",transform:"translate(0 ,"+.1*this.config.height+"px)"});this.downCss()}.bind(this));this.parent.bind(_event._up,function(){parseBool(this.config.isThreeDimensional)&&this.parent.css({transition:"all .3s",transform:"translate(0,0)"});this.mouseOn?this.overCss():this.normalCss()}.bind(this))}});
Class("WaterButton",{create:function(a,b){a.width&&a.height&&a.id&&b&&(this.lineWidth=a.height/30,this.width=a.width-this.lineWidth,this.height=a.height-this.lineWidth,this.id=a.id,this.bdRadius=this.height/6,this.parent=b,this.enter=!1,this.initConfig(),this.getGradient(),this.initHtml(),this.initCss(),isPhone()||isPad()||this.initEvent())},initHtml:function(){this.canvas=$("<canvas width='"+(this.width+this.lineWidth)+"' height='"+(this.height+this.lineWidth)+"'></canvas>");this.context=this.canvas[0].getContext("2d");
this.parent.append(this.canvas);this.drawButton()},initCss:function(){this.canvas.css({position:"absolute",left:"0",top:"0"})},onResize:function(a,b){this.lineWidth=b/30;this.width=a-b/30;this.height=b-b/30;this.bdRadius=this.height/6;this.canvas[0].width=a;this.canvas[0].height=b;this.drawButton()},draw:function(){this.context.clearRect(0,0,this.width,this.height);this.context.lineWidth=this.lineWidth;this.context.beginPath();this.context.strokeStyle=this.borderColor1;this.context.moveTo(this.bdRadius+
this.lineWidth,this.lineWidth);this.context.arcTo(this.width-this.lineWidth,this.lineWidth,this.width-this.lineWidth,this.height-this.lineWidth/2,this.bdRadius+this.lineWidth/2);this.context.arcTo(this.width-this.lineWidth,this.height-this.lineWidth/2,this.lineWidth,this.height-this.lineWidth/2,this.bdRadius+this.lineWidth/2);this.context.arcTo(this.lineWidth,this.height-this.lineWidth/2,this.lineWidth,this.lineWidth,this.bdRadius+this.lineWidth/2);this.context.arcTo(this.lineWidth,this.lineWidth,
this.width-this.lineWidth/2,this.lineWidth,this.bdRadius+this.lineWidth/2);this.context.fillStyle=this.outerBg;this.context.fill();this.context.stroke();this.context.closePath();this.context.beginPath();this.context.moveTo(2*this.lineWidth+this.bdRadius,2*this.lineWidth);var a=this.context.createLinearGradient(0,this.lineWidth,0,this.height/2+this.lineWidth);a.addColorStop(0,"rgba(255,255,255,1)");a.addColorStop(1,"rgba(255,255,255,0.15)");this.context.fillStyle=a;this.context.arcTo(this.width-2*
this.lineWidth,2*this.lineWidth,this.width-2*this.lineWidth,this.height/2+this.lineWidth,this.bdRadius);this.context.arcTo(this.width-2*this.lineWidth,this.height/2+this.lineWidth,2*this.lineWidth,this.height/2+this.lineWidth,this.bdRadius);this.context.arcTo(2*this.lineWidth,this.height/2+this.lineWidth,2*this.lineWidth,2*this.lineWidth,this.bdRadius);this.context.arcTo(2*this.lineWidth,2*this.lineWidth,this.width-2*this.lineWidth,2*this.lineWidth,this.bdRadius);this.context.fill()},initConfig:function(){this.waters=
[{defaultBg:"#000000;#212321;rgb(187,187,187)",enterBg:"#030303;rgb(102,102,102);rgb(200,200,200)"},{defaultBg:"rgb(0,20,26);#006FC9;rgb(68,179,253)",enterBg:"rgb(0,56,93);rgb(25,162,253;rgb(244,244,244)"},{defaultBg:"rgb(233,234,233);rgb(110,115,111);rgb(153,156,153)",enterBg:"rgb(113,115,117);rgb(206,209,207);rgb(255,255,255)"},{defaultBg:"rgb(29,39,2);rgb(159,205,19);rgb(194,234,31)",enterBg:"rgb(35,43,2);rgb(175,214,15);rgb(245,250,220)"},{defaultBg:"rgb(123,0,80);rgb(208,15,150);rgb(245,27,173)",
enterBg:"rgb(125,0,82);rgb(236,14,170);rgb(245,238,249)"},{defaultBg:"rgb(170,1,1);rgb(254,48,48);rgb(254,166,169)",enterBg:"rgb(249,12,12);rgb(253,170,170);rgb(254,249,249)"},{defaultBg:"rgb(90,2,101);rgb(186,46,203);rgb(165,125,170)",enterBg:"rgb(92,3,103);rgb(235,107,250);rgb(251,230,254)"},{defaultBg:"rgb(144,143,1);rgb(236,236,18);rgb(253,253,194)",enterBg:"rgb(144,143,1);rgb(251,251,45);rgb(254,254,242)"},{defaultBg:"rgb(250,93,9);rgb(255,136,24);rgb(217,79,11)",enterBg:"rgb(247,78,7);rgb(254,198,174);rgb(254,247,244)"}]},
getGradient:function(){this.defaultBg=this.waters[this.id-1].defaultBg.split(";");this.enterBg=this.waters[this.id-1].enterBg.split(";")},drawButton:function(){this.context.clearRect(0,0,this.width,this.height);this.context.beginPath();this.context.lineWidth="5";this.borderColor1=this.context.createLinearGradient(this.lineWidth,this.lineWidth,this.height/2+this.lineWidth,this.height/2+this.lineWidth);this.borderColor1.addColorStop(0,"#ffffff");this.borderColor1.addColorStop(1,"#000");this.outerBg=
this.context.createLinearGradient(0,this.lineWidth,0,this.height-this.lineWidth);this.outerBg.addColorStop(0,this.defaultBg[0]);this.outerBg.addColorStop(.96,this.defaultBg[1]);this.outerBg.addColorStop(1,this.defaultBg[2]);this.draw()},enterEvent:function(){this.getGradient();this.change=function(a,b){var c=a/b;this.context.clearRect(0,0,this.width+this.lineWidth+10,this.height+this.lineWidth+10);if(this.enter)var d=c,e=this.lineWidth+5+this.width/2*c,f=this.height/2+this.lineWidth+5+this.width/
2*c;else d=1-c,e=this.width/2+this.lineWidth+5-this.width/2*c,f=this.width/2+this.height/2+this.lineWidth+5-this.width/2*c;this.outerBg=this.context.createLinearGradient(0,this.lineWidth,0,this.height-this.lineWidth);this.borderColor1=this.context.createLinearGradient(e,e,f,f);c=this.enter?.95-.15*c:.8+.15*c;a==b&&(this.enter?this.borderColor1.addColorStop(0,"#000"):this.borderColor1.addColorStop(d,"#ffffff"),this.borderColor1.addColorStop(1,"#000"));this.enter?(this.outerBg.addColorStop(0,this.enterBg[0]),
this.outerBg.addColorStop(c,this.enterBg[1]),this.outerBg.addColorStop(1,this.enterBg[2])):(this.outerBg.addColorStop(0,this.defaultBg[0]),this.outerBg.addColorStop(c,this.defaultBg[1]),this.outerBg.addColorStop(1,this.defaultBg[2]));this.borderColor1.addColorStop(0,"#000");this.borderColor1.addColorStop(d,"#ffffff");this.borderColor1.addColorStop(1,"#000");this.draw()};this.timer&&this.timer.stop();this.timer=this.change.animation(this,400)},initEvent:function(){this.canvas.bind(_event._enter,function(){this.enter=
!0;this.enterEvent()}.bind(this));this.canvas.bind(_event._leave,function(){this.enter=!1;this.enterEvent()}.bind(this))}});
Class("GlossyButton",{create:function(a,b){a.width&&a.height&&a.id&&b&&(this.lineWidth=a.height/30,this.width=a.width-this.lineWidth,this.height=a.height-this.lineWidth,this.id=a.id,7<this.id&&(this.id-=3),this.bdRadius=this.height/15,this.parent=b,this.initConfig(),this.setPosition(),this.initHtml(),this.getGradient(),this.drawButton(),this.initCss())},initHtml:function(){this.container=$("<div></div>");this.canvas=$("<canvas width='"+this.width+"' height='"+this.height+"'></canvas>");this.secCanvas=
$("<canvas width='"+this.width+"' height='"+(this.height/2-this.lineWidth/2)+"'></canvas>");this.secCtx=this.secCanvas[0].getContext("2d");this.context=this.canvas[0].getContext("2d");this.parent.append(this.container);this.container.append(this.canvas);this.container.append(this.secCanvas)},onResize:function(a,b){this.width=a;this.height=b;this.bdRadius=b/15;this.lineWidth=b/30;this.canvas[0].width=a;this.canvas[0].height=b;this.secCanvas[0].width=a;this.secCanvas[0].height=b/2;this.getGradient();
this.drawButton()},initCss:function(){this.container.css({position:"absolute",width:this.width+"px",height:this.height+"px",left:"0",top:"0"});this.secCanvas.css({position:"absolute",background:"transparent",left:"0",top:"0"})},drawButton:function(){var a={width:this.width,height:this.height,bdRadius:this.bdRadius,lineWidth:this.lineWidth,context:this.context,canvas:this.canvas,color:this.shadows[6<this.id-1?this.id-1-7:this.id-1]};this.drawFirstBg();1==this.id||8==this.id?new GlossButton1(a,this.container):
2==this.id||9==this.id?new GlossButton2(a,this.container):3==this.id||5==this.id||10==this.id||12==this.id?new GlossButton3(a,this.container):4==this.id||11==this.id?new GlossButton4(a,this.container):6==this.id||13==this.id?new GlossButton5(a,this.container):(7==this.id||14==this.id)&&new GlossButton6(a,this.container);a={ctx:this.secCtx,secCanvas:this.secCanvas,arr1:this.arr1,arr2:this.arr2,width:this.width,height:this.height,container:this.container,lineWidth:this.lineWidth};1<=this.id&&7>=this.id?
this.bubbles=new AnimationBubble(a):this.stars=new AnimationStar(a);this.drawUnder()},drawFirstBg:function(){this.context.beginPath();this.context.lineWidth=this.lineWidth/10;this.context.moveTo(this.bdRadius+this.lineWidth/2,this.lineWidth/2);this.context.arcTo(this.width-this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,this.height/2-this.lineWidth/2,this.bdRadius);this.context.arcTo(this.width-this.lineWidth/2,this.height/2-this.lineWidth/2,this.lineWidth/2,this.height/2-this.lineWidth/
2,this.bdRadius);this.context.arcTo(this.lineWidth/2,this.height/2-this.lineWidth/2,this.lineWidth/2,this.lineWidth/2,this.bdRadius);this.context.arcTo(this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,this.lineWidth/2,this.bdRadius);this.context.fillStyle=this.bgColor;this.context.strokeStyle=this.borderColor1;this.context.fill();this.context.stroke();this.context.closePath()},drawUnder:function(){this.context.beginPath();this.context.moveTo(this.bdRadius+this.lineWidth/2,this.height/
2-this.lineWidth/4);this.context.arcTo(this.width-this.lineWidth/2,this.height/2-this.lineWidth/4,this.width-this.lineWidth/2,this.height-this.lineWidth/2,this.bdRadius);this.context.arcTo(this.width-this.lineWidth/2,this.height-this.lineWidth/2,this.lineWidth/2,this.height-this.lineWidth/2,this.bdRadius);this.context.arcTo(this.lineWidth/2,this.height-this.lineWidth/2,this.lineWidth/2,this.height/2-this.lineWidth/4,this.bdRadius);this.context.arcTo(this.lineWidth/2,this.height/2-this.lineWidth/4,
this.width-this.lineWidth/2,this.height/2-this.lineWidth/4,this.bdRadius);this.context.fillStyle=this.underShadow;this.context.fill();this.context.closePath()},initConfig:function(){this.shadows=[{defaultBg:"#030303;#A00303;#525252",enterBg:"#6CFCDE"},{defaultBg:"#040436;#008BC1;#525252",enterBg:"#FF0000"},{defaultBg:"#184618;#2EC64D;#525252",enterBg:"#FFFFFF"},{defaultBg:"#371200;#995F2E;#525252",enterBg:"#FFFFFF"},{defaultBg:"#15002B;#6A0AC9;#525252",enterBg:"#FFFFFF"},{defaultBg:"#420021;#9C4370;#525252",
enterBg:"#FFFFFF"},{defaultBg:"#000000;#6F6F00;#525252",enterBg:"#FFFFFF"}]},getGradient:function(){this.defaultBg=this.shadows[6<this.id-1?this.id-1-7:this.id-1].defaultBg.split(";");this.enterBg=this.shadows[6<this.id-1?this.id-1-7:this.id-1].enterBg;this.borderColor1=this.defaultBg[2];this.bgColor=this.defaultBg[0];this.coverBg=this.context.createLinearGradient(0,0,0,this.height/4*3);this.coverBg.addColorStop(0,"rgba(255,255,255,0.15)");this.coverBg.addColorStop(1,"rgba(255,255,255,0.3)");this.underShadow=
this.context.createLinearGradient(0,this.height/2-this.lineWidth/1.8,0,this.height-this.lineWidth/2);this.underShadow.addColorStop(0,Color(this.defaultBg[0]).rgba(.25));this.underShadow.addColorStop(.4,Color(this.defaultBg[0]).rgba(0))},stopAnimation:function(){this.bubbles&&this.bubbles.leaveTimer&&this.bubbles.leaveTimer.stop();this.bubbles&&this.bubbles.enterTimer&&this.bubbles.enterTimer.stop();this.stars&&this.stars.leaveTimer&&this.stars.leaveTimer.stop();this.stars&&this.stars.enterTimer&&
this.stars.enterTimer.stop()},runAnimation:function(){this.bubbles&&this.bubbles.leaveEvent();this.stars&&this.stars.leaveEvent()},setPosition:function(){this.arr1=[];for(var a=0;15>a;a++){var b=Math.random()*(this.width+this.lineWidth),c=this.height/2*Math.random();this.arr1.push({x:b,y:c})}this.arr2=[];for(a=0;15>a;a++)b=Math.random()*(this.width+this.lineWidth),c=this.height/2*Math.random(),this.arr2.push({x:b,y:c})}});
Class("AnimationBubble",{create:function(a){this.secCanvas=a.secCanvas;this.container=a.container;this.secCtx=a.ctx;this.width=a.width;this.height=a.height;this.lineWidth=a.lineWidth;this.setPosition();isPhone()||isPad()||this.initEvent()},drawBubble:function(a,b,c,d,e){this.secCtx.beginPath();this.secCtx.ellipse&&(this.secCtx.ellipse(d,e,this.height/30,this.height/30,0,0,2*Math.PI,!1),b=this.secCtx.createRadialGradient(d-this.height/40,e+this.height/30,0,d,e,this.height/20),b.addColorStop(0,"rgba(255,255,255,"+
1.6*a+")"),b.addColorStop(1,"rgba(255,255,255,"+.14*a+")"),this.secCtx.fillStyle=b,this.secCtx.fill(),this.secCtx.closePath(),this.secCtx.beginPath(),this.secCtx.ellipse(d+this.height/40,e-this.height/60,this.height/80,this.height/100,-.2*Math.PI,0,2*Math.PI,!1),this.secCtx.fillStyle="rgba(255,255,255,"+.8*a+")",this.secCtx.fill(),this.secCtx.closePath())},popBubbles:function(a,b,c,d){for(var e=0;10>e;e++){this.focus?(d[e].x+=this.width/6/c*b,d[e].y+=this.height/6/c):(d[e].x+=this.width/6/c*b,d[e].y-=
this.height/6/c);if(1==a||d[e].x<1.5*this.lineWidth||d[e].x>this.width-this.lineWidth||d[e].y<.5*this.lineWidth||d[e].y>this.height/2-this.lineWidth/2)d[e].x=Math.random()*(this.width+this.lineWidth),d[e].y=this.height/2*Math.random();this.drawBubble(a,b,c,d[e].x,d[e].y)}},enterEvent:function(){this.enterTimer&&this.enterTimer.stop();this.enterTimer=this.enterAnimation.animation(this,1200)},enterAnimation:function(a,b){this.secCtx.clearRect(-20,-20,1.5*this.width,1.5*this.height);var c=1,d=a/b;this.focus?
a==b&&this.focus?(this.popBubbles(d,c,b,this.arr1),this.popBubbles(1-d-.5,c,b,this.arr2),this.enterTimer&&this.enterTimer.stop(),this.enterTimer=this.enterAnimation.animation(this,1200)):this.focus&&(.5>=a/b?c=1:(c=-1,d=1-d),this.popBubbles(d,c,b,this.arr1),this.popBubbles(1-d-.5,c,b,this.arr2)):this.enterTimer.stop()},leaveEvent:function(){this.leaveTimer&&this.leaveTimer.stop();this.leaveTimer=this.leaveAnimation.animation(this,1200)},leaveAnimation:function(a,b){this.secCtx.clearRect(-20,-20,1.5*
this.width,1.5*this.height);var c=a/b,d=1;this.focus?this.leaveTimer.stop():a!=b||this.focus?(.5>a/b?d=1:(d=-1,c=1-c),this.focus||(.5>c?(this.popBubbles(c,d,b,this.arr1),this.popBubbles(c,d,b,this.arr2)):(this.popBubbles(1-c,d,b,this.arr1),this.popBubbles(1-c,d,b,this.arr2)))):(this.popBubbles(0,d,b,this.arr1),this.popBubbles(0,d,b,this.arr2))},initEvent:function(){this.container.bind(_event._enter,function(){this.focus=!0;this.setPosition();this.enterEvent()}.bind(this));this.container.bind(_event._leave,
function(){this.focus=!1;this.setPosition();this.leaveEvent()}.bind(this))}}).extend("GlossyButton");
Class("AnimationStar",{create:function(a){this.secCanvas=a.secCanvas;this.container=a.container;this.secCtx=a.ctx;this.width=a.width;this.height=a.height;this.lineWidth=a.lineWidth;this.setPosition();isPhone()||isPad()||this.initEvent()},drawStar:function(a,b,c,d,e){function f(q,p){var t=new Image;t.src=q;t.complete?p.call(t):t.onload=function(){p.call(t)}}this.secCtx.beginPath();var g=parseInt(b.x),h=parseInt(b.y),k=this.secCtx,l=this.width,m=this.height,n=new Image;n.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAcNJREFUeNq8lrtKA0EYhTMx0RizGiUqWGihnRcQFaxEOzsrwVfwcXwIbS0sLAKK2NiJkEbEiBjB+yWJihvd8YycwDJkzTJuZuFjw2TnP3vO/Du7QkoZs3nEDeclTeeaCvZQ1JpgBiRsCjq2BbttR+q0QlDQSZDD9gbjKdBhKijpYtJ3nWggWB/LgVHw/Z9IH8ELWAZp0MU5aTrJ8camwDQ4B19/FQzTaVc8r4FDzlHRjYEKxTrBLvCaFQsj2AaewR5YASWKxRmrcrvDczWsoNBiFj7iXLNBcAvWwSx4AnmwBXrBDWOWdCp91HviV9BhsT6uSZYCGUaVYvOoYkNgjv+r7W2eN1Vms3yCD/LKcZXOA7lLMIY3cKE5FT7HWYqN8/cM128fbLPYNXjXHWlOZUKzHdTJLospVxtgFRTUHYMBcMwY3Sh2Go+PwwLdXIJTcAKOKLrIlCLZ2obBBNjkepxxGUpsogNQBEvNdpkwj0U/GyTPphCMX7mpcVMQjFddO8JeqJkICq5JQdvuYmwYVxu7Z2cKU4eSBRod5YAGiaRpggRrNt+HFduC1WZvhVZEaiQoDD+Ek3xMPFuC1r+8jY8fAQYACgJ37BkSsIMAAAAASUVORK5CYII=";
k.save();k.globalAlpha=a;this.focus&&(this.runPosition(a,b,c,d,e),f(n.src,function(){k.drawImage(n,b.x,b.y,l/20,m/10)}.bind(this)));k.restore();this.focus||this.rotation(a,a*Math.PI,n,g,h);k.restore()},runPosition:function(a,b,c,d,e){1==e?(b.x+=this.width/8/d*e,b.y+=this.height/12/d*e,b.x=b.x>this.width-this.lineWidth-this.width/30?Math.random()*(this.width-this.lineWidth-this.width/30):b.x,b.y=b.y>this.height/2-this.lineWidth/2+this.height/30?Math.random()*(this.height/2-this.lineWidth/2):b.y):(b.x+=
this.width/8/d*e,b.y+=this.height/12/d*e,b.x=b.x<this.width/40+this.lineWidth/2?Math.random()*(this.width-this.lineWidth-this.width/30):b.x,b.y=b.y<this.lineWidth/2-this.height/20?Math.random()*(this.height/2-this.lineWidth/2):b.y)},rotation:function(a,b,c,d,e){this.secCtx.save();this.secCtx.globalAlpha=a;this.secCtx.translate(d+this.width/40,e+this.height/20);this.secCtx.rotate(b);this.secCtx.translate(-d-this.width/40,-e-this.height/20);this.secCtx.drawImage(c,d,e,this.width/20,this.height/10);
this.secCtx.restore()},popStars:function(a,b,c,d,e){for(var f=0;15>f;f++)this.drawStar(a,b[f],c,d,e)},enterEvent:function(){this.enterTimer&&this.enterTimer.stop();this.enterTimer=this.enterAnimation.animation(this,1E3)},enterAnimation:function(a,b){this.secCtx.clearRect(-20,-20,1.5*this.width,1.5*this.height);if(this.focus)if(a==b&&this.focus)this.add=1==this.add?-1:1,this.enterTimer&&this.enterTimer.stop(),this.enterTimer=this.enterAnimation.animation(this,1E3);else{var c=a/b;.33>c&&(this.runCase=
1);.33<=c&&.66>=c&&(this.runCase=2);.66<=c&&1>=c&&(this.runCase=3);if(this.focus)switch(this.runCase){case 1:this.popStars(3*c,this.arr1,a,b,this.add);this.popStars(3*c,this.arr2,a,b,-this.add);break;case 2:this.popStars(1,this.arr1,a,b,this.add);this.popStars(1,this.arr2,a,b,-this.add);break;case 3:this.popStars(3*(1-c),this.arr1,a,b,this.add),this.popStars(3*(1-c),this.arr2,a,b,-this.add)}}else this.enterTimer&&this.enterTimer.stop()},leaveEvent:function(){this.leaveTimer&&this.leaveTimer.stop();
this.leaveTimer=this.leaveAnimation.animation(this,800)},leaveAnimation:function(a,b){this.secCtx.clearRect(-20,-20,1.5*this.width,1.5*this.height);1==this.focus?this.leaveTimer.stop():a!=b||this.focus?(a/=b,this.focus||(this.add?(this.popStars(a,this.arr1),this.popStars(1-a,this.arr2)):(this.popStars(1-a,this.arr1),this.popStars(a,this.arr2)))):(this.add=this.add?!1:!0,this.leaveTimer&&this.leaveTimer.stop())},initEvent:function(){this.container.bind(_event._enter,function(){this.add=this.focus=
!0;this.setPosition();this.enterEvent.delay(this,500)}.bind(this));this.container.bind(_event._leave,function(){this.focus=!1;this.runCase=1;this.setPosition();this.leaveEvent()}.bind(this))}}).extend("GlossyButton");
Class("GlossButton1",{create:function(a,b){this.setConfig(a);this.getGradient();this.drawFirstBg();this.drawCover();this.drawTopBottomBg()},setConfig:function(a){this.width=a.width;this.height=a.height;this.bdRadius=a.bdRadius;this.lineWidth=a.lineWidth;this.context=a.context;this.canvas=a.canvas;this.color=a.color;this.parent=parent},getGradient:function(){this.defaultBg=this.color.defaultBg.split(";");this.enterBg=this.color.enterBg;this.topBg=this.context.createRadialGradient(this.width/2,-this.lineWidth/
2,0,this.width/2,-this.lineWidth/2,this.width/2);this.topBg.addColorStop(0,this.defaultBg[1]);this.topBg.addColorStop(1,Color(this.defaultBg[1]).rgba(0));this.bottomBg=this.context.createRadialGradient(this.width/2,1.5*this.height+this.lineWidth/4,0,this.width/2,1.5*this.height+this.lineWidth/4,this.width/2);this.bottomBg.addColorStop(0,this.defaultBg[1]);this.bottomBg.addColorStop(1,Color(this.defaultBg[1]).rgba(0))},drawTopBottomBg:function(){this.context.save();this.context.scale(1,1/3);this.context.beginPath();
this.context.fillStyle=this.topBg;this.context.fillRect(this.lineWidth/2,1.5*this.lineWidth,this.width,1.5*this.height);this.context.closePath();this.context.beginPath();this.context.fillStyle=this.bottomBg;this.context.fillRect(this.lineWidth/2,this.lineWidth,this.width,1.5*this.height-2.5*this.lineWidth);this.context.restore()},drawCover:function(){this.context.beginPath();this.context.moveTo(this.lineWidth/2,this.lineWidth/2+this.height/10);this.context.lineTo(this.lineWidth/2,this.height/10);
this.context.arcTo(this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,this.lineWidth/2,this.bdRadius);this.context.lineTo(this.width-this.lineWidth,this.lineWidth/2+this.lineWidth/20);var a=this.context.createLinearGradient(0,this.lineWidth/2,0,this.height/2);a.addColorStop(0,"rgba(255,255,255,0.05)");a.addColorStop(1,"rgba(255,255,255,0.1)");this.context.fillStyle=a;this.context.moveTo(this.lineWidth/2,this.lineWidth/2+this.height/10);this.context.quadraticCurveTo(this.lineWidth/2+.85*
this.width,this.lineWidth/2+.55*this.height,this.width-this.lineWidth,this.lineWidth/2+this.lineWidth/20);this.context.fill();this.context.closePath();this.context.beginPath();this.context.fillStyle=a;this.context.moveTo(this.lineWidth/2,this.lineWidth/2+this.height/3);this.context.arcTo(this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,this.lineWidth/2,this.bdRadius);this.context.lineTo(this.lineWidth/2+.9*this.width,this.lineWidth/2);this.context.fill()}}).extend("GlossyButton");
Class("GlossButton2",{create:function(a,b){this.setConfig(a);this.getGradient();this.drawCenterBg();this.drawCover()},setConfig:function(a){this.width=a.width;this.height=a.height;this.bdRadius=a.bdRadius;this.lineWidth=a.lineWidth;this.context=a.context;this.canvas=a.canvas;this.parent=parent;this.color=a.color},getGradient:function(){this.defaultBg=this.color.defaultBg.split(";");this.enterBg=this.color.enterBg;this.borderColor1=this.defaultBg[2];this.bgColor=this.defaultBg[0];this.center=this.context.createRadialGradient(this.width/
2,this.height+this.lineWidth/2,0,this.width/2,this.height+this.lineWidth/2,this.width/2);this.center.addColorStop(0,this.defaultBg[1]);this.center.addColorStop(1,Color(this.defaultBg[1]).rgba(0))},drawCenterBg:function(){this.context.save();this.context.scale(1,.25);this.context.beginPath();this.context.fillStyle=this.center;this.context.fillRect(this.lineWidth/2,2*this.lineWidth,this.width,2*this.height);this.context.closePath();this.context.restore()},drawCover:function(){this.context.beginPath();
this.context.moveTo(this.lineWidth/2,this.lineWidth/2+this.height/10);this.context.lineTo(this.lineWidth/2,this.height/10);this.context.arcTo(this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,this.lineWidth/2,this.bdRadius);this.context.lineTo(this.width-this.lineWidth,this.lineWidth/2+this.lineWidth/20);var a=this.context.createLinearGradient(0,this.lineWidth/2,0,this.height/2);a.addColorStop(0,"rgba(255,255,255,0.05)");a.addColorStop(1,"rgba(255,255,255,0.2)");this.context.fillStyle=
a;this.context.moveTo(this.lineWidth/2,this.height/4);this.context.arcTo(this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,this.lineWidth/2,this.bdRadius);this.context.arcTo(this.width-this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,this.height/4-this.lineWidth/4,this.bdRadius);this.context.lineTo(this.lineWidth/2+this.width,this.height/4);this.context.moveTo(this.lineWidth/2,this.height/4);this.context.fill();this.context.closePath()}}).extend("GlossyButton");
Class("GlossButton3",{create:function(a,b){this.setConfig(a);this.getGradient();this.drawCover();this.drawBottomBg()},setConfig:function(a){this.width=a.width;this.height=a.height;this.bdRadius=a.bdRadius;this.lineWidth=a.lineWidth;this.context=a.context;this.canvas=a.canvas;this.parent=parent;this.color=a.color},getGradient:function(){this.defaultBg=this.color.defaultBg.split(";");this.enterBg=this.color.enterBg;this.borderColor1=this.defaultBg[2];this.bgColor=this.defaultBg[0];this.center=this.context.createRadialGradient(this.width/
2,1.8*this.height+this.lineWidth/2,0,this.width/2,1.8*this.height+this.lineWidth/2,this.width/2);this.center.addColorStop(0,this.defaultBg[1]);this.center.addColorStop(1,Color(this.defaultBg[1]).rgba(0))},drawBottomBg:function(){this.context.save();this.context.scale(1,.25);this.context.beginPath();this.context.fillStyle=this.center;this.context.fillRect(this.lineWidth/2,2*this.lineWidth,this.width,2*this.height-4*this.lineWidth);this.context.closePath();this.context.restore()},drawCover:function(){this.context.beginPath();
var a=this.context.createLinearGradient(0,this.lineWidth/2,0,this.height/2);a.addColorStop(0,"rgba(255,255,255,0.2)");a.addColorStop(1,"rgba(255,255,255,0.05)");this.context.fillStyle=a;this.context.moveTo(this.lineWidth/2,this.height/8*3);this.context.arcTo(this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,this.lineWidth/2,this.bdRadius);this.context.arcTo(this.width-this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,this.height/4-this.lineWidth/4,this.bdRadius);this.context.lineTo(this.lineWidth/
2+this.width,this.height/8*3);this.context.fill();this.context.closePath();this.context.save();this.context.scale(1,.25);this.context.beginPath();this.context.moveTo(this.lineWidth/2,this.height/8*12);this.context.fillStyle=this.defaultBg[0];this.context.quadraticCurveTo(this.width/2,this.height/6*4,this.width-this.lineWidth/2,this.height/8*12);this.context.fill();this.context.closePath();this.context.restore()}}).extend("GlossyButton");
Class("GlossButton4",{create:function(a,b){this.setConfig(a);this.getGradient();this.drawCenterBg();this.drawCover();this.drawBorder()},setConfig:function(a){this.width=a.width;this.height=a.height;this.bdRadius=a.bdRadius;this.lineWidth=a.lineWidth;this.context=a.context;this.canvas=a.canvas;this.parent=parent;this.color=a.color},getGradient:function(){this.defaultBg=this.color.defaultBg.split(";");this.enterBg=this.color.enterBg;this.borderColor1=this.defaultBg[2];this.bgColor=this.defaultBg[0];
this.leftBg=this.context.createRadialGradient(this.width/9,this.height/2+this.lineWidth/2,0,this.width/9,this.height/2+this.lineWidth/2,.45*this.width);this.leftBg.addColorStop(0,this.defaultBg[1]);this.leftBg.addColorStop(1,Color(this.defaultBg[1]).rgba(0));this.rightBg=this.context.createRadialGradient(.9*this.width,this.height/2*3+this.lineWidth/2,0,.9*this.width,this.height/2*3+this.lineWidth/2,.45*this.width);this.rightBg.addColorStop(0,this.defaultBg[1]);this.rightBg.addColorStop(1,Color(this.defaultBg[1]).rgba(0))},
drawCenterBg:function(){this.context.save();this.context.scale(1,.25);this.context.beginPath();this.context.fillStyle=this.leftBg;this.context.moveTo(this.bdRadius+this.lineWidth/1.8,2*this.lineWidth-this.lineWidth/10);this.context.arcTo(this.width-this.lineWidth/2,2*this.lineWidth,this.width-this.lineWidth/2,2*this.height-2*this.lineWidth,2*this.bdRadius);this.context.arcTo(this.width-this.lineWidth/2,2*this.height-2*this.lineWidth,this.lineWidth/1.8,2*this.height-2*this.lineWidth,2*this.bdRadius);
this.context.arcTo(this.lineWidth/1.8,2*this.height-2*this.lineWidth,this.lineWidth/1.8,2*this.lineWidth,2*this.bdRadius);this.context.arcTo(this.lineWidth/1.8,1.8*this.lineWidth,this.width-this.lineWidth/2,2*this.lineWidth,2*this.bdRadius);this.context.fill();this.context.closePath();this.context.beginPath();this.context.moveTo(this.bdRadius+this.lineWidth/2,2*this.lineWidth-this.lineWidth/10);this.context.arcTo(this.width-this.lineWidth/1.8,2*this.lineWidth,this.width-this.lineWidth/2,2*this.height-
2*this.lineWidth,2*this.bdRadius);this.context.arcTo(this.width-this.lineWidth/1.8,2*this.height-1.8*this.lineWidth,this.lineWidth/2,2*this.height-2*this.lineWidth,2*this.bdRadius);this.context.arcTo(this.lineWidth/2,2*this.height-2*this.lineWidth,this.lineWidth/2+this.lineWidth/10,2*this.lineWidth,2*this.bdRadius);this.context.arcTo(this.lineWidth/2,2*this.lineWidth,this.width-this.lineWidth/2,2*this.lineWidth,2*this.bdRadius);this.context.fillStyle=this.rightBg;this.context.fill();this.context.closePath();
this.context.restore()},drawCover:function(){this.context.beginPath();this.context.moveTo(this.lineWidth/2,this.lineWidth/2+this.bdRadius);this.context.lineTo(this.lineWidth/2,this.height/8*3.5);this.context.quadraticCurveTo(this.width/5,this.height/10,.9*this.width,this.lineWidth/2);this.context.arcTo(this.lineWidth/2,this.lineWidth/2,this.lineWidth/2,this.height/8*3.5,this.bdRadius);var a=this.context.createLinearGradient(0,this.lineWidth/2,0,this.height/2);a.addColorStop(0,"rgba(255,255,255,0.05)");
a.addColorStop(1,"rgba(255,255,255,0.1)");this.context.fillStyle=a;this.context.fill();this.context.closePath();this.context.beginPath();this.context.moveTo(this.lineWidth/2,this.lineWidth/2+this.bdRadius);this.context.lineTo(this.lineWidth/2,this.height/8*3.5);this.context.quadraticCurveTo(this.width/2,.4*this.height,.9*this.width,this.lineWidth/2);this.context.arcTo(this.lineWidth/2,this.lineWidth/2,this.lineWidth/2,this.height/8*3.5,this.bdRadius);this.context.fillStyle=a;this.context.fill();this.context.closePath()},
drawBorder:function(){this.context.beginPath();this.context.lineWidth=this.lineWidth/10;this.context.moveTo(this.bdRadius+this.lineWidth/2,this.lineWidth/2);this.context.arcTo(this.width-this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,this.height/2-this.lineWidth/2,this.bdRadius);this.context.arcTo(this.width-this.lineWidth/2,this.height/2-this.lineWidth/2,this.lineWidth/2,this.height/2-this.lineWidth/2,this.bdRadius);this.context.arcTo(this.lineWidth/2,this.height/2-this.lineWidth/
2,this.lineWidth/2,this.lineWidth/2,this.bdRadius);this.context.arcTo(this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,this.lineWidth/2,this.bdRadius);this.context.strokeStyle=this.borderColor1;this.context.stroke()}}).extend("GlossyButton");
Class("GlossButton5",{create:function(a,b){this._super(a,b)},getGradient:function(){this.defaultBg=this.color.defaultBg.split(";");this.enterBg=this.color.enterBg;this.borderColor1=this.defaultBg[2];this.bgColor=this.defaultBg[0];this.leftBg=this.context.createRadialGradient(this.width/15,this.height+this.lineWidth/2,0,this.width/15,this.height+this.lineWidth/2,.45*this.width);this.leftBg.addColorStop(0,this.defaultBg[1]);this.leftBg.addColorStop(1,Color(this.defaultBg[1]).rgba(0));this.rightBg=this.context.createRadialGradient(.9*
this.width,this.height+this.lineWidth/2,0,.9*this.width,this.height+this.lineWidth/2,.45*this.width);this.rightBg.addColorStop(0,this.defaultBg[1]);this.rightBg.addColorStop(1,Color(this.defaultBg[1]).rgba(0));this.center=this.context.createRadialGradient(this.width/2,this.height+this.lineWidth/2,0,this.width/2,this.height+this.lineWidth/2,this.width/2);this.center.addColorStop(0,this.defaultBg[1]);this.center.addColorStop(1,Color(this.defaultBg[1]).rgba(0))}}).extend("GlossButton4");
Class("GlossButton6",{create:function(a,b){this._super(a,b)},getGradient:function(){this.defaultBg=this.color.defaultBg.split(";");this.enterBg=this.color.enterBg;this.borderColor1=this.defaultBg[2];this.bgColor=this.defaultBg[0];this.leftBg=this.context.createRadialGradient(this.width/2+this.lineWidth,this.lineWidth,0,this.width/2+this.lineWidth,this.lineWidth,this.width/2);this.leftBg.addColorStop(0,this.defaultBg[1]);this.leftBg.addColorStop(1,Color(this.defaultBg[1]).rgba(0));this.rightBg=this.context.createRadialGradient(this.width/
2+this.lineWidth/4,2*this.height-2*this.lineWidth,0,this.width/2+this.lineWidth/4,2*this.height-2*this.lineWidth,this.width/2);this.rightBg.addColorStop(0,this.defaultBg[1]);this.rightBg.addColorStop(1,Color(this.defaultBg[1]).rgba(0))}}).extend("GlossButton4");
Class("PushButton",{create:function(a,b){a.width&&a.height&&a.id&&b&&(this.width=a.width/.6,this.height=a.height,this.bdRadius=this.height/6,this.id=a.id,this.lineWidth=this.height/30,this.parent=b,this.enter=!1,this.initConfig(),this.initHtml(),this.getGradient(),this.drawButton(),this.initCss(),isPhone()||isPad()||this.initEvent())},initHtml:function(){this.canvas=$("<canvas width='"+.6*this.width+"' height='"+this.height+"'></canvas>");this.context=this.canvas[0].getContext("2d");this.context.scale(.6,
1);this.parent.append(this.canvas)},initCss:function(){this.canvas.css({position:"absolute",left:"0",top:"0"})},onResize:function(a,b){this.lineWidth=b/30;this.width=a/.6;this.height=b;this.bdRadius=this.height/6;this.canvas[0].width=.6*this.width;this.canvas[0].height=this.height;this.context.scale(.6,1);this.getGradient();this.drawButton()},draw:function(){this.context.clearRect(0,0,this.width+10,this.height+10);this.context.lineWidth=this.lineWidth;this.context.beginPath();this.context.moveTo(this.bdRadius+
2*this.lineWidth,this.lineWidth);this.context.arcTo(this.width-2*this.lineWidth,this.lineWidth,this.width-this.lineWidth,this.height-this.lineWidth/2,this.bdRadius+this.lineWidth/2);this.context.arcTo(this.width-2*this.lineWidth,this.height-this.lineWidth/2,this.lineWidth,this.height-this.lineWidth/2,this.bdRadius+this.lineWidth/2);this.context.arcTo(2*this.lineWidth,this.height-this.lineWidth/2,this.lineWidth,this.lineWidth,this.bdRadius+this.lineWidth/2);this.context.arcTo(2*this.lineWidth,this.lineWidth,
this.width-this.lineWidth/2,this.lineWidth,this.bdRadius+this.lineWidth/2);this.context.fillStyle=this.outerBg;this.context.fill();this.context.closePath();this.context.beginPath();this.context.moveTo(4*this.lineWidth,2*this.lineWidth);var a=this.context.createLinearGradient(0,this.lineWidth,0,this.height/2+this.lineWidth);a.addColorStop(0,"rgba(255,255,255,0.90)");a.addColorStop(1,"rgba(255,255,255,0.2)");this.context.fillStyle=a;this.context.arcTo(this.width-4*this.lineWidth,2*this.lineWidth,this.width-
4*this.lineWidth,this.height/2+this.lineWidth,this.bdRadius);this.context.arcTo(this.width-4*this.lineWidth,this.height/2+this.lineWidth,4*this.lineWidth,this.height/2+this.lineWidth,this.bdRadius);this.context.arcTo(4*this.lineWidth,this.height/2+this.lineWidth,4*this.lineWidth,this.lineWidth,this.bdRadius);this.context.arcTo(4*this.lineWidth,2*this.lineWidth,this.width-4*this.lineWidth,this.lineWidth,this.bdRadius);this.context.fill();this.context.closePath()},initConfig:function(){this.pushs=[{defaultBg:"rgb(78,78,78);rgb(11,11,11);rgb(182,182,182)",
enterBg:"rgb(11,11,11);rgb(101,101,101);rgb(255,255,255)"},{defaultBg:"rgb(1,46,90);rgb(1,83,165);rgb(81,180,249)",enterBg:"rgb(1,46,90);rgb(42,147,253);rgb(255,255,255)"},{defaultBg:"rgb(149,13,13);rgb(200,0,0);rgb(234,111,111)",enterBg:"rgb(120,0,0);rgb(199,33,33);rgb(255,255,255)"},{defaultBg:"rgb(99,144,0);rgb(128,199,16);rgb(198,230,150)",enterBg:"rgb(97,140,0);rgb(136,204,35);rgb(255,255,255)"},{defaultBg:"rgb(125,63,1);rgb(174,90,9);rgb(249,180,92)",enterBg:"rgb(166,78,1);rgb(229,128,26);rgb(255,255,255)"},
{defaultBg:"rgb(122,122,1);rgb(170,170,6);rgb(251,251,72)",enterBg:"rgb(152,151,1);rgb(249,249,1);rgb(254,249,249)"}]},getGradient:function(){this.defaultBg=this.pushs[this.id-1].defaultBg.split(";");this.enterBg=this.pushs[this.id-1].enterBg.split(";");this.outerBg=this.context.createRadialGradient(this.width/2,this.height/2,0,this.width/2,this.height/2,this.width/3*2)},drawButton:function(){this.context.clearRect(0,0,this.width,this.height);this.context.beginPath();this.outerBg.addColorStop(0,this.defaultBg[0]);
this.outerBg.addColorStop(.25,this.defaultBg[1]);this.outerBg.addColorStop(.8,this.defaultBg[2]);this.outerBg.addColorStop(1,this.defaultBg[2]);this.draw()},enterEvent:function(){this.getGradient();(function(a,b){this.getGradient();this.enter?(a=.2+.43*a/b,this.outerBg.addColorStop(0,this.enterBg[0]),this.outerBg.addColorStop(a,this.enterBg[1]),this.outerBg.addColorStop(.75,this.enterBg[2]),this.outerBg.addColorStop(1,this.enterBg[2])):(a=.6-.4*a/b,this.outerBg.addColorStop(0,this.defaultBg[0]),this.outerBg.addColorStop(a,
this.defaultBg[1]),this.outerBg.addColorStop(.8,this.defaultBg[2]),this.outerBg.addColorStop(1,this.defaultBg[2]));this.draw()}).animation(this,300)},initEvent:function(){this.canvas.bind(_event._enter,function(){this.enter=!0;this.enterEvent()}.bind(this));this.canvas.bind(_event._leave,function(){this.enter=!1;this.enterEvent()}.bind(this))}});
Class("LineLightButton",{create:function(a,b){b&&(this.lineWidth=a.height/30,this.width=a.width-this.lineWidth,this.height=a.height-this.lineWidth,this.bdRadius=this.height/6,this.id=a.id,this.parent=b,this.enter=!1,this.initConfig(),this.initHtml(),this.initCss(),this.getGradient(),this.drawButton(),isPhone()||isPad()||this.initEvent())},initHtml:function(){this.canvas=$("<canvas width='"+this.width+"' height='"+this.height+"'></canvas>");this.context=this.canvas[0].getContext("2d");this.parent.append(this.canvas)},
onResize:function(a,b){this.lineWidth=b/30;this.width=a;this.height=b;this.bdRadius=this.height/6;this.canvas[0].width=this.width;this.canvas[0].height=this.height;this.getGradient();this.drawButton()},initCss:function(){this.canvas.css({position:"absolute",left:"0",top:"0"})},draw:function(){this.context.clearRect(0,0,this.width+10,this.height+10);this.context.beginPath();this.context.strokeStyle=this.borderColor1;this.context.moveTo(this.bdRadius+this.lineWidth,this.lineWidth);this.context.arcTo(this.width-
this.lineWidth,this.lineWidth,this.width-this.lineWidth,this.height-this.lineWidth/2,this.bdRadius+this.lineWidth/2);this.context.arcTo(this.width-this.lineWidth,this.height-this.lineWidth/2,this.lineWidth,this.height-this.lineWidth/2,this.bdRadius+this.lineWidth/2);this.context.arcTo(this.lineWidth,this.height-this.lineWidth/2,this.lineWidth,this.lineWidth,this.bdRadius+this.lineWidth/2);this.context.arcTo(this.lineWidth,this.lineWidth,this.width-this.lineWidth/2,this.lineWidth,this.bdRadius+this.lineWidth/
2);this.context.fillStyle=this.outerBg;this.context.fill();this.context.closePath();this.context.beginPath();this.context.moveTo(2*this.lineWidth,2*this.lineWidth);var a=this.context.createLinearGradient(0,this.lineWidth,0,this.height/2+this.lineWidth);a.addColorStop(0,"rgba(255,255,255,0.90)");a.addColorStop(1,"rgba(255,255,255,0.2)");this.context.fillStyle=a;this.context.arcTo(this.width-2*this.lineWidth,2*this.lineWidth,this.width-2*this.lineWidth,this.height/2+this.lineWidth,this.bdRadius);this.context.arcTo(this.width-
2*this.lineWidth,this.height/2+this.lineWidth,2*this.lineWidth,this.height/2+this.lineWidth,this.bdRadius);this.context.arcTo(2*this.lineWidth,this.height/2+this.lineWidth,2*this.lineWidth,2*this.lineWidth,this.bdRadius);this.context.arcTo(2*this.lineWidth,2*this.lineWidth,this.width-2*this.lineWidth,2*this.lineWidth,this.bdRadius);this.context.fill();this.context.closePath()},initConfig:function(){this.pushs=[{defaultBg:"rgb(81,76,25);rgb(244,227,73);rgb(81,76,25)",enterBg:"rgb(81,76,25);rgb(244,227,73);rgb(185,167,21)"},
{defaultBg:"rgb(26,11,1);rgb(245,107,16);rgb(26,11,1)",enterBg:"rgb(26,11,1);rgb(245,107,16);rgb(181,77,9)"},{defaultBg:"rgb(7,70,12);rgb(67,229,82);rgb(7,70,12)",enterBg:"rgb(7,70,12);rgb(35,250,35);rgb(8,98,11)"},{defaultBg:"rgb(112,8,8);rgb(253,76,76);rgb(31,9,9)",enterBg:"rgb(112,8,8);rgb(253,76,76);rgb(187,18,18)"},{defaultBg:"rgb(12,61,123);rgb(59,155,252);rgb(11,22,32)",enterBg:"rgb(12,61,123);rgb(59,155,252);rgb(14,86,184)"}]},getGradient:function(){this.defaultBg=this.pushs[this.id-1].defaultBg.split(";");
this.enterBg=this.pushs[this.id-1].enterBg.split(";");this.outerBg=this.context.createLinearGradient(0,this.lineWidth,0,this.height+this.lineWidth)},drawButton:function(){this.context.clearRect(0,0,this.width+this.lineWidth,this.height+this.lineWidth);this.context.beginPath();this.outerBg.addColorStop(0,this.defaultBg[0]);this.outerBg.addColorStop(.5,this.defaultBg[1]);this.outerBg.addColorStop(1,this.defaultBg[2]);this.draw();this.drawHint()},drawHint:function(){this.context.beginPath();this.context.strokeStyle=
"#333";this.context.fillStyle="rgba(255,255,255,0.4)";this.context.moveTo(.9*this.bdRadius,this.height-.88*this.bdRadius-this.lineWidth);this.context.bezierCurveTo(.5*this.bdRadius,this.height+.2*this.bdRadius-this.lineWidth,2*this.lineWidth,this.height-.2*this.bdRadius-this.lineWidth,this.width-this.bdRadius,this.height-.1*this.bdRadius-this.lineWidth);this.context.closePath();this.context.fill();this.context.beginPath();this.context.strokeStyle="transparent";this.context.fillStyle=this.outerBg;
this.context.moveTo(.9*this.bdRadius,this.height-this.bdRadius-this.lineWidth);this.context.bezierCurveTo(.5*this.bdRadius,this.height-.5*this.bdRadius-this.lineWidth,this.width/3,this.height-.05*this.bdRadius-this.lineWidth,this.width/3*2,this.height-.3*this.bdRadius-this.lineWidth);this.context.lineTo(this.width-this.bdRadius,this.height-.2*this.bdRadius-this.lineWidth);this.context.closePath();this.context.fill()},enterEvent:function(){this.getGradient();this.change=function(a,b){this.getGradient();
this.enter?(a=.5+.35*a/b,this.outerBg.addColorStop(0,this.enterBg[0]),this.outerBg.addColorStop(a,this.enterBg[1]),this.outerBg.addColorStop(1,this.enterBg[2])):(a=.85-.35*a/b,this.outerBg.addColorStop(0,this.defaultBg[0]),this.outerBg.addColorStop(a,this.defaultBg[1]),this.outerBg.addColorStop(1,this.defaultBg[2]));this.draw();this.drawHint()};this.timer&&this.timer.stop();this.timer=this.change.animation(this,400)},initEvent:function(){this.canvas.bind(_event._enter,function(){this.enter=!0;this.enterEvent()}.bind(this));
this.canvas.bind(_event._leave,function(){this.enter=!1;this.enterEvent()}.bind(this))}});
Class("StarButton",{create:function(a,b){b&&(this.lineWidth=a.height/30,this.width=a.width-this.lineWidth,this.height=a.height-this.lineWidth,this.bdRadius=parseInt(this.height/12),this.id=a.id,this.parent=b,this.enter=!1,this.initConfig(),this.getGradient(),this.initHtml(),this.initCss(),isPhone()||isPad()||this.initEvent())},initHtml:function(){this.canvas=$("<canvas width='"+(this.width+50)+"' height='"+(this.height+50)+"'></canvas>");this.context=this.canvas[0].getContext("2d");this.context.translate(20,
20);this.parent.append(this.canvas);this.drawButton()},initCss:function(){this.canvas.css({position:"absolute",left:"-20px",top:"-20px"})},onResize:function(a,b){this.lineWidth=b/30;this.width=a-this.lineWidth;this.height=b-this.lineWidth;this.bdRadius=parseInt(this.height/12);this.canvas[0].width=this.width+50;this.canvas[0].height=this.height+50;this.context.translate(20,20);this.getGradient();this.drawButton()},draw:function(){this.context.clearRect(-50,-50,this.width+100,this.height+100);this.context.shadowColor=
1==this.id||5==this.id?this.enterBg[1]:this.enterBg[0];this.context.shadowBlur=this.height/10;this.context.lineWidth=this.lineWidth;this.context.fillStyle=this.outerBg;this.context.beginPath();this.context.fillStyle=this.outerBg;this.context.moveTo(this.lineWidth/2,this.lineWidth/2);this.context.arcTo(this.width-this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,this.height-this.lineWidth/2,this.bdRadius);this.context.arcTo(this.width-this.lineWidth/2,this.height-this.lineWidth/2,this.lineWidth/
2,this.height-this.lineWidth/2,this.bdRadius);this.context.arcTo(this.lineWidth/2,this.height-this.lineWidth/2,this.lineWidth/2,this.lineWidth/2,this.bdRadius);this.context.arcTo(this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,this.lineWidth/2,this.bdRadius);this.context.fill();this.context.closePath();this.context.beginPath();this.context.strokeStyle=this.borderColor1;this.context.beginPath();this.context.moveTo(this.bdRadius+1.5*this.lineWidth,1.5*this.lineWidth);this.context.arcTo(this.width-
2*this.lineWidth,1.5*this.lineWidth,this.width-2*this.lineWidth,this.height-2*this.lineWidth,this.bdRadius);this.context.stroke();this.context.closePath();this.context.beginPath();this.context.moveTo(this.width-2*this.lineWidth,this.bdRadius+this.lineWidth);this.context.strokeStyle=this.borderColor2;this.context.arcTo(this.width-2*this.lineWidth,this.height-2*this.lineWidth,1.5*this.lineWidth,this.height-2*this.lineWidth,this.bdRadius);this.context.stroke();this.context.closePath();this.context.strokeStyle=
this.borderColor3;this.context.beginPath();this.context.moveTo(this.width-2*this.lineWidth-this.bdRadius,this.height-2*this.lineWidth);this.context.arcTo(1.5*this.lineWidth,this.height-2*this.lineWidth,1.5*this.lineWidth,1.5*this.lineWidth,this.bdRadius);this.context.stroke();this.context.closePath();this.context.beginPath();this.context.moveTo(1.5*this.lineWidth,this.height-2*this.lineWidth);this.context.strokeStyle=this.borderColor4;this.context.arcTo(1.5*this.lineWidth,1.5*this.lineWidth,this.width-
2*this.lineWidth,1.5*this.lineWidth,this.bdRadius);this.context.stroke();this.context.closePath()},initConfig:function(){this.stars=[{defaultBg:"rgba(0,0,204,1);rgb(14,6,89);rgb(0,0,0)",enterBg:"#fff;#00f"},{defaultBg:"rgb(0,0,30);rgb(0,0,15);rgb(0,0,0)",enterBg:"#C48939;#F5A505"},{defaultBg:"rgb(26,0,154);rgb(16,0,61);rgb(0,0,0)",enterBg:"#F00898;#1A0060"},{defaultBg:"rgb(0,16,0);rgb(0,8,0);rgb(0,0,0)",enterBg:"#0AFA00;#000B00"},{defaultBg:"rgb(173,15,203);rgb(129,7,107);rgb(112,0,0)",enterBg:"#F8F1F6;#8A0BA0"}]},
getGradient:function(){this.defaultBg=this.stars[this.id-1].defaultBg.split(";");this.enterBg=this.stars[this.id-1].enterBg.split(";")},drawButton:function(){this.enterBg1=Color(this.enterBg[0]);this.enterBg2=Color(this.enterBg[1]);this.context.clearRect(-50,-50,this.width+50,this.height+50);this.context.beginPath();this.setColor();this.draw()},setColor:function(){this.borderColor1=this.context.createLinearGradient(0,0,this.width/2,0);this.borderColor1.addColorStop(0,this.enterBg1.rgba(.5));this.borderColor1.addColorStop(.25,
this.enterBg1.rgba(1));this.borderColor1.addColorStop(1,this.enterBg1.rgba(0));this.borderColor2=this.context.createLinearGradient(0,this.height/2-this.lineWidth,0,this.height);this.borderColor2.addColorStop(0,this.enterBg1.rgba(0));this.borderColor2.addColorStop(1,this.enterBg1.rgba(.5));this.borderColor3=this.context.createLinearGradient(this.width,0,this.width/2,0);this.borderColor3.addColorStop(0,this.enterBg1.rgba(.5));this.borderColor3.addColorStop(1,this.enterBg1.rgba(0));this.borderColor4=
this.context.createLinearGradient(0,this.height+this.lineWidth,0,0);this.borderColor4.addColorStop(0,this.enterBg1.rgba(0));this.borderColor4.addColorStop(1,this.enterBg1.rgba(.7));this.outerBg=this.context.createRadialGradient(this.width/6,1.5*this.height,this.height/4,this.width/4,this.height+this.lineWidth,this.width);this.outerBg.addColorStop(0,this.defaultBg[0]);this.outerBg.addColorStop(.5,this.defaultBg[1]);this.outerBg.addColorStop(1,this.defaultBg[2])},insetColor:function(a){a||(a=1);this.starBg1=
this.context.createRadialGradient(this.bdRadius+.1*this.width,2*this.lineWidth,0,this.bdRadius+.1*this.width,2*this.lineWidth,this.height/(11-5*a));this.starBg1.addColorStop(0,this.enterBg1.rgba(.6));this.starBg1.addColorStop(.5,this.enterBg1.rgba(.1));this.starBg1.addColorStop(1,this.enterBg2.rgba(0));this.lineBG1=this.context.createLinearGradient(1,0,this.bdRadius+.2*this.width,0);this.lineBG1.addColorStop(0,this.enterBg2.rgba(.2));this.lineBG1.addColorStop(1,this.enterBg1.rgba(.4));this.starOutBg1=
this.context.createRadialGradient(this.bdRadius+.1*this.width,2*this.lineWidth,0,this.bdRadius+.1*this.width,2*this.lineWidth,.5*this.height*a);this.starOutBg1.addColorStop(0,this.enterBg1.rgba(.1));this.starOutBg1.addColorStop(1,this.enterBg1.rgba(0));this.starBg2=this.context.createRadialGradient(.85*this.width+this.bdRadius,this.height-2*this.lineWidth,0,.85*this.width+this.bdRadius,this.height-2*this.lineWidth,this.height/(11-5*a));this.starBg2.addColorStop(0,this.enterBg1.rgba(.6));this.starBg2.addColorStop(.5,
this.enterBg1.rgba(.1));this.starBg2.addColorStop(1,this.enterBg2.rgba(0));this.lineBG2=this.context.createLinearGradient(.9*this.width+this.bdRadius,0,this.width+this.bdRadius+25*a,0);this.lineBG2.addColorStop(0,this.enterBg1.rgba(.4));this.lineBG2.addColorStop(1,this.enterBg2.rgba(.2));this.starOutBg2=this.context.createRadialGradient(.85*this.width+this.bdRadius,this.height-2*this.lineWidth,0,.85*this.width+this.bdRadius,this.height-2*this.lineWidth,.5*this.height*a);this.starOutBg2.addColorStop(0,
this.enterBg1.rgba(.1));this.starOutBg2.addColorStop(1,this.enterBg1.rgba(0))},drawStar:function(a){a||(a=1);this.context.beginPath();this.context.lineWidth=this.height/100;this.context.shadowColor=this.enterBg1.rgba(1);this.context.shadowBlur=this.height/50;this.context.moveTo(this.lineWidth-25*a,1.5*this.lineWidth);this.context.strokeStyle=this.lineBG1;this.context.lineTo(this.bdRadius+.1*this.width,1.5*this.lineWidth);this.context.stroke();this.context.closePath();this.context.beginPath();this.context.fillStyle=
this.starOutBg1;this.context.shadowColor=this.enterBg2.rgba(1);this.context.shadowBlur=20;this.context.arc(this.bdRadius+.1*this.width,2*this.lineWidth,this.height/(2-1*a),0,2*Math.PI,!1);this.context.fill();this.context.closePath();this.context.beginPath();this.context.fillStyle=this.starBg1;this.context.shadowColor=this.enterBg1.rgba(1);this.context.shadowBlur=20;this.context.arc(this.bdRadius+.1*this.width,2*this.lineWidth,this.height/(10-5*a),0,2*Math.PI,!1);this.context.fill();this.context.closePath();
this.context.beginPath();this.context.shadowColor=this.enterBg1.rgba(1);this.context.shadowBlur=this.height/50;this.context.moveTo(.9*this.width+this.bdRadius,this.height-2*this.lineWidth);this.context.strokeStyle=this.lineBG2;this.context.lineTo(this.width-this.lineWidth+25*a,this.height-2*this.lineWidth);this.context.stroke();this.context.closePath();this.context.beginPath();this.context.fillStyle=this.starOutBg2;this.context.shadowColor=this.enterBg2.rgba(1);this.context.shadowBlur=20;this.context.arc(.85*
this.width+this.bdRadius,this.height-2*this.lineWidth,this.height/(2-1*a),0,2*Math.PI,!1);this.context.fill();this.context.closePath();this.context.beginPath();this.context.fillStyle=this.starBg2;this.context.shadowColor=this.enterBg1.rgba(1);this.context.shadowBlur=20;this.context.arc(.85*this.width+this.bdRadius,this.height-2*this.lineWidth,this.height/(10-5*a),0,2*Math.PI,!1);this.context.fill();this.context.closePath()},enterEvent:function(){this.getGradient();this.change=function(a,b){this.draw();
this.hasChange?a==b?(this.hasChange=!1,this.focus&&(this.timer&&this.timer.stop(),this.timer=this.change.animation(this,400))):(this.insetColor(1-a/b),this.drawStar(1-a/b)):a==b?(this.hasChange=!0,this.focus&&(this.timer&&this.timer.stop(),this.timer=this.change.animation(this,400))):(this.insetColor(a/b),this.drawStar(a/b))};this.timer&&this.timer.stop();this.timer=this.change.animation(this,400)},initEvent:function(){this.canvas.bind(_event._enter,function(){this.focus=!0;this.hasChange=!1;this.enterEvent()}.bind(this));
this.canvas.bind(_event._leave,function(){this.focus=!1;this.context.clearRect(-50,-50,this.width+50,this.height+50);this.drawButton()}.bind(this))}});
Class("GlitterButton",{create:function(a,b){b&&(this.lineWidth=a.height/40,this.width=a.width,this.height=a.height,this.id=a.id,this.bdRadius=this.height/20,this.parent=b,this.enter=!1,this.initConfig(),this.initHtml(),this.initCss(),this.getGradient(),this.setEllipseBg(),this.draw(),isPhone()||isPad()||this.initEvent())},initHtml:function(){this.canvas=$("<canvas width='"+this.width+"' height='"+(this.height+this.height/20)+"'></canvas>");this.context=this.canvas[0].getContext("2d");this.parent.append(this.canvas)},
initCss:function(){this.canvas.css({position:"absolute",background:"#eee",left:"0",top:"0"})},onResize:function(a,b){this.lineWidth=b/40;this.width=a;this.height=b;this.bdRadius=this.height/20;this.canvas[0].width=a;this.canvas[0].height=b+this.height/20;this.getGradient();this.setEllipseBg();this.draw()},draw:function(){this.context.clearRect(0,0,this.width+10,3*this.height+10);this.context.beginPath();this.context.moveTo(this.lineWidth/2,this.lineWidth/2);this.context.arcTo(this.width-this.lineWidth/
2,this.lineWidth/2,this.width-this.lineWidth/2,this.height-this.lineWidth/2,this.bdRadius);this.context.arcTo(this.width-this.lineWidth/2,this.height-this.lineWidth/2,this.lineWidth/2,this.height-this.lineWidth/2,this.bdRadius);this.context.arcTo(this.lineWidth/2,this.height-this.lineWidth/2,this.lineWidth/2,this.lineWidth/2,this.bdRadius);this.context.arcTo(this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,this.lineWidth/2,this.bdRadius);this.context.fillStyle=this.outerBg;this.context.fill();
this.context.closePath();this.drawCover();this.drawEllipse();this.drawBottomLine()},drawBottomLine:function(){this.context.beginPath();this.context.lineWidth=this.lineWidth/2;this.context.moveTo(this.lineWidth/2,this.lineWidth/2);this.context.lineTo(this.width-this.lineWidth/2,this.lineWidth/2);var a=this.context.createLinearGradient(this.lineWidth/2,0,this.width-this.lineWidth/2,0);a.addColorStop(0,Color(this.defaultBg[2]).rgba(.05));a.addColorStop(.5,Color(this.defaultBg[2]).rgba(.3));a.addColorStop(1,
Color(this.defaultBg[2]).rgba(.05));this.context.strokeStyle=a;this.context.stroke();this.context.closePath();this.context.save();this.context.beginPath();this.context.shadowColor=this.enterBg[2];this.context.shadowBlur=this.height/30;this.context.shadowOffsetX=0;this.context.shadowOffsetY=this.height/40;a=this.context.createLinearGradient(this.lineWidth/2,0,this.width-this.lineWidth/2,0);a.addColorStop(.1,"rgba(255,255,255,0.3)");a.addColorStop(.5,"rgba(255,255,255,1)");a.addColorStop(.9,"rgba(255,255,255,0.3)");
this.context.strokeStyle=a;this.context.lineWidth=0;this.focus&&(this.context.lineWidth=2);this.context.moveTo(this.lineWidth/2,this.height-this.lineWidth/2);this.context.lineTo(this.width-this.lineWidth/2,this.height-this.lineWidth/2);this.context.stroke();this.context.closePath();this.context.restore()},drawCover:function(){this.context.save();this.context.beginPath();this.context.moveTo(this.lineWidth,this.lineWidth);var a=this.context.createLinearGradient(0,this.lineWidth,0,this.height/2+this.lineWidth);
a.addColorStop(0,"rgba(255,255,255,0.8)");a.addColorStop(.5,"rgba(255,255,255,0.35)");a.addColorStop(1,"rgba(255,255,255,0.2)");this.context.fillStyle=a;this.context.arcTo(this.width-this.lineWidth,this.lineWidth,this.width-this.lineWidth,this.height/2.6+this.lineWidth,this.bdRadius);this.context.lineTo(this.width-this.lineWidth,this.height/2.6+this.lineWidth,this.lineWidth,this.height/2.6+this.lineWidth);this.context.lineTo(this.lineWidth,this.height/2.6+this.lineWidth,this.lineWidth,this.lineWidth);
this.context.arcTo(this.lineWidth,this.lineWidth,this.width-this.lineWidth,this.lineWidth,this.bdRadius);this.context.fill();this.context.closePath();this.context.beginPath();this.context.moveTo(this.lineWidth,this.height/2.6+this.lineWidth);this.context.bezierCurveTo(this.width/4+this.lineWidth/2,this.height/2.6+this.lineWidth+this.height/8,.75*this.width-this.lineWidth/2,this.height/2.6+this.lineWidth+this.height/8,this.width-this.lineWidth/2,this.height/2.6+this.lineWidth);this.context.fill();
this.context.closePath();this.context.restore()},drawEllipse:function(){this.context.save();this.context.scale(1,1/3);this.context.beginPath();this.context.shadowColor=Color(this.defaultBg[2]).rgba(.9);this.context.shadowBlur=this.height/3;this.context.fillStyle=this.enterRoundBg;this.context.fillRect(this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,3*(this.height-this.lineWidth/2));this.context.fill();this.context.closePath();this.context.restore()},initConfig:function(){this.glitters=
[{defaultBg:"#FFFFFF;#8BA8B1;#00AAFC",enterBg:"#03AaFF;#fff;#000"},{defaultBg:"#9195A4;#060606;#0336FF",enterBg:"#0022ff;#fff;#1534E3"},{defaultBg:"#EBE9E7;#ACACAB;#FA6703;",enterBg:"#E1CD57;#fff;#000"},{defaultBg:"#FFFFFF;#F98435;#F73BF7;",enterBg:"#FFCD05;#fff;#000"},{defaultBg:"#D0CED1;#0C0C0C;#DA09AE;",enterBg:"#A70080;#fff;#F000E8"},{defaultBg:"#E0DEDB;#080808;#FF9005",enterBg:"#EA7E00;#fff;#F0BC00"}]},getGradient:function(){this.defaultBg=this.glitters[this.id-1].defaultBg.split(";");this.enterBg=
this.glitters[this.id-1].enterBg.split(";");var a=Color(this.enterBg[0]);this.outerBg=this.context.createLinearGradient(0,5,0,this.height+5);this.outerBg.addColorStop(0,this.defaultBg[0]);this.outerBg.addColorStop(.4,Color(this.defaultBg[1]).rgba(.6));this.outerBg.addColorStop(1,this.defaultBg[1]);this.leaveShineBg=this.context.createRadialGradient(.5*this.width,2.25*this.height,0,.5*this.width,2.25*this.height,this.width/3*2);this.leaveShineBg.addColorStop(0,a.rgba(1));this.leaveShineBg.addColorStop(.6,
a.rgba(.6));this.leaveShineBg.addColorStop(1,a.rgba(0))},setShineColor:function(a){a=Color(this.enterBg[1]);var b=Color(this.enterBg[0]);this.enterShineBg=this.context.createRadialGradient(.5*this.width+this.lineWidth/2,this.height/2*3,0,.5*this.width+this.lineWidth/2,this.height/2*3,this.width/1.5);2==this.shineCase?this.enterShineBg.addColorStop(0,a.rgba(.65)):this.enterShineBg.addColorStop(0,a.rgba(.45));this.enterShineBg.addColorStop(.9,b.rgba(0))},setEllipseBg:function(){var a=Color(this.enterBg[0]);
this.enterRoundBg=this.context.createRadialGradient(.5*this.width,this.height/2*3,0,.5*this.width,this.height/2*3,(this.width-this.lineWidth)/1.7);this.focus?(this.enterRoundBg.addColorStop(0,a.rgba(.25)),this.enterRoundBg.addColorStop(.4,a.rgba(.1)),this.enterRoundBg.addColorStop(.7,a.rgba(.05)),this.enterRoundBg.addColorStop(1,a.rgba(0))):(this.enterRoundBg.addColorStop(0,Color(this.defaultBg[2]).rgba(.2)),this.enterRoundBg.addColorStop(.8,Color(this.defaultBg[2]).rgba(0)))},drawShine:function(a){a||
(a=1);this.context.save();this.context.scale(1,1/3);this.context.beginPath();this.context.shadowColor=Color(this.enterBg[1]).rgba(1);this.context.shadowBlur=this.height;this.context.fillStyle=this.leaveShineBg;this.context.fillRect(this.lineWidth/2,this.lineWidth/2,this.width,3*this.height);this.context.fill();this.context.closePath();this.context.beginPath();this.context.shadowColor=Color(this.enterBg[1]).rgba(1);this.context.shadowBlur=this.height/2;this.context.fillStyle=this.enterShineBg;this.context.fillRect(this.width/
2+this.lineWidth-(this.width/2+this.lineWidth/2)*a,this.lineWidth,1.1*this.width*a-.1*this.width,3*this.height);this.context.fill();this.context.closePath();this.context.restore()},enterEvent:function(){this.getGradient();this.change=function(a,b){var c=this.focus?a/b:1-a/b;this.setShineColor(1);this.draw();this.drawShine(c);a==b&&(this.focus?(this.shineTimer&&this.shineTimer.stop(),this.shinePlayFun.animation(this,100),this.lineTimer&&this.shineTimer.stop(),this.lineRunFun.animation(this,1E3)):(this.setShineColor(1),
this.draw()))};this.timer&&this.timer.stop();this.timer=this.change.animation(this,400);this.shinePlayFun=function(a,b){1==this.shineCase?a==b&&(this.shineCase=2,this.focus?(this.shineTimer&&this.shineTimer.stop(),this.shineTimer=this.shinePlayFun.animation(this,100)):this.draw()):a==b&&(this.shineCase=1,this.focus?(this.shineTimer&&this.shineTimer.stop(),this.shineTimer=this.shinePlayFun.animation(this,100)):this.draw());this.setShineColor(1);this.draw();this.drawShine(1)};this.lineRunFun=function(a,
b){var c=a/b;this.stop?(this.setEllipseBg(),this.draw()):(this.drawRunLine(c),a==b&&(this.focus?(this.timer0&&(clearTimeout(this.timer0),this.timer0=null),this.timer0=setTimeout(function(){this.lineTimer&&this.lineTimer.stop();this.lineTimer=this.lineRunFun.animation(this,1E3)}.bind(this),1E3)):(this.setEllipseBg(),this.draw())))}},drawRunLine:function(a){this.context.beginPath();this.context.lineWidth=this.lineWidth;this.context.moveTo(this.bdRadius+this.lineWidth/2,this.lineWidth/2);this.context.arcTo(this.width-
this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,this.height-this.lineWidth/2,this.bdRadius+this.lineWidth/2);this.context.lineTo(this.width-this.lineWidth/2,this.height-this.lineWidth/2,this.lineWidth/2,this.height-this.lineWidth/2);this.context.lineTo(this.lineWidth/2,this.height-this.lineWidth/2,this.lineWidth/2,this.lineWidth/2);this.context.arcTo(this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,this.lineWidth/2,this.bdRadius+this.lineWidth/2);1!=a?(this.runLine=this.context.createLinearGradient(this.lineWidth/
2,this.lineWidth/2,this.width,this.height),this.runLine.addColorStop(0,"rgba(255,255,255,0)"),this.runLine.addColorStop(.02+.82*a,"rgba(255,255,255,0)"),this.runLine.addColorStop(.1+.82*a,"rgba(255,255,255,1)"),this.runLine.addColorStop(.18+.82*a,"rgba(255,255,255,0)")):(this.runLine=this.context.createLinearGradient(this.lineWidth/2,this.lineWidth/2,this.width,this.height),this.runLine.addColorStop(0,"rgba(255,255,255,0)"));this.runLine.addColorStop(1,"rgba(255,255,255,0)");this.context.strokeStyle=
this.runLine;this.context.stroke();this.context.closePath()},initEvent:function(){this.canvas.bind(_event._enter,function(){this.stop=!1;this.shineCase=1;this.focus=!0;this.context.clearRect(-10,-10,this.width+20,3*this.height+20);this.setEllipseBg();this.enterEvent()}.bind(this));this.canvas.bind(_event._leave,function(){this.focus=!1;this.stop=!0;this.setEllipseBg();this.enterEvent()}.bind(this))}});
Class("ShadowButton",{create:function(a,b){b&&(this.lineWidth=a.height/10,this.width=a.width-this.lineWidth,this.height=a.height-this.lineWidth,this.id=a.id,this.bdRadius=this.height/12,this.parent=b,this.enter=!1,this.initConfig(),this.getGradient(),this.initHtml(),this.initCss(),isPhone()||isPad()||this.initEvent())},initHtml:function(){this.container=$("<div></div>");this.canvas=$("<canvas width='"+(this.width+this.lineWidth)+"' height='"+(this.height+this.lineWidth)+"'></canvas>");this.context=
this.canvas[0].getContext("2d");this.container.append(this.canvas);this.parent.append(this.container);this.drawShadowButton();this.leftToRight=!0;this.playCase=1;this.drawFlower()},initCss:function(){this.container.css({position:"absolute",left:"0",top:"0"})},draw:function(){this.context.save();this.context.scale(1,2/3);this.context.lineWidth=this.lineWidth;this.drawFirstBg();this.drawSecondBg();this.drawThirdBg();this.context.restore();this.drawEnterShadow();this.drawCover();this.drawCoverShadow()},
onResize:function(a,b){this.lineWidth=b/10;this.width=a-this.lineWidth;this.height=b-this.lineWidth;this.bdRadius=this.height/12;this.canvas[0].width=a;this.canvas[0].height=b;this.container.find("img").css({width:this.width/4*3+"px",height:this.height/4*3+"px",left:this.width/8+this.lineWidth/4+"px",top:this.height/9+"px"});this.getGradient();this.drawShadowButton()},stopAnimation:function(){},runAnimation:function(){},drawFirstBg:function(){this.context.save();this.context.shadowColor=this.shadowColor;
this.context.shadowBlur=10;this.context.beginPath();this.context.strokeStyle=this.borderColor1;this.context.moveTo(this.bdRadius+this.lineWidth,this.lineWidth);this.context.arcTo(this.width,this.lineWidth,this.width,1.5*this.height,this.bdRadius);this.context.arcTo(this.width,1.5*this.height,this.lineWidth,1.5*this.height,this.bdRadius);this.context.arcTo(this.lineWidth,1.5*this.height,this.lineWidth,this.lineWidth,this.bdRadius);this.context.arcTo(this.lineWidth,this.lineWidth,this.width,this.lineWidth,
this.bdRadius);this.context.stroke();this.context.closePath();this.context.restore()},drawSecondBg:function(){this.context.beginPath();this.context.lineWidth=.5;this.context.moveTo(this.bdRadius+1.1*this.lineWidth,1.1*this.lineWidth);this.context.strokeStyle="#000";this.context.arcTo(this.width-this.lineWidth/8,1.1*this.lineWidth,this.width-this.lineWidth/8,1.5*this.height-.1*this.lineWidth,this.bdRadius);this.context.arcTo(this.width-this.lineWidth/8,1.5*this.height-.1*this.lineWidth,1.5*this.lineWidth,
1.5*this.height-.1*this.lineWidth,this.bdRadius);this.context.arcTo(1.1*this.lineWidth,1.5*this.height-.1*this.lineWidth,1.5*this.lineWidth,1.1*this.lineWidth,this.bdRadius);this.context.arcTo(1.1*this.lineWidth,1.1*this.lineWidth,this.width-this.lineWidth/8,1.1*this.lineWidth,this.bdRadius);this.context.fillStyle=this.borderColor2;this.context.fill();this.context.stroke();this.context.closePath()},drawThirdBg:function(){this.context.beginPath();this.context.moveTo(this.bdRadius+2*this.lineWidth,
2*this.lineWidth);this.context.strokeStyle=this.borderColor2;this.context.arcTo(this.width-this.lineWidth,2*this.lineWidth,this.width-this.lineWidth/2,1.5*this.height-this.lineWidth,this.bdRadius);this.context.arcTo(this.width-this.lineWidth,1.5*this.height-this.lineWidth,1.5*this.lineWidth,1.5*this.height-this.lineWidth,this.bdRadius);this.context.arcTo(2*this.lineWidth,1.5*this.height-this.lineWidth,1.5*this.lineWidth,1.5*this.lineWidth,this.bdRadius);this.context.arcTo(2*this.lineWidth,2*this.lineWidth,
this.width-this.lineWidth/2,1.5*this.lineWidth,this.bdRadius);this.context.fillStyle=this.defaultBg[1];this.context.fill();this.context.closePath()},drawEnterShadow:function(){this.context.save();this.context.scale(1,.5);this.context.beginPath();this.context.shadowColor="#fff";this.context.shadowBlur=this.height/8;var a=this.context.createRadialGradient(this.width/2+this.lineWidth,this.height+this.lineWidth,0,this.width/2+this.lineWidth,this.height+this.lineWidth,.95*this.height);a.addColorStop(0,
"rgba(255,255,255,0.6)");a.addColorStop(.5,"rgba(255,255,255,0.3)");a.addColorStop(1,Color(this.defaultBg[1]).rgba(0));this.context.fillStyle=a;this.context.fillRect(this.bdRadius+1.1*this.lineWidth,this.lineWidth,this.width,2*this.height);this.context.restore()},drawCoverShadow:function(){this.context.save();this.context.scale(1,.5);this.context.beginPath();this.context.shadowColor="#fff";this.context.shadowBlur=this.height/8;var a=this.context.createRadialGradient(this.width/2+.5*this.lineWidth,
this.height+this.lineWidth,0,this.width/2+.5*this.lineWidth,this.height+this.lineWidth,.95*this.height);a.addColorStop(0,"rgba(255,255,255,0.6)");a.addColorStop(.6,"rgba(255,255,255,0.3)");a.addColorStop(1,"rgba(255,255,255,0)");this.context.fillStyle=a;this.context.fillRect(this.bdRadius+1.1*this.lineWidth,this.lineWidth,.9*this.width,2*this.height);this.context.restore()},drawFlower:function(){var a=$("<img src='"+uiBaseURL+"buttonFlower.svg' />");a.css({position:"absolute","pointer-events":"none",
width:this.width/4*3+"px",height:this.height/4*3+"px",left:this.width/8+this.lineWidth/4+"px",top:this.height/9+"px"});this.container.append(a)},drawCover:function(){this.context.beginPath();this.context.fillStyle=this.defaultBg[2];this.context.moveTo(this.bdRadius+1.14*this.lineWidth,this.height/2);this.context.quadraticCurveTo(this.width/2,this.height/6,this.width-this.lineWidth,this.height/2.5);this.context.fill();this.context.closePath();this.context.beginPath();this.context.moveTo(this.bdRadius+
1.14*this.lineWidth,this.height/2);this.context.quadraticCurveTo(this.width/2,this.height/6,this.width-this.lineWidth,this.height/2.5);this.context.moveTo(this.bdRadius+1.14*this.lineWidth,this.height/2);this.context.fillStyle=this.defaultBg[2];this.context.arcTo(this.bdRadius+1.14*this.lineWidth,this.height-this.lineWidth/1.6,this.width-.9*this.lineWidth,this.height-this.lineWidth/1.5,this.bdRadius/2);this.context.arcTo(this.width-.95*this.lineWidth,this.height-this.lineWidth/1.6,this.width-.95*
this.lineWidth,this.lineWidth,this.bdRadius/2);this.context.lineTo(this.width-.95*this.lineWidth,this.height/2.5);this.context.fill();this.context.closePath()},initConfig:function(){this.shadows=[{defaultBg:"#666666;#9AC2FF;#287EFF",enterBg:"#FFFFFF"},{defaultBg:"#666666;#FF9090;#FF1515",enterBg:"#FFFFFF"},{defaultBg:"#666666;#FFFF85;#FFFF24",enterBg:"#FFFFFF"},{defaultBg:"#666666;#94EEB0;#1FDC59",enterBg:"#FFFFFF"},{defaultBg:"#666666;#E499FF;#C936FF",enterBg:"#FFFFFF"},{defaultBg:"#666666;#9B9B9B;#404040",
enterBg:"#FFFFFF"}]},getGradient:function(){this.defaultBg=this.shadows[this.id-1].defaultBg.split(";");this.enterBg=this.shadows[this.id-1].enterBg;this.shadowColor="transparent"},drawShadowButton:function(){this.context.clearRect(-20,-20,3*this.width,3*this.height);this.context.beginPath();this.context.lineWidth=5;this.bgColor1=this.defaultBg[1];this.borderColor1=this.context.createLinearGradient(this.lineWidth+5,0,this.width+this.lineWidth+5,0);this.borderColor1.addColorStop(0,this.defaultBg[0]);
this.borderColor1.addColorStop(1,this.defaultBg[0]);this.borderColor2=this.context.createLinearGradient(this.lineWidth+5,0,this.width-this.lineWidth/2,0);this.borderColor2.addColorStop(0,this.defaultBg[0]);this.borderColor2.addColorStop(.5,"rgba(255,255,255,1)");this.borderColor2.addColorStop(1,this.defaultBg[0]);this.outerBg=this.context.createLinearGradient(0,this.lineWidth+5,0,this.height);this.outerBg.addColorStop(0,this.defaultBg[1]);this.outerBg.addColorStop(1,this.defaultBg[1]);this.draw()},
change:function(a,b){a!=b&&(this.context.clearRect(-20,-20,3*this.width,3*this.height),this.shadowColor=this.focus?Color(this.defaultBg[2]).rgba(a/b):Color(this.defaultBg[2]).rgba(1-a/b),this.draw())},enterEvent:function(){this.getGradient();this.change.animation(this,1200)},initEvent:function(){this.canvas.bind(_event._enter,function(){this.focus=!0;this.enterEvent()}.bind(this));this.canvas.bind(_event._leave,function(){this.focus=!1;this.enterEvent()}.bind(this))}});
Class("BottomLightButton",{create:function(a,b){b&&(this.width=a.width,this.height=a.height,this.id=a.id,this.bdRadius=this.height/15,this.lineWidth=this.height/10,this.parent=b,this.initConfig(),this.initHtml(),this.getGradient(),this.drawButton(),this.initCss(),isPhone()||isPad()||this.initEvent())},initHtml:function(){this.canvas=$("<canvas width='"+this.width+"' height='"+this.height+"'></canvas>");this.context=this.canvas[0].getContext("2d");this.parent.append(this.canvas)},initCss:function(){this.canvas.css({position:"absolute",
left:"0",top:"0"})},drawButton:function(){this.context.beginPath();this.context.lineWidth=5;this.outerBg=this.context.createLinearGradient(0,this.lineWidth+5,0,this.height);this.outerBg.addColorStop(0,this.defaultBg[1]);this.outerBg.addColorStop(1,this.defaultBg[1]);this.shadowColor(0);this.draw()},draw:function(){this.context.clearRect(0,0,this.width,this.height);this.context.lineWidth=this.lineWidth;this.drawFirstBg();this.drawCover();this.drawCoverShadow()},onResize:function(a,b){this.bdRadius=
b/15;this.lineWidth=b/10;this.width=a;this.height=b;this.canvas[0].width=a;this.canvas[0].height=b;this.getGradient();this.drawButton()},drawFirstBg:function(){this.context.save();this.context.beginPath();this.context.moveTo(this.bdRadius,this.lineWidth/2);this.context.arcTo(this.width-this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,this.height/2,this.bdRadius);this.context.arcTo(this.width-this.lineWidth/2,this.height/2,this.lineWidth/2,this.height/2,this.bdRadius);this.context.arcTo(this.lineWidth/
2,this.height/2,this.lineWidth/2,this.lineWidth/2,this.bdRadius);this.context.arcTo(this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,this.lineWidth/2,this.bdRadius);this.context.fillStyle=this.bgColor;this.context.fill();this.context.closePath();this.context.restore()},drawCoverShadow:function(){this.context.save();this.context.scale(1,.5);this.context.beginPath();this.context.shadowColor=this.enterBg;this.context.shadowBlur=this.height/4;this.context.fillStyle=this.color;this.context.fillRect(this.lineWidth/
2,this.lineWidth/2,this.width,this.height-this.lineWidth/2);this.context.restore();this.context.clearRect(this.lineWidth/2,this.height/2,this.width,this.height)},drawCover:function(){this.context.save();this.context.beginPath();this.context.lineWidth=0;this.context.fillStyle=this.coverBg;this.context.moveTo(this.lineWidth/2,this.height/8*3);this.context.arcTo(this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,this.lineWidth/2,this.bdRadius);this.context.arcTo(this.width-this.lineWidth/
2,this.lineWidth/2,this.width-this.lineWidth/2,this.height/8*3-this.lineWidth/2,this.bdRadius);this.context.lineTo(this.width-this.lineWidth/2,this.height/8*3);this.context.quadraticCurveTo(this.width/2,this.height/7,this.lineWidth/2,this.height/8*3);this.context.fill();this.context.closePath()},initConfig:function(){this.shadows=[{defaultBg:"#181818;#181818;#181818",enterBg:"#6CFCDE"},{defaultBg:"#181818;#181818;#181818",enterBg:"#FF0000"},{defaultBg:"#187B0D;#3DB330;#60E751",enterBg:"#FFFFFF"},
{defaultBg:"#07507E;#3586B0;#5DB5DB",enterBg:"#FFFFFF"},{defaultBg:"#EA8C44;#F38536;#EC5A1D",enterBg:"#FFFFFF"},{defaultBg:"#F7BFD9;#EE62AB;#E61685",enterBg:"#FFFFFF"},{defaultBg:"#8A0F0F;#BE2424;#F54444",enterBg:"#FFFFFF"},{defaultBg:"#58F762;#46C446;#17578E",enterBg:"#FFFFFF"},{defaultBg:"#6B6822;#D1B95D;#ECD067",enterBg:"#FFFFFF"}]},getGradient:function(){this.defaultBg=this.shadows[this.id-1].defaultBg.split(";");this.enterBg=this.shadows[this.id-1].enterBg;this.bgColor=this.context.createLinearGradient(0,
0,0,this.height/2);this.bgColor.addColorStop(0,this.defaultBg[0]);this.bgColor.addColorStop(.5,this.defaultBg[1]);this.bgColor.addColorStop(1,this.defaultBg[2]);this.coverBg=this.context.createLinearGradient(0,0,0,this.height/4*3);this.coverBg.addColorStop(0,"rgba(255,255,255,0.15)");this.coverBg.addColorStop(1,"rgba(255,255,255,0.3)")},shadowColor:function(a){this.color=this.context.createRadialGradient(this.width/2,1.2*this.height,0,this.width/2,1.2*this.height,this.height/1);this.color.addColorStop(.3,
Color(this.enterBg).rgba(1*a));this.color.addColorStop(.6,Color(this.enterBg).rgba(.4*a));this.color.addColorStop(.8,Color(this.enterBg).rgba(.1*a));this.color.addColorStop(.9,Color(this.enterBg).rgba(0))},enterEvent:function(){this.getGradient();this.change=function(a,b){this.shadowColor(this.focus?a/b:1-a/b);this.draw()};this.timer&&this.timer.stop();this.timer=this.change.animation(this,1E3)},initEvent:function(){this.canvas.bind(_event._enter,function(){this.focus=!0;this.enterEvent()}.bind(this));
this.canvas.bind(_event._leave,function(){this.focus=!1;this.enterEvent()}.bind(this))}});
Class("OtherButton",{create:function(a,b){b&&(this.width=a.width,this.height=a.height,this.id=a.id,this.bdRadius=this.height/12,this.lineWidth=this.height/10,this.parent=b,this.initHtml(),this.draw(),this.initCss())},initHtml:function(){this.container=$("<div></div>");this.canvas=$("<canvas width='"+this.width+"' height='"+this.height+"'></canvas>");this.context=this.canvas[0].getContext("2d");this.parent.append(this.container);this.container.append(this.canvas)},initCss:function(){this.container.css({width:this.width+
"px",height:this.height+"px",left:"0",top:"0"})},draw:function(){var a={width:this.width,height:this.height,bdRadius:this.bdRadius,lineWidth:this.lineWidth,context:this.context,canvas:this.canvas};switch(this.id){case 1:this.button=new OtherButton1(a,this.container);break;case 2:this.button=new OtherButton2(a,this.container);break;case 3:this.button=new OtherButton3(a,this.container)}},onResize:function(a,b){this.bdRadius=b/12;this.lineWidth=b/10;this.width=a;this.height=b;a={width:this.width,height:this.height,
bdRadius:this.bdRadius,lineWidth:this.lineWidth,context:this.context,canvas:this.canvas};this.container.css({width:this.width+"px",height:this.height+"px"});this.canvas[0].width=this.width;this.canvas[0].height=this.height;if(this.button)this.button.onResize(a)}});
Class("OtherButton1",{create:function(a,b){b&&(this.width=a.width,this.height=a.height,this.bdRadius=a.bdRadius,this.lineWidth=a.lineWidth,this.context=a.context,this.canvas=a.canvas,this.parent=b,this.enter=!1,this.createSecondCanvas(),this.drawButton(),isPhone()||isPad()||this.initEvent())},onResize:function(a){this.width=a.width;this.height=a.height;this.bdRadius=a.bdRadius;this.lineWidth=a.lineWidth;this.secCanvas[0].width=this.width;this.secCanvas[0].height=this.height;this.drawButton()},drawButton:function(){this.context.clearRect(0,
0,this.width,this.height);this.borderColor1=this.context.createLinearGradient(this.lineWidth+5,this.lineWidth+5,this.height/2+this.lineWidth+5,this.height/2+this.lineWidth+5);this.borderColor1.addColorStop(0,"#333");this.borderColor1.addColorStop(1,"#333");this.outerBg="#111";this.drawfirst();this.drawDash();this.drawSecond();this.drawUnder()},createSecondCanvas:function(){this.secCanvas=$("<canvas width='"+this.width+"' height='"+this.height+"'></canvas>");this.secCtx=this.secCanvas[0].getContext("2d");
this.parent.append(this.secCanvas);this.secCanvas.css({position:"absolute",left:"0",top:"0",background:"transparent"})},drawfirst:function(){this.context.beginPath();this.context.moveTo(this.lineWidth/2,this.lineWidth/2);this.context.shadowColor="#333";this.context.shadowBlur=10;this.context.fillStyle="#105A8D";this.context.fillRect(this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth,this.height/2-this.lineWidth);this.context.closePath()},drawSecond:function(){this.context.beginPath();this.context.moveTo(this.lineWidth/
2,this.lineWidth/2);this.context.shadowColor="#fff";this.context.shadowBlur=10;var a=this.context.createLinearGradient(0,0,0,this.height/2);a.addColorStop(0,"rgba(255,255,255,0.2)");a.addColorStop(1,"rgba(255,255,255,0)");this.context.fillStyle=a;this.context.fillRect(this.lineWidth/4,this.lineWidth/2,this.width-this.lineWidth/4,this.height/2-this.lineWidth);this.context.closePath()},drawUnder:function(){this.context.beginPath();this.context.moveTo(this.lineWidth/2,this.height+this.lineWidth/2);this.context.shadowColor=
"#333";this.context.shadowBlur=10;var a=this.context.createLinearGradient(0,this.height/2,0,this.height);a.addColorStop(0,Color("#008EFF").rgba(.2));a.addColorStop(.05,Color("#008EFF").rgba(.5));a.addColorStop(.5,Color("#fff").rgba(0));this.context.fillStyle=a;this.context.fillRect(this.lineWidth/2,this.height/2,this.width-this.lineWidth,this.height/2-this.lineWidth);this.context.closePath();this.context.beginPath();a=this.context.createLinearGradient(0,this.height/2,0,this.height);a.addColorStop(0,
"rgba(255,255,255,0.05)");a.addColorStop(.8,"rgba(255,255,255,0)");this.context.fillStyle=a;this.context.fillRect(this.lineWidth/2,this.height/2,this.width-this.lineWidth,this.height/2-this.lineWidth);this.context.closePath();this.context.save();a=this.context.createLinearGradient(0,this.height/2,0,this.height);a.addColorStop(0,"rgba(255,255,255,0.2)");a.addColorStop(.5,"rgba(255,255,255,0)");this.context.fillStyle=a;for(a=-this.width/2;a<this.width+this.lineWidth;a+=this.width/50)for(var b=this.height;b>
this.height/2;b-=this.height/70)this.context.beginPath(),this.context.shadowColor="#fff",this.context.shadowBlur=10,this.context.arc(b+a,b,this.height/140,0,2*Math.PI,!1),this.context.fill(),this.context.closePath();this.context.restore();this.context.clearRect(0,this.height/2-this.lineWidth/2,this.lineWidth/2,this.height);this.context.clearRect(this.width-this.lineWidth/2,this.height/2-this.lineWidth/2,this.lineWidth/2,this.height)},drawDash:function(){this.context.save();this.context.fillStyle=
"rgba(255,255,255,0.15)";for(var a=this.width+this.lineWidth/2+this.height/2;a>this.lineWidth;a-=this.width/50)for(var b=this.height/2;b>this.lineWidth;b-=this.height/70)this.context.beginPath(),this.context.shadowColor="#fff",this.context.shadowBlur=this.height/4,this.context.arc(a-b,b-this.lineWidth/2,this.height/140,0,2*Math.PI,!1),this.context.fill(),this.context.closePath();this.context.restore()},createBubble:function(a,b,c){this.secCtx.beginPath();var d=this.secCtx.createRadialGradient(b,c,
0,b,c,this.height/20+this.height/40*a);d.addColorStop(0,"rgba(255,255,255,0.4)");d.addColorStop(1,"rgba(255,255,255,0.05)");this.secCtx.shadowColor="#fff";this.secCtx.shadowBlur=10;this.secCtx.fillStyle=d;this.secCtx.arc(b,c,this.height/20+this.height/40*a,0,2*Math.PI,!1);this.secCtx.fill();this.secCtx.closePath()},popBubble:function(a){this.secCtx.clearRect(0,0,1.5*this.width,1.5*this.height);for(var b=this.width-2*this.lineWidth,c=this.height/2,d=1;10>d;d++)1==d?this.createBubble(a,b*d/9-a*this.lineWidth,
c-a*(this.height/2-this.height/30)):5==d?this.createBubble(a,b*d/9-a*this.lineWidth,c-a*(this.height/2-this.height/30)):8==d?this.createBubble(a,b*d/9-a*this.lineWidth,c-a*(this.height/2-this.height/30)):this.createBubble(a,b*d/9+a*this.lineWidth,c+-a*(this.height/2-this.height/30))},enterEvent:function(){this.change=function(a,b){a==b-1?this.popBubble(a/b*1.2):a==b?this.secCtx.clearRect(0,0,1.5*this.width,1.5*this.height):this.popBubble(a/b)};this.timer&&this.timer.stop();this.timer=this.change.animation(this,
600)},initEvent:function(){this.secCanvas.bind(_event._enter,function(){this.focus=!0;this.enterEvent()}.bind(this));this.secCanvas.bind(_event._leave,function(){this.focus=!1;this.secCtx.clearRect(0,0,1.5*this.width,1.5*this.height)}.bind(this))}});
Class("OtherButton2",{create:function(a,b){b&&(this.width=a.width,this.height=a.height,this.bdRadius=a.bdRadius,this.lineWidth=2*a.lineWidth,this.context=a.context,this.canvas=a.canvas,this.parent=b,this.enter=!1,this.drawButton(),isPhone()||isPad()||this.initEvent())},onResize:function(a){this.width=a.width;this.height=a.height;this.bdRadius=a.bdRadius;this.lineWidth=2*a.lineWidth;this.drawButton()},draw:function(){this.context.beginPath();this.context.moveTo(this.bdRadius+this.lineWidth/2,this.lineWidth/
2);this.context.arcTo(this.width-this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,this.height-this.lineWidth/2,this.bdRadius);this.context.arcTo(this.width-this.lineWidth/2,this.height-this.lineWidth/2,this.lineWidth/2,this.height-this.lineWidth/2,this.bdRadius);this.context.arcTo(this.lineWidth/2,this.height-this.lineWidth/2,this.lineWidth/2,this.lineWidth/2,this.bdRadius);this.context.arcTo(this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,this.lineWidth/2,this.bdRadius);
this.context.fillStyle=this.outerBg;this.context.fill();this.context.closePath();this.context.beginPath();this.context.moveTo(this.lineWidth/1.5,this.lineWidth/1.5);var a=this.context.createLinearGradient(0,this.lineWidth/1.5,0,this.height/2);a.addColorStop(0,"rgba(255,255,255,0.50)");a.addColorStop(1,"rgba(255,255,255,0.25)");this.context.fillStyle=a;this.context.arcTo(this.width-this.lineWidth/1.5,this.lineWidth/1.5,this.width-this.lineWidth/1.5,this.height/2,this.bdRadius);this.context.arcTo(this.width-
this.lineWidth/1.5,this.height/2,this.lineWidth/1.5,this.height/2,this.bdRadius);this.context.arcTo(this.lineWidth/1.5,this.height/2,this.lineWidth/1.5,this.lineWidth/1.5,this.bdRadius);this.context.arcTo(this.lineWidth/1.5,this.height/2,this.lineWidth/1.5,this.lineWidth/1.5,this.bdRadius);this.context.arcTo(this.lineWidth/1.5,this.lineWidth/1.5,this.width-this.lineWidth/1.5,this.lineWidth/1.5,this.bdRadius);this.context.fill()},drawfirst:function(a){this.context.save();this.context.clearRect(-20,
-20,2*this.width,2*this.height);this.context.lineWidth=this.lineWidth/4;this.context.beginPath();this.context.shadowColor="#FCF500";this.context.shadowBlur=40*a;this.context.moveTo(this.bdRadius+this.lineWidth/3,this.lineWidth/3);this.context.arcTo(this.width-this.lineWidth/3,this.lineWidth/3,this.width-this.lineWidth/3,this.height-this.lineWidth/3,this.bdRadius);this.context.arcTo(this.width-this.lineWidth/3,this.height-this.lineWidth/3,this.lineWidth/3,this.height-this.lineWidth/3,this.bdRadius);
this.context.arcTo(this.lineWidth/3,this.height-this.lineWidth/3,this.lineWidth/3,this.lineWidth/3,this.bdRadius);this.context.arcTo(this.lineWidth/3,this.lineWidth/3,this.width-this.lineWidth/3,this.lineWidth/3,this.bdRadius);this.context.fillStyle="#393939";this.context.fill();this.context.restore()},drawButton:function(){this.context.beginPath();this.outerBg="#111";this.drawfirst(0);this.draw()},enterEvent:function(){this.change=function(a,b){this.drawfirst(this.focus?a/b:1-a/b);this.draw()};this.timer&&
this.timer.stop();this.timer=this.change.animation(this,600)},initEvent:function(){this.canvas.bind(_event._enter,function(){this.focus=!0;this.enterEvent()}.bind(this));this.canvas.bind(_event._leave,function(){this.focus=!1;this.enterEvent()}.bind(this))}});
Class("OtherButton3",{create:function(a,b){b&&(this.width=a.width,this.height=a.height,this.bdRadius=a.bdRadius,this.lineWidth=a.lineWidth,this.context=a.context,this.canvas=a.canvas,this.parent=b,this.initConfig(),this.getGradient(),this.draw(),isPhone()||isPad()||this.initEvent())},onResize:function(a){this.width=a.width;this.height=a.height;this.bdRadius=a.bdRadius;this.lineWidth=2*a.lineWidth;this.getGradient();this.draw()},draw:function(a){this.context.clearRect(0,0,this.width,this.height);this.context.lineWidth=
this.lineWidth;this.context.save();this.focus&&(this.context.shadowColor=this.enterBg,this.context.shadowBlur=this.height/30*a,this.context.shadowOffsetY=-this.height/40);this.drawFirstBg();this.context.restore();this.drawSecondBg();this.drawCover();this.drawCoverShadow()},drawFirstBg:function(){this.context.beginPath();this.context.lineWidth=this.height/100;this.context.moveTo(this.bdRadius+this.lineWidth/2,this.lineWidth/2);this.context.arcTo(this.width-this.lineWidth/2,this.lineWidth/2,this.width-
this.lineWidth/2,this.height-this.lineWidth/2,this.bdRadius);this.context.arcTo(this.width-this.lineWidth/2,this.height-this.lineWidth/2,this.lineWidth/2,this.height-this.lineWidth/2,this.bdRadius);this.context.arcTo(this.lineWidth/2,this.height-this.lineWidth/2,this.lineWidth/2,this.lineWidth/2,this.bdRadius);this.context.arcTo(this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,this.lineWidth/2,this.bdRadius);this.context.fillStyle=this.bgColor1;this.context.fill();this.context.stroke();
this.context.closePath()},drawSecondBg:function(){this.context.beginPath();this.context.lineWidth=this.height/100;this.context.moveTo(this.bdRadius+this.lineWidth/2,this.lineWidth/2);this.context.arcTo(this.width-this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,this.height-this.lineWidth/2,this.bdRadius);this.context.arcTo(this.width-this.lineWidth/2,this.height-this.lineWidth/2,this.lineWidth/2,this.height-this.lineWidth/2,this.bdRadius);this.context.arcTo(this.lineWidth/2,this.height-
this.lineWidth/2,this.lineWidth/2,this.lineWidth/2,this.bdRadius);this.context.arcTo(this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,this.lineWidth/2,this.bdRadius);this.context.fillStyle=this.bgColor2;this.context.fill();this.context.stroke();this.context.closePath()},drawCoverShadow:function(){this.context.save();this.context.scale(1,1/3);this.context.beginPath();this.context.shadowColor=this.enterBg;this.context.shadowBlur=this.height/2;this.context.restore()},drawCover:function(){this.context.beginPath();
this.context.fillStyle=this.coverBg;this.context.moveTo(this.lineWidth/2,this.height/2.5);this.context.arcTo(this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,this.lineWidth/2,this.bdRadius);this.context.arcTo(this.width-this.lineWidth/2,this.lineWidth/2,this.width-this.lineWidth/2,this.height/4*3-this.lineWidth/2,this.bdRadius);this.context.lineTo(this.width-this.lineWidth/2,this.height/2.5);this.context.fill();this.context.closePath();this.context.beginPath();this.context.fillStyle=
this.coverBg;this.context.moveTo(this.lineWidth/2,this.height/2.5);this.context.quadraticCurveTo(this.width/2,this.height/5*4,this.width-this.lineWidth/2,this.height/2.5);this.context.fill();this.context.closePath()},initConfig:function(){this.otherColor={defaultBg:"#24363E;#E8E7E7;#E8E7E7",enterBg:"#f00"}},getGradient:function(){this.defaultBg=this.otherColor.defaultBg.split(";");this.enterBg=this.otherColor.enterBg;this.bgColor2=this.context.createLinearGradient(0,this.lineWidth/2,0,this.height-
this.lineWidth/2);this.bgColor2.addColorStop(0,Color(this.defaultBg[0]).rgba(.5));this.bgColor2.addColorStop(1,Color(this.defaultBg[0]).rgba(.05));this.bgColor1="transparent";this.coverBg=this.context.createLinearGradient(0,0,0,this.height/4*3);this.coverBg.addColorStop(0,"rgba(255,255,255,0.1)");this.coverBg.addColorStop(1,"rgba(255,255,255,0.2)")},setBgColor:function(a){this.bgColor1=this.context.createLinearGradient(0,this.lineWidth/2,0,this.height-this.lineWidth/2);this.bgColor1.addColorStop(0,
Color(this.enterBg).rgba(1));this.bgColor1.addColorStop(.25+.6*a,Color(this.enterBg).rgba(.85));this.bgColor1.addColorStop(.45+.55*a,Color(this.enterBg).rgba(0))},enterEvent:function(){this.getGradient();this.change=function(a,b){this.context.clearRect(0,0,this.width+this.lineWidth,this.height+this.lineWidth);var c=this.focus?a/b:1-a/b;a!=b||this.focus?this.setBgColor(c):this.bgColor1="transparent";this.draw(c)};this.timer&&this.timer.stop();this.timer=this.change.animation(this,400)},initEvent:function(){this.canvas.bind(_event._enter,
function(){this.focus=!0;this.enterEvent()}.bind(this));this.canvas.bind(_event._leave,function(){this.focus=!1;this.enterEvent()}.bind(this))}});
Class("DynamicButton",{Package:"PageItem",create:function(a,b,c,d){b&&(this._super(a,b,c,d),this.animateConfig(),this.fScale=c/this.config.pageWidth,this.config.src&&(this.initConfig(),this.initHtml(),this.initCss(),this.initEvt(),this.initLinkHint(this.button),parseBool(this.config.reflection)&&this.imageReflection(this.button)))},initHtml:function(){null==this.config.src||""==this.config.src?(this.button=$("<button type = 'button' class='flip-action'></button>"),this.img=$("<img/>"),this.config.alpha=
0):".png"==this.config.src.substr(this.config.src.length-4,4)&&(this.button=$("<div class='flip-action'></div>"),this.img=$("<img src='"+this.config.src+"'/>"),this.buttonEvt=$("<div></div>"),this.createCaption(),this.hasSpecial=this.config.src.indexOf("RotatePriceButton"),-1!=this.hasSpecial&&(this.sepcialImg(),this.rotationImg()),this.button.append(this.img),this.button.append(this.buttonEvt));this.setRotation(this.button,this.config.rotation);this.parent.append(this.button);-1!=this.hasSpecial&&
this.img.changeButtonColor(this.BGColor)},sepcialImg:function(){this.coverSrc=this.config.src.replace(".png","Cover.png");this.img.attr("src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASoAAAEqCAYAAACiOh0vAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAA7iSURBVHja7N15sJVlHcDxL7GjyCKIooEgsiZBZYJiZipILqOpKLijppVZOuWW4zJOLqWNM2maS26EhJpajQnSuKGEO2bosAgJJigqiOwg/fE8dzje7vKec+85533P+X5m7uhdzgV+997ved/3vu/ztti6dSuSlGZfcgSSDJUkGSpJhkqSDJUkGSpJhkqSDJUkQyVJhkqSDJUkQyVJhkqSDJUkQyVJhkqSoZIkQyVJhkqSoZIkQyVJhkqSoZIkQyXJUEmSoZIkQyXJUEmSoZIkQyXJUEmSoZJkqCTJUEmSoZJkqCTJUEmSoZJkqCTJUEkyVJJkqCTJUEkyVJJkqCTJUEkyVJJkqCQZKkkyVJJkqCQZKkkyVJJkqCQZKkkyVJIMlSQZKkkyVJIMlSQZKkkyVJIMlSQZKkmGSpIMlSQZKkmGSpIMlSQZKkmGSpIMlSRDJUnp0soRJPPx6s8dAlwD/BWY1cTPcziwF3BttQ+0a0e3FZJosXXrVqdgqJL4MrAIeBQ4Adhc4OfpGGM3BOgLrDZUctdPzfV9cgfQEjgGeALYo4DP8xVgOnAA0A24zdHKUKm53ACMyXn9IOAF4Ht5fI7xwPPAiJy3TQAucrxy189dv6YaDUxr4P2/IBy7asjVwGX1vG8rsDfwirt+couquk0ATi3gcb2Auxv5mF8Ck4CudbyvB+GY1mUNPVkCU4AdC/je/SFwlF9et6iU/S2qTsACwjGhZwnHmh4C1id47HPAqIR/zr+A03O2jEYC95P8WNYjCXclO8bdyLOAbwDzgKHABreoDJWhym6oxgOTa71tDnAfMBVYWs/jrgSuyPPP+hA4DmgbP3enPB9/LnBLPe/rG/8tJwMD6tg9fdJQGSpDld1QPU34LVtdlsYtmXuAV3PeflR8e6ltBA6JW3419gVOi3+n7vU87kFgnKEyVIYqm6HaD5iZ4OM+I5zb9BtgTXxM1zL9nRcQfqvYB/gJMBZo18hj1gPDgbcNlaEyVNlzJ3BGHh+/FlhBOIheTouBXYHWeTzmeuBiQ2WoDFW27Aq8CXSuki/R4rhVtdJQVR6nVLmOraJIAewedxNlqJQRrYFTqvDffbpf+srk6gnp1xL4ObADMBtYCCwBVjXwmDHA16pwVgcD+8Q51aVF3MrsBfQnnOv1DnCz32aGSk3TCfgx0DO+vo6wisGCGK1FwFzCqQZLCAfEJ1bprFoQTmWYHefWE+gNDI67hv0I52P1AdrEx7wE3Aps8VvNUKlwPfjisab28QdvcK2P+ziG6gNg/yqe14kxTr2A3Wj8pNMucb4f+a1mqFS43kCHBB/XlfKd+5QmHcnvoPpuwC6GKt08mJ5+uzuComoXdwVlqGSonLEMVaXv+qm4ejkCQ6XCtXS3pCScsaFSE+xMuKmCih8qf7FkqNSEXZJujqHoehKujZShUgF2YtuJiSqeHQnnq8lQqQADHEFJtCZcUqOUcpmXhJppmZeWhGv2Osb/7kA4K7oj4WTNHoSTDzvGLamRbLt0RsW1kLDe+xbCUjHL4stK4NOc/9a8fAY0+ZvCZV6S8QBiaR1BuEde+5yXdo4lFfag4RtRrIsvawlLJp8I/NOxGapK1I7C7jCs8qt5Yumas7uoEnG7s7QWAJsdQ+a9R1geRoaqIn1EWOVA2baCcJxKhqoifUK4952y/3Vc5xgMVaVa6xZVRfjQXXhDVck2xt0GZZtPNobKb3Kl3jJHYKiqYbdB2fauIzBUlW6JI8i85Y7AUFW6eY4g09YTzqOSoar4b3RvzZRda/EcqpLzEprSGQkcCBxFuDhZ2dQVuAt4DHiOcCGziszVExIqcPWEITFMY4BvAm2dZEVZA7wAPAH8hXCJVH7Vc/UEQ1WmUO0BjAYOJdxivIPTqwqrgGkxWjNI+EsTQ2WoShmq7sAxMU774fLB1e69nC2th2PEDJWhKnuoRhGOV0i1DQLeNlRN45Sax+vAa45BtcyggONWMlTF8hnwR8egWu7Gi5cNVco8Cqx2DIqWEo5RyVClykLgSceg6DG8AN1QpdSfHIGiKY7AUKXVNGCRY6h6L+MdagxViq0iHKuSW9YeRDdUqWaoqts6wuU0MlSpNhsvVK1m/8ClfAxVBmwA7nEMVetWR2CosqA3cIBjqFpHEK79lKFKrdPirt+xjqJqnQPMBI52FIYqjVtRjxAumejhOKpef+DPwJ2EhfZkqMruDOAZwgJ5Uu3vjWeBIx2FoSqXgcDU+KzZ23GoHkMIl9Pc7ta2oSq1s+Iz5XGOQnl8zzwDjHMUhqrYtiOs2Hg7/mZH+RtAOGv9ZrzBh6Eqoi1AO8egZvi5c2ndPLgUcUI5SxF3B14EdncqKsBs4FvARnApYreoiudDwvEGC698rQIm1kRKhqrYZgC/dgzK06XAXMfgrl8pdv1qtCfcEmmY01ECfwe+W/uN7vq5RVVs6+Jm/HpHoUZ8EA8XyFCVxWvA1Y5BjbiAcFNSGaqyuY6wBpFUl7vxVmqGKgU+B74PzHcUqmV23JqSoUqFd3AJYv2/e4GVjsFQpcVhwKmOQbX8DBjhGAxVGuxLWEVhJ0ehWvoCk/EqBkNVZv3iN2IHR6F69CEs89LNURiqcugBPI5rUalxQ4EHgbaOwlCVUgfCr5z3dBRK6NvAff7MGapSzuwh4CBHoTyNI6xlJkNVdLcCYx2DCnQGcKVjyE8rR5DYcOBswsmdUlNcAWwmrPbpicKGqlmdHEMlNYeLCSeDGip3/Zr9WfAQYKGjUBPNBEYBf3AUhqq5rSYsmHcw8JLjUIGeAA4HXgfWOg5DVSyLgQOBKY5Cebo9RmqVozBUpbAGGA/c4iiU0OWEY5xbHIWhKrVzgUvwRg+q3yrgJFxg0VCV2XXxG9FnStX2EXA0LpxnqFJiMnAo8JajUPQyMBp4ylEYqjSZ4TOnctwIvOoYDFXa7IyL52mb84A2jsFQpc35uJqCthmJVzIYqpTZDa8BVN1bVds7BkOVFj8COjsG1dIPmOAYms5buidUxy3dc78Z5+ByxKrbu4SVNz6u653e0t0tqlK5yEipAb2AcxyDW1Tl3KIaRPgVdDsnpAYsBwbXtVXlFpVbVKVwqZFSAj2ACx2DoSqHUXigVMmdCQxxDIaq1E52fsrDjoTr/mSoSuoq4KfAAkehRrwBTAR+7ygK48H0hBo4PaELcBrwAzwzXV80B/gt4RrQ9XV9gAfTDVWpQlWjO2ExvbMJv+FR9XoRuA2YSlhksV6GylCVOlQ1doixmggMdHJV5RXCcsP3AhuSPMBQGapyharGdjFWZwF7OcGK34K6BZgE5PWNYqgMVblDVWMs8LgTrFibgGHA3EIebKiScUrFN8ARVLRWhCsUZKgy7RBHUNl7JYQlh2WoMqsbHp+qBsNjsGSoMmkI0NMxVLyB7uIbqiwbBrR0DBWvI17HZ6gybKQjqBr7OAJDlUXb+yxbVb6Ox6kMVQb1xzPTq8kgwi3TZKgyZRjhHBtVh13wN7yGKoOOdARV5zBHYKiyZjGwhHCJhSrb+vj1XuYoisNr/RIq8Fq/nQjHLvoBIwjHrfrhuVVZ9x9gIeH6vpcIiye+BXyS7yfyWj9DlYZQ1dYqRmoQYc2qrwJD4+veJCKdPo0ReiO+vAnMA94HmvzDY6gMVRpDVV+8xgH3uyueOmsIxxqfJs/lWwxV83JK5bcZ+LdjSKW1wPxiRUqGKmvaN8duhJp/j8NdckOlbbb4rJ3ard3NjsFQaVuotjgGvy4yVGn2uT8QblHJUGXhB8JQ+QQiQ+Uzt/y6GCo1hcdC3KKSoUq9TT5zpzZU/jbWUClqQbhhqdLF89tSwvWS0mEzsBToAawmXI2/Iee/G+NW1zpgOeG28cf79cvbp8CDcSupWwxRa6AN0Da+tIv/7Qz811AZKm3zPmEto5aEyzY25rxsqmf3oy+uyZ6vacCZdby9ZU6w2sT/3z4+Uax1bIZK27aoFuf5mFmGKm8v1PP2ml9mrHdE6eQxqux6xhHkZSPwrGMwVCqt2cAKx5DYfMK6UjJUKqHlhNUllXy3b51jMFQqvacdgbvKhkppNwtPSExiJTDTMRgqlceL5HfcZRbwaoUEOp9/x2zCDRmUUZ6ekG0b4u7fkAbe/wowPW5RPA90IdykoFtG/80LgO8QznXaP74cTLhRRmt3kSuTN3dIqIg3d2iq44EpOa8vA16OYZoOvFbHYy4Ers/ol+IUwo0wcrUE9gZGx3ANqxXiUTHSqePNHQxVtYSqL/AA8DbweNwdXNTIY9oQfmM4NGNfhqfi1lRj+hNOhj0c6AQcB6wyVIbKUJVXB/K/1GM04ZKSfC0C+jTx71vo5xhBON5U7NkYqpRxSpWhkB/E6fElcauB84B9gDua8He9Nn6Oywn3zUvqgQIiVehs5BaVW1QpMjT+8Dd2S6i7CMe05uc8wd0HnJjnn3cTcH7O64NjsI5v5HErgOGEFSYqiltUblGpcW8Av2vg/XOAYwgrDszPefvnwEnAI3n8WXfUihTAXOAEwgHy+Q089leVGCm5ReUWVXJdCOdi9ch52yrgRuAGGr7spC0wCTg2wRbZmQn+HhcBF/DF0wzmEX6LV5GXv7hF5RaVkvkEuDLn9cmEY0hXJ4jDBsJv1P7WwMdMShCpmr/HxYQD5o/lvP0SvEbPLSq3qKp+iwrCSpf3Ei7cvamAx3cmnMs1ptbbHwbGExb/y9dVwJ7AhEoevFtUhspQlVYb4FFgbHx9KuE41iZHY6gMlaFKk3aEY0prgYGOw1A1F6/1U3NaD1xDOHYluUUlqXq43SnJUEmSoZJkqCTJUEmSoZJkqCTJUEkyVJJkqCTJUEkyVJJkqCTJUEkyVJJkqCQZKkkyVJJkqCQZKkkyVJJkqCQZKkkyVJIMlSQZKkkyVJIMlSQZKkkyVJIMlSQZKkmGSpIMlSQZKkmGSpIMlSQZKkmGSpIMlSRDJUmGSpIMlSRDJUmGSpIMlSRDJUmGSpKhkiRDJUmGSpKhkiRDJUmGSpKhkiRDJclQSZKhkiRDJclQSZKhkiRDJclQSZKhkmSoJMlQSZKhkmSoJMlQSZKhkmSoJMlQSTJUkpQy/xsAWwn4K/i5x1AAAAAASUVORK5CYII=");
this.coverImg=$("<img src='"+this.coverSrc+"'/>");this.coverImg.css("z-index","2");this.button.append(this.coverImg);this.img.changeButtonColor(this.BGColor);this.prices=this.price.split(".");this.textBox=$("<div style='position:absolute;font-size:12px;'></div>");this.unitBox=$("<div style='z-index:3;position:absolute;color:#fff'>"+this.unit+"</div>");this.priecInteger=$("<div style='z-index:3;position:relative;color:#fff'>"+this.prices[0]+"</div>");this.priecDecimal=$("<div style='z-index:3;position:absolute;color:#fff'>"+
this.prices[1]+"</div>");this.fontTitle=$("<div style='z-index:3;position:absolute;color:#fff'>"+this.fontTitle+"</div>");this.textBox.append(this.fontTitle).append(this.priecInteger).append(this.priecDecimal).append(this.unitBox);this.button.append(this.textBox);this.elems=[{elem:this.fontTitle,scale:this.height/25/12,x:.25*this.width,y:.303*this.height},{elem:this.priecInteger,scale:this.height/7/12,x:.307*this.width,y:.363*this.height},{elem:this.priecDecimal,scale:this.height/25/12,x:.45*this.width,
y:.384*this.height},{elem:this.unitBox,scale:this.height/7/12,x:.505*this.width,y:.363*this.height}];this.setSpecialImgCss();this.button.bind(isTouch?_event._down:_event._enter,function(){animateOnce(this.button,{transform:"scale(1.5)"},.5)}.bind(this));this.button.bind(isTouch?_event._up:_event._leave,function(){animateOnce(this.button,{transform:"scale(1)"},.5);this.buttonEvt.css({display:"none"})}.bind(this))},setSpecialImgCss:function(){for(var a=0;a<this.elems.length;a++){var b=this.elems[a];
b.elem.css({transform:"scale("+b.scale+")"})}this.textBox.css({"z-index":"2",width:this.width/2+"px",height:this.height/2+"px",left:this.width/4+"px",top:this.height/4+"px"});this.fontTitle.css({left:"20%",top:"15%","transform-origin":"0 0 0",width:this.width/2/(this.height/25/12)+"px"});this.priecInteger.css({display:"inline-block","transform-origin":"0 0 0",left:"15%",top:"35%"});this.priecDecimal.css({display:"inline-block","transform-origin":"0 0 0",left:this.width/4-this.height/25/12*12+"px",
top:"32%"});this.unitBox.css({display:"inline-block","transform-origin":"0 0 0",right:.15*this.width+"px",top:"35%"})},rotationImg:function(){-1!=this.hasSpecial&&(this.animate=function(a,b){this.rotation3d(360*a/b)},this.animate.animation(this,1E4),this.timer=setInterval(function(){this.animate.animation(this,1E4)}.bind(this),1E4))},rotation3d:function(a){this.img.css({transform:"rotate3d(0,0,1,"+a+"deg)","-webkit-transform":"rotate3d(0,0,1,"+a+"deg)","-o-transform":"rotate3d(0,0,1,"+a+"deg)","-ms-transform":"rotate3d(0,0,1,"+
a+"deg)","-moz-transform":"rotate3d(0,0,1,"+a+"deg)"})},initConfig:function(){this.width=this.pageWidth*this.config.width;this.height=this.pageHeight*this.config.height;this.button=null;this.left=this.pageWidth*this.config.x;this.top=this.pageHeight*this.config.y;this.config.src&&(this.config.src=this.config.src.replace(".swf",".png"),this.config.src=uiBaseURL+this.config.src.slice(this.config.src.lastIndexOf("/")+1));this.config.properties&&3==this.config.properties.length&&(this.config.buttonCaption=
this.config.properties[0].value,this.color=Color(this.config.properties[1].value).toString(),this.fontSize=this.config.properties[2].value);this.config.properties&&4==this.config.properties.length&&(this.color=Color("#ffffff").toString(),this.fontTitle=this.config.properties[0].value,this.unit=this.config.properties[1].value,this.price=this.config.properties[2].value,this.BGColor=Color(this.config.properties[3].value).toString());this.config.hint&&(this.config.hint.hintShapeColor=Color(this.config.hint.hintShapeColor).toString(),
this.config.hint.hintShapeColor2=this.config.hint.hintShapeColor2?Color(this.config.hint.hintShapeColor2).toString():Color(this.config.hint.hintShapeColor).toString(),"null"==this.config.hint.text&&(this.config.hint.text=""))},initCss:function(){this.img.css({position:"absolute",width:this.width+"px",height:this.height+"px","z-index":"1",top:"0",bottom:"0",left:"0",right:"0"});-1!=this.config.src.indexOf("RotatePriceButton")&&this.coverImg.css({position:"absolute",width:this.width+"px",height:this.height+
"px",top:"0",bottom:"0",left:"0",right:"0"});this.buttonEvt.css({display:"none",width:this.width+"px",height:this.height+"px"});this.button.css({position:"absolute",width:this.width+"px",height:this.height+"px",left:this.left+"px",top:this.top+"px",opacity:this.config.alpha})},createCaption:function(){this.config.buttonCaption&&(this.buttonCaption=new label(this.config.buttonCaption,this.button),this.captionCss())},captionCss:function(){var a=transformCSS({origin:{x:0,y:0},scale:this.fScale});this.buttonCaption.labelBox.css(a);
a=isTouchDevice()?0:5;this.config.properties&&(this.buttonCaption.setFont(this.fontSize+"px",this.color,this.fontSize),this.buttonCaption.labelBox.css({"z-index":"3","text-align":"center","pointer-events":"none",overflow:"hidden",height:"auto",width:(this.width-2*a)/this.fScale+"px"}),this.buttonCaption.setLabelPosition(a,this.fontSize*this.height/100))},parseConfig:function(a){return{width:a.location.width,height:a.location.height,pageWidth:a.location.pageWidth,pageHeight:a.location.pageHeight,rotation:a.location.rotation,
reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,x:a.location.x,y:a.location.y,alpha:a.alpha,src:a.meta.item.swfURL,action:a.action,hint:a.hint,buttonCaption:"",properties:a.meta.item.properties,animation:a.animation}},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.fScale=this.pageWidth/this.config.pageWidth;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.left=this.config.x*
this.pageWidth;this.top=this.config.y*this.pageHeight;this.button.css({width:this.width+"px",height:this.height+"px"});this.button.find("img").css({width:this.width+"px",height:this.height+"px"});transformCSS({origin:{x:0,y:0},scale:this.fScale});this.buttonCaption&&this.captionCss();this.initCss();-1!=this.hasSpecial&&(this.textBox.css({transform:"scale("+this.fScale+")","transform-origin":"0 0"}),this.textBox.css({"z-index":"2",left:this.width/4+"px",top:this.height/4+"px"}))},showAnimate:function(){if(this.config.animation&&
this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.button.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.button.one(a,function(){this.button.css({animation:""})}.bind(this))}},hide:function(){isTouchDevice()},initEvt:function(){this.addActionEvent(this.button);this.button.bind(_event._down,function(){this.buttonEvt.css({display:"block"})}.bind(this));this.button.bind(_event._end,function(){this.buttonEvt.css({display:"none"})}.bind(this));
this.button.bind("mouseleave",function(){this.buttonEvt.css({display:"none"})}.bind(this))}}).extend(PageItem.Item);
Class("Area",{Package:"PageItem",create:function(a,b,c,d,e){this._super(a,b,c,d);this.id="Area"+e;this.color=Color(this.config.color);this.initArea();this.initEvents();this.onResize(c,d)},initArea:function(){this.Area=$("<div id='"+this.id+"'></div>");this.Area.css({position:"absolute",overflow:"hidden","background-color":this.color.rgba(this.config.alpha)});!0===parseBool(this.config.rounds)&&this.Area.css({"border-radius":this.config.ellipseWidth+"px "+this.config.ellipseHeight+"px"});this.addShadow(this.Area);
this.parent.append(this.Area)},parseConfig:function(a){return{x:a.location.x,y:a.location.y,width:a.location.width,height:a.location.height,alpha:a.alpha,color:a.color,rounds:a.round,ellipseWidth:a.ellipseWidth,ellipseHeight:a.ellipseHeight,hasShadow:parseBool(a.shadow.hasDropShadow),shadow:a.shadow,action:a.action}},initEvents:function(){this.addActionEvent(this.Area)},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.config.width*this.pageWidth;this.height=this.config.height*
this.pageHeight;this.Area.css({width:this.width+"px",height:this.height+"px"});this.setPosition();if(null!=this.form)this.form.onResize(bookContainer.width(),bookContainer.height());if(null!=this.slide)this.slide.onResize(bookContainer.width(),bookContainer.height());if(null!=this.audios)this.audios.onResize(bookContainer.width(),bookContainer.height())},setPosition:function(){this.left=this.config.x*this.pageWidth;this.top=this.config.y*this.pageHeight;this.Area.css({left:this.left+"px",top:this.top+
"px"})}}).extend(PageItem.Item);
Class("VideoForm",{Package:"PageItem",create:function(a,b,c,d,e){this.parent=a;this.type=e;this.playCount=0;this.config=$.extend({width:400,height:300,src:null,alpha:.3,caption:""},b);if(null!=this.config.src){this.config.width=Math.min(windowWidth-10,Number(this.config.width));this.config.height=Math.min(windowHeight-90,Number(this.config.height));this.sw=c;this.sh=d;this.th=28;this.background=$("<div ></div>");this.closeButton=$("<div></div>");this.form=$("<div class='flip-action' style='display:none;'></div>");this.titleBar=
$("<div></div>");"text"!=this.type&&(this.config.src=this.fixRelativePath(this.config.src));""!=this.config.caption&&(this.captionLabel=new label(this.config.caption,this.titleBar),this.captionLabel.setLabelPosition(5,3,["left","top"]),this.captionLabel.setFont(13,"#dddddd","Tahoma"),this.captionLabel.labelBox.css({width:this.config.width-35+"px","padding-right":"25px"}));"right"==this.config.languageLayout&&(this.alignCss={"text-align":"right",direction:"rtl"},this.captionLabel.labelBox.css({"padding-left":"25px",
"padding-right":"0","text-align":"right",direction:"rtl"}));parseBool(this.config.hideTitle)&&this.titleBar.css({display:"none"});this.parent.append(this.background);this.parent.append(this.form);this.form.append(this.titleBar);this.form.append(this.closeButton);this.setCss();"text"==this.type&&(a=this.config.src.replaceAll("  ","&ensp;"),a=(new TextFormatAnalyzer(a)).getHTML(this.alignCss),a.css({position:"absolute"}),this.text=$("<div class='text'></div>"),this.text.html(a),a.css({width:this.config.width-
20+"px"}),this.text.css({width:this.config.width-10+"px",height:this.config.height-this.th-10+"px",top:this.th+"px",left:"0px",overflow:"hidden",position:"absolute",padding:"5px"}),this.form.css({"background-color":"#ffffff",border:"5px solid rgba(204,204,204,0.8)"}),this.form.append(this.text),this.initScroll(this.text,a),this.text.scroll({},Direction.top,"win10"));if("video"==this.type){this.video=new Media($("<video src='"+this.config.src+"' webkit-playsinline='true' playsinline='true' controls='controls' controlslist='nodownload' ></video>"),
"video");this.video.setCss({width:this.config.width+"px",height:this.config.height-this.th+"px",top:this.th+"px","z-index":"200",position:"absolute"});parseBool(this.config.hideTitle)&&this.video.setCss({height:this.config.height+"px",top:"0px"});this.form.css({"background-color":"#000000",border:"5px solid rgba(204,204,204,0.8)"});this.form.append(this.video.$media);0<this.config.H5PlaybackNumber&&this.video.$media.bind("ended",function(){this.playCount++;0<this.config.H5PlaybackNumber&&this.playCount<=
this.config.H5PlaybackNumber&&this.video.play()}.bind(this));var f=(new Date).getTime();this.video.$media.bind("play",function(g){f=(new Date).getTime();BookEvent.trigger("playMedia",["play",BookInfo.getCurrentPageIndex(),this.video.$media[0].src,"Video",0]);this.playCount>this.config.H5PlaybackNumber&&(this.playCount=0)}.bind(this));this.video.$media.bind("pause",function(g){BookEvent.trigger("playMedia",["pause",BookInfo.getCurrentPageIndex(),this.video.$media[0].src,"Video",(new Date).getTime()-
f])}.bind(this));this.video.play()}"flash"==this.type&&(this.content=$("<div><div>"),this.content.flash({swf:this.config.src,width:this.config.width+"px",height:this.config.height-this.th+"px",wmode:"transparent"}),this.content.css({width:this.config.width+"px",height:this.config.height-this.th+"px",top:this.th+2+"px","line-height":"1.8",overflow:"auto",position:"absolute"}),this.form.css("background-color","#000000"),this.form.append(this.content));this.form.css({left:(windowWidth-this.config.width)/
2+"px",top:(windowHeight-this.config.height)/2+"px"});this.showForm();this.initEvent();this.initTimer()}},initTimer:function(){this.timer=function(){if(this.parentWidth!=windowWidth||this.parentHeight!=windowHeight)this.parentWidth=windowWidth,this.parentHeight=windowHeight,this.onResize()}.interval(this,300)},initScroll:function(a,b){a.addClass("stage");b.addClass("swiper");this.progress=$("<div class='progress'></div>");this.progressBar=$("<div class='progressBar'></div>");this.progress.append(this.progressBar);
a.append(this.progress);this.progress.css({background:"#aaa",width:"8px",height:"100%",position:"absolute",padding:"5px 0 5px",right:"0",cursor:"pointer"});this.progressBar.css({width:"8px",background:"rgba(11,11,11,0.55)",position:"absolute",top:"0",cursor:"pointer","border-radius":"4px"})},setCss:function(){this.closeButton.css({display:"none",position:"absolute",background:"url("+uiBaseURL+"singleClose.png) repeat 2px 1px",right:"4px",top:"3px","z-index":"201",width:"18px",height:"18px",cursor:"pointer"});
this.background.css({width:"100%",height:"100%",background:"rgba(0,0,0,0.5)","z-index":200,position:"absolute",left:"0px",top:"0px"});this.form.css({width:this.config.width+"px",height:this.config.height+"px",left:"0",top:"0",overflow:"hidden","-webkit-border-radius":"5px","-moz-border-radius":"5px","-ms-border-radius":"5px","border-radius":"5px",position:"absolute","z-index":"201",border:"5px solid rgba(251,251,251,0.8)"});this.titleBar.css({"line-height":"1.8",width:this.config.width+"px",height:this.th+
"px","border-top-left-radius":"5px","border-top-right-radius":"5px",position:"absolute",cursor:"pointer","background-color":"#111111"});"right"==this.config.languageLayout&&this.closeButton.css({right:"auto",left:"3px"})},initEvent:function(){this.form.bind(_event._down,function(h){h.stopPropagation()}.bind(this));this.background.onTap(function(h){this.closeForm();return!1}.bind(this));this.closeButton.onTap(function(h){this.closeForm();return!1}.bind(this));this.form.bind("mouseenter",function(){this.closeButton.fadeIn()}.bind(this));
this.form.bind("mouseleave",function(){this.closeButton.fadeOut()}.bind(this));if(this.config.drag){var a,b,c,d,e=!1;this.background.on(_event._end,function(h){return e=!1}.bind(this));this.form.bind("mousedown",function(h){h=h.originalEvent&&h.originalEvent.changedTouches?h.originalEvent.changedTouches:h.changedTouches?h.changedTouches:[h];this.form.css({cursor:"move"});a=parseInt(this.form.left());b=parseInt(this.form.top());c=parseInt(h[0].pageX);d=parseInt(h[0].pageY);e=!0}.bind(this));for(var f=
[this.background,this.form],g=0;g<f.length;g++)f[g].bind(_event._move,function(h){h=h.originalEvent&&h.originalEvent.changedTouches?h.originalEvent.changedTouches:h.changedTouches?h.changedTouches:[h];e&&(a=a+h[0].pageX-c,b=b+h[0].pageY-d,this.form.css({left:a+"px",top:b+"px",cursor:"move"}),c=h[0].pageX,d=h[0].pageY)}.bind(this));this.form.bind(_event._up,function(h){h=h.originalEvent&&h.originalEvent.changedTouches?h.originalEvent.changedTouches:h.changedTouches?h.changedTouches:[h];a=a+h[0].pageX-
c;b=b+h[0].pageY-d;this.form.css({cursor:"auto",left:a+"px",top:b+"px"});e=!1;c=a;d=b}.bind(this))}},showForm:function(){this.form.fadeIn(300,function(){this.text&&this.text.refreshData()}.bind(this))},closeForm:function(){this.timer&&this.timer.stop();this.video&&this.video.pause();this.form.fadeOut(300,function(){this.background.remove();this.form.remove();for(var a=0,b=[this.background,this.form];a<b.length;a++)b[a].unbind(_event._move)}.bind(this))},onResize:function(){this.form.css({left:(windowWidth-
this.config.width)/2+"px",top:(windowHeight-this.config.height)/2+"px"})}}).extend(PageItem.Item);
Class("MobileVideo",{create:function(a,b,c,d,e){this.config=b;this.parent=a;this.playCount=0;this.parentWidth=c;this.parentHeight=d;this.config.src=this.fixRelativePath(this.config.src);this.closeButton=$("<img style='width:20px;height:20px;position:absolute;cursor:pointer;padding:5px;right:5px;top:5px;z-index:1111;' src='"+phoneBaseURL+"close.png'/>");this.bg=$('<div style="width:100%;height:100%;left:0;top:0;bottom:0;right:0;position:absolute;z-index:-1; "></div>');this.content=$("<div style='display:none;'></div>");
this.video=new Media($('<video x5-video-player-type="h5" x5-video-player-fullscreen="true" x-webkit-airplay="true" webkit-playsinline="true" playsinline="true" controls="controls" controlslist="nodownload" class="flip-action"><source src="'+this.config.src+'"></video>'),"video");this.content.append(this.video.$media);this.content.append(this.closeButton);this.content.append(this.bg);this.parent.append(this.content);this.video.$media[0].play&&this.video.play();this.initStyle();this.initEvents();this.onResize();
this.show()},initStyle:function(){this.content.css({position:"absolute","z-index":200,left:"0px",top:"0px",background:"rgba(0,0,0,0.9)"});this.video.setCss({background:"#000",left:"2px","z-index":"200",position:"absolute",width:"100%",margin:"auto",top:"0px",bottom:"0px"})},initEvents:function(){function a(c){c.stopPropagation()}this.initTimer();this.content.on(_event._down,a);this.content.on(_event._end,a);this.video.$media.on(_event._down,a);this.video.$media.on(_event._end,a);this.closeButton.on(_event._down,
a);0<this.config.H5PlaybackNumber&&this.video.$media.bind("ended",function(){this.playCount++;0<this.config.H5PlaybackNumber&&this.playCount<=this.config.H5PlaybackNumber&&this.video.play()}.bind(this));var b=(new Date).getTime();this.video.$media.bind("play",function(){b=(new Date).getTime();BookEvent.trigger("playMedia",["play",BookInfo.getCurrentPageIndex(),this.video.$media[0].src,"Video",0]);this.playCount>this.config.H5PlaybackNumber&&(this.playCount=0)}.bind(this));this.video.$media.bind("pause",
function(c){BookEvent.trigger("playMedia",["pause",BookInfo.getCurrentPageIndex(),this.video.$media[0].src,"Video",(new Date).getTime()-b])}.bind(this));this.video.play();this.closeButton.onTap(function(c){this.hide();return!1}.bind(this));this.bg.onTap(function(c){this.hide()}.bind(this))},initTimer:function(){this.timer=function(){if(this.parentWidth!=windowWidth||this.parentHeight!=windowHeight)this.parentWidth=windowWidth,this.parentHeight=windowHeight,this.onResize()}.interval(this,300)},setCurrentTime:function(a){this.video.setCurrentTime(a)},
show:function(){this.content.fadeIn(300)},hide:function(){this.timer&&this.timer.stop();this.video.pause();this.content.fadeOut(300,function(){this.video.setCss("display","none");this.content.css("display","none");this.content.remove();this.closeButton.remove()}.bind(this))},onResize:function(){this.parentWidth=windowWidth;this.parentHeight=windowHeight;this.content.css({width:this.parentWidth+"px",height:this.parentHeight+"px"});this.video.setCss({height:Math.min(this.parentHeight,9*this.parentWidth/
16)+"px"})}}).extend(PageItem.Item);
Class("TextLightBox",{create:function(a,b,c,d,e){this.parent=a;this.config=b;this.container=$("<div class='flip-action' style='display:none'></div>");this.background=$("<div class='flip-action'></div>");this.box=$("<div id=textling></div>");this.title=$("<div>"+this.config.caption+"</div>");"right"==this.config.languageLayout&&(this.alignCss={"text-align":"right",direction:"rtl"},this.title.css({"text-align":"right",direction:"rtl"}));a=(new TextFormatAnalyzer(this.config.src)).getHTML(this.alignCss);this.panel=
$("<div></div>");this.panel.html(a);parseBool(this.config.hideTitle)&&this.title.text("");a=getLanguage("btnClose","Close");this.closeButton=$("<div>"+a+"</div>");this.container.append(this.background).append(this.box);this.box.append(this.title).append(this.panel).append(this.closeButton);this.parent.append(this.container);this.setCss();this.initEvent();$(window).off("resize").on("resize",this.setCss.bind(this));this.show()},setCss:function(){this.panel.css({position:"absolute",width:windowWidth-
40-16+"px","overflow-x":"hidden","font-size":"12px","line-height":"2",left:"9px"});this.container.css({top:"0",left:"0",width:windowWidth+"px",height:windowHeight+"px",position:"absolute","z-index":"100"});this.background.css({top:"0",left:"0","background-color":"black",opacity:"0.6",width:windowWidth+"px",height:windowHeight+"px",position:"absolute","z-index":"0"});this.box.css({width:windowWidth-40+"px",height:windowHeight-60+"px",position:"absolute",margin:"auto",top:"30px",left:"20px","background-color":"white",
"border-radius":"4px","z-index":"200",overflow:"hidden"});this.closeButton.css({position:"absolute",bottom:"8px","border-radius":"4px",cursor:"pointer","text-align":"center",padding:"8px 12px","background-color":"red",width:windowWidth-80+"px",right:"0",left:"0",margin:"auto",color:"white"});this.title.css({position:"relative",padding:"13px 18px","font-weight":"bold",background:"#EBEBEB","border-radius":"5px 5px 0 0"});this.panel.css({height:windowHeight-60-this.closeButton.height()-32-this.title.height()-
26+"px"})},initTimer:function(){this.timer=function(){if(this.parentWidth!=windowWidth||this.parentHeight!=windowHeight)this.parentWidth=windowWidth,this.parentHeight=windowHeight,this.onResize()}.interval(this,300)},initEvent:function(){this.initTimer();this.closeButton.onTap(function(){this.timer&&this.timer.stop();this.container.fadeOut(300,function(){this.box.remove();this.background.remove();this.container.remove()}.bind(this))}.bind(this))},show:function(){this.container.fadeIn(300)},onResize:function(){this.setCss()}});
Class("Callout",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b,c,d);this.getDefault(c,d);this.getCanvasDefault();this.animateConfig();this.defaultScale=c/this.pageWidth;this.container=$("<div class='callout textContainer'></div>");this.callout=$("<canvas  width="+this.canvasWidth+" height="+this.canvasHeight+"></canvas>");this.textBox=$("<div></div>");this.config.textStr||(this.config.textStr=this.config.formats.defaultFormat.htmlText);a=new TextFormatAnalyzer(this.config.textStr);this.text=
a.getHTML();this.context=this.callout[0].getContext("2d");this.fillStyle=this.fillColor();this.initCss(c,d);this.config.action||a.htmlHasATag()||this.container.css({"pointer-events":"none"});switch(this.config.bubbleType){case "1":this.drawRoundRect();break;case "2":this.drawRoundBubble();break;case "3":this.drawCloudBubble()}this.textBox.append(this.text);this.container.append(this.callout,this.textBox);this.parent.append(this.container);this.setRotation(this.callout,this.config.location.rotation);
this.setRotation(this.text,this.config.location.rotation);this.setRotation(this.textBox,this.config.location.rotation);this.resizeCallout(c);this.initEvents();parseBool(this.config.location.reflection)&&this.imageReflection(this.cross)},getDefault:function(a,b){this.config.location.pageWidth||(this.config.location.pageWidth=1080);this.config.location.pageHeight||(this.config.location.pageHeight=1440);this.width=this.config.location.width*this.config.location.pageWidth;this.height=this.config.location.height*
this.config.location.pageHeight;this.pageWidth=this.config.location.pageWidth;this.pageHeight=this.config.location.pageHeight;this.canvasPosition=Point(this.config.location.x*a,this.config.location.y*b);this.left=this.config.hookContrPointRatioX*this.width;this.top=this.config.hookContrPointRatioY*this.height;this.dock1=Point(this.config.hookContr1RatioX*this.width,this.config.hookContr1RatioY*this.height);this.dock2=Point(this.config.hookContr2RatioX*this.width,this.config.hookContr2RatioY*this.height);
this.startVertex=this.vertex=Point(this.config.hookContrPointRatioX*this.width,this.config.hookContrPointRatioY*this.height);this.cornerRadius=parseInt(this.config.cornerRadiut);this.fontSize=this.config.lineHeightRation*this.pageWidth;this.borderWidth=parseInt(this.config.borderWidth);this.fScale=a/this.pageWidth;this.strokeStyle=Color(this.config.borderColor).rgba(this.config.bordreAlpha);this.canvasLeft=this.canvasTop=this.canvasHeight=this.canvasWidth=0},getCanvasDefault:function(){switch(this.config.hookDirect){case "Down":if(0>
this.vertex.x){this.canvasWidth=this.width-this.vertex.x+2*this.borderWidth;this.canvasHeight=this.vertex.y+2*this.borderWidth;this.canvasTop=this.canvasPosition.y-this.borderWidth;this.canvasLeft=this.canvasPosition.x-(this.canvasWidth-this.width-this.borderWidth);this.leftTop=Point(this.canvasWidth-this.width-this.borderWidth,this.borderWidth);this.rightTop=Point(this.canvasWidth-this.borderWidth,this.borderWidth);this.rightBottom=Point(this.canvasWidth-this.borderWidth,this.height+this.borderWidth);
this.leftBottom=Point(this.canvasWidth-this.width-this.borderWidth,this.height+this.borderWidth);this.center=Point(this.canvasWidth-this.borderWidth-this.width/2,this.borderWidth+this.height/2);this.dock1=Point(this.dock1.x-this.vertex.x+this.borderWidth,this.height+this.borderWidth);this.dock2=Point(this.dock2.x-this.vertex.x+this.borderWidth,this.height+this.borderWidth);this.vertex=Point(this.borderWidth,this.vertex.y);break}this.canvasWidth=this.vertex.x>this.width?this.vertex.x+2*this.borderWidth:
this.width+2*this.borderWidth;this.canvasHeight=this.vertex.y+2*this.borderWidth;this.canvasTop=this.canvasPosition.y-this.borderWidth;this.canvasLeft=this.canvasPosition.x-this.borderWidth;this.leftTop=Point(this.borderWidth,this.borderWidth);this.rightTop=Point(this.width+this.borderWidth,this.borderWidth);this.rightBottom=Point(this.width+this.borderWidth,this.height+this.borderWidth);this.leftBottom=Point(this.borderWidth,this.height+this.borderWidth);this.center=Point(this.borderWidth+this.width/
2,this.borderWidth+this.height/2);this.dock1=Point(this.dock1.x+this.borderWidth,this.height+this.borderWidth);this.dock2=Point(this.dock2.x+this.borderWidth,this.height+this.borderWidth);this.vertex=Point(this.vertex.x,this.vertex.y);break;case "left":if(0>this.vertex.y){this.canvasWidth=this.width-this.vertex.x+2*this.borderWidth;this.canvasHeight=this.height-this.vertex.y+2*this.borderWidth;this.canvasTop=this.canvasPosition.y-this.borderWidth;this.canvasLeft=this.canvasPosition.x+this.vertex.x+
0;this.leftTop=Point(this.canvasWidth-this.width-this.borderWidth,this.canvasHeight-this.height-this.borderWidth);this.rightTop=Point(this.canvasWidth-this.borderWidth,this.canvasHeight-this.height-this.borderWidth);this.rightBottom=Point(this.canvasWidth-this.borderWidth,this.canvasHeight-this.borderWidth);this.leftBottom=Point(this.canvasWidth-this.width-this.borderWidth,this.canvasHeight-this.borderWidth);this.dock1=Point(this.canvasWidth-this.width-this.borderWidth,this.dock1.y-this.vertex.y+
this.borderWidth);this.dock2=Point(this.canvasWidth-this.width-this.borderWidth,this.dock1.y-this.vertex.y+this.borderWidth);this.center=Point(this.canvasWidth-this.borderWidth-this.width/2,this.canvasHeight-this.borderWidth-this.height/2);this.vertex=Point(this.borderWidth,this.borderWidth);break}this.vertex.y>this.height?(this.canvasWidth=this.width-this.vertex.x+2*this.borderWidth,this.canvasHeight=this.vertex.y+2*this.borderWidth,this.canvasTop=this.canvasPosition.y-this.borderWidth,this.canvasLeft=
this.canvasPosition.x+this.vertex.x+0,this.leftTop=Point(this.canvasWidth-this.width-this.borderWidth,this.borderWidth),this.rightTop=Point(this.canvasWidth-this.borderWidth,this.borderWidth),this.rightBottom=Point(this.canvasWidth-this.borderWidth,this.height+this.borderWidth),this.leftBottom=Point(this.canvasWidth-this.width-this.borderWidth,this.height+this.borderWidth)):(this.canvasWidth=this.width-this.vertex.x+2*this.borderWidth,this.canvasHeight=this.height+2*this.borderWidth,this.canvasTop=
this.canvasPosition.y-this.borderWidth,this.canvasLeft=this.canvasPosition.x+this.vertex.x+0,this.leftTop=Point(this.canvasWidth-this.width-this.borderWidth,this.borderWidth),this.rightTop=Point(this.canvasWidth-this.borderWidth,this.borderWidth),this.rightBottom=Point(this.canvasWidth-this.borderWidth,this.canvasHeight-this.borderWidth),this.leftBottom=Point(this.canvasWidth-this.width-this.borderWidth,this.canvasHeight-this.borderWidth));this.dock1=Point(this.canvasWidth-this.width-this.borderWidth,
this.dock1.y+this.borderWidth);this.dock2=Point(this.canvasWidth-this.width-this.borderWidth,this.dock2.y+this.borderWidth);this.center=Point(this.canvasWidth-this.borderWidth-this.width/2,this.borderWidth+this.height/2);this.vertex=Point(this.borderWidth,this.vertex.y);break;case "Up":if(0>this.vertex.x){this.canvasWidth=this.width-this.vertex.x+2*this.borderWidth;this.canvasHeight=this.height-this.vertex.y+2*this.borderWidth;this.canvasTop=this.canvasPosition.y-(this.canvasHeight-this.height-this.borderWidth);
this.canvasLeft=this.canvasPosition.x-(this.canvasWidth-this.width-this.borderWidth);this.leftTop=Point(this.canvasWidth-this.width-this.borderWidth,this.canvasHeight-this.height-this.borderWidth);this.rightTop=Point(this.canvasWidth-this.borderWidth,this.canvasHeight-this.height-this.borderWidth);this.rightBottom=Point(this.canvasWidth-this.borderWidth,this.canvasHeight-this.borderWidth);this.leftBottom=Point(this.canvasWidth-this.width-this.borderWidth,this.canvasHeight-this.borderWidth);this.dock1=
Point(this.borderWidth-this.vertex.x+this.dock1.x,this.canvasHeight-this.height-this.borderWidth);this.dock2=Point(this.borderWidth-this.vertex.x+this.dock2.x,this.canvasHeight-this.height-this.borderWidth);this.center=Point(this.canvasWidth-this.borderWidth-this.width/2,this.canvasHeight-this.borderWidth-this.height/2);this.vertex=Point(this.borderWidth,this.borderWidth);break}this.canvasWidth=this.vertex.x>this.width?this.vertex.x+2*this.borderWidth:this.width+2*this.borderWidth;this.canvasHeight=
this.height-this.vertex.y+2*this.borderWidth;this.canvasTop=this.canvasPosition.y-(this.canvasHeight-this.height-this.borderWidth);this.canvasLeft=this.canvasPosition.x-this.borderWidth;this.leftTop=Point(this.borderWidth,this.canvasHeight-this.height-this.borderWidth);this.rightTop=Point(this.width+this.borderWidth,this.canvasHeight-this.height-this.borderWidth);this.rightBottom=Point(this.width+this.borderWidth,this.canvasHeight-this.borderWidth);this.leftBottom=Point(this.borderWidth,this.canvasHeight-
this.borderWidth);this.dock1=Point(this.dock1.x+this.borderWidth,this.canvasHeight-this.height-this.borderWidth);this.dock2=Point(this.dock2.x+this.borderWidth,this.canvasHeight-this.height-this.borderWidth);this.center=Point(this.borderWidth+this.width/2,this.canvasHeight-this.borderWidth-this.height/2);this.vertex=Point(this.vertex.x,this.borderWidth);break;case "Right":0>this.vertex.y?(this.canvasWidth=this.vertex.x+2*this.borderWidth,this.canvasHeight=this.height-this.vertex.y+2*this.borderWidth,
this.canvasTop=this.canvasPosition.y-(this.canvasHeight-this.height-this.borderWidth),this.canvasLeft=this.canvasPosition.x-this.borderWidth,this.leftTop=Point(this.borderWidth,this.canvasHeight-this.height-this.borderWidth),this.rightTop=Point(this.width+this.borderWidth,this.canvasHeight-this.height-this.borderWidth),this.rightBottom=Point(this.width+this.borderWidth,this.canvasHeight-this.borderWidth),this.leftBottom=Point(this.borderWidth,this.canvasHeight-this.borderWidth),this.dock1=Point(this.width+
this.borderWidth,this.borderWidth+this.dock1.y-this.vertex.y),this.dock2=Point(this.width+this.borderWidth,this.borderWidth+this.dock2.y-this.vertex.y),this.center=Point(this.borderWidth+this.width/2,this.canvasHeight-this.borderWidth-this.height/2),this.vertex=Point(this.vertex.x,this.borderWidth)):(this.vertex.y>this.height?(this.canvasWidth=this.vertex.x+2*this.borderWidth,this.canvasHeight=this.vertex.y+2*this.borderWidth):(this.canvasWidth=this.vertex.x+2*this.borderWidth,this.canvasHeight=this.height+
2*this.borderWidth),this.canvasTop=this.canvasPosition.y-this.borderWidth,this.canvasLeft=this.canvasPosition.x-this.borderWidth,this.leftTop=Point(this.borderWidth,this.borderWidth),this.rightTop=Point(this.width+this.borderWidth,this.borderWidth),this.rightBottom=Point(this.width+this.borderWidth,this.height+this.borderWidth),this.leftBottom=Point(this.borderWidth,this.height+this.borderWidth),this.dock1=Point(this.width+this.borderWidth,this.borderWidth+this.dock1.y),this.dock2=Point(this.width+
this.borderWidth,this.borderWidth+this.dock2.y),this.center=Point(this.borderWidth+this.width/2,this.borderWidth+this.height/2),this.vertex=Point(this.vertex.x,this.vertex.y))}},initCss:function(a,b){this.callout.css({position:"absolute"});1!=parseInt(this.config.alpha)&&(this.callout.css({opacity:this.config.alpha}),this.textBox.css({opacity:this.config.alpha}));this.setPosition(a,b)},drawRoundRect:function(){switch(this.config.hookDirect){case "Down":this.context.beginPath();this.config.shadow&&
(this.context.shadowOffsetX=this.config.shadowBlurX,this.context.shadowOffsetY=this.config.shadowBlurY,this.context.shadowColor=Color(this.config.shadowColor).toString(),this.context.shadowBlur=this.config.shadowDistance);this.context.strokeStyle=this.strokeStyle;this.context.fillStyle=this.fillStyle;this.context.lineWidth=this.borderWidth;this.context.moveTo(this.leftTop.x+this.cornerRadius,this.leftTop.y);this.context.arcTo(this.rightTop.x,this.rightTop.y,this.rightBottom.x,this.rightBottom.y,this.cornerRadius);
this.context.arcTo(this.rightBottom.x,this.rightBottom.y,this.leftBottom.x,this.leftBottom.y,this.cornerRadius);this.context.lineTo(this.dock2.x,this.dock2.y);this.context.lineTo(this.vertex.x+this.borderWidth,this.vertex.y+this.borderWidth);this.context.lineTo(this.dock1.x,this.dock1.y);this.context.arcTo(this.leftBottom.x,this.leftBottom.y,this.leftTop.x,this.leftTop.y,this.cornerRadius);this.context.arcTo(this.leftTop.x,this.leftTop.y,this.rightTop.x,this.rightTop.y,this.cornerRadius);this.context.fill();
this.context.stroke();this.context.closePath();break;case "left":this.context.beginPath();this.config.shadow&&(this.context.shadowOffsetX=this.config.shadowBlurX,this.context.shadowOffsetY=this.config.shadowBlurY,this.context.shadowColor=Color(this.config.shadowColor).toString(),this.context.shadowBlur=this.config.shadowDistance);this.context.strokeStyle=this.strokeStyle;this.context.fillStyle=this.fillStyle;this.context.lineWidth=this.borderWidth;this.context.moveTo(this.leftTop.x+this.cornerRadius,
this.leftTop.y);this.context.arcTo(this.rightTop.x,this.rightTop.y,this.rightBottom.x,this.rightBottom.y,this.cornerRadius);this.context.arcTo(this.rightBottom.x,this.rightBottom.y,this.leftBottom.x,this.leftBottom.y,this.cornerRadius);this.context.arcTo(this.leftBottom.x,this.leftBottom.y,this.leftTop.x,this.leftTop.y,this.cornerRadius);this.context.lineTo(this.dock2.x,this.dock2.y);this.context.lineTo(this.vertex.x+this.borderWidth,this.vertex.y+this.borderWidth);this.context.lineTo(this.dock1.x,
this.dock1.y);this.context.arcTo(this.leftTop.x,this.leftTop.y,this.rightTop.x,this.rightTop.y,this.cornerRadius);this.context.fill();this.context.stroke();this.context.closePath();break;case "Up":this.context.beginPath();this.config.shadow&&(this.context.shadowOffsetX=this.config.shadowBlurX,this.context.shadowOffsetY=this.config.shadowBlurY,this.context.shadowColor=Color(this.config.shadowColor).toString(),this.context.shadowBlur=this.config.shadowDistance);this.context.strokeStyle=this.strokeStyle;
this.context.fillStyle=this.fillStyle;this.context.lineWidth=this.borderWidth;this.context.moveTo(this.leftTop.x+this.cornerRadius,this.leftTop.y);this.context.lineTo(this.dock2.x,this.dock2.y);this.context.lineTo(this.vertex.x+this.borderWidth,this.vertex.y+this.borderWidth);this.context.lineTo(this.dock1.x,this.dock1.y);this.context.arcTo(this.rightTop.x,this.rightTop.y,this.rightBottom.x,this.rightBottom.y,this.cornerRadius);this.context.arcTo(this.rightBottom.x,this.rightBottom.y,this.leftBottom.x,
this.leftBottom.y,this.cornerRadius);this.context.arcTo(this.leftBottom.x,this.leftBottom.y,this.leftTop.x,this.leftTop.y,this.cornerRadius);this.context.arcTo(this.leftTop.x,this.leftTop.y,this.rightTop.x,this.rightTop.y,this.cornerRadius);this.context.fill();this.context.stroke();this.context.closePath();break;case "Right":this.context.beginPath(),this.config.shadow&&(this.context.shadowOffsetX=this.config.shadowBlurX,this.context.shadowOffsetY=this.config.shadowBlurY,this.context.shadowColor=Color(this.config.shadowColor).toString(),
this.context.shadowBlur=this.config.shadowDistance),this.context.strokeStyle=this.strokeStyle,this.context.fillStyle=this.fillStyle,this.context.lineWidth=this.borderWidth,this.context.moveTo(this.leftTop.x+this.cornerRadius,this.leftTop.y),this.context.arcTo(this.rightTop.x,this.rightTop.y,this.rightBottom.x,this.rightBottom.y,this.cornerRadius),this.context.lineTo(this.dock2.x,this.dock2.y),this.context.lineTo(this.vertex.x+this.borderWidth,this.vertex.y+this.borderWidth),this.context.lineTo(this.dock1.x,
this.dock1.y),this.context.arcTo(this.rightBottom.x,this.rightBottom.y,this.leftBottom.x,this.leftBottom.y,this.cornerRadius),this.context.arcTo(this.leftBottom.x,this.leftBottom.y,this.leftTop.x,this.leftTop.y,this.cornerRadius),this.context.arcTo(this.leftTop.x,this.leftTop.y,this.rightTop.x,this.rightTop.y,this.cornerRadius),this.context.fill(),this.context.stroke(),this.context.closePath()}},drawRoundBubble:function(){function a(v,x){var w=x.x-v.x;v=x.y-v.y;return Math.pow(w*w+v*v,.5)}var b=this.config.borderWidth/
2,c=(this.width-5.5)/2,d=(this.height-5.5)/2,e=Point(this.vertex.x-this.center.x,this.vertex.y-this.center.y);e=e.y/e.x;var f=Math.tan((180*Math.atan(e)/Math.PI-15)/180*Math.PI),g=Math.tan((180*Math.atan(e)/Math.PI+15)/180*Math.PI),h=Math.tan(180*Math.atan(e)/Math.PI/180*Math.PI),k=Math.sqrt(c*c*d*d/(d*d+c*c*f*f)),l=Math.sqrt(f*f*c*c*d*d/(d*d+c*c*f*f)),m=Math.sqrt(c*c*d*d/(d*d+c*c*g*g)),n=Math.sqrt(g*g*c*c*d*d/(d*d+c*c*g*g)),q=Math.sqrt(c*c*d*d/(d*d+c*c*h*h));c=Math.sqrt(h*h*c*c*d*d/(d*d+c*c*h*h));
e=Point(this.vertex.x-b,this.vertex.y-b);var p=null,t=null;d=b=null;0<=f?(p=Point(k+this.width/2,l+this.height/2),t=Point(-k+this.width/2,-l+this.height/2)):(p=Point(-k+this.width/2,l+this.height/2),t=Point(k+this.width/2,-l+this.height/2));0<=g?(b=Point(m+this.width/2,n+this.height/2),d=Point(-m+this.width/2,-n+this.height/2)):(b=Point(-m+this.width/2,n+this.height/2),d=Point(m+this.width/2,-n+this.height/2));0<=h?(Point(q+this.width/2,c+this.height/2),Point(-q+this.width/2,-c+this.height/2)):(Point(-q+
this.width/2,c+this.height/2),Point(q+this.width/2,-c+this.height/2));f=a(p,e)<=a(t,e)?p:t;g=a(b,e)<=a(d,e)?b:d;void 0==CanvasRenderingContext2D.prototype.ellipse&&(CanvasRenderingContext2D.prototype.ellipse=function(v,x,w,u,r,y,z,A){this.save();this.translate(v,x);this.rotate(r);this.scale(w,u);this.arc(0,0,1,y,z,A);this.restore()});this.context.beginPath();this.config.shadow&&(this.context.shadowOffsetX=this.config.shadowBlurX,this.context.shadowOffsetY=this.config.shadowBlurY,this.context.shadowColor=
Color(this.config.shadowColor).toString(),this.context.shadowBlur=this.config.shadowDistance);this.context.strokeStyle=this.strokeStyle;this.context.fillStyle=this.fillStyle;this.context.lineWidth=this.borderWidth;this.context.ellipse(this.center.x,this.center.y,this.width/2,this.height/2,0,2*Math.PI,0,!1);this.context.fill();this.context.stroke();this.context.closePath();this.context.beginPath();this.context.moveTo(f.x+this.center.x-this.width/2,f.y+this.center.y-this.height/2);this.context.lineTo(e.x,
e.y+this.borderWidth);this.context.lineTo(g.x+this.center.x-this.width/2,g.y+this.center.y-this.height/2);this.context.fill();this.context.stroke();this.context.closePath()},drawCloudBubble:function(){var a=this.getPointList("0.006060606060606061,0.6018181818181818;0.02181818181818182,0.39636363636363636;0.16,0.38;0.15393939393939393,0.21636363636363637;0.3212121212121212,0.2381818181818182;0.39515151515151514,0.014545454545454545;0.5745454545454546,0.00909090909090909;0.7781818181818182,0.014545454545454545;0.8618181818181818,0.28909090909090907;0.9854545454545455,0.3236363636363636;1,0.5163636363636364;0.9903030303030304,0.6636363636363637;0.8666666666666667,0.7218181818181818;0.8278787878787879,0.88;0.6690909090909091,0.8818181818181818;0.6557575757575758,0.9836363636363636;0.5781818181818181,1;0.49575757575757573,0.9963636363636363;0.4812121212121212,0.8836363636363637;0.31636363636363635,0.9563636363636364;0.26181818181818184,0.8309090909090909;0.1890909090909091,0.8636363636363636;0.11393939393939394,0.8236363636363636;0.01090909090909091,0.7618181818181818"),
b=this.config.borderWidth/2,c=this.width/2>=this.height/2?this.width/25:this.height/25;b=b>3*c/this.borderWidth?3*c/this.borderWidth:b;this.vertex.x=0>this.startVertex.x?this.vertex.x+c/2:this.vertex.x-c/2;this.vertex.y=0>this.startVertex.y?this.vertex.y+c/2:this.vertex.y-c/2;this.getSecondPoint();this.context.beginPath();this.config.shadow&&(this.context.shadowOffsetX=this.config.shadowBlurX,this.context.shadowOffsetY=this.config.shadowBlurY,this.context.shadowColor=Color(this.config.shadowColor).toString(),
this.context.shadowBlur=this.config.shadowDistance);this.context.lineWidth=this.borderWidth;this.context.strokeStyle=this.strokeStyle;this.context.fillStyle=this.fillStyle;for(e=0;e<a.length;e++){var d=a[e];d.x>this.width/2?d.x-=b:d.x<this.width/2?d.x+=b:d.y>this.height/2?d.y-=b:d.y<this.height/2&&(d.y+=b)}this.context.moveTo(a[0][0],a[0][1]);for(var e=1;e<a.length-1;e++)0!=e%2&&this.context.quadraticCurveTo(a[e][0],a[e][1],a[e+1][0],a[e+1][1]);this.context.quadraticCurveTo(a[a.length-1][0],a[a.length-
1][1],a[0][0],a[0][1]);this.context.fill();this.context.stroke();this.context.closePath();this.context.beginPath();this.context.arc(this.vertex.x,this.vertex.y,3*c/5-b,0,2*Math.PI);this.context.fill();this.context.stroke();this.context.closePath();this.context.beginPath();this.context.arc(this.secondecondMovePoint.x,this.secondecondMovePoint.y,c-b,0,2*Math.PI);this.context.fill();this.context.stroke();this.context.closePath()},getPointList:function(a){var b=this.config.borderWidth/2;a=a.split(";");
for(var c=[],d=0;d<a.length;d++){var e=String(a[d]).split(",");switch(this.config.hookDirect){case "Down":var f=0>this.left?[e[0]*(this.width-b)+this.borderWidth-this.left,e[1]*(this.height-b)+this.borderWidth]:[e[0]*(this.width-b)+this.borderWidth,e[1]*(this.height-b)+this.borderWidth];break;case "left":f=0>this.top?[e[0]*(this.width-b)+this.borderWidth-this.left,e[1]*(this.height-b)-this.top+this.borderWidth]:[e[0]*(this.width-b)+this.borderWidth-this.left,e[1]*(this.height-b)+this.borderWidth];
break;case "Up":f=0>this.left?[e[0]*(this.width-b)+this.borderWidth-this.left,e[1]*(this.height-b)-this.top]:[e[0]*(this.width-b)+this.borderWidth,e[1]*(this.height-b)-this.top+this.borderWidth];break;case "Right":f=0>this.top?[e[0]*(this.width-b)+this.borderWidth,e[1]*(this.height-b)-this.top]:[e[0]*(this.width-b)+this.borderWidth,e[1]*(this.height-b)+this.borderWidth]}c.push(f)}return c},getSecondPoint:function(){function a(h,k){var l=k.x-h.x;h=k.y-h.y;return Math.pow(l*l+h*h,.5)}var b=this.config.borderWidth/
2,c=(this.width-5.5)/2,d=(this.height-5.5)/2,e=Point(this.vertex.x-this.center.x,this.vertex.y-this.center.y),f=Math.tan(180*Math.atan(e.y/e.x)/Math.PI/180*Math.PI),g=Math.sqrt(c*c*d*d/(d*d+c*c*f*f));c=Math.sqrt(f*f*c*c*d*d/(d*d+c*c*f*f));e=Point(this.vertex.x-b,this.vertex.y-b);d=b=null;0<=f?(b=Point(g+this.center.x,c+this.center.y),d=Point(-g+this.center.x,-c+this.center.y)):(b=Point(-g+this.center.x,c+this.center.y),d=Point(g+this.center.x,-c+this.center.y));e=a(b,e)<=a(d,e)?b:d;this.secondecondMovePoint=
0<this.left&&0<this.top?Point((this.left+e.x)/2,(this.top+e.y)/2):0<this.left&&0>this.top?Point((this.left+e.x)/2,(this.borderWidth+e.y)/2):0>this.left&&0<this.top?Point((e.x+this.borderWidth)/2,(this.top+e.y)/2):Point((e.x+this.borderWidth)/2,(e.y+this.borderWidth)/2)},fillColor:function(){var a=this.context.createLinearGradient(parseInt(this.canvasWidth),0,parseInt(this.canvasWidth),parseInt(this.canvasHeight));this.config.background.color?a.addColorStop(0,Color(this.config.background.color).rgba(this.config.background.alpha)):
a.addColorStop(0,"rgba(255,255,255,1)");this.config.background.color2?a.addColorStop(1,Color(this.config.background.color2).rgba(this.config.background.alpha)):a.addColorStop(1,"rgba(255,255,255,1)");return parseBool(this.config.background.fillBg)?a:"transparent"},resizeCallout:function(a){a=transformCSS({origin:{x:0,y:0},scale:a/this.pageWidth});this.callout.css(a);this.textBox.css(a)},initEvents:function(){this.addActionEvent(this.container);this.container.bind(_event._down,function(a){a.stopPropagation();
BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),"CallOut",this.config.hookContrPointRatioX,this.config.hookContrPointRatioY,this.config.location.width,this.config.location.height])}.bind(this))},onResize:function(a,b){this.textBox.css({width:this.width,height:this.height});this.setPosition(a,b);this.resizeCallout(a,b)},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.container.css({animation:b.name+
" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.container.one(a,function(){this.container.css({animation:""})}.bind(this))}},setPosition:function(a,b){var c=a/this.pageWidth;this.vertex1=Point(this.config.hookContrPointRatioX*this.width,this.config.hookContrPointRatioY*this.height);this.leftTopX=this.config.location.x*a;this.leftTopY=this.config.location.y*b;0>this.vertex1.x&&(this.leftTopX=this.config.location.x*a+this.vertex1.x*c-2*this.borderWidth*c);0>this.vertex1.y&&
(this.leftTopY=this.config.location.y*b+this.vertex1.y*c-2*this.borderWidth*c);this.textPosition=0>this.left&&0<this.top?Point((this.borderWidth-this.left)*c,this.borderWidth*c):0>this.left&&0>this.top?Point((this.borderWidth-this.left)*c,(this.borderWidth-this.top)*c):0<this.left&&0>this.top?Point((this.canvasWidth-this.width+this.borderWidth)*c/2,(-this.top+this.borderWidth)*c):Point((this.canvasWidth-this.width)*c/2,(this.canvasWidth-this.width+this.borderWidth)*c/2);this.textPosition=Point(this.borderWidth*
c,(.05*this.height+this.borderWidth)*c);0>this.left&&(this.textPosition.x=(this.borderWidth-this.left)*c);0>this.top&&(this.textPosition.y=(.05*this.height+this.borderWidth-this.top)*c);this.textBox.css({width:this.width+"px",height:.9*this.height+"px",position:"absolute",top:this.textPosition.y+"px",left:this.textPosition.x+"px","box-sizing":"border-box",display:"table-cell",padding:"0 2px",overflow:"hidden"});this.text.css({width:this.width+"px",height:.9*this.height+"px",position:"relative",top:"0",
left:"0","box-sizing":"border-box"});this.container.css({width:this.canvasWidth*c+"px",height:this.canvasHeight*c+"px",position:"absolute",left:this.leftTopX+"px",top:this.leftTopY+"px"});switch(this.config.bubbleType){case "2":this.textBox.css({display:"table",height:.33*this.height+"px"});this.text.css({display:"table-cell","vertical-align":"middle"});break;case "3":this.textBox.css({display:"table",height:.33*this.height+"px"}),this.text.css({display:"table-cell","vertical-align":"middle"})}}}).extend(PageItem.Item);
Class("AText",{Package:"PageItem",create:function(a,b,c,d,e){this._super(a,b,c,d);this.animateConfig();this.color=this.config.color?Color(this.config.color):Color("#000000");this.originWidth=this.config.pageW||this.config.pageH;this.originHeight=this.config.pageH;this.pageWidth=c;this.speed=34E3/this.config.moveSpeed;this.id="text"+e;this.initOldText();1!=parseInt(this.config.alpha)&&this.atext.css({opacity:this.config.alpha});this.initEvents();parseBool(this.config.reflection)&&this.imageReflection(this.atext);
this.onResize(this.pageWidth,this.pageHeight)},initOldText:function(){this.alignCss="";"right"==this.config.languageLayout&&(this.alignCss={"text-align":"right",direction:"rtl"});this.scrollid="scroll"+this.id;var a=new TextFormatAnalyzer(this.config.textStr);this.text=a.getHTML(this.alignCss);this.fontSize=a.getMinFontSize();this.fontColor=a.getFontColor();this.container=$("<div id="+this.id+" class='textContainer' style='position:absolute;'></div>");this.atext=$("<div style='overflow: hidden;opacity:"+
this.config.alpha+"'></div>");this.atext2=$("<div style='font-color:"+this.fontColor+";font-size:12px;font-family:"+this.config.fontName+";'></div>");this.atext2.html(this.text);this.config.action||this.config.hint||a.htmlHasATag()||this.container.css({"pointer-events":"none"});!0===parseBool(this.config.tbold)&&this.atext2.css({"font-weight":"bold"});!0===parseBool(this.config.italic)&&this.atext2.css({"font-style":"italic"});this.adjustFontSize=_agent_.browser.chrome?Math.max(1,12/this.fontSize):
1;this.width=this.config.width*this.originWidth*this.adjustFontSize;this.height=this.config.height*this.originHeight*this.adjustFontSize;this.atext.css({position:"relative",width:this.width+"px",height:this.height+"px"});this.atext2.css({"width:":"100%"});this.atext.append(this.atext2);this.container.append(this.atext);this.parent.append(this.container);this.setPosition()},parseConfig:function(a){return{x:a.location.x,y:a.location.y,width:a.location.width,height:a.location.height,rotation:a.location.rotation,
alpha:a.alpha,textStr:a.strText?a.strText:a.format.htmlText,fontName:a.format.font,fontSize:a.format.size,reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,color:a.format.color,tbold:a.format.bold,italic:a.format.italic,align:a.format.align,action:a.action,repeat:a.repeat,moveSpeed:a.moveSpeed,pageH:a.format.pageH,pageW:a.format.pageW,hasShadow:parseBool(a.shadow.hasDropShadow),shadow:a.shadow,HRate:a.HRate,languageLayout:a.languageLayout,
animation:a.animation}},play:function(){this.timer&&this.timer.stop();this.timer=null;this.initScroll()},pause:function(){this.timer&&this.timer.stop();this.timer=null},initScroll:function(){this.rHeight=this.atext2.height()+this.height+20;this.rTop=this.height;this.stop=!1;this.timer=this.textRun.animation(this,this.speed)},textRun:function(a,b){a==b&&(this.rTop=this.height,this.textRun.animation(this,this.speed));this.rTop=this.height-this.rHeight*a/b;this.atext2.css({transform:"translateY("+this.rTop+
"px)"})},initEvents:function(){this.atext.bind(_event._down,function(a){a.stopPropagation&&a.stopPropagation();return!1});this.atext.bind(_event._move,function(a){a.stopPropagation&&a.stopPropagation();return!1});this.atext.bind(_event._up,function(a){a.stopPropagation&&a.stopPropagation();return!1});this.addActionEvent(this.container);this.container.onTap(function(a){BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),"ScrollText",this.config.x,this.config.y,this.config.width,this.config.height])}.bind(this))},
onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.setPosition();this.resizeText(this.pageWidth);a=this.atext.find("p").height()/this.height;this.speed=1<a?this.speed*a:this.speed},resizeText:function(a){a=this.pageWidth/this.originWidth/this.adjustFontSize;this.atext.css({"-webkit-transform-origin":"0% 0%","-moz-transform-origin":"0% 0%","-ms-transform-origin":"0% 0%","-o-transform-origin":"0% 0%","transform-origin":"0% 0%",transform:"scale("+a+")  rotate("+this.config.rotation+"deg)",
"-webkit-transform":"scale("+a+") rotate("+this.config.rotation+"deg)","-ms-transform":"scale("+a+") rotate("+this.config.rotation+"deg)","-o-transform":"scale("+a+") rotate("+this.config.rotation+"deg)","-moz-transform":"scale("+a+") rotate("+this.config.rotation+"deg)"});this.container.css({width:this.width*a,height:this.height*a})},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.container.css({animation:b.name+" "+
b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.container.one(a,function(){this.container.css({animation:""})}.bind(this))}},setPosition:function(){this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.container.css({left:this.x+"px",top:this.y+"px"})}}).extend(PageItem.Item);
Class("FlashShow",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b,c,d);this.width=this.pageWidth*this.config.width;this.height=this.pageHeight*this.config.height;this.config=this.parseConfig(b);if(null!=this.config.photo){this.showingA=!0;this.showingIndex=1;this.background=$("<div></div>");this.totalImage=this.config.photo.Image.length;for(a=0;a<this.config.photo.Image.length;a++)this.config.photo.Image[a]=this.fixRelativePath(this.config.photo.Image[a]);this.moveTo=1;this.background.css({width:this.width+
"px",height:this.height+"px",left:this.config.x*this.pageWidth+"px",top:this.config.y*this.pageHeight+"px",position:"absolute",overflow:"hidden"});this.setRotation(this.background,this.config.rotation);this.photoA=new animateImage(this.background,this.config.photo,this.width,this.height,this.config.repeatPlay,this.config.customSize,this.config.photo.width,this.config.photo.width);this.photoB=new animateImage(this.background,this.config.photo,this.width,this.height,this.config.repeatPlay,this.config.customSize,
this.config.photo.width,this.config.photo.width);this.parent.append(this.background);this.photoB.fillImage(2);this.photoA.fillImage(1);this.initChangeImageEvent(!0);this.initEvent()}},initEvent:function(){this.content.onTap(function(a){BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),"FlashShow",this.config.x,this.config.y,this.config.width,this.config.height])}.bind(this))},parseConfig:function(a){return{width:a.location.width,height:a.location.height,rotation:a.location.rotation,
x:a.location.x,y:a.location.y,alpha:a.alpha,photo:Instance.copy(a.Images),repeatPlay:a.isRepeat}},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.pageWidth*this.config.width;this.height=this.pageHeight*this.config.height;this.background.css({width:this.width+"px",height:this.height+"px"});this.photoA.onResize(a,b);this.photoB.onResize(a,b);this.setPosition()},setPosition:function(){this.background.css({left:this.pageWidth*this.config.x+"px",top:this.pageHeight*this.config.y+
"px"})},initChangeImageEvent:function(a){var b=this,c=this.photoA.getImage(),d=this.photoB.getImage(),e;a||(c=this.photoB.getImage(),d=this.photoA.getImage());switch(this.moveTo){case 1:var f=e=1;break;case 2:f=e=-1;break;case 3:e=1;f=-1;break;case 4:e=-1,f=1}this.moveTo=4==this.moveTo?1:this.moveTo+1;var g=c.position().left+66*e,h=c.position().top+66*f,k=c.position().left+77*e,l=c.position().top+77*f;c.animate({left:g,top:h},{queue:!1,duration:3E3,complete:function(){b.showingIndex++;b.showingInde>
b.totalImage&&!b.config.repeatPlay||(b.showingIndex>b.totalImage&&(b.showingIndex=0),c.animate({opacity:0,left:k,top:l},500,function(){a?b.photoA.fillImage(b.showingIndex+1):b.photoB.fillImage(b.showingIndex+1);c.css({"z-index":0});d.css({"z-index":1})}),b.initChangeImageEvent(!a))}}).animate({opacity:1},500)}}).extend("Item");
var animateImage=Class({create:function(a,b,c,d,e,f,g,h){this.img=$("<img />");this.imgIndex=-1;this.imageArr=b;this.bw=c;this.bh=d;this.repeat=e;this.parent.append(this.img);this.img.css({position:"absolute"});f&&void 0!=g&&void 0!=h&&this.img.css({width:g+"px",height:h+"px"})},fillImage:function(a){if(this.imgIndex==a)this.img.css({left:(this.bw-this.img[0].width)/2+"px",top:(this.bh-this.img[0].height)/2+"px"});else if(!(a>this.imageArr.Image.length)||this.repeat){a>this.imageArr.Image.length&&
(a=1);this.imgIndex=a;var b=this;this.img.attr("src",b.getImageDiv(a));this.img.on("load",function(){b.img.css({left:(b.bw-this.width)/2+"px",top:(b.bh-this.height)/2+"px"})})}},getImageDiv:function(a){return this.imageArr.Image[a-1].photo},setZIndex:function(a){this.img.css("z-index",a)},onResize:function(a,b){this.bw=a;this.bh=b;this.img.css({left:(this.bw-this.img[0].width)/2+"px",top:(this.bh-this.img[0].height)/2+"px"})},setPosition:function(a,b){this.img.css({left:a+"px",top:b+"px"})},animate:function(){},
getImage:function(){return this.img}});
Class("Sound",{Package:"PageItem",create:function(a,b,c,d,e){this._super(a,b,c,d);this.sound=null;null!=this.config.src&&(this.config.src=this.config.src,this.arr=null,this.arr="undefined"!=typeof this.config.src.path?this.config.src.path:this.config.src[0].path,this.arr=this.fixRelativePath(this.arr),this.pageWidth=c,this.pageHeight=d,this.width=this.config.width*this.pageWidth,this.height=this.config.height*this.pageHeight,this.x=this.config.x*this.pageWidth,this.y=this.config.y*this.pageHeight,
this.h1=this.height/6,this.h2=this.height/3,this.c=this.nflay=this.flay=0,this.st=null,this.id="AdvancedSound"+e,this.sounddiv=$("<div class='flip-action' style='position:absolute; width:"+this.width+"px;height:"+this.height+"px;top:"+this.y+"px;left:"+this.x+"px;background:url("+uiBaseURL+"audio.png);background-size:"+this.width+"px "+this.height+"px;background-repeat:no-repeat;'></div>"),this.sound=new Media($("<audio id='"+this.id+"' src='"+this.arr+"'></audio>"),"media"),this.preimg=$("<img src='"+
uiBaseURL+"Pre_down.png' style='position:absolute; left:10px;bottom:5px;cursor:pointer;' />"),this.playimg=$("<img src='"+uiBaseURL+"Play_down.png' style='position:absolute; left:50px;bottom:5px;cursor:pointer;'/>"),this.nextimg=$("<img src='"+uiBaseURL+"Nextpage_down.png' style='position:absolute; left:90px;bottom:5px;cursor:pointer;' />"),this.soundname=$("<div style='position:absolute; right:10px;top:"+this.h2+"px;color:#389ac2;font-size:10px;'></div>"),this.soundtime=$("<div style='position:absolute; right:10px;top:"+
this.h1+"px;color:#389ac2;font-size:10px;'></div>"),this.parent.append(this.sounddiv),this.sounddiv.append(this.sound.$media),this.sounddiv.append(this.preimg),this.sounddiv.append(this.playimg),this.sounddiv.append(this.nextimg),this.sounddiv.append(this.soundname),this.sounddiv.append(this.soundtime),null!=this.config.src&&this.initEvent(),this.setRotation(this.sounddiv,this.config.rotation))},parseConfig:function(a){return{width:a.location.width,height:a.location.height,rotation:a.location.rotation,
x:a.location.x,y:a.location.y,alpageHeighta:a.alpageHeighta,src:a.soundList.sound,skinType:a.skinType,soundPlay:a.soundPlayTriggerEvt||a.componentData.playEvt}},initEvent:function(){var a=this;a.nflay=0;var b=a.playimg[0],c=a.sound[0],d=a.config.src[0].path,e=typeof a.config.src.path;"undefined"!=e?a.soundname.html(this.getname(a.config.src.path)):a.soundname.html(this.getname(d));a.soundtime.html("00:00 / 00:00");this.playimg.bind(_event._down,function(f){0==a.flay?(b.src=uiBaseURL+"Pause_down.png",
c.play(),a.flay=1,a.gettime(c.duration)):(b.src=uiBaseURL+"Play_down.png",c.pause(),a.flay=0,clearTimeout(a.st))});this.preimg.bind(_event._down,function(f){c.pause();clearTimeout(a.st);"undefined"!=e?c.src=a.config.src.path:0<a.nflay&&a.nflay<a.config.src.length?(c.src=a.config.src[a.nflay-1].path,a.soundname.html(a.getname(a.config.src[a.nflay].path)),--a.nflay):(c.src=d,a.soundname.html(a.getname(d)));c.play();b.src=uiBaseURL+"Pause_down.png";a.flay=1;setTimeout(function(){a.c=0;a.gettime(c.duration)},
1E3)});this.nextimg.bind(_event._down,function(f){c.pause();clearTimeout(a.st);"undefined"!=e?c.src=a.config.src.path:a.nflay<a.config.src.length?(a.nflay+=1,c.src=a.config.src[a.nflay].path,a.soundname.html(a.getname(a.config.src[a.nflay].path)),a.nflay+=1):(c.src=d,a.soundname.html(a.getname(d)),a.nflay=0);c.play();b.src=uiBaseURL+"Pause_down.png";a.flay=1;setTimeout(function(){a.c=0;a.gettime(c.duration)},1E3)})},gettime:function(a){var b=this,c=null,d=0,e=null;c=b.c%60;e=parseInt(a%60);e=10>e?
"0"+e:e;var f=parseInt(a/60);b.c<a&&(b.c+=1,60>b.c?c=10>b.c?"00:0"+b.c:"00:"+b.c:(d=parseInt(b.c/60),c=10>d?10>c?"0"+d+":0"+c:"0"+d+":"+c:10>c?d+":0"+c:d+":"+c),10>f?b.soundtime.html(c+" / 0"+f+":"+e):b.soundtime.html(c+" / "+f+":"+e),b.st=setTimeout(function(){b.gettime(a)},1E3))},getname:function(a){a=a.split("/");return a[a.length-1].split(".")[0]},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;
this.sounddiv.css({width:this.width+"px",height:this.height+"px"});this.sounddiv.css("background-size",this.width+"px "+this.height+"px");this.soundname.css("top",this.height/3+"px");this.soundtime.css("top",this.height/6+"px");this.setPosition()},setPosition:function(){this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.sounddiv.css({left:this.x+"px",top:this.y+"px"})}}).extend("Item");
Class("EffectText",{Package:"PageItem",create:function(a,b,c,d,e){this._super(a,b,c,d);this.animateConfig();this.originWidth=b.location.pageWidth;this.originHeight=b.location.pageHeight;this.color=Color(this.config.color).toString();this.speed=this.pos=0;this.speed="ChangeSpeed"==this.config.moveSpeed?250:150;this.width=this.config.width*this.originWidth;this.height=this.config.height*this.originHeight;this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.id="efftext"+e;this.scrollid=
"efftext"+this.id;this.alignCss="";"right"==this.config.languageLayout&&(this.alignCss={"text-align":"right",direction:"rtl"});a=new TextFormatAnalyzer(this.config.textStr);this.config.textStr=a.getLines();this.fontFamily=a.getFontFamily();this.fontSize=a.getFontSize();this.config.color=a.getFontColor();this.color=Color(this.config.color).toString();this.container=$("<div id="+this.id+" class='textContainer' style='position:absolute;text-align:"+a.getAlign()+"'></div>");!0===parseBool(this.config.sh)?
this.efftext=$("<div style='position:absolute;height:"+this.height+"px;width:"+this.width+"px;box-shadow:"+this.config.sx+"px "+this.config.sy+"px "+this.config.se+"px "+Color(this.config.sr).toString()+";opacity:"+this.config.alpha+"'></div>"):this.efftext=$("<div style='position:absolute;height:"+this.height+"px;width:"+this.width+"px;opacity:"+this.config.alpha+"'></div>");this.efftext2=$("<div id="+this.scrollid+" style='word-wrap: break-word;line-height:"+a.getLineHeight()+"px;font-family:"+
this.fontFamily+";width:"+this.width+"px;font-size:"+this.fontSize+"px;color:"+this.color+";'></div>");!0===parseBool(this.config.tbold)&&this.efftext.css({"font-weight":"bold"});!0===parseBool(this.config.italic)&&this.efftext.css({"font-style":"italic"});this.container.css({height:this.height+"px",width:this.width+"px"});1!=parseInt(this.config.alpha)&&this.efftext.css({opacity:this.config.alpha});this.initEvent();this.efftext.append(this.efftext2);this.container.append(this.efftext);this.parent.append(this.container);
this.initeffAmin();this.onResize(c,d);parseBool(this.config.reflection)&&this.imageReflection(this.efftext);this.setRotation(this.efftext,this.config.rotation)},parseConfig:function(a){return{x:a.location.x,y:a.location.y,rotation:a.location.rotation,width:a.location.width,height:a.location.height,reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,alpha:a.alpha,textStr:a.htmlText||a.textStr,moveSpeed:a.effectStyle,lineH:a.lineHeightRation,
sh:parseBool(a.shadow.hasDropShadow),sx:a.shadow.shadowBlurX,sy:a.shadow.shadowBlurY,se:a.shadow.shadowDistance,sr:a.shadow.shadowColor,languageLayout:a.languageLayout,animation:a.animation}},initeffAmin:function(){this.cel=this.row=0;this.currentText=""},runText:function(){this.timer=setInterval(function(){var a=this.config.textStr,b=this.config.textStr[this.row],c=b[this.cel];if("&"==c){var d=b.slice(this.cel,this.cel+6);"&nbsp;"===d&&(this.cel+=5,c=d)}if("<"==c){d=b.indexOf(">",this.cel);for(c=
b[d+1];"<"==c;){d=b.indexOf(">",d+1);if(-1==d)break;c=b[d+1]}c=b.substring(this.cel,d+2);this.cel=d+1}c&&(this.currentText+=c);this.cel+=1;if(!b.length||this.cel>=b.length)if(this.currentText+="<br/>",this.row+=1,this.cel=0,this.row>=a.length){this.efftext2.html(this.currentText);this.row=0;this.currentText="";clearInterval(this.timer);this.timer=null;return}this.efftext2.html(this.currentText)}.bind(this),this.speed)},initEvent:function(){this.addActionEvent(this.container);this.container.onTap(function(a){BookEvent.trigger("clickPageItem",
[BookInfo.getCurrentPageIndex(),"EffectTexts",this.config.x,this.config.y,this.config.width,this.config.height])}.bind(this))},play:function(){this.runText()},pause:function(){this.timer&&(clearInterval(this.timer),this.timer=null)},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.setPosition();this.fontSize=this.config.lineH*this.originHeight*.75;this.resizeText(this.pageWidth)},resizeText:function(a){a/=this.originWidth;this.efftext.css({"-webkit-transform-origin":"0% 0%","-moz-transform-origin":"0% 0%",
"-ms-transform-origin":"0% 0%","-o-transform-origin":"0% 0%","transform-origin":"0% 0%","-webkit-transform":"scale("+a+")","-moz-transform":"scale("+a+")","-ms-transform":"scale("+a+")","-o-transform":"scale("+a+")",transform:"scale("+a+")"})},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.container.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.container.one(a,function(){this.container.css({animation:""})}.bind(this))}},
setPosition:function(){this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.container.css({left:this.x+"px",top:this.y+"px"})}}).extend(PageItem.Item);
Class("PngImage",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b,c,d);this.img=$("<img>");null!=this.config.src&&(this.config.src=this.fixRelativePath(this.config.src),this.width=this.config.width*this.pageWidth,this.height=this.config.height*this.pageHeight,this.left=this.pageWidth*this.config.x,this.top=this.pageHeight*this.config.y,this.img.on("load",function(){this.onImageLoad()}.bind(this)),this.img.css({position:"absolute",width:"0px",height:"0px",left:this.left+"px",top:this.top+
"px",opacity:this.config.alpha}),this.img.attr({src:this.config.src}),this.parent.append(this.img),this.initEvt())},parseConfig:function(a){return{width:a.location.width,height:a.location.height,x:a.location.x,y:a.location.y,alpha:a.alpha,src:a.url,action:a.action}},onImageLoad:function(){var a=this.img[0];this.imageWidth=a.naturalWidth;this.imageHeight=a.naturalHeight;this.fitImage()},fitImage:function(){var a=this.imageWidth/this.imageHeight;if(a>this.width/this.height){var b=this.width;var c=b/
a;a=this.left;var d=(this.height-c)/2+this.top}else c=this.height,b=c*a,a=(this.width-b)/2+this.left,d=this.top;this.img.css({left:a+"px",top:d+"px",width:b+"px",height:c+"px"})},initEvt:function(){if(void 0!=this.config.action){this.linkURL="";try{void 0!=this.config.action.length&&(this.config.action=this.config.action[0]),this.linkURL=this.config.action.url}catch(a){}null!=this.linkURL&&"www"==this.linkURL.substr(0,3).toLowerCase()&&(this.linkURL="http://"+this.linkURL);this.addActionEvent(this.img)}},
onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.pageWidth*this.config.width;this.height=this.pageHeight*this.config.height;this.left=this.pageHeight*this.config.x;this.top=this.pageHeight*this.config.y;this.fitImage();this.width>this.height?this.img.css({height:this.height+"px",left:this.pageWidth*this.config.x+"px",top:this.pageHeight*this.config.y+"px"}):this.img.css({width:this.width+"px",left:this.pageWidth*this.config.x+"px",top:this.pageHeight*this.config.y+"px"});
this.setPosition(this.config.x*a,this.config.y*b)},setPosition:function(a,b){this.img.css({left:a+"px",top:b+"px"})}}).extend(PageItem.Item);
Class("TextAmin",{Package:"PageItem",create:function(a,b,c,d,e){this._super(a,b,c,d);this.animateConfig();this.color=this.config.color?Color(this.config.color):Color("#000000");this.originWidth=this.config.pageW;this.originHeight=this.config.pageH;this.pos=0;this.id="amintext"+e;this.scrollid="animscroll"+this.id;this.initText();this.initEvents();parseBool(this.config.reflection)&&this.imageReflection(this.amintext);1!=parseInt(this.config.alpha)&&this.amintext.css({opacity:this.config.alpha});this.onResize(this.pageWidth,
this.pageHeight)},initText:function(){this.alignCss="";"right"==this.config.languageLayout&&(this.alignCss={"text-align":"right",direction:"rtl"});var a=new TextFormatAnalyzer(this.config.textStr);this.fontSize=a.getMinFontSize();this.adjustFontSize=_agent_.browser.chrome?Math.max(1,12/this.fontSize):1;this.width=this.config.width*this.originWidth*this.adjustFontSize;this.height=this.config.height*this.originHeight*this.adjustFontSize;this.container=$("<div class='textAmin' class='textContainer' style='overflow:hidden;position:absolute; pointer-events:none;'></div>");
this.amintext=$("<div style='position:absolute; height:"+this.height+"px;width:"+this.width+"px;opacity:"+this.config.alpageHeighta+"'></div>");this.addShadow(this.amintext);this.amintext2=a.getHTML(this.alignCss);this.amintext.append(this.amintext2);this.container.append(this.amintext);this.parent.append(this.container);this.config.action||a.htmlHasATag()||this.container.css({"pointer-events":"none"});this.trimingFontSize(this.height);this.textContents=this.getTextContents();this.hideContents()},
getTextContents:function(){var a=this.amintext2.find("span"),b=[];if(0==a.length){var c={element:this.amintext2,text:this.amintext2.text().replaceAll("&nbsp;"," ")};0<this.amintext2.find("b").length&&(c.bold=!0);0<this.amintext2.find("i").length&&(c.italic=!0);0<this.amintext2.find("u").length&&(c.underline=!0);b.push(c)}else for(var d=0;d<a.length;d++){var e=$(a[d]);c={element:e,text:e.text().replaceAll("&nbsp;"," ")};0<e.find("b").length&&(c.bold=!0);0<e.find("i").length&&(c.italic=!0);0<e.find("u").length&&
(c.underline=!0);b.push(c)}return b},hideContents:function(){for(var a=0;a<this.textContents.length;a++)this.textContents[a].element.css("display","none")},trimingFontSize:function(a){function b(d,e){if(d.css){var f=d.css(e);f&&(f=parseInt(f.replace("px","")),f--,"line-height"==e&&(f*=.85),d.css(e,f+"px"))}}function c(d){if((d=d.children())&&0!=d.length)for(var e=0;e<d.length;e++){var f=$(d[e]);f.is("span")&&(b(f,"font-size"),b(f,"line-height"));c(f)}}for(;this.amintext2.height()>a&&_agent_.system.name!=
_agent_.system.IOS&&!(_agent_.browser.chrome&&12>=this.fontSize)&&!(c(this.amintext2),this.fontSize--,0>=this.fontSize););},parseConfig:function(a){return{x:a.location.x,y:a.location.y,width:a.location.width,height:a.location.height,alpageHeighta:a.alpageHeighta,alpha:a.alpha,effectType:a.effectType,textStr:a.textStr?a.textStr:a.formats.defaultFormat.htmlText,rotation:a.location.rotation,fontName:a.formats.defaultFormat.fontName,fontSize:a.formats.defaultFormat.fontSize,color:a.formats.defaultFormat.color,
tbold:a.formats.defaultFormat.bold,italic:a.formats.defaultFormat.italic,action:a.action,reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,lineH:a.HRate,pageW:a.formats.defaultFormat.pageW,pageH:a.formats.defaultFormat.pageH,hasShadow:parseBool(a.shadow.hasDropShadow),shadow:a.shadow,lineHeightRation:a.lineHeightRation,languageLayout:a.languageLayout,animation:a.animation}},play:function(){this.TextAnimate()},pause:function(){this.timer&&
(this.timer.stop(),this.timer=null);if("Scale Word"==this.config.effectType){var a=this.textContents.slice();a.reverse();for(var b=0;b<a.length;b++)a[b].element.css({"-webkit-transform":"scale(2.5)","-ms-transform":"scale(2.5)",transform:"scale(2.5)",display:"inline-block",opacity:"0","-webkit-transition":"","-ms-transition":"",transition:""})}},TextAnimate:function(){this.hideContents();switch(this.config.effectType){case "Default":this.initAmin();break;case "Letter Spacing":this.litterText();break;
case "Scale Word":this.scaleText();break;case "Right To Left":this.RightText();break;case "Center To Edges":this.initAmin();break;default:this.initAmin()}},changeAnimateContent:function(a){var b=this.textContents[a];a=b.element;b=b.text;a.text("");a.css("display","block");return{content:a,text:b}},initAmin:function(){this.timer&&this.timer.stop();this.cel=this.row=0;this.currentText="";var a=(new TextFormatAnalyzer(this.config.textStr)).getLines();var b=this.textContents[0].element;b.css({display:"block"});
b=this.changeAnimateContent(0).content;this.timer=function(){var c=a[this.row],d=a[this.row][this.cel];if("&"==d){var e=c.slice(this.cel,this.cel+6);"&nbsp;"===e&&(this.cel+=5,d=e)}if("<"==d){e=c.indexOf(">",this.cel);for(d=a[this.row][e+1];"<"==d;){e=c.indexOf(">",e+1);if(-1==e)break;d=a[this.row][e+1]}d=c.substring(this.cel,e+2);this.cel=e+1}d&&(this.currentText+=d);this.cel+=1;if(this.cel>=a[this.row].length||!c.length)if(this.currentText+="<br/>",this.row+=1,this.cel=0,this.row>=a.length){b.html(this.currentText);
this.row=0;this.currentText="";this.timer.stop();this.timer=null;return}b.html(this.currentText)}.interval(this,200)},scaleText:function(){this.timer2&&(clearTimeout(this.timer2),this.timer2=null);this.container.css({perspective:"200","-webkit-perspective":"200",overflow:""});var a=this.textContents.slice();a.reverse();for(var b=0;b<a.length;b++){var c=a[b];c.element.css({"-webkit-transform":"scale(2.5)","-ms-transform":"scale(2.5)",transform:"scale(2.5)",display:"inline-block",opacity:"0"});(function(d){this.timer2=
setTimeout(function(){d.element.css({opacity:"1","-webkit-transform":"scale(1)","-ms-transform":"scale(1)",transform:"scale(1)","-webkit-transition":"all 0.25s","-ms-transition":"all 0.25s",transition:"all 0.25s"});d.element.one("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){d.element.css({"-webkit-transition":"","-ms-transition":"",transition:""})}.bind(this))}.bind(this),100+200*b)}).call(this,c)}},RightText:function(){this.amintext2.css({position:"absolute",opacity:.1,
left:"50px"});for(var a=0;a<this.textContents.length;a++)this.textContents[a].element.css("display","inline-block");(function(){this.amintext2.animate({opacity:1,left:"0px"})}).delay(this,100)},litterText:function(a,b){this.timer&&this.timer.stop();var c=0,d=0,e=-this.fontSize,f,g,h=function(k){k=this.changeAnimateContent(k);f=k.content;g=k.text}.bind(this);h(0);this.timer=function(){if(c<g.length){var k=$("<div></div>");k.css({position:"relative",display:"inline-block",top:e+"px"});var l=g.substr(c,
1);k.text(l);" "==l&&k.css({width:this.fontSize/2+"px",height:this.fontSize+"px"});f.append(k);k.animate({top:"0px"},400,"swing");c++}else d++,d>=this.textContents.length?(this.timer.stop(),this.timer=null):(h(d),c=0)}.interval(this,200)},initEvents:function(){this.addActionEvent(this.container);this.container.onTap(function(a){BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),"TextAmin",this.config.x,this.config.y,this.config.width,this.config.height])}.bind(this))},onResize:function(a,
b){this.pageWidth=a;this.pageHeight=b;this.setPosition();this.amintext.css("font-size",this.fontSize+"px");this.amintext2.css("font-size",this.fontSize+"px");this.resizeText(this.pageWidth)},resizeText:function(a){a=a/this.originWidth/this.adjustFontSize;this.amintext.css({"-webkit-transform-origin":"0% 0%","-moz-transform-origin":"0% 0%","-ms-transform-origin":"0% 0%","-o-transform-origin":"0% 0%","transform-origin":"0% 0%","-webkit-transform":"scale("+a+") rotate("+this.config.rotation+"deg)","-moz-transform":"scale("+
a+") rotate("+this.config.rotation+"deg)","-ms-transform":"scale("+a+") rotate("+this.config.rotation+"deg)","-o-transform":"scale("+a+") rotate("+this.config.rotation+"deg)",transform:"scale("+a+") rotate("+this.config.rotation+"deg)"});this.container.css({width:this.width*a+"px",height:this.height*a+"px"})},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.container.css({animation:b.name+" "+b.duration+"s "+b.timeFun+
" "+b.delay+"s "+b.count+" "+b.direction});this.container.one(a,function(){this.container.css({animation:""})}.bind(this))}},setPosition:function(){this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.container.css({left:this.x+"px",top:this.y+"px"})}}).extend(PageItem.Item);
Class("StarText",{Package:"PageItem",create:function(a,b,c,d,e){this._super(a,b,c,d);this.animateConfig();this.originWidth=this.config.pageW||this.config.pageH;this.originHeight=this.config.pageH;this.speed=1/this.config.moveSpeed*24E3;this.tid=e;this.id="startext"+e;this.scrollid="starwars"+this.id;this.textli="";this.offset=0;this.stepping=.2;this.initText();this.initEvents();parseBool(this.config.reflection)&&this.imageReflection(this.startext);1!=parseInt(this.config.alpha)&&this.startext.css({opacity:this.config.alpha});
this.onResize(this.pageWidth,this.pageHeight)},initText:function(){this.alignCss="";"right"==this.config.languageLayout&&(this.alignCss={"text-align":"right",direction:"rtl"});var a=new TextFormatAnalyzer(this.config.textStr);this.fontSize=a.getMinFontSize();this.text=a.getHTML(this.alignCss);this.text.css({"width:":"100%",height:"100%"});this.adjustFontSize=_agent_.browser.chrome?Math.max(1,12/this.fontSize):1;this.width=this.config.width*this.originWidth*this.adjustFontSize;this.height=this.config.height*
this.originHeight*this.adjustFontSize;this.container=$("<div id='"+this.id+" class='textContainer' style='position:absolute; height:"+this.height+"px;width:"+this.width+"px;'></div>");this.startext=$("<div style='position:absolute; overflow:hidden;height:"+this.height+"px;width:"+this.width+"px;opacity:"+this.config.alpha+"'></div>");this.sFontSize=this.config.fontSize?this.config.fontSize.replaceAll('"',""):"9";this.startext2=$("<div id='"+this.scrollid+"' style='word-wrap: break-word;'></div>");
this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.config.pageW?this.startext2.css({position:"absolute",width:"80%",left:"10%",top:"-40%","-webkit-transform-origin":this.width/2+"px "+this.height+"px","-moz-transform-origin":this.width/2+"px "+this.height+"px","-ms-transform-origin":this.width/2+"px "+this.height+"px","-o-transform-origin":this.width/2+"px "+this.height+"px","transform-origin":this.width/2+"px "+this.height+"px"}):this.startext2.css({position:"absolute"});
this.config.action||a.htmlHasATag()||this.container.css({"pointer-events":"none"});!0===parseBool(this.config.tbold)&&this.startext2.css({"font-weight":"bold"});!0===parseBool(this.config.italic)&&this.startext2.css({"font-style":"italic"});this.addShadow(this.startext);this.container.append(this.startext);this.parent.append(this.container);this.startext.append(this.startext2);this.startext2.append(this.text)},parseConfig:function(a){return{x:a.location.x,y:a.location.y,width:a.location.width,height:a.location.height,
reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,alpha:a.alpha,textStr:a.strText?a.strText:a.format.htmlText,fontName:a.format.font,fontSize:a.format.size,color:a.format.color,tbold:a.format.bold,italic:a.format.italic,align:a.format.align,pageW:a.format.pageW,pageH:a.format.pageH,action:a.action,repeat:a.repeat,moveSpeed:a.moveSpeed,lineH:a.HRate,hasShadow:parseBool(a.shadow.hasDropShadow),shadow:a.shadow,languageLayout:a.languageLayout,
animation:a.animation}},play:function(){this.config.pageW?(this.playText=!0,this.textHeight=this.startext2.height(),this.initScroll()):this.initScrollOld()},pause:function(){this.config.pageW?(this.playText=!1,this.setRunCss(["",1.5*this.height])):this.startext2.stop()},setRunCss:function(a){this.startext2.css({"-webkit-transition":a[0],"-o-transition":a[0],"-moz-transition":a[0],transition:a[0],"-webkit-transform":"rotateX(70deg)  translateY("+a[1]+"px)","-moz-transform":"rotateX(70deg)   translateY("+
a[1]+"px)","-o-transform":"rotateX(70deg)   translateY("+a[1]+"px)","-mos-transform":"rotateX(70deg) t translateY("+a[1]+"px)",transform:"rotateX(70deg)   translateY("+a[1]+"px)"})},initScrollOld:function(){this._wrap=this.startext2;var a=this.text.length;this._wrap.height();for(var b=a;0<=b;b--)$(a[b]).css("fontSize",this.sFontSize-this.offset+"px"),this.offset+=this.stepping;this._wrap.css("marginTop",this.height);this.initScrollTextOld()},initScrollTextOld:function(){var a=this,b=a._wrap,c=a.tid,
d=b.height();b.animate({marginTop:-d+"px"},a.speed,"linear",function(){if("true"==a.config.repeat){for(var e=c;0<=e;e--)$(c[e]).css("fontSize",a.sFontSize-a.offset+"pt"),a.offset+=a.stepping;b.css("marginTop",a.height);a.offset=0;a.stepping=.2;a.initScrollTextOld()}else b.css("marginTop",0)})},initScroll:function(){this.setRunCss(["",1.5*this.height]);(function(){this.playText&&this.initScrollText()}).delay(this,30)},initScrollText:function(){if(this.transitionEnd=this.whichTransitionEvent())this.startext2.one(this.transitionEnd,
function(a){a.stopPropagation();"true"==this.config.repeat&&this.initScroll()}.bind(this));this.setRunCss(["all "+this.speed+"ms linear",-this.textHeight])},whichTransitionEvent:function(){var a,b=this.startext2[0],c={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd",MsTransition:"msTransitionEnd"};for(a in c)if(void 0!==b.style[a])return c[a]},initEvents:function(){this.addActionEvent(this.container);this.container.onTap(function(a){BookEvent.trigger("clickPageItem",
[BookInfo.getCurrentPageIndex(),"StarText",this.config.x,this.config.y,this.config.width,this.config.height])}.bind(this))},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.setPosition();this.resizeText(this.pageWidth)},resizeText:function(a){a=a/this.originWidth/this.adjustFontSize;this.startext.css({perspective:this.height/2+"px","-webkit-transform-origin":"0% 0%","-moz-transform-origin":"0% 0%","-ms-transform-origin":"0% 0%","-o-transform-origin":"0% 0%","transform-origin":"0% 0%",
"-webkit-transform":"scale("+a+")","-moz-transform":"scale("+a+")","-ms-transform":"scale("+a+")","-o-transform":"scale("+a+")",transform:"scale("+a+")"});this.container.css({width:this.width*a+"px",height:this.height*a+"px"})},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.container.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.container.one(a,function(){this.container.css({animation:""})}.bind(this))}},
setPosition:function(){this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.container.css({left:this.x+"px",top:this.y+"px"})}}).extend(PageItem.Item);
Class("Banner",{Package:"PageItem",create:function(a,b,c,d,e){this._super(a,b,c,d);this.animateConfig();this.ratio=2;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.banners=this.config.banners;this.id="banner"+e;this.time=this.banners.length?1E3*this.banners[0].displayTime:this.banners?1E3*this.banners.displayTime:2E3;this.btnWidth=30;this.shadowColor=260<this.width?"#000":"#111";
this.initHtml();this.initCss();this.getPosition();this.initEvent();this.drawNextImage(this.images[0]);this.setRotation(this.banner,this.config.rotation)},parseConfig:function(a){return{width:a.location.width,height:a.location.height,rotation:a.location.rotation,x:a.location.x,y:a.location.y,alpha:a.alpha,action:a.action,selectBtn:a.selectBtn,autoBool:parseBool(a.autoBool),banners:a.banners,animation:a.animation}},initHtml:function(){this.banner=$("<div ></div>");this.canvas=$("<canvas class='box' style='background:#ffffff;width:"+
this.width+"px;height:"+this.height+"px;' width='"+this.width*this.ratio+"' height='"+this.height*this.ratio+"'></canvas>");this.leftBtn=$("<img src='"+uiBaseURL+"pre_image.png' />");this.rightBtn=$("<img src='"+uiBaseURL+"next_image.png' />");this.leftBtn.css({position:"absolute",width:"20px",height:"20px",left:"0",top:(this.height-20)/2+"px"});this.rightBtn.css({position:"absolute",width:"20px",height:"20px",right:"0",top:(this.height-20)/2+"px"});this.images=[];if(!this.banners.length){if(!this.banners.banner)return;
var a=new Image,b=this.fixRelativePath(this.banners.banner.imageUrl);bookConfig.useTheAliCloudChart&&(b=this.getOssUrl(b,this.width,this.height,"lfit"));a.src=b;this.images.push(a)}for(var c=0;this.banners.length&&c<this.banners.length;c++)a=new Image,b=this.fixRelativePath(this.banners[c].imageUrl),bookConfig.useTheAliCloudChart&&(b=this.getOssUrl(b,this.width,this.height,"lfit")),a.src=b,this.images.push(a);this.ctx=this.canvas[0].getContext("2d");this.banner.append(this.canvas);parseBool(this.config.selectBtn)&&
this.banner.append(this.leftBtn).append(this.rightBtn);this.parent.append(this.banner)},initCss:function(){this.banner.css({opacity:this.config.alpha,position:"absolute",width:this.width+"px",height:this.height+"px",left:this.x+"px",top:this.y+"px"});this.leftBtn.css({cursor:"pointer"});this.rightBtn.css({cursor:"pointer"})},initEvent:function(){this.leftBtn.onTap(function(a){a.preventDefault();a=this.images.pop();this.images.unshift(a);this.drawNextImage(this.images[0])}.bind(this));this.rightBtn.onTap(function(a){BookEvent.trigger("clickPageItem",
[BookInfo.getCurrentPageIndex(),"Banner",this.config.x,this.config.y,this.config.width,this.config.height]);this.drawNextImage(this.images[1]);a=this.images.shift();this.images.push(a)}.bind(this))},getPosition:function(){x1=this.width*this.ratio;y1=this.height/2*this.ratio;x2=.85*this.width*this.ratio;y2=this.height*this.ratio;x3=.76*this.width*this.ratio;y3=.88*this.height*this.ratio;x4=this.width*this.ratio;y4=this.height/2*this.ratio;this.positions=[{x:x1,y:y1},{x:x2,y:y2},{x:x3,y:y3},{x:x4,y:y4}]},
getImageConfig:function(a){if(a.naturalWidth/a.naturalHeight>this.width/this.height)if(a.naturalWidth<this.width){var b=a.naturalWidth,c=a.naturalHeight;a=(this.width-b)/2;var d=(this.height-c)/2}else b=this.width,d=this.width/a.naturalWidth,c=a.naturalHeight*d,a=0,d=(this.height-c)/2;else a.naturalHeight<this.height?(b=a.naturalWidth,c=a.naturalHeight,a=(this.width-b)/2,d=(this.height-c)/2):(d=this.height/a.naturalHeight,c=this.height,b=a.naturalWidth*d,a=(this.width-b)/2,d=0);return{width:b,height:c,
left:a*this.ratio,top:d*this.ratio}},drawWhiteBg:function(){this.ctx.save();this.ctx.fillStyle="#fff";this.ctx.fillRect(0,0,this.width*this.ratio,this.height*this.ratio);this.ctx.restore()},drawNextImage:function(a){if(a){this.ctx.beginPath();if(a.complete){if(!a.naturalWidth){this.canvas.css({background:"transparent"});this.imgError=!0;return}var b=this.getImageConfig(a);this.drawWhiteBg();this.ctx.drawImage(a,b.left,b.top,b.width*this.ratio,b.height*this.ratio)}else a.onload=function(){if(a.naturalWidth){var c=
this.getImageConfig(a);this.drawWhiteBg();this.ctx.drawImage(a,c.left,c.top,c.width*this.ratio,c.height*this.ratio)}else this.canvas.css({background:"transparent"}),this.imgError=!0}.bind(this);this.ctx.closePath()}},cutImg:function(a){this.ctx.beginPath();var b=this.images[0];if(b.complete)if(b.naturalWidth){var c=this.getImageConfig(b);this.ctx.beginPath();this.ctx.save();this.ctx.moveTo(0,0);0<a[0].y&&this.ctx.lineTo(a[0].x,0);this.ctx.lineTo(a[0].x,a[0].y);this.ctx.lineTo(a[1].x,a[1].y);this.ctx.lineTo(0,
this.height*this.ratio);this.ctx.lineTo(0,0);this.ctx.clip();this.drawWhiteBg();this.ctx.drawImage(b,c.left,c.top,c.width*this.ratio,c.height*this.ratio);this.ctx.restore();this.ctx.closePath()}else this.canvas.css({background:"transparent"}),this.imgError=!0;else b.onload=function(){if(b.naturalWidth){var d=this.getImageConfig(b);this.ctx.beginPath();this.ctx.save();this.ctx.moveTo(0,0);0<a[0].y&&this.ctx.lineTo(a[0].x,0);this.ctx.lineTo(a[0].x,a[0].y);this.ctx.lineTo(a[1].x,a[1].y);this.ctx.lineTo(0,
this.height*this.ratio);this.ctx.lineTo(0,0);this.ctx.clip();this.drawWhiteBg();this.ctx.drawImage(b,d.left,d.top,d.width*this.ratio,d.height*this.ratio);this.ctx.restore();this.ctx.closePath()}else this.canvas.css({background:"transparent"}),this.imgError=!0}.bind(this)},drawCover:function(a){this.ctx.beginPath();var b=this.ctx.createLinearGradient(0,0,1.2*a[0].x,.8*a[1].x);b.addColorStop(0,"#fff");b.addColorStop(.6,"#ddd");b.addColorStop(1,"#eee");this.ctx.fillStyle=b;this.ctx.moveTo(a[0].x,a[0].y);
this.ctx.lineTo(a[1].x,a[1].y);this.ctx.lineTo(a[2].x,a[2].y);this.ctx.lineTo(a[3].x,a[3].y);this.ctx.lineTo(a[0].x,a[0].y);this.ctx.fill();this.ctx.closePath();this.drawShadow(a)},drawShadow:function(a){this.ctx.beginPath();this.ctx.save();1<=a[0].x?(this.ctx.shadowColor=this.shadowColor,this.ctx.strokeStyle="#dedede",this.ctx.shadowBlur=.075*(this.width-a[2].x/2),this.ctx.shadowOffsetX=.09*-(this.width-a[1].x),this.ctx.lineWidth=2):this.ctx.restore();this.ctx.moveTo(a[0].x+2,.9*a[0].y);this.ctx.lineTo(a[1].x+
2,.95*a[1].y);1<=a[0].x&&(this.ctx.stroke(),this.ctx.restore());this.ctx.closePath();this.ctx.beginPath();this.ctx.save();1<=a[0].x?(this.ctx.shadowColor=this.shadowColor,this.ctx.strokeStyle="#dedede",this.ctx.shadowBlur=.075*(this.width-a[2].x/2),this.ctx.shadowOffsetX=.13*-(this.width-a[1].x),this.ctx.lineWidth=2):this.ctx.restore();this.ctx.moveTo(a[0].x+2,.9*a[0].y);this.ctx.lineTo(a[1].x+2,.95*a[1].y);1<=a[0].x&&(this.ctx.stroke(),this.ctx.restore());this.ctx.closePath();this.ctx.beginPath();
this.ctx.save();1<=a[0].x?(this.ctx.shadowColor=this.shadowColor,this.ctx.strokeStyle="#dedede",this.ctx.lineWidth=2,this.ctx.shadowBlur=.075*(this.width-a[2].x/2),this.ctx.shadowOffsetX=.04*(this.width-a[2].x)):this.ctx.restore();this.ctx.moveTo(a[0].x,a[0].y);this.ctx.lineTo(a[1].x,a[1].y);1<=a[0].x&&(this.ctx.stroke(),this.ctx.restore());this.ctx.closePath()},play:function(){this.imgError||1>=this.images.length||!this.config.autoBool||this.timer||this.timeOut||(this.timeOut=setTimeout(this.animate.bind(this),
this.time))},pause:function(){this.imgError||1>=this.images.length||!this.config.autoBool||(clearTimeout(this.timeOut),this.timeOut=null,cancelAnimationFrame(this.timer),this.timer=null)},getRunPosition:function(){0>=this.positions[0].y&&(this.positions[0].x-=.0175*this.width*this.ratio);this.positions[0].x<this.width/2&&(this.positions[0].x-=.0035*this.width*this.ratio);0<this.positions[0].y&&(this.positions[0].y-=.05*this.height*3.5*this.ratio);0<this.positions[1].x&&(this.positions[1].x-=.0175*
this.width*this.ratio);this.positions[2].x-=.0085*this.width*3.5*this.ratio;this.positions[2].y-=.01925*this.height*this.ratio;this.positions[2].x<=.4*this.width&&(this.positions[2].y+=.01925*this.height*this.ratio);0>=this.positions[0].y&&(this.positions[3].x-=.03325*this.width*this.ratio);0<this.positions[3].y&&(this.positions[3].y-=.05*this.height*3.5*this.ratio)},animate:function(){this.ctx.clearRect(0,0,this.width,this.height);if(!this.imgError&&(this.drawNextImage(this.images[1]),this.cutImg(this.positions),
this.drawCover(this.positions),this.getRunPosition(),0<=this.positions[0].x&&(this.timer=requestAnimationFrame(this.animate.bind(this))),0>this.positions[0].x)){this.pause();this.drawNextImage(this.images[1]);var a=this.images.shift();this.images.push(a);this.getPosition();this.timeOut=setTimeout(this.animate.bind(this),this.time)}},onResize:function(a,b){var c=this.config.width*a/this.width;this.fScale=a/this.pageWidth;this.pageWidth=a;this.pageHeight=b;this.btnWidth*=this.fScale;this.banner.css({"-webkit-transform-origin":"0 0",
"-o-transform-origin":"0 0","-moz-transform-origin":"0 0","-ms-transform-origin":"0 0","transform-origin":"0 0","-webkit-transform":"scale("+c+")","-o-transform":"scale("+c+")","-ms-transform":"scale("+c+")","-moz-transform":"scale("+c+")",transform:"scale("+c+")"});this.setPosition()},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.banner.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+
" "+b.direction});this.banner.one(a,function(){this.banner.css({animation:""})}.bind(this))}},setPosition:function(){this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.banner.css({left:this.x+"px",top:this.y+"px"})}}).extend("Item");
Class("Print",{Package:"PageItem",create:function(a,b,c,d,e){this._super(a,b,c,d);this.pageIndex=e;this.initArea();this.initEvents();this.onResize()},initArea:function(){this.area=$("<div class='flip-action'></div>");this.button=$("<img src = '"+uiBaseURL+"print_icon.png'></img>");this.parent.append(this.area);this.area.append(this.button);this.initStyle();this.initImageForPrint()},initStyle:function(){this.area.css({position:"absolute",border:Math.floor(this.config.borderWidth/2)+"px solid "+Color(this.config.borderColor).rgba(this.config.overAlpha),
opacity:this.config.alpha,"border-radius":Math.floor(this.config.borderWidth/2)+"px","-webkit-transform-origin":"50% 50%","-moz-transform-origin":"50% 50%","-ms-transform-origin":"50% 50%","-o-transform-origin":"50% 50%","transform-origin":"50% 50%"});this.button.css({position:"absolute",width:"16px",height:"16px",top:"5px",right:"5px",cursor:"pointer"})},getImageSizeForMM:function(a,b){var c=a/b;c>690/1021?690<a&&(a=690,b=a/c):1021<b&&(b=1021,a=b*c);return{width:a,height:b}},getScaleConfig:function(a,
b){var c=bookConfig.largePageWidth,d=bookConfig.largePageHeight,e=a/b,f=c/d,g=c*this.config.x,h=d*this.config.y;return e>f&&a>=c?{y:(h-(d-c/e)/2)/b,x:this.config.x,pWidth:c,pHeight:d}:e<f&&b>=d?{x:(g-(c-d*e)/2)/a,y:this.config.y,pWidth:c,pHeight:d}:{x:this.config.x,y:this.config.y,pWidth:a,pHeight:b}},initImageForPrint:function(){this.ready=!1;var a=this.getImageSizeForMM(bookConfig.largePageWidth*this.config.width,bookConfig.largePageHeight*this.config.height),b=a.width,c=a.height;this.printedImage=
$("<div></div>");var d=$("<img width='"+b+"px' height = '"+c+"px'></img>");this.printedImage.append(d);var e=$("<img></img>"),f=$("<canvas width='"+b+"px' height = '"+c+"px'></canvas>");e.on("load",function(g){try{var h=f[0].getContext("2d");if(h){var k=e[0].naturalWidth,l=e[0].naturalHeight,m=k*this.config.x,n=l*this.config.y,q=k*this.config.width,p=l*this.config.height;if(!bookConfig.bookPageStretch){var t=this.getScaleConfig(k,l);m=k*t.x;n=l*t.y;q=t.pWidth*this.config.width;p=t.pHeight*this.config.height}h.drawImage(e[0],
m,n,q,p,0,0,b,c);d[0].src=f[0].toDataURL("image/png");e.attr("src","")}}catch(v){console.error&&console.error("Load printed image failed."),this.ready=!0}}.bind(this));d.on("load",function(g){this.ready=!0}.bind(this));getPageDir(this.pageIndex,"normal",originTotalPageCount).then(function(g){e.attr("src",g)})},parseConfig:function(a){return{width:a.location.width,height:a.location.height,rotation:a.location.rotation,x:a.location.x,y:a.location.y,alpha:a.alpha,overAlpha:a.overAlpha,borderColor:a.borderColor,
overColor:a.overColor,borderWidth:a.barderWidth,printTitle:a.printTitle,printDesc:a.printDesc}},initEvents:function(){parseInt(this.config.rotation);var a=Color(this.config.overColor),b=parseFloat(this.config.overAlpha),c=a.rgba(b);this.area.bind(isPhone()||isPad()?_event._down:_event._enter,function(d){this.area.css({"background-color":c})}.bind(this));this.area.bind(isPhone()||isPad()?_event._up:_event._leave,function(d){this.area.css({"background-color":""})}.bind(this));this.button.asButton();
this.button.bind(_event._start,function(d){return!1});this.button.onTap(function(d){BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),"Print",this.config.x,this.config.y,this.config.width,this.config.height]);this.print();return!1}.bind(this))},print:function(){if(this.ready)try{this.printedImage.printArea()}catch(a){console.error&&console.error("Print image area failed.")}else this.print.delay(this,300)},onResize:function(a,b){a&&(this.pageWidth=a);b&&(this.pageHeight=b);this.left=
this.pageWidth*this.config.x-this.config.borderWidth;this.top=this.pageHeight*this.config.y-this.config.borderWidth;this.width=this.pageWidth*this.config.width;this.height=this.pageHeight*this.config.height;0>this.left&&(this.left=0);0>this.top&&(this.top=0);this.width+parseInt(this.config.borderWidth)>this.pageWidth&&(this.width=this.pageWidth-parseInt(this.config.borderWidth));this.area.css({left:this.left+"px",top:this.top+"px",width:this.width+"px",height:this.height+"px"})}}).extend(PageItem.Item);
Class("Prismatic",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b,c,d);this.animateConfig();this.color=Color(this.config.color).toString();this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.colorA=Color(this.config.colorA).toString();this.colorB=Color(this.config.colorB).toString();this.prismatic=$("<canvas width='"+this.width+"' height='"+this.height+"' id='prismatic'></canvas>");
this.prismatic.css({position:"absolute",opacity:this.config.alpha,left:this.x+"px",top:this.y+"px"});this.setRotation(this.prismatic,this.config.rotation);this.parent.append(this.prismatic);this.draw();this.initEvent();parseBool(this.config.reflection)&&this.imageReflection(this.prismatic)},parseConfig:function(a){return{x:a.location.x,y:a.location.y,width:a.location.width,rotation:a.location.rotation,height:a.location.height,alpha:a.alpha,fillStyle:a.fillStyle,color:a.color,colorA:a.gradientColorA,
colorB:a.gradientColorB,angle:a.angle,spalpha:a.spalpha,reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,borderWidth:a.borderWidth,borderColor:a.borderColor,borderAlpha:a.borderAlpha,sh:parseBool(a.shadow.hasDropShadow),sa:a.shadow.shadowAngle,sx:a.shadow.shadowBlurX,sy:a.shadow.shadowBlurY,se:a.shadow.shadowDistance,sr:a.shadow.shadowColor,action:a.action,animation:a.animation}},draw:function(){var a=this.prismatic[0],b=a.getContext("2d");
b.clearRect(0,0,a.width,a.height);this.width-=this.config.borderWidth;this.height-=this.config.borderWidth;b.beginPath();b.lineCap="round";b.lineJoin="round";b.strokeStyle=Color(this.config.borderColor).toString();b.lineWidth=this.config.borderWidth;b.globalAlpha=this.config.spalpha;b.moveTo(this.config.borderWidth,this.height/2);b.lineTo(this.width/2,this.height);b.lineTo(this.width-2,this.height/2);b.lineTo(this.width/2,this.config.borderWidth);this.config.sh&&this.setShapeShadow(b);if("gradient"==
this.config.fillStyle){a=this.config.angle*Math.PI/180;var c=(Number(this.config.angle)+180)*Math.PI/180;a=b.createLinearGradient(this.width/2+this.width/2*Math.cos(c),this.height/2+this.height/2*Math.sin(c),this.width/2+this.width/2*Math.cos(a),this.height/2+this.height/2*Math.sin(a));a.addColorStop(0,this.colorA);a.addColorStop(1,this.colorB);b.fillStyle=a;b.fill()}"Pure"==this.config.fillStyle&&(b.fillStyle=this.color,b.fill());b.closePath();0!=this.config.borderWidth&&b.stroke()},initEvent:function(){this.linkURL=
"";null!=this.config.action&&(null!=this.config.action.length&&(this.config.action=this.config.action[0]),this.linkURL=this.config.action.url,null!=this.linkURL&&"www"==this.linkURL.substr(0,3).toLowerCase()&&(this.linkURL="http://"+this.linkURL));this.prismatic.onTap(function(a){BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),"Prismatic",this.config.x,this.config.y,this.config.width,this.config.height]);bookConfig.googleAnalyticsID&&gtag("event","click",{event_category:"Prismatic",
event_label:"Page"+BookInfo.getCurrentPages()[0]})}.bind(this));this.addActionEvent(this.prismatic)},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.pageWidth*this.config.width;this.height=this.pageHeight*this.config.height;this.prismatic[0].width=this.width;this.prismatic[0].height=this.height;this.draw();this.setPosition()},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.prismatic.css({animation:b.name+
" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.prismatic.one(a,function(){this.prismatic.css({animation:""})}.bind(this))}},setPosition:function(){this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.prismatic.css({left:this.x+"px",top:this.y+"px"})}}).extend(PageItem.Item);
Class("Triangle",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b,c,d);this.animateConfig();this.color=Color(this.config.color).toString();this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.width=Number(this.config.width*this.pageWidth);this.height=Number(this.config.height*this.pageHeight);this.config.borderWidth=Number(this.config.borderWidth);this.colorA=Color(this.config.ColorA).toString();this.colorB=Color(this.config.ColorB).toString();this.config.triangleRight=
parseBool(this.config.triangleRight);this.config.triangleLeft=parseBool(this.config.triangleLeft);this.borderColor=Color(this.config.borderColor).toString();this.triangle=$("<canvas width='"+this.width+"' height='"+this.height+"' id='myCanvas'></canvas>");this.triangle.css({position:"absolute",opacity:this.config.alpha,left:this.x+"px",top:this.y+"px"});this.setRotation(this.triangle,this.config.rotation);this.parent.append(this.triangle);this.draw();this.initEvent();parseBool(this.config.reflection)&&
this.imageReflection(this.triangle)},parseConfig:function(a){return{width:a.location.width,height:a.location.height,x:a.location.x,y:a.location.y,rotation:a.location.rotation,alpha:a.alpha,color:a.color,fillStyle:a.fillStyle,ColorA:a.gradientColorA,ColorB:a.gradientColorB,angle:a.angle,spalpha:a.spalpha,reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,triangleRight:a.triangleRight,triangleLeft:a.triangleLeft,borderWidth:a.borderWidth,
borderColor:a.borderColor,borderAlpha:a.borderAlpha,sh:parseBool(a.shadow.hasDropShadow),sa:a.shadow.shadowAngle,sx:a.shadow.shadowBlurX,sy:a.shadow.shadowBlurY,se:a.shadow.shadowDistance,sr:a.shadow.shadowColor,arrowType:a.arrowType,action:a.action,animation:a.animation}},draw:function(){var a=this.triangle[0],b=a.getContext("2d");b.clearRect(0,0,a.width,a.height);b.beginPath();b.strokeStyle=Color(this.config.borderColor).toString();b.lineWidth=this.config.borderWidth;b.globalAlpha=this.config.spalpha;
b.lineCap="round";b.lineJoin="round";this.width-=this.config.borderWidth;this.height-=this.config.borderWidth;0==this.config.triangleRight&&0==this.config.triangleLeft&&(b.moveTo(this.config.borderWidth,this.height),b.lineTo(this.width,this.height),b.lineTo(this.width/2,this.config.borderWidth));1==this.config.triangleRight&&0==this.config.triangleLeft&&(b.moveTo(this.config.borderWidth,this.config.borderWidth),b.lineTo(this.config.borderWidth,this.height),b.lineTo(this.width,this.height));0==this.config.triangleRight&&
1==this.config.triangleLeft&&(b.moveTo(this.width,this.config.borderWidth),b.lineTo(this.width,this.height),b.lineTo(this.config.borderWidth,this.height));1==parseBool(this.config.sh)&&this.setShapeShadow(b);if("gradient"==this.config.fillStyle){a=this.config.angle*Math.PI/180;var c=(Number(this.config.angle)+180)*Math.PI/180;a=b.createLinearGradient(this.width/2+this.width/2*Math.cos(c),this.height/2+this.height/2*Math.sin(c),this.width/2+this.width/2*Math.cos(a),this.height/2+this.height/2*Math.sin(a));
a.addColorStop(0,this.colorA);a.addColorStop(1,this.colorB);b.fillStyle=a;b.fill()}"Pure"==this.config.fillStyle&&(b.fillStyle=this.color,b.fill());b.closePath();0!=this.config.borderWidth&&b.stroke()},initEvent:function(){this.linkURL="";null!=this.config.action&&(void 0!=this.config.action.length&&(this.config.action=this.config.action[0]),this.linkURL=this.config.action.url,null!=this.linkURL&&"www"==this.linkURL.substr(1,3).toLowerCase()&&(this.linkURL="http://"+this.linkURL));this.triangle.onTap(function(a){BookEvent.trigger("clickPageItem",
[BookInfo.getCurrentPageIndex(),"Triangle",this.config.x,this.config.y,this.config.width,this.config.height]);bookConfig.googleAnalyticsID&&gtag("event","click",{event_category:"Triangle",event_label:"Page"+BookInfo.getCurrentPages()[0]})}.bind(this));this.addActionEvent(this.triangle)},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.triangle[0].width=this.width;this.triangle[0].height=this.height;
this.draw();this.setPosition()},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.container.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.container.one(a,function(){this.container.css({animation:""})}.bind(this))}},setPosition:function(){this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.triangle.css({left:this.x+"px",top:this.y+"px"})}}).extend(PageItem.Item);
Class("AlphaTransitionBanner",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b,c,d);1>this.config.images.length||(this.animateConfig(),this.initConfig(c,d),this.initHtml(),this.initCss(),this.addItem(),this.leftButton.onMouseDown(this,this.prePage),this.rightButton.onMouseDown(this,this.nextPage),this.setTitle(0),this.toolBar.hide(),this.currentImageHolder=this.image0Holder,this.currentImage=2%this.images.length,this.image0Holder.append(this.images[0]),this.image1Holder.append(this.images[1]),
this.leftButton.remove(),this.rightButton.remove(),this.initEvent())},initEvent:function(){this.background.onTap(function(a){BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),"AlphaTransitionBanner",this.config.x,this.config.y,this.config.width,this.config.height])}.bind(this))},initConfig:function(a,b){if("string"==typeof this.config.images){if(""==this.config.images.trim()){this.photos=[];return}this.photos=[{url:this.config.images}]}else this.photos=Instance.copy(this.config.images);
this.photos.node instanceof Array&&(this.photos=this.photos.node);this.photos instanceof Array||(this.photos=[this.photos.node]);1>this.photos.length||(this.photos instanceof Array||void 0==this.photos.node||(this.photos=void 0==this.photos.node[1]?[this.photos.node]:this.photos.node),this.imgIndex=-1,this.imgWidth=this.config.width*a,this.imgHeight=this.config.height*b,this.boxWidth=this.imgWidth-8,this.boxHeight=this.imgHeight-8,this.x=this.config.x*this.pageWidth,this.y=this.config.y*this.pageHeight,
this.interval=3E3,this.duration=1E3*this.config.duration,this.oneTime=1E3*this.config.duration-50,this.fadeTime=10,this.alpha=100,this.images=[])},initHtml:function(){this.background=$("<div class='banner_background'></div>");this.slideShowBG=new grayBackground(this.background,"#ffffff",1,this.imgWidth,this.imgHeight);this.toolBar=$("<div></div>");this.imgTitle=$("<div></div>");this.image0Holder=$("<div></div>");this.image1Holder=$("<div></div>");this.img=$("<img style='position : absolute;' />");
this.leftButton=new button(this.toolBar,{buttonType:1,iconURL:uiBaseURL+"previous_down.png"});this.rightButton=new button(this.toolBar,{buttonType:1,iconURL:uiBaseURL+"next_down.png"});this.parent.append(this.background);this.background.append(this.image1Holder);this.background.append(this.image0Holder);this.background.append(this.toolBar)},initCss:function(){this.toolBar.css({width:this.boxWidth,height:"35px",position:"relative"});this.toolBar.css({"z-index":"209"});this.toolBG=new grayBackground(this.toolBar,
"#000000",.4,this.boxWidth,35);this.toolBG.setZindex("210");this.toolBG.setPosition(0,0);this.imgTitle.css({overflow:"hidden",width:this.boxWidth-20+"px",height:"20px",position:"absolute","z-index":"211",background:"",left:"10px",top:"7px",color:"#ffffff"});this.toolBar.css({left:(this.imgWidth-this.boxWidth)/2+"px",top:(this.imgHeight-this.boxHeight)/2+"px"});this.toolBar.append(this.imgTitle);this.rightButton.setCSS({"z-index":212,right:"0px",top:"13px"});this.leftButton.setCSS({"z-index":212,right:"20px",
top:"13px"});this.background.css({opacity:this.config.alpha,border:"1px solid #333333",width:this.imgWidth,height:this.imgHeight,left:this.x+"px",top:this.y+"px",transform:"translate(0,0)","-webkit-transform":"translate(0,0)",position:"absolute","-webkit-box-shadow":"0 0 10px rgba(40, 40, 40, 0.7)","-moz-box-shadow":"0 0 10px rgba(40, 40, 40, 0.7)","-ms-box-shadow":"0 0 10px rgba(40, 40, 40, 0.7)","-o-box-shadow":"0 0 10px rgba(40, 40, 40, 0.7)","box-shadow":"0 0 10px rgba(40, 40, 40, 0.7)"});this.setRotation(this.background,
this.config.rotation);this.image0Holder.css({background:"#fff",width:this.boxWidth+"px",height:this.boxHeight+"px",left:(this.imgWidth-this.boxWidth)/2+"px",top:(this.imgHeight-this.boxHeight)/2+"px",position:"absolute","z-index":207,opacity:"1"});this.image1Holder.css({background:"#fff",width:this.boxWidth+"px",height:this.boxHeight+"px",left:(this.imgWidth-this.boxWidth)/2+"px",top:(this.imgHeight-this.boxHeight)/2+"px",position:"absolute","z-index":207,opacity:"1"})},parseConfig:function(a){return{width:a.location.width,
height:a.location.height,rotation:a.location.rotation,x:a.location.x,y:a.location.y,alpha:a.alpha,src:a.url,action:a.action,images:a.Images,autoBool:parseBool(a.autoBool),duration:a.duration,animation:a.animation}},play:function(){1>this.config.images.length||1>this.photos.length||!this.config.autoBool||(clearInterval(this.timer1),this.timer1=null,this.timer1=setTimeout(this.transition.bind(this),this.duration))},pause:function(){this.config.autoBool&&(clearTimeout(this.timer1),this.timer1=null)},
transition:function(){var a=this;animateOnce(a.currentImageHolder,{opacity:"0"},this.oneTime,function(){a.currentImageHolder.empty().append(a.images[a.currentImage]);a.currentImageHolder==a.image0Holder?(a.image1Holder.css({"z-index":"208",opacity:"1"}),a.image0Holder.css({"z-index":"207",opacity:"1"}),a.currentImageHolder=a.image1Holder):(a.image0Holder.css({"z-index":"208",opacity:"1"}),a.image1Holder.css({"z-index":"207",opacity:"1"}),a.currentImageHolder=a.image0Holder);a.currentImage=(a.currentImage+
1)%a.images.length;a.timer1=setTimeout(a.transition.bind(a),a.duration)})},setTitle:function(a){a=this.photos[a].url;var b=a.lastIndexOf("/");a=a.substring(b+1);this.imgTitle.html(a)},nextPage:function(){clearInterval(this.timer0);this.timer0=null;this.setTitle(0<this.currentImage?(this.currentImage-1)%this.images.length:this.images.length-1);this.currentImageHolder==this.image0Holder?($(this.image0Holder).css({"z-index":"207"}),$(this.image1Holder).css({"z-index":"208"}),this.alpha=100,$(this.currentImageHolder).css({opacity:this.alpha/
100}),this.currentImageHolder=this.image1Holder,this.image0Holder.empty().append(this.images[this.currentImage])):($(this.image0Holder).css({"z-index":"208"}),$(this.image1Holder).css({"z-index":"207"}),this.alpha=100,$(this.currentImageHolder).css({opacity:this.alpha/100}),this.currentImageHolder=this.image0Holder,this.image1Holder.empty().append(this.images[this.currentImage]));this.currentImage=(this.currentImage+1)%this.images.length},prePage:function(){clearInterval(this.timer0);this.timer0=
null;var a=2<this.currentImage?(this.currentImage-3)%this.images.length:1==this.currentImage?this.images.length-2:this.images.length-3;this.setTitle(a);this.currentImageHolder==this.image0Holder?($(this.image0Holder).css({"z-index":"207"}),$(this.image1Holder).css({"z-index":"208"}),this.alpha=100,$(this.currentImageHolder).css({opacity:this.alpha/100}),this.currentImageHolder=this.image1Holder,this.image1Holder.empty().append(this.images[a])):($(this.image0Holder).css({"z-index":"208"}),$(this.image1Holder).css({"z-index":"207"}),
this.alpha=100,$(this.currentImageHolder).css({opacity:this.alpha/100}),this.currentImageHolder=this.image0Holder,this.image0Holder.empty().append(this.images[this.index]));this.currentImage=(this.currentImage-1)%this.images.length},addItem:function(){for(var a=0;a<this.photos.length;a++){var b=$("<div></div>");b.css({width:this.boxWidth+"px",height:this.boxHeight+"px"});image=$("<img style='position : absolute;' />");image.remove();var c=this.photos[a].url;c=this.fixRelativePath(c);var d=getCoverSize(this.boxWidth,
this.boxHeight,1024,1024);bookConfig.useTheAliCloudChart&&(c=isPhone()||isPad()?this.getOssUrl(c,d.width,d.height,"lfit"):this.getOssUrl(c,this.boxWidth,this.boxHeight,"lfit"));image.attr("src",c);image.css({width:this.boxWidth+"px",height:this.boxHeight+"px"});b.append(image);this.images[a]=b}},onResize:function(a,b){if(!(1>this.config.images.length||1>this.photos.length)){this.pageWidth=a;this.pageHeight=b;this.imgWidth=this.config.width*this.pageWidth;this.imgHeight=this.config.height*this.pageHeight;
this.boxWidth=this.imgWidth-8;this.boxHeight=this.imgHeight-8;this.background.css({width:this.imgWidth,height:this.imgHeight});this.toolBar.css({width:this.boxWidth,height:"35px"});this.toolBG.onResize(this.boxWidth,35);this.toolBG.setPosition(0,0);this.imgTitle.css({width:this.boxWidth-20+"px",height:"20px",left:"10px",top:"7px"});this.slideShowBG.onResize(this.imgWidth,this.imgHeight);for(a=0;a<this.images.length;a++)this.images[a].children().css({width:this.boxWidth+"px",height:this.boxHeight+
"px"}),(isIphone()||isIpad())&&this.setContainerSize(this.images[a].children(),this.boxWidth,this.boxHeight);this.setPosition()}},setPosition:function(){this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.background.css({left:this.x+"px",top:this.y+"px",position:"absolute"});this.image0Holder.css({width:this.boxWidth+"px",height:this.boxHeight+"px",left:(this.imgWidth-this.boxWidth)/2+"px",top:(this.imgHeight-this.boxHeight)/2+"px",position:"absolute"});this.image1Holder.css({width:this.boxWidth+
"px",height:this.boxHeight+"px",left:(this.imgWidth-this.boxWidth)/2+"px",top:(this.imgHeight-this.boxHeight)/2+"px",position:"absolute"})},changeImage:function(a){this.imgIndex=a;this.img.remove();a=this.photos[a].url;a=this.fixRelativePath(a);var b=this;this.img.attr("src",a);this.img.on("load",function(){var c=b.boxWidth,d=b.boxHeight;b.img.css({width:c+"px",height:d+"px"});b.boxWidth!=c||b.boxHeight!=d?b.image0Holder.animate({width:c+8,height:d+8,left:(b.pw-c)/2,top:(b.ph-d)/2},300,function(){b.image0Holder.append(b.img)}):
(b.image0Holder.append(b.img),b.image1Holder.append(b.img))})},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.background.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.background.one(a,function(){this.background.css({animation:""})}.bind(this))}},setImagePosition:function(){},show:function(){},hide:function(){}}).extend("Item");
Class("Carousel",{Package:"PageItem",create:function(a,b,c,d,e){this._super(a,b,c,d);this.animateConfig();this.width=Number(this.config.width)*this.pageWidth;this.height=Number(this.config.height)*this.pageHeight;this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.config.duration||(this.config.duration=3);this.id="carousel"+e;this.imageItem=[];if(this.images=Instance.copy(this.config.images))this.images.node instanceof Array&&(this.images=this.images.node),this.images[0]||
(this.images=[this.images.node]);if(!(1>this.config.images)){if(this.images&&this.images.length)for(a=0;a<this.images.length;a++)this.imageItem.push(this.images[a]),this.imageItem[a].url=this.fixRelativePath(this.imageItem[a].url);this.content=$("<div class='initCarousel'></div>");this.content.css({opacity:this.config.alpha,position:"absolute",left:this.x+"px",top:this.y+"px",width:this.width+"px",height:this.height+"px",border:"0px solid red"});this.setRotation(this.content,this.config.rotation);
this.currentIndex=0;this.parent.append(this.content);this.initImages();this.config.showButton&&this.initButtons();this.initEvent()}},initEvent:function(){this.content.onTap(function(a){BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),"Carousel",this.config.x,this.config.y,this.config.width,this.config.height])}.bind(this))},parseConfig:function(a){return{width:a.location.width,height:a.location.height,rotation:a.location.rotation,x:a.location.x,y:a.location.y,alpha:a.alpha,images:a.Images,
duration:parseInt(a.duration),autoPlay:parseBool(a.autoBool),showButton:parseBool(a.selectBtn),hasShadow:parseBool(a.shadow.hasDropShadow),shadow:a.shadow,animation:a.animation}},initImages:function(){if(!(1>this.config.images||void 0==this.images||null==this.images||0==this.images.length)){this.refreshImageAndPosition();this.carouselList=new CarouselImageList(this.imageItem.length);this.carouselList.setResources(this.aImages);this.carouselList.setImagesIndex(this.aImagesIndex);this.carouselList.setPositions(this.aPositions);
for(var a=0;a<this.aPositions.length;a++){var b=new CarouselImage(this,this.aPositions[a]);b.setBoxIndex(a);this.carouselList.addInstance(b)}this.carouselList.loadResources();this.carouselList.blurAll()}},initButtons:function(){this.leftButton=$('<img class="flip-action" src="'+uiBaseURL+'pre_image.png" style="position:absolute;z-index:1000;cursor:pointer;"></img>');this.rightButton=$('<img class="flip-action" src="'+uiBaseURL+'next_image.png" style="position:absolute;z-index:1000;cursor:pointer;"></img>');
this.setButtonPosition();this.content.append(this.leftButton);this.content.append(this.rightButton);this.leftButton.onTap(function(a){this.move(1)}.bind(this));this.rightButton.onTap(function(a){this.move(-1)}.bind(this))},refreshImageAndPosition:function(){void 0!=this.imageItem&&null!=this.imageItem&&0!=this.imageItem.length&&(this.instanceCount=5,5>this.imageItem.length&&(this.instanceCount=Math.min(this.imageItem.length)),this.refreshImages(),this.refreshPositions())},refreshImages:function(){this.refreshImagesIndex();
this.aImages=[];for(var a=getCoverSize(this.width,this.height,1024,1024),b=0;b<this.aImagesIndex.length;b++){var c=this.imageItem[this.aImagesIndex[b]].url;bookConfig.useTheAliCloudChart&&(c=isPhone()||isPad()?this.getOssUrl(c,a.width,a.height,"lfit"):this.getOssUrl(c,2*this.width,2*this.height,"lfit"));this.aImages.push(c)}},refreshImagesIndex:function(){this.aImagesIndex=[];switch(this.instanceCount){case 1:this.aImagesIndex.push(0);break;case 2:this.aImagesIndex.push(this.currentIndex%this.imageItem.length);
this.aImagesIndex.push((this.currentIndex+1)%this.imageItem.length);break;case 3:this.aImagesIndex.push((this.currentIndex-1+this.imageItem.length)%this.imageItem.length);this.aImagesIndex.push(this.currentIndex%this.imageItem.length);this.aImagesIndex.push((this.currentIndex+1)%this.imageItem.length);break;case 4:this.aImagesIndex.push((this.currentIndex-1+this.imageItem.length)%this.imageItem.length);this.aImagesIndex.push(this.currentIndex%this.imageItem.length);this.aImagesIndex.push((this.currentIndex+
1)%this.imageItem.length);break;default:this.aImagesIndex.push((this.currentIndex-2+this.imageItem.length)%this.imageItem.length),this.aImagesIndex.push((this.currentIndex-1+this.imageItem.length)%this.imageItem.length),this.aImagesIndex.push(this.currentIndex%this.imageItem.length),this.aImagesIndex.push((this.currentIndex+1)%this.imageItem.length),this.aImagesIndex.push((this.currentIndex+2)%this.imageItem.length)}},refreshPositions:function(){this.aPositions=[];switch(this.instanceCount){case 1:this.aPositions.push(new CarouselPosition(0,
0,this.width,this.height,1,1));break;case 2:var a=Math.ceil(this.width/2);var b=Math.ceil(this.width/4);this.aPositions.push(new CarouselPosition(b,0,a,this.height,2,1));b=Math.ceil(a+.1*a)/.8;this.aPositions.push(new CarouselPosition(b,.1*this.height/.8,a,this.height,1,.8));break;case 3:a=Math.ceil(this.width/2);b=Math.ceil(.05*a)/.8;this.aPositions.push(new CarouselPosition(b,.1*this.height/.8,a,this.height,1,.8));b=Math.ceil(this.width/4);this.aPositions.push(new CarouselPosition(b,0,a,this.height,
2,1));b=Math.ceil(a)/.8;this.aPositions.push(new CarouselPosition(b,.1*this.height/.8,a,this.height,1,.8));break;case 4:a=Math.ceil(this.width/2);b=Math.ceil(.05*a)/.8;this.aPositions.push(new CarouselPosition(b,.1*this.height/.8,a,this.height,1,.8));b=Math.ceil(this.width/4);this.aPositions.push(new CarouselPosition(b,0,a,this.height,2,1));b=Math.ceil(a)/.8;this.aPositions.push(new CarouselPosition(b,.1*this.height/.8,a,this.height,1,.8));break;default:a=this.width/3,b=Math.ceil(.2*a)/.6,this.aPositions.push(new CarouselPosition(b,
.2*this.height/.6,a,this.height,1,.6)),b=Math.ceil(this.width/6+.1*a)/.8,this.aPositions.push(new CarouselPosition(b,.1*this.height/.8,a,this.height,2,.8)),this.aPositions.push(new CarouselPosition(a,0,a,this.height,3,1)),this.aPositions.push(new CarouselPosition(Math.ceil(this.width/2)/.8,.1*this.height/.8,a,this.height,2,.8)),this.aPositions.push(new CarouselPosition(Math.ceil(.66*this.width)/.6,.2*this.height/.6,a,this.height,1,.6))}},play:function(){!(1>this.config.images)&&this.images&&this.images.length&&
this.config.autoPlay&&(window.clearInterval(this.timer),this.timer=null,this.timer=window.setInterval(function(){this.move(1)}.bind(this),1E3*this.config.duration))},pause:function(){this.config.autoPlay&&(window.clearInterval(this.timer),this.timer=null)},move:function(a){this.isMoving||(this.isMoving=!0,this.currentIndex+=a,this.currentIndex>=this.imageItem.length&&(this.currentIndex%=this.imageItem.length),0>this.currentIndex&&(this.currentIndex+=this.imageItem.length),this.instanceCount=this.carouselList.instanceCount(),
this.refreshImages(),this.carouselList.setResources(this.aImages),this.carouselList.setImagesIndex(this.aImagesIndex),this.carouselList.move(a),function(){this.isMoving=!1}.delay(this,1E3))},moveTo:function(a){5<=this.imageItem.length?this.move(a-2):4==this.imageItem.length?this.move(a-1):this.move(a-this.currentIndex)},onResize:function(a,b){if(!(1>this.config.images)&&this.images&&this.images.length){this.pageWidth=a;this.pageHeight=b;this.width=this.config.width*this.pageWidth;this.height=this.config.height*
this.pageHeight;this.content.css({width:this.width+"px",height:this.height+"px"});if(isIphone()||isIpad())a=getCoverSize(this.width,this.height,1024,1024),this.width=a.width,this.height=a.height,this.content.css({width:this.width+"px",height:this.height+"px","-webkit-transform-origin":"0 0","transform-origin":"0 0","-webkit-transform":"scale("+a.scale+")",transform:"scale("+a.scale+")"});this.setPosition();this.config.showButton&&this.setButtonPosition();this.refreshImageAndPosition();this.carouselList.setResources(this.aImages);
this.carouselList.setImagesIndex(this.aImagesIndex);this.carouselList.setPositions(this.aPositions);this.carouselList.resizeAll()}},setPosition:function(){this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.content.css({left:this.x+"px",top:this.y+"px"})},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.content.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+
b.direction});this.content.one(a,function(){this.content.css({animation:""})}.bind(this))}},setButtonPosition:function(){var a=(this.height-32)/2;this.leftButton.css({left:"0px",top:a+"px"});this.rightButton.css({right:"0px",top:a+"px"})}}).extend("Item");
var CarouselImage=Class({create:function(a,b){this.parent=a;this.position=Instance.copy(b);this.instance=$('<img style="position:absolute"/>');this.parent.content.append(this.instance);this.parent.addShadow(this.instance);this.imageHeight=this.imageWidth=0;this.instance.on("load",this.onImageLoad.bind(this));this.instance.onTap(this.onClick.bind(this));this.setArea();this.setZindex(this.position.zindex)},blur:function(a,b){1==a?this.instance.css({"-webkit-filter":"blur("+2*b+"px)","-moz-filter":"blur("+
2*b+"px)","-o-filter":"blur("+2*b+"px)","-ms-filter":"blur("+2*b+"px)",filter:"blur("+2*b+"px)"}):this.instance.css({"-webkit-filter":"blur(0px)","-moz-filter":"blur(0px)","-o-filter":"blur(0px)","-ms-filter":"blur(0px)",filter:"blur(0px)"})},setSrc:function(a){this.instance[0].src=a},getSrc:function(){return this.instance[0].src},setIndex:function(a){this.imageIndex=a},setBoxIndex:function(a){this.boxIndex=a},onImageLoad:function(){var a=this.instance[0];this.imageWidth=a.naturalWidth;this.imageHeight=
a.naturalHeight;this.resetPosition();this.setArea(this.position)},onClick:function(){4>this.parent.imageItem.length?this.parent.moveTo(this.imageIndex):this.parent.moveTo(this.boxIndex);return!1},resetPosition:function(){if(0!=this.imageWidth&&0!=this.imageHeight){var a=Math.ceil(this.imageHeight*this.position.width/this.imageWidth);a>this.position.height?(this.position.width=Math.ceil(this.position.height*this.imageWidth/this.imageHeight),this.position.top=(this.parent.height-this.position.height)/
2/this.position.scale):(this.position.height=a,this.position.top=(this.parent.height-a)/2/this.position.scale)}},setArea:function(){this.instance.css({width:this.position.width+"px",height:this.position.height+"px"}).css(this.transformCSS({scale:this.position.scale,tran:{x:this.position.left,y:this.position.top}}))},setZindex:function(a){this.instance.css({"z-index":a})},gotoPosition:function(a){this.position=Instance.copy(a);this.setZindex(this.position.zindex);animateOnce(this.instance,this.transformCSS({scale:this.position.scale,
tran:{x:this.position.left,y:this.position.top}}),.5)},resizeCss:function(a){this.position=Instance.copy(a);this.setZindex(this.position.zindex);this.instance.css(this.transformCSS({scale:this.position.scale,tran:{x:this.position.left,y:this.position.top}}))},transformCSS:function(a){var b="",c={};void 0!=a.scale&&(b=b+"scale("+a.scale+") ");void 0!=a.rotate&&(b=b+"rotate("+a.rotate+"deg) ");void 0!=a.rotateY&&(b=b+"rotateY("+a.rotateY+"deg) ");a.tran&&(b=b+"translate("+a.tran.x+"px,"+a.tran.y+"px) ");
void 0!=a.perspective&&(b=b+"perspective("+a.perspective+"px) ");void 0!=a.scaleX&&(b=b+"scaleX("+a.scaleX+") ");void 0!=a.scaleY&&(b=b+"scaleY("+a.scaleY+") ");if(a.origin){var d=a.origin.x+"% "+a.origin.y+"%";c["-webkit-transform-origin"]=d;c["-moz-transform-origin"]=d;c["-ms-transform-origin"]=d;c["-o-transform-origin"]=d;c["transform-origin"]=d}b&&(c["-webkit-transform"]=b,c["-moz-transform"]=b,c["-ms-transform"]=b,c["-o-transform"]=b,c.transform=b);a.obj&&a.obj.css(c);return c}}),CarouselPosition=
Class({create:function(a,b,c,d,e,f){this.left=Math.ceil(a);this.top=Math.ceil(b);this.width=Math.ceil(c);this.height=Math.ceil(d);this.scale=parseFloat(f);this.zindex=e},asString:function(){return"transform:scale("+this.scale+") translate("+this.left+"px,"+this.top+"px),width:"+this.width+",height:"+this.height+",z-index:"+this.zindex}}),CarouselImageList=Class({create:function(a){this.imgLength=a;this.imageInstances=[]},setResources:function(a){this.imageResources=[];for(var b=0;b<a.length;b++)this.imageResources.push(a[b])},
setImagesIndex:function(a){this.imagesIndex=[];for(var b=0;b<a.length;b++)this.imagesIndex.push(a[b])},setPositions:function(a){this.imagePositions=[];for(var b=0;b<a.length;b++)this.imagePositions.push(a[b])},addInstance:function(a){this.imageInstances.push(a)},instanceCount:function(){return this.imageInstances.length},loadResources:function(){for(var a=this.imageInstances.length,b=0;b<a;b++){var c=this.imageInstances[b];c.getSrc()!=this.imageResources[b]&&(c.setSrc(this.imageResources[b]),c.setIndex(this.imagesIndex[b]))}},
move:function(a){var b=this.imageInstances.length;if(0!=b){for(var c=[],d=0;d<b;d++)c[d]=this.imageInstances[d];for(d=0;d<b;d++){var e=d+a;0>e&&(e+=b);e>=b&&(e%=b);this.imageInstances[d]=c[e]}for(d=0;d<b;d++)a=this.imageInstances[d],a.setBoxIndex(d),a.gotoPosition(this.imagePositions[d]);this.resizeAll();this.loadResources();this.blurAll()}},resizeAll:function(){var a=this.imageInstances.length;if(0!=a)for(var b=0;b<a;b++){var c=this.imageInstances[b];c.resizeCss(this.imagePositions[b]);c.resetPosition();
c.setArea()}},blurAll:function(){for(var a=this.imageInstances.length,b=Math.floor((a+1)/2)-1,c=0;c<a;c++){var d=this.imageInstances[c];c!=b?d.blur(!0):d.blur(!1)}}});
Class("DynamicShow",{Package:"PageItem",create:function(a,b,c,d,e){this._super(a,b,c,d);this.animateConfig();this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.childWidth=Math.ceil(this.width/4);this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.borderWidth=this.config.borderWidth;this.id="dynshow"+e;this.images=Instance.copy(this.config.images);this.imageItem=[];this.images||(this.images=[]);this.images[0]||(this.images=[this.images.Image]);
if(this.images&&this.images.length)for(a=0;a<this.images.length;a++)"[object Object]"===Object.prototype.toString.call(this.images[a])?this.imageItem.push(this.images[a].value):this.imageItem.push(this.images[a]),this.imageItem[a]=this.fixRelativePath(this.imageItem[a]),bookConfig.useTheAliCloudChart&&(b=getCoverSize(this.width,this.height,1024,1024),isPhone()||isPad()?this.imageItem[a]=this.getOssUrl(this.imageItem[a],b.width,b.height,"lfit"):this.imageItem[a]=this.getOssUrl(this.imageItem[a],this.width,
this.height,"lfit"));this.maxZindex=this.images.length+1;this.content=$("<div id='DynamicShow'></div>");this.content.css({opacity:this.config.alpha,position:"absolute",left:this.x+"px",top:this.y+"px",width:this.width+"px",height:this.height+"px",border:"0px solid red"});this.setRotation(this.content,this.config.rotation);this.currentIndex=0;this.parent.append(this.content);this.init();this.initEvent()},initEvent:function(){this.content.onTap(function(a){BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),
"DynamicShow",this.config.x,this.config.y,this.config.width,this.config.height])}.bind(this))},parseConfig:function(a){return{width:a.location.width,height:a.location.height,rotation:a.location.rotation,x:a.location.x,y:a.location.y,alpha:a.alpha,images:a.Images,borderWidth:a.borderWidth,animation:a.animation}},init:function(){this.imageInstances=[];if(0!=this.imageItem.length){for(var a=0;a<this.imageItem.length;a++){var b=new ImageInstance(this,a);b.setImage(this.imageItem[a]);this.content.append(b);
this.imageInstances.push(b)}this.currentIndex=-1;this.initButtons()}},initButtons:function(){this.leftButton=$('<img class="flip-action" src="'+uiBaseURL+'pre_image.png" style="cursor:pointer;position:absolute;z-index:1000"></img>');this.rightButton=$('<img class="flip-action" src="'+uiBaseURL+'next_image.png" style="cursor:pointer;position:absolute;z-index:1000"></img>');this.setButtonPosition();this.leftButton.bind(_event._click,function(){this.preImage()}.bind(this));this.rightButton.bind(_event._click,
function(){this.nextImage()}.bind(this));this.leftButton.css({display:"none"});this.rightButton.css({display:"none"});this.content.append(this.leftButton);this.content.append(this.rightButton);isPhone()||isPad()||(this.content.bind(_event._enter,function(){this.leftButton.css({display:"block"});this.rightButton.css({display:"block"})}.bind(this)),this.content.bind(_event._leave,function(){this.leftButton.css({display:"none"});this.rightButton.css({display:"none"})}.bind(this)))},preImage:function(){-1!=
this.currentIndex&&this.imageInstances[this.currentIndex].hide();this.currentIndex=(this.currentIndex-1+this.images.length)%this.images.length;this.imageInstances[this.currentIndex].show()},nextImage:function(){-1!=this.currentIndex&&this.imageInstances[this.currentIndex].hide();this.currentIndex=(this.currentIndex+1)%this.images.length;this.imageInstances[this.currentIndex].show()},showImage:function(a){-1!=a&&(-1!=this.currentIndex&&this.imageInstances[this.currentIndex].hide(),this.currentIndex=
a,this.imageInstances[this.currentIndex].show())},refreshZindex:function(){for(var a=this.imageInstances[this.currentIndex].zIndex,b=0;b<this.images.length;b++)if(b!=this.currentIndex){var c=this.imageInstances[b].zIndex;c>a&&(c--,this.imageInstances[b].setZindex(c))}this.imageInstances[this.currentIndex].setZindex(this.images.length-1)},setButtonPosition:function(){var a=(this.height-32)/2;this.leftButton.css({left:"0px",top:a+"px"});this.rightButton.css({right:"0px",top:a+"px"})},onResize:function(a,
b){var c=a/this.pageWidth;this.pageWidth=a;this.pageHeight=b;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.content.css({width:this.width+"px",height:this.height+"px"});if(isIphone()||isIpad())a=getCoverSize(this.width,this.height,1024,1024),this.width=a.width,this.height=a.height,this.content.css({width:this.width+"px",height:this.height+"px","-webkit-transform-origin":"0 0","transform-origin":"0 0","-webkit-transform":"scale("+a.scale+")",transform:"scale("+
a.scale+")"});this.setPosition();this.setButtonPosition();this.childWidth=Math.ceil(this.width/4);for(a=0;a<this.imageInstances.length;a++)this.imageInstances[a].onResize(c)},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.content.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.content.one(a,function(){this.content.css({animation:""})}.bind(this))}},setPosition:function(){this.x=
this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.content.css({left:this.x+"px",top:this.y+"px"})}}).extend("Item");
var ImageInstance=Class({create:function(a,b){this.parent=a;this.zIndex=this.index=b;this.imageHeight=this.imageWidth=0;this.borderWidth=Math.ceil(this.parent.borderWidth/2);this.height=this.width=this.parent.width-2*this.borderWidth;this.maxLeft=this.parent.width-this.width;this.maxTop=this.parent.height-this.height;this.randomPos=randomPosition(this.parent.width/2,this.parent.height/2);this.rotation=this.randomPos.rotation;this.animate=[];this.instance=$("<img></img>");this.instance.css({position:"absolute",
display:"none"});this.setTransform(this.instance,this.randomPos);this.setBorderWidth(this.borderWidth);this.initShadow();this.initEvents();a.content.append(this.instance)},initShadow:function(){this.instance.css({"-moz-box-shadow":"2px 2px 4px #252525","box-shadow":"2px 2px 4px #252525","-webkit-box-shadow":"2px 2px 4px #252525","-ms-box-shadow":"2px 2px 4px #252525","-o-box-shadow":"2px 2px 4px #252525"})},initEvents:function(){this.instance.on("load",function(){this.onImageLoad()}.bind(this));this.instance.bind(_event._click,
function(){this.parent.currentIndex==this.index?(this.hide(),this.parent.currentIndex=-1):this.parent.showImage(this.index)}.bind(this))},onImageLoad:function(){var a=this.instance[0];this.imageWidth=a.naturalWidth;this.imageHeight=a.naturalHeight;this.getImgConfig();this.height=Math.ceil(this.imageHeight*this.width/this.imageWidth);this.maxTop=this.parent.height-this.height;this.instance.css({width:this.width+"px",height:this.height+"px",left:this.left+"px",top:this.top+"px",display:"block"})},setImage:function(a){this.instance.attr("src",
a)},onResize:function(a){this.instance.css("z-Index")!=this.parent.maxZindex&&(this.randomPos.left*=a,this.randomPos.top*=a,this.setTransform(this.instance,this.randomPos));this.getImgConfig();this.resize()},resize:function(){this.instance.css({width:this.width+"px",height:this.height+"px",left:this.left+"px",top:this.top+"px"})},setTransform:function(a,b){a.css({"-webkit-transform":"rotate("+b.rotation+"deg) scale("+b.scale+") translate("+b.left+"px,"+b.top+"px)","-ms-transform":"rotate("+b.rotation+
"deg) scale("+b.scale+") translate("+b.left+"px,"+b.top+"px)","-moz-transform":"rotate("+b.rotation+"deg) scale("+b.scale+") translate("+b.left+"px,"+b.top+"px)","-o-transform":"rotate("+b.rotation+"deg) scale("+b.scale+") translate("+b.left+"px,"+b.top+"px)",transform:"rotate("+b.rotation+"deg) scale("+b.scale+") translate("+b.left+"px,"+b.top+"px)"})},getTransform:function(a){return{"-webkit-transform":"rotate("+a.rotation+"deg) scale("+a.scale+") translate("+a.left+"px,"+a.top+"px)","-ms-transform":"rotate("+
a.rotation+"deg) scale("+a.scale+") translate("+a.left+"px,"+a.top+"px)","-moz-transform":"rotate("+a.rotation+"deg) scale("+a.scale+") translate("+a.left+"px,"+a.top+"px)","-o-transform":"rotate("+a.rotation+"deg) scale("+a.scale+") translate("+a.left+"px,"+a.top+"px)",transform:"rotate("+a.rotation+"deg) scale("+a.scale+") translate("+a.left+"px,"+a.top+"px)"}},move:function(){this.instance.css({left:this.left+"px",top:this.top+"px"})},setZindex:function(a){this.zIndex=a;this.instance.css({"z-index":a})},
setBorderWidth:function(a){this.instance.css({border:a+"px solid white"})},getImgConfig:function(){this.imageWidth/this.imageHeight>this.parent.width/this.parent.height?(this.width=this.parent.width-2*this.borderWidth,this.height=this.width*this.imageHeight/this.imageWidth,this.left=0,this.top=(this.parent.height-this.height-2*this.borderWidth)/2):(this.height=this.parent.height-2*this.borderWidth,this.width=this.height*this.imageWidth/this.imageHeight,this.left=(this.parent.width-this.width-2*this.borderWidth)/
2,this.top=0)},show:function(){0!=this.imageWidth&&0!=this.imageHeight&&(this.instance.css({"z-index":this.parent.maxZindex}),animateOnce(this.instance,this.getTransform({left:"0",top:"0",rotation:"0",scale:"1"}),500))},hide:function(){0!=this.imageWidth&&0!=this.imageHeight&&(this.randomPos=randomPosition(this.parent.width/2,this.parent.height/2),this.parent.refreshZindex(),animateOnce(this.instance,this.getTransform(this.randomPos),500))}});
function randomPosition(a,b){a=Math.floor(Math.random()*a);.5>=Math.random()&&(a=-a);b=Math.floor(Math.random()*b);.5>=Math.random()&&(b=-b);return{left:a,top:b,scale:.25,rotation:75-Math.floor(150*Math.random())}}
Class("FocusJump",{Package:"PageItem",create:function(a,b,c,d,e){this._super(a,b,c,d);this.id="flip_jump_"+e;this.translate=0;this.animateConfig();this.width=this.config.width*c;this.height=this.config.height*d;this.margin=Math.floor(5*this.width/100);this.initContent();this.initImages();this.initButtons();this.initEvents();parseBool(this.config.reflection)&&this.imageReflection(this.content);this.onResize(c,d)},initContent:function(){this.content=$("<div id='"+this.id+"'></div>");this.content.css({opacity:this.config.alpha,
overflow:"hidden",position:"absolute","z-index":"1"});this.setRotation(this.content,this.config.rotation);this.imagesContent=$("<div></div>");this.imagesContent.css({position:"absolute",left:"0px",top:"0px",height:"100%"}).css(transformCSS({tran:{x:0,y:0}}));this.parent.append(this.content);this.content.append(this.imagesContent);this.initBackground()},initBackground:function(){if(this.config.addBackground){var a=Color(this.config.backgroundColor);this.content.css({"background-color":a.rgba(this.config.backgroundAlpha)})}this.config.addBorder&&
(a=Color(this.config.borderColor),this.content.css({border:this.config.borderWidth+"px solid "+a.rgba(this.config.borderAlpha)}))},initButtons:function(){this.leftButton=$('<img class="flip-action" src="'+uiBaseURL+'pre_image.png" style="cursor:pointer;position:absolute;z-index:1000;left:0px;top:0px;bottom:0px;margin:auto"></img>');this.rightButton=$('<img class="flip-action" src="'+uiBaseURL+'next_image.png" style="cursor:pointer;position:absolute;z-index:1000;right:0px;top:0px;bottom:0px;margin:auto"></img>');
isPhone()||isPad()||(this.leftButton.css({display:"none"}),this.rightButton.css({display:"none"}));this.content.append(this.leftButton);this.content.append(this.rightButton)},initImages:function(){this.$images=[];this.images=this.config.images;if(""!=this.images){if(!(this.images instanceof Array)){if(""==this.images)return;this.images.node&&(this.images=[this.images.node])}for(var a=this,b=0;b<this.images.length;b++){var c=this.images[b].url,d=this.images[b].title,e=this.images[b].link;c=this.fixRelativePath(c);
if(bookConfig.useTheAliCloudChart){var f=getCoverSize(this.width,this.height,1024,1024);c=isPhone()||isPad()?this.getOssUrl(c,f.width,f.height,"lfit"):this.getOssUrl(c,this.getImageWidth(),this.height/2,"lfit")}var g=$("<div style='position:absolute;'></div>");d=$("<span class='text' style='font-weight:bold;color:rgba(255,0,0,0.5);position:absolute;overflow:auto;'>"+d+"</span>");f=$("<img style='position:absolute;display:none;top:0px'></img>");g.append(f).append(d);e&&function(h,k){g.bind(_event._click,
function(){window.open(k)})}(this,e);f.on("load",function(){var h=$(this);a.resizeImage(h,h.parent(),h.next());h.css({display:"block"}).css(transformCSS({tran:{x:0,y:0}}))});f.attr("src",c);this.imagesContent.append(g);this.$images.push(g)}}},resizeImage:function(a,b,c){if(a[0].naturalWidth&&a[0].naturalHeight){var d=this.getImageWidth(),e=Math.floor(d/a[0].naturalWidth*a[0].naturalHeight);a.css({width:d+"px",height:e+"px"});b.css({width:d+"px",height:e+"px"});c.css({top:e+"px"});this.imagesContent.css({height:e+
"px",top:(this.height-e)/2+"px"})}},getImageWidth:function(){return Math.floor((this.width-3*this.margin)/3)},parseConfig:function(a){return{width:a.location.width,height:a.location.height,x:a.location.x,y:a.location.y,alpha:a.alpha,rotation:a.location.rotation,reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,images:a.componentData.Images,addBackground:parseBool(a.componentData.addBack),addBorder:parseBool(a.componentData.addBorder),
backgroundColor:a.componentData.backColor,backgroundAlpha:a.componentData.backAlpha,borderColor:a.componentData.borderColor,borderAlpha:a.componentData.borderAlpha,borderWidth:a.componentData.borderWidth,animation:a.animation}},initEvents:function(){this.content.onTap(function(d){BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),"FocusJump",this.config.x,this.config.y,this.config.width,this.config.height])}.bind(this));this.content.bind(_event._enter,function(){3>=this.images.length||
(this.leftButton.css({display:"block"}),this.rightButton.css({display:"block"}))}.bind(this));this.content.bind(_event._leave,function(){this.leftButton.css({display:"none"});this.rightButton.css({display:"none"})}.bind(this));this.leftButton.onTap(function(d){this.moveLeft();return!1}.bind(this));this.rightButton.onTap(function(d){this.moveRight();return!1}.bind(this));for(var a=this,b=0;b<this.$images.length;b++){var c=this.$images[b];isPhone()||isPad()?(c.bind(_event._down,function(){a.moveImageUp($(this))}),
c.bind(_event._end,function(){a.moveImageDown($(this))})):(c.bind(_event._enter,function(){a.moveImageUp($(this))}),c.bind(_event._leave,function(){a.moveImageDown($(this))}))}},moveLeft:function(){this.translate+=this.getImageWidth();0<this.translate&&(this.translate=0);animateOnce(this.imagesContent,transformCSS({tran:{x:this.translate,y:0}}),1E3)},moveRight:function(){this.translate-=this.getImageWidth();var a=this.width-this.imagesContent.width();this.translate<a&&(this.translate=a);animateOnce(this.imagesContent,
transformCSS({tran:{x:this.translate,y:0}}),1E3)},moveImageUp:function(a){animateOnce(a,transformCSS({tran:{x:0,y:-Math.floor(this.height/4)}}),800)},moveImageDown:function(a){animateOnce(a,transformCSS({tran:{x:0,y:0}}),800)},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.left=this.pageWidth*this.config.x;this.top=this.pageHeight*this.config.y;this.width=this.pageWidth*this.config.width;this.height=this.pageHeight*this.config.height;this.margin=Math.floor(5*this.width/100);this.content.css({left:this.left+
"px",top:this.top+"px",width:this.width+"px",height:this.height+"px"});if(isIphone()||isIpad())a=getCoverSize(this.width,this.height,1024,1024),this.width=a.width,this.height=a.height,this.content.css({width:this.width+"px",height:this.height+"px","-webkit-transform-origin":"0 0","transform-origin":"0 0","-webkit-transform":"scale("+a.scale+")",transform:"scale("+a.scale+")"});this.resizeImages()},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),
b=this.config.animation;this.content.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.content.one(a,function(){this.content.css({animation:""})}.bind(this))}},resizeImages:function(){var a=this.getImageWidth();this.imagesContent.css({width:this.margin+(this.margin+a)*this.$images.length+"px"});if(1==this.$images.length){var b=this.$images[0],c=this.margin+a;b.css({left:c+"px"});this.resizeImage(b.find("img"),b,b.find("text"))}else for(var d=0;d<this.$images.length;d++)b=
this.$images[d],c=this.margin+(this.margin+a)*d,b.css({left:c+"px"}),this.resizeImage(b.find("img"),b,b.find("span"))}}).extend("Item");
Class("FlipJump",{Package:"PageItem",create:function(a,b,c,d,e){this._super(a,b,c,d);this.animateConfig();this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.id="jump"+e;this.itemHeight=Math.floor(.5*this.height);this.itemWidth=Math.floor(.5*this.width);this.images=this.config.images;this.images[0]||(this.images=[this.images.Image]);this.Items=[];this.imageCount=this.images.length;
if(this.images&&this.images instanceof Array)for(a=0;a<this.images.length;a++)"[object Object]"===Object.prototype.toString.call(this.images[a])?this.Items.push(this.images[a].value):this.Items.push(this.images[a]),this.Items[a]=this.fixRelativePath(this.Items[a]),bookConfig.useTheAliCloudChart&&(this.Items[a]=this.getOssUrl(this.Items[a],2*this.itemWidth,2*this.itemHeight,"lfit"));this.minZindex=0;this.maxZindex=this.images.length+1;this.content=$("<div></div>");this.content.css({opacity:this.config.alpha,
position:"absolute",overflow:"hidden",left:this.x+"px",top:this.y+"px",width:this.width+"px",height:this.height+"px","z-index":"1"});this.setRotation(this.content,this.config.rotation);this.initBackground();this.parent.append(this.content);this.init();this.initEvent();this.imageItems[0].toNormal()},initEvent:function(){this.content.onTap(function(a){BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),"FlipJump",this.config.x,this.config.y,this.config.width,this.config.height])}.bind(this))},
initBackground:function(){if(this.config.addBackground){var a=Color(this.config.backgroundColor);this.content.css({"background-color":a.rgba(this.config.backgroundAlpha)})}this.config.addBorder&&(a=Color(this.config.borderColor),this.content.css({border:"1px solid "+a.rgba(this.config.borderAlpha)}))},parseConfig:function(a){return{width:a.location.width,height:a.location.height,rotation:a.location.rotation,x:a.location.x,y:a.location.y,alpha:a.alpha,images:a.Images,addBackground:parseBool(a.addBack),
addBorder:parseBool(a.addBorder),backgroundColor:a.backgroundColor,backgroundAlpha:a.backgroundColorAlpha,borderColor:a.backgroundBorderColor,animation:a.animation}},init:function(){this.busy=!1;this.imageItems=[];for(var a=0;a<this.Items.length;a++){var b=new FlipJumpItem(this,0==a?!1:!0);b.setImage(this.Items[a]);this.imageItems.push(b)}this.resetZindex();this.resetJumpEvent();1<=this.imageCount&&this.initButtons()},initButtons:function(){this.leftButton=$('<img class="flip-action" src="'+uiBaseURL+
'pre_image.png" style="cursor:pointer;position:absolute;z-index:1000"></img>');this.rightButton=$('<img class="flip-action" src="'+uiBaseURL+'next_image.png" style="cursor:pointer;position:absolute;z-index:1000"></img>');this.setButtonPosition();var a=this;this.leftButton.onTap(function(b){this.preImage();return!1}.bind(this));this.rightButton.onTap(function(b){this.nextImage();return!1}.bind(this));this.leftButton.css({display:"none"});this.rightButton.css({display:"none"});this.content.append(this.leftButton);
this.content.append(this.rightButton);isPhone()||isPad()||(this.content.bind(_event._enter,function(){a.leftButton.css({display:"block"});a.rightButton.css({display:"block"})}),this.content.bind(_event._leave,function(){a.leftButton.css({display:"none"});a.rightButton.css({display:"none"})}))},preImage:function(){if(1!=this.busy){this.busy=!0;var a=this.imageItems[0],b=this.imageItems[this.imageCount-1],c=this;b.jumpUp(function(){a.jumpDown();b.setZindex(c.maxZindex);b.toNormal(function(){c.imageItems.pop();
c.imageItems.unshift(b);c.resetZindex();c.busy=!1})})}},nextImage:function(){if(1!=this.busy){this.busy=!0;var a=this.imageItems[0],b=this.imageItems[1],c=this;1==this.imageItems.length&&(b=a);a.jumpUp(function(){a.setZindex(c.minZindex);b.toNormal();a.jumpDown(function(){c.imageItems.shift();c.imageItems.push(a);c.resetZindex();c.busy=!1})})}},resetZindex:function(){for(var a=0;a<this.imageItems.length;a++)this.imageItems[a].setZindex(this.imageItems.length-a)},resetJumpEvent:function(){for(var a=
0;a<this.imageItems.length;a++)this.imageItems[a].instance.bind(_event._click,function(){this.nextImage()}.bind(this))},setButtonPosition:function(){var a=(this.height-32)/2;this.leftButton.css({left:"0px",top:a+"px"});this.rightButton.css({right:"0px",top:a+"px"})},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.content.css({width:this.width+"px",height:this.height+"px"});this.setPosition();
this.setButtonPosition();this.itemHeight=Math.floor(.5*this.height);this.itemWidth=Math.floor(.5*this.width);for(a=0;a<this.imageItems.length;a++)this.imageItems[a].resize(this.itemWidth,this.itemHeight)},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.content.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.content.one(a,function(){this.content.css({animation:""})}.bind(this))}},
setPosition:function(){this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.content.css({left:this.x+"px",top:this.y+"px"})}}).extend("Item");
var FlipJumpItem=Class({create:function(a,b){this.parent=a;this.initRotate=b;this.rotation=0;this.width=a.itemWidth;this.height=a.itemHeight;this.imageHeight=this.imageWidth=0;this.instance=$("<img></img>");this.instance.css({position:"absolute",left:"0px",top:"0px",width:this.width+"px",height:this.height+"px",border:"2px solid white",display:"none"});this.instance.on("load",function(){this.onImageLoad()}.bind(this));this.initShadow();a.content.append(this.instance)},initShadow:function(){this.instance.css({"-moz-box-shadow":"2px 2px 4px #252525",
"box-shadow":"2px 2px 4px #252525","-webkit-box-shadow":"2px 2px 4px #252525","-ms-box-shadow":"2px 2px 4px #252525","-o-box-shadow":"2px 2px 4px #252525"})},getRandomRotation:function(){return 80-Math.ceil(160*Math.random())},onImageLoad:function(){var a=this.instance[0];this.naturalWidth=a.naturalWidth;this.naturalHeight=a.naturalHeight;this.width=this.parent.itemWidth;this.height=this.parent.itemHeight;this.setImageSize();this.instance.css({left:this.left+"px",top:this.top+"px",width:this.width+
"px",height:this.height+"px",display:"block"});1==this.initRotate&&(a=this.getRandomRotation(),this.instance.css(transformCSS({rotate:a,tran:{x:0,y:0}})),this.rotation=a)},setImageSize:function(){var a=this.naturalWidth/this.naturalHeight;a>=this.width/this.height?this.naturalWidth>=this.width?(this.width=this.width,this.height=this.width/a):(this.height=this.naturalHeight,this.width=this.naturalWidth):this.naturalHeight>=this.height?(this.height=this.height,this.width=a*this.height):(this.height=
this.naturalHeight,this.width=this.naturalWidth);this.left=Math.ceil((this.parent.width-this.width)/2);this.top=Math.ceil((this.parent.height-this.height)/2)},setImage:function(a){this.instance.attr("src",a)},setZindex:function(a){this.instance.css({"z-index":a})},randomRotate:function(a){var b=this.getRandomRotation();this.rotateTo(b,a)},rotateTo:function(a,b){var c=this.rotation,d=20;void 0!=b&&(d=b);var e=this,f=0,g=window.setInterval(function(){var h=$.easing.swing(null,f,c,a-c,d);e.instance.rotate(h);
e.rotation=h;f++>=d&&window.clearInterval(g)},20)},jumpUp:function(a){animateOnce(this.instance,transformCSS({rotate:this.getRandomRotation(),tran:{x:0,y:Math.floor(-this.parent.height)}}),500,a)},jumpDown:function(a){animateOnce(this.instance,transformCSS({rotate:this.getRandomRotation(),tran:{x:0,y:0}}),400,a)},toNormal:function(a){animateOnce(this.instance,transformCSS({rotate:"0",tran:{x:0,y:0}}),400,a)},resize:function(a,b){if(0!=this.imageWith||0!=this.imageHeight)this.width=a,this.height=b,
this.setImageSize(),this.instance.css({left:this.left+"px",top:this.top+"px",width:this.width+"px",height:this.height+"px"})}});
Class("Rotate3D",{Package:"PageItem",create:function(a,b,c,d,e){this._super(a,b,c,d);this.animateConfig();this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.id="3d"+e;if(""!=this.config.images&&(a=this.config.images,a||(this.images=[]),this.Item=[],a instanceof Array||(a.node&&(a=[this.config.images.node]),a.Image&&(a=[this.config.images.Image])),this.imageCount=a.length,0!=this.imageCount)){this.topZindex=
this.imageCount;if(a&&a.length)for(b=0;b<a.length;b++){if("[object Object]"===Object.prototype.toString.call(a[b]))if(a[b].originalURL)this.Item.push(a[b].originalURL);else if(a[b].value)this.Item.push(a[b].value);else if(a[b].image)this.Item.push(a[b].image);else return;else this.Item.push(a[b]);this.Item[b]=this.fixRelativePath(this.Item[b]);bookConfig.useTheAliCloudChart&&(c=getCoverSize(this.width,this.height,1024,1024),isPhone()||isPad()?this.Item[b]=this.getOssUrl(this.Item[b],c.width,c.height,
"fixed"):this.Item[b]=this.getOssUrl(this.Item[b],parseInt(.8*this.width),this.height,"fixed"))}a=1==this.config.addBorder?1:0;this.content=$("<div></div>");this.content.css({opacity:this.config.alpha,position:"absolute",overflow:"hidden",left:this.x+"px",top:this.y+"px",width:this.width+"px",height:this.height+"px",border:a+"px solid "+Color(this.config.borderColor).toString()});this.setRotation(this.content,this.config.rotation);1==this.config.addBackground&&this.content.css({background:Color(this.config.backgroundColor).rgba(this.config.backgroundAlpha)});
this.parent.append(this.content);this.init();this.rotateTimer=-1;this.step=0;this.initEvent()}},initEvent:function(){this.content.onTap(function(a){BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),"Rotate3D",this.config.x,this.config.y,this.config.width,this.config.height])}.bind(this))},parseConfig:function(a){return{width:a.location.width,height:a.location.height,x:a.location.x,y:a.location.y,rotation:a.location.rotation,alpha:a.alpha,images:a.componentData.Images,addBackground:parseBool(a.componentData.addBack),
addBorder:parseBool(a.componentData.addBorder),backgroundColor:a.componentData.backColor,backgroundAlpha:a.componentData.backAlpha,borderColor:a.componentData.borderColor,sh:parseBool(a.shadow.hasDropShadow),sx:a.shadow.shadowBlurX,sy:a.shadow.shadowBlurY,se:a.shadow.shadowDistance,sr:a.shadow.shadowColor,animation:a.animation}},init:function(){this.imageItems=[];for(var a=0;a<this.Item.length;a++){var b=new Rotate3DItem(this,a);b.setImage(this.Item[a]);this.imageItems.push(b)}this.imageItems[0].show();
this.currentIndex=0;1<this.Item.length&&this.initButtons()},getOssUrl:function(a,b,c,d){return a=0<a.lastIndexOf("?")?a+("&x-oss-process=image/resize,m_"+d+",w_"+parseInt(b)+",h_"+parseInt(c)):a+("?x-oss-process=image/resize,m_"+d+",w_"+parseInt(b)+",h_"+parseInt(c))},initButtons:function(){this.leftButton=$('<img class="flip-action" src="'+uiBaseURL+'pre_image.png" style="cursor:pointer;position:absolute;z-index:1000"></img>');this.rightButton=$('<img class="flip-action" src="'+uiBaseURL+'next_image.png" style="cursor:pointer;position:absolute;z-index:1000"></img>');
this.setButtonPosition();var a=this;this.leftButton.bind(_event._down,this.preImage.bind(this));this.rightButton.bind(_event._down,this.nextImage.bind(this));this.leftButton.bind(_event._end,this.stopRotate.bind(this));this.rightButton.bind(_event._end,this.stopRotate.bind(this));this.leftButton.bind(_event._leave,this.stopRotate.bind(this));this.rightButton.bind(_event._leave,this.stopRotate.bind(this));isTouchDevice()||(this.leftButton.css({display:"none"}),this.rightButton.css({display:"none"}));
this.content.append(this.leftButton);this.content.append(this.rightButton);this.content.bind(_event._enter,function(){a.leftButton.css({display:"block"});a.rightButton.css({display:"block"})});this.content.bind(_event._leave,function(){a.leftButton.css({display:"none"});a.rightButton.css({display:"none"})})},setButtonPosition:function(){if(!(1>=this.Item.length)){var a=(this.height-32)/2;this.leftButton.css({left:"0px",top:a+"px"});this.rightButton.css({right:"0px",top:a+"px"})}},onResize:function(a,
b){if(""!=this.config.images&&this.content){this.pageWidth=a;this.pageHeight=b;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.content.css({width:this.width+"px",height:this.height+"px"});this.setPosition();this.setButtonPosition();for(a=0;a<this.imageItems.length;a++)bookConfig.useTheAliCloudChart?this.imageItems[a].resizeOss():this.imageItems[a].resize();this.imageItems[this.currentIndex].show()}},setPosition:function(){this.x=this.config.x*this.pageWidth;
this.y=this.config.y*this.pageHeight;this.content.css({left:this.x+"px",top:this.y+"px"})},preImage:function(){this.step=-1;this.doRotate();this.rotateTimeOut()},nextImage:function(){this.step=1;this.doRotate();this.rotateTimeOut()},rotateTimeOut:function(){this.outTimer&&(window.clearTimeout(this.outTimer),this.outTimer=null);this.outTimer=window.setTimeout(function(){this.startRotate()}.bind(this),600)},startRotate:function(){var a=this;this.doRotate();window.clearInterval(this.rotateTimer);this.rotateTimer=
window.setInterval(function(){a.doRotate()},150)},doRotate:function(){var a=this.currentIndex;this.currentIndex+=this.step;0>this.currentIndex&&(this.currentIndex+=this.imageCount);this.currentIndex>=this.imageCount&&(this.currentIndex%=this.imageCount);this.imageItems[a].hide();this.imageItems[this.currentIndex].show()},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.content.css({animation:b.name+" "+b.duration+"s "+
b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.content.one(a,function(){this.content.css({animation:""})}.bind(this))}},stopRotate:function(){window.clearInterval(this.rotateTimer);this.step=0;this.rotateTimer=-1}}).extend("Item");
var Rotate3DItem=Class({create:function(a,b){var c=this;this.parent=a;this.zIndex=b;this.height=this.parent.height;this.width=this.parent.width;this.imageHeight=this.imageWidth=0;this.instance=$("<img></img>");this.instance.css({position:"absolute",left:"0px",top:"0px",display:"none"});this.setZindex(b);this.initShadow();if(!bookConfig.useTheAliCloudChart)this.instance.on("load",function(){Rotate3DItem.prototype.onImageLoad.apply(c,arguments)});a.content.append(this.instance)},initShadow:function(){var a=
this.parent.config;this.shadowColor=Color(a.sr).toString();1==a.sh&&this.instance.css({"box-shadow":a.sx+"px "+a.sy+"px "+a.se+"px "+this.shadowColor,"-moz-box-shadow":a.sx+"px "+a.sy+"px "+a.se+"px "+this.shadowColor,"-webkit-box-shadow":a.sx+"px "+a.sy+"px "+a.se+"px "+this.shadowColor,"-ms-box-shadow":a.sx+"px "+a.sy+"px "+a.se+"px "+this.shadowColor,"-o-box-shadow":a.sx+"px "+a.sy+"px "+a.se+"px "+this.shadowColor})},onImageLoad:function(){var a=this.instance[0];this.imageWidth=a.naturalWidth;
this.imageHeight=a.naturalHeight;this.height=Math.floor(this.parent.height);this.width=Math.ceil(.8*this.parent.width);this.left=Math.ceil(.1*this.parent.width);this.top=0;this.instance.css({left:this.left+"px",top:this.top+"px",width:this.width+"px",height:this.height+"px"})},setImage:function(a){this.instance.attr("src",a)},setZindex:function(a){this.instance.css({"z-index":a})},show:function(){this.instance.css({display:"block"});this.setZindex(this.parent.topZindex)},hide:function(){this.instance.css({display:"none"});
this.setZindex(this.zIndex)},resizeOss:function(){this.left=Math.ceil(.1*this.parent.width);this.top=0;this.height=Math.floor(this.parent.height);this.width=Math.ceil(.8*this.parent.width);this.instance.css({width:this.width+"px",height:this.height+"px",left:this.left+"px",top:this.top+"px"})},resize:function(){if(0!=this.imageWidth||0!=this.imageHeight)this.height=Math.floor(this.parent.height),this.width=Math.ceil(.8*this.parent.width),this.left=Math.ceil(.1*this.parent.width),this.top=0,this.instance.css({left:this.left,
top:this.top,width:this.width,height:this.height})}});
Class("EmbeddedSlideshow",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b,c,d);this.animateConfig();a=Instance.copy(this.config.images);this.maskType=b.frameStyle;this.photoItem=[];if(a.Image){"string"==typeof a.Image&&this.photoItem.push(a.Image);if(a.Image instanceof Array)for(b=0;b<a.Image.length;b++)this.photoItem.push(a.Image[b].Image);a.Image instanceof Object&&this.photoItem.push(a.Image.value)}else for(b=0;b<a.length;b++)a[b].value?this.photoItem.push(a[b].value):this.photoItem.push(a[b]);
a=this.photoItem.length;for(b=0;b<a;b++)this.photoItem[b]=this.fixRelativePath(this.photoItem[b]);if(4>a)for(b=a;4>b;b++)this.photoItem[b]=this.photoItem[0];2==a&&(this.photoItem[2]=this.photoItem[0],this.photoItem[3]=this.photoItem[1]);this.showIndex=this.index=0;this.nextIndex=1;this.imgWidth=this.config.width*this.pageWidth;this.imgHeight=this.config.height*this.pageHeight;this.boxWidth=this.imgWidth-8;this.boxHeight=this.imgHeight-8;this.btnSize=18>=.2*this.boxHeight?18:.2*this.boxHeight;this.x=
this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.alpha=0;this.nextAlpha=100;this.images=[];this.runArr=[];this.background=$("<div></div>");this.background.css({opacity:this.config.alpha,width:this.imgWidth,height:this.imgHeight,left:this.x+"px",top:this.y+"px",position:"absolute",overflow:"hidden"});this.setRotation(this.background,this.config.rotation);this.runBox1=$("<div class='"+this.maskType+"'></div>");this.runBox2=$("<div class='"+this.maskType+"'></div>");this.leftBtn=
$("<img src='"+uiBaseURL+"pre_image.png' />");this.rightBtn=$("<img src='"+uiBaseURL+"next_image.png' />");this.leftBtn.css({display:"none","z-index":"1000",cursor:"pointer",position:"absolute",width:this.btnSize+"px",height:this.btnSize+"px",left:"0",top:(this.imgHeight-this.btnSize)/2+"px"});this.rightBtn.css({display:"none","z-index":"1000",cursor:"pointer",position:"absolute",width:this.btnSize+"px",height:this.btnSize+"px",right:"0",top:(this.imgHeight-this.btnSize)/2+"px"});this.config.selectBtn&&
(this.leftBtn.css({display:"block"}),this.rightBtn.css({display:"block"}));this.addItem();this.background.append(this.leftBtn).append(this.rightBtn).append(this.runBox1).append(this.runBox2);this.parent.append(this.background);this.runBox1.append(this.images[this.showIndex]);this.runBox2.append(this.images[this.nextIndex].css({opacity:"0"}));this.runArr.push(this.runBox2);this.runArr.push(this.runBox1);this.initRunConfig();this.images[this.showIndex].css(this.tranCss(this.pos1.x,this.pos1.y));this.initCss();
this.initBtnEvent();this.initEvent()},initEvent:function(){this.background.onTap(function(a){BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),"EmbeddedSlideshow",this.config.x,this.config.y,this.config.width,this.config.height])}.bind(this))},initCss:function(){this.runBox1.css({"mask-size":this.boxWidth+"px "+this.boxHeight+"px","-webkit-mask-size":this.boxWidth+"px "+this.boxHeight+"px",position:"absolute",width:this.imgWidth+"px",height:this.imgHeight+"px"});this.runBox2.css({"mask-size":this.boxWidth+
"px "+this.boxHeight+"px","-webkit-mask-size":this.boxWidth+"px "+this.boxHeight+"px",position:"absolute",width:this.imgWidth+"px",height:this.imgHeight+"px"})},initRunConfig:function(){switch(this.index){case 0:this.pos1={x:this.imgWidth/4,y:this.imgHeight/4,endX:0,endY:0};this.pos2={x:0,y:this.imgHeight/2,endX:this.imgWidth/4,endY:this.imgHeight/4};break;case 1:this.pos1={x:this.imgWidth/4,y:this.imgHeight/4,endX:this.imgWidth/2,endY:0};this.pos2={x:this.imgWidth/2,y:0,endX:this.imgWidth/4,endY:this.imgHeight/
4};break;case 2:this.pos1={x:this.imgWidth/4,y:this.imgHeight/4,endX:0,endY:this.imgHeight/2};this.pos2={x:0,y:0,endX:this.imgWidth/4,endY:this.imgHeight/4};break;case 3:this.pos1={x:this.imgWidth/4,y:this.imgHeight/4,endX:this.imgWidth/2,endY:this.imgHeight/2},this.pos2={x:this.imgWidth/2,y:this.imgHeight/2,endX:this.imgWidth/4,endY:this.imgHeight/4}}},initBtnEvent:function(){this.leftBtn.onTap(function(a){this.prevEvent()}.bind(this));this.rightBtn.onTap(function(a){this.nextEvent()}.bind(this))},
changeConfig:function(){this.tranX1&&this.tranY1||(this.tranX1=this.pos1.x,this.tranY1=this.pos1.y);this.tranX2&&this.tranY2||(this.tranX2=this.pos2.x,this.tranY2=this.pos2.y);this.currentAlpha1||(this.currentAlpha1=1);this.currentAlpha2||(this.currentAlpha2=0)},prevEvent:function(){if(!this.running){this.pause();this.index=0>this.index-1?3:this.index-1;this.nextIndex-=2;-1>this.nextIndex&&(this.nextIndex=this.images.length-2);0>this.nextIndex&&(this.nextIndex=this.images.length-1);this.changeConfig();
var a=function(c,d){this.running=!0;var e=this.currentAlpha1*(1-c/d),f=this.tranX1+(this.pos1.endX-this.tranX1)*c/d,g=this.tranY1+(this.pos1.endY-this.tranY1)*c/d;this.runBox1.children().css({transform:"translate("+f+"px,"+g+"px)",opacity:e});c==d&&(a.stop(),this.nextIndex=this.nextIndex+1>=this.images.length?0:this.nextIndex+1,this.runBox1.empty().append(this.images[this.nextIndex]).children().css({opacity:"1"}))}.bind(this).animation(this,800),b=function(c,d){var e=this.currentAlpha2+(1-this.currentAlpha2)*
c/d,f=this.tranX2+(this.pos2.endX-this.tranX2)*c/d,g=this.tranY2+(this.pos2.endY-this.tranY2)*c/d;this.runBox2.children().css({transform:"translate("+f+"px,"+g+"px)",opacity:e});c==d&&(b.stop(),this.afterAnimate())}.bind(this).animation(this,800)}},nextEvent:function(){if(!this.running){this.pause();this.changeConfig();var a=function(c,d){this.running=!0;var e=this.currentAlpha1*(1-c/d),f=this.tranX1+(this.pos1.endX-this.tranX1)*c/d,g=this.tranY1+(this.pos1.endY-this.tranY1)*c/d;this.runBox1.children().css({transform:"translate("+
f+"px,"+g+"px)",opacity:e});c==d&&(a.stop(),this.nextIndex=this.nextIndex+1>=this.images.length?0:this.nextIndex+1,this.runBox1.empty().append(this.images[this.nextIndex]).children().css({opacity:"1"}))}.bind(this).animation(this,800),b=function(c,d){var e=this.currentAlpha2+(1-this.currentAlpha2)*c/d,f=this.tranX2+(this.pos2.endX-this.tranX2)*c/d,g=this.tranY2+(this.pos2.endY-this.tranY2)*c/d;this.runBox2.children().css({transform:"translate("+f+"px,"+g+"px)",opacity:e});c==d&&(b.stop(),this.afterAnimate())}.bind(this).animation(this,
800)}},afterAnimate:function(){this.index=3<this.index+1?0:this.index+1;this.initRunConfig();this.runBox1.children().css({opacity:"0"});this.runBox1.children().css({transform:"translate("+this.pos2.x+"px,"+this.pos2.y+"px)"});var a=this.runBox1;this.runBox1=this.runBox2;this.runBox2=a;this.config.autoBool&&(this.runTime1=this.runfun1.animation(this,this.config.delayTime),this.runTime2=this.runfun2.animation(this,this.config.delayTime));this.running=!1},tranCss:function(a,b){return{transform:"translate("+
a+"px,"+b+"px)","-webkit-transform":"translate("+a+"px,"+b+"px)","-o-transform":"translate("+a+"px,"+b+"px)","-moz-transform":"translate("+a+"px,"+b+"px)","-ms-transform":"translate("+a+"px,"+b+"px)"}},tranAnimate:function(){this.initRunConfig();this.runBox1.children().css(this.tranCss(this.pos1.x,this.pos1.y));this.runBox2.children().css(this.tranCss(this.pos2.x,this.pos2.y));this.runTime1=this.runfun1.animation(this,this.config.delayTime);this.runTime2=this.runfun2.animation(this,this.config.delayTime)},
runfun1:function(a,b){this.currentAlpha1=a<=b/2?1-2*a/b:0;this.tranX1=this.pos1.x+(this.pos1.endX-this.pos1.x)/b*a;this.tranY1=this.pos1.y+(this.pos1.endY-this.pos1.y)/b*a;this.runBox1.children().css({transform:"translate("+this.tranX1+"px,"+this.tranY1+"px)",opacity:this.currentAlpha1});a==b&&(this.nextIndex=this.nextIndex+1>=this.images.length?0:this.nextIndex+1,this.runBox1.empty().append(this.images[this.nextIndex]).children().css({opacity:"1"}))},runfun2:function(a,b){this.currentAlpha2=a<=b/
2?2*a/b:1;this.tranX2=this.pos2.x+(this.pos2.endX-this.pos2.x)/b*a;this.tranY2=this.pos2.y+(this.pos2.endY-this.pos2.y)/b*a;this.runBox2.children().css({transform:"translate("+this.tranX2+"px,"+this.tranY2+"px)",opacity:this.currentAlpha2});a==b&&this.afterAnimate()},play:function(){this.config.autoBool&&(this.timer1&&clearTimeout(this.timer1),this.timer1=null,this.runTime1&&this.runTime1.stop(),this.runTime2&&this.runTime2.stop(),this.timer1=setTimeout(this.tranAnimate.bind(this),this.config.delayTime))},
pause:function(){this.config.autoBool&&(this.timer1&&clearTimeout(this.timer1),this.timer1=null,this.runTime1&&this.runTime1.stop(),this.runTime2&&this.runTime2.stop())},parseConfig:function(a){return{width:a.location.width,height:a.location.height,rotation:a.location.rotation,x:a.location.x,y:a.location.y,alpha:a.alpha,autoBool:parseBool(a.autoBool),images:a.Images,delayTime:100>a.duration?1E3*a.duration:a.duration,selectBtn:parseBool(a.selectBtn)}},addItem:function(){for(var a=this,b=0;b<a.photoItem.length;b++){var c=
$("<div></div>");c.css({width:a.boxWidth+"px",height:a.boxHeight+"px",position:"absolute"});var d=$("<img />");d.css("position","absolute");var e=a.photoItem[b];c.append(d);$(d).on("load",function(){var f=$(this)[0];$(this).css({left:(a.boxWidth-f.naturalWidth)/2+"px",top:(a.boxHeight-f.naturalHeight)/2+"px",position:"absolute"})}).attr("src",e);a.images[b]=c}},resizeItem:function(){for(var a=0;a<this.photoItem.length;a++){var b=this.images[a],c=b.children(),d=c[0];void 0!=c&&null!=c&&($(c).css({left:(this.boxWidth-
d.naturalWidth)/2+"px",top:(this.boxHeight-d.naturalHeight)/2+"px",position:"absolute"}),b.css({width:this.boxWidth+"px",height:this.boxHeight+"px"}));this.images[a]=b}},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.imgWidth=this.config.width*this.pageWidth;this.imgHeight=this.config.height*this.pageHeight;if(isIphone()||isIpad())a=getCoverSize(this.imgWidth,this.imgHeight,1024,1024),this.imgWidth=a.width,this.imgHeight=a.height,this.background.css({width:this.imgWidth+"px",height:this.imgHeight+
"px","-webkit-transform-origin":"0 0","transform-origin":"0 0","-webkit-transform":"scale("+a.scale+")",transform:"scale("+a.scale+")"});this.boxWidth=this.imgWidth-8;this.boxHeight=this.imgHeight-8;this.btnSize=.2*this.imgHeight;this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.initRunConfig();this.background.css({width:this.imgWidth,height:this.imgHeight,left:this.x+"px",top:this.y+"px"});this.leftBtn.css({width:this.btnSize+"px",height:this.btnSize+"px",top:(this.imgHeight-
this.btnSize)/2+"px"});this.rightBtn.css({width:this.btnSize+"px",height:this.btnSize+"px",top:(this.imgHeight-this.btnSize)/2+"px"});this.initCss();this.setPosition()},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.background.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.background.one(a,function(){this.background.css({animation:""})}.bind(this))}},setPosition:function(){this.resizeItem()}}).extend("Item");
Class("FlashSwf",{Package:"PageItem",create:function(a,b,c,d){this.config=this.parseConfig(b);this.parent=a;this.pageWidth=c;this.pageHeight=d;this.width=this.pageWidth*this.config.width;this.height=this.pageHeight*this.config.height;this.left=this.pageWidth*this.config.x;this.top=this.pageHeight*this.config.y;this.config.src=this.config.src;this.config.hint&&(this.config.hint.hintShapeColor=Color(this.config.hint.hintShapeColor).toString(),this.config.hint.hintShapeColor2=Color(this.config.hint.hintShapeColor2).toString());
this.content=$("<div></div>");this.content.css({position:"absolute",left:this.left,top:this.top,width:this.width,height:this.height});this.setRotation(this.content,this.config.rotation);this.parent.append(this.content);isTouchDevice()||(this.config.src=this.fixRelativePath(this.config.src),this.initLinkHint(this.content),this.content.flash({swf:this.config.src,width:this.width+"px",height:this.height+"px",wmode:"transparent"}),parseBool(this.config.reflection)&&this.imageReflection(this.content))},
parseConfig:function(a){return{width:a.location.width,height:a.location.height,rotation:a.location.rotation,reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,x:a.location.x,y:a.location.y,alpha:a.alpha,src:a.swfURL,hint:a.hint,shadow:a.shadow}},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.content.css({width:this.width+"px",
height:this.height+"px"});this.content.flash().remove();this.content.flash({swf:this.config.src,width:this.width+"px",height:this.height+"px",wmode:"transparent"});this.setPosition(this.config.x*this.pageWidth,this.config.y*this.pageHeight)},setPosition:function(a,b){this.content.css({left:a+"px",top:b+"px"})},hide:function(){this.content.html("")},show:function(){this.content.flash({swf:this.config.src,width:this.width+"px",height:this.height+"px",wmode:"transparent"})}}).extend(PageItem.Item);
Class("PageItemPopup",{Package:"PageItem.Popup",dialog:null,left:0,top:0,width:0,height:0,containerWidth:0,containerHeight:0,create:function(a,b){this.container=a||tmpContainer;this.containerWidth=a.width();this.containerHeight=a.height();this.zIndex=b||1E3},onResize:function(a,b){this.containerWidth=a;this.containerHeight=b;this.dialog.css({left:Math.floor((a-this.width)/2)+"px",top:Math.floor((b-this.height)/2)+"px","z-index":this.zIndex})},getOssUrl:function(a,b,c,d){return a=0<a.lastIndexOf("?")?
a+("&x-oss-process=image/resize,m_"+d+",w_"+parseInt(b)+",h_"+parseInt(c)):a+("?x-oss-process=image/resize,m_"+d+",w_"+parseInt(b)+",h_"+parseInt(c))},fixRelativePath:function(a){return a?"string"!==typeof a?fixURLValue(a):1==bookConfig.isFlipPdf?a.startsWith("../")?fixURLValue(a):a.startsWith("./")?fixURLValue("."+a):a.startsWith("files")?fixURLValue("../"+a):a.isUrl()?fixURLValue(a):fixURLValue("../"+a):fixURLValue(a):a},destroy:virtual_function,show:virtual_function,hide:virtual_function});
Class("PageItemNormalPopup",{Package:"PageItem.Popup",create:function(a,b){this._super(a,b)},destroy:function(){this._super();this.dialog.remove();this.dialog=null},show:function(){this.visible=!0;this.container.append(this.dialog)},hide:function(){animateOnce(this.dialog,{"-webkit-transform":"scale(0)","-o-transform":"scale(0)","-ms-transform":"scale(0)","-moz-transform":"scale(0)",transform:"scale(0)"},400,function(){this.destroy();this.visible=!1}.bind(this))}}).extend("PageItemPopup");
Class("PageItemModalPopup",{Package:"PageItem.Popup",modalBackground:null,create:function(a,b){this._super(a,b);this.createModalBackground()},createModalBackground:function(){this.modalBackground=$("<div name='modal_dialog_background'></div>");this.modalBackground.css({left:"0%",top:"0%",width:"100%",height:"100%",position:"absolute","background-color":"rgba(0, 0, 0, 0.5)","z-index":this.zIndex,cursor:"default"});this.initModalBackgroundEvents()},initModalBackgroundEvents:function(a){this.modalBackground.onTap(function(){this.hide();
return!1}.bind(this));this.modalBackground.bind(_event._down,function(b){b.stopPropagation();return!1}.bind(this));this.modalBackground.bind(_event._up,function(b){b.stopPropagation();return!1}.bind(this))},destroy:function(){this._super();this.dialog.remove();this.modalBackground.remove();this.modalBackground=this.dialog=null},show:function(){if(!this.timer){this.timer=this.visible=!0;this.dialog.css({"-webkit-transform":"scale(0)","-o-transform":"scale(0)","-ms-transform":"scale(0)","-moz-transform":"scale(0)",
transform:"scale(0)"});this.container.append(this.dialog);this.container.append(this.modalBackground);var a={"-webkit-transform":"scale(1)","-o-transform":"scale(1)","-ms-transform":"scale(1)","-moz-transform":"scale(1)",transform:"scale(1)"};setTimeout(function(){animateOnce(this.dialog,a,300,function(){this.timer=!1;this.onShow()}.bind(this))}.bind(this),100)}},onShow:function(){},hide:function(){this.timer||(this.timer=!0,animateOnce(this.dialog,{"-webkit-transform":"scale(0)","-o-transform":"scale(0)",
"-ms-transform":"scale(0)","-moz-transform":"scale(0)",transform:"scale(0)"},300,function(){this.modalBackground.css({opacity:"0"});this.destroy();this.visible=this.timer=!1}.bind(this)))}}).extend("PageItemPopup");var QAF_UNKNOWN=-1,QAF_RIGHT=0,QAF_MISTAKE=1;
Class("QuizPanelPC",{Package:"PageItem.Popup",create:function(a,b){this._super(a);this.config=b;this.parent=a;this.quiz=this.config.action.quiz;this.quiz[0]||(this.quiz=[this.quiz.topic]);this.dialog=$("<div></div>");this.closeButton=$("<div></div>");this.content=$("<div></div>");this.title=$("<div class='titleDiv'></div>");this.button=$("<div></div>");this.rightSmile=$("<div style='background:url("+uiBaseURL+"quiz.png) no-repeat -5px -14px;position:absolute;left:25px;top:85px;width:38px;height:50px'></div>");
this.mistakeSmile=$("<div style='background:url("+uiBaseURL+"quiz.png) no-repeat -5px -74px;position:absolute;right:25px;top:85px;width:38px;height:50px'></div>");this.rightNumber=$("<div style='position:absolute;left:37px;top:145px;color:#03B503;font-size:25px;font-weight:bold'>0</div>");this.mistakeNumber=$("<div style='position:absolute;right:37px;top:145px;color:red;font-size:25px;font-weight:bold'>0</div>");this.nextPage=$("<div/></div>");this.prePage=$("<div><div>");this.advanceImg=$("<div></div>");
this.progressBar=new TopicProgressBar(this.quiz.length);this.dialog.append(this.content);this.dialog.append(this.closeButton);this.parent.append(this.dialog);this.initQuiz();this.content.append(this.title).append(this.changBox).append(this.rightSmile).append(this.mistakeSmile).append(this.rightNumber).append(this.mistakeNumber).append(this.nextPage).append(this.prePage).append(this.progressBar.progressContainer);this.title.html(this.config.action.guizTxt);""==this.config.action.guizURL?this.setQuestionURL(this.topicItem[0].QuizTopicPanel.content):
(this.advance=new SetAdvance(this.config.action,this),this.content.append(this.advance.QuizTopicPanel.content),this.hideButton(),this.progressBar.progressContainer.hide(),this.advance.start.on("click",function(){this.setQuestionURL(this.topicItem[0].QuizTopicPanel.content);this.showButton();this.topicItem[this.currentIndex].QuizTopicPanel.Animate();this.prePage.hide();this.progressBar.progressContainer.show();this.advance.QuizTopicPanel.content.remove()}.bind(this)));this.setCss();this.initEvent();
this.prePage.hide()},setQuestionURL:function(a){this.content.append(a)},initEvent:function(){this.currentIndex=0;var a=this.topicItem.length;this.OnNextPageClick=function(){if(!(this.currentIndex>a))if(this.currentIndex+=1,this.progressBar.setProgress(this.currentIndex+1),this.currentIndex<a)this.setQuestionURL(this.topicItem[this.currentIndex].QuizTopicPanel.content),this.topicItem[this.currentIndex].QuizTopicPanel.Animate(),this.topicItem[this.currentIndex].resetScroll(),this.prePage.show();else{var b=
new Onclusion(this,this.config.action,this.rightNumber[0].innerText,this.mistakeNumber[0].innerText);this.setQuestionURL(b.QuizTopicPanel.content);this.nextPage.hide()}}.bind(this);this.nextPage.on("click",this.OnNextPageClick);this.prePage.on("click",function(){0!=this.currentIndex&&(0==this.currentIndex&&(this.currentIndex+=a),this.currentIndex=(this.currentIndex-1)%a,this.setQuestionURL(this.topicItem[this.currentIndex].QuizTopicPanel.content),this.topicItem[this.currentIndex].QuizTopicPanel.Animate(),
this.progressBar.setProgress(this.currentIndex+1),this.nextPage.show(),0==this.currentIndex&&this.prePage.hide())}.bind(this));this.closeButton.bind("click",function(b){b.stopPropagation();this.hide()}.bind(this));this.nextPage.on("mouseover",function(){this.nextPage.css({background:"url("+uiBaseURL+"quiz.png) no-repeat -257px -61px",cursor:"pointer"})}.bind(this));this.nextPage.on("mouseout",function(){this.nextPage.css("background","url("+uiBaseURL+"quiz.png) no-repeat -257px -16px")}.bind(this));
this.prePage.on("mouseover",function(){this.prePage.css({background:"url("+uiBaseURL+"quiz.png) no-repeat -310px -62px",cursor:"pointer"})}.bind(this));this.prePage.on("mouseout",function(){this.prePage.css("background","url("+uiBaseURL+"quiz.png) no-repeat -310px -17px")}.bind(this));$(window).resize(this.onResize.bind(this))},initQuiz:function(){this.topicItem=[];this.topicAnswer=[];for(var a=0;a<this.quiz.length;a++)"right"==this.config.action.languageLayout&&(this.quiz[a].alignCss={"text-align":"right",
direction:"rtl"}),this.topic=new SetQuestionPanel(this,this.quiz[a],a),this.topicItem.push(this.topic),this.topicAnswer[a]=null},getAnswerFlags:function(){for(var a=[],b=0;b<this.quiz.length;b++)null===this.topicAnswer[b]?a[b]=QAF_UNKNOWN:this.topicAnswer[b]==this.topicItem[b].getRightAnswer()?a[b]=QAF_RIGHT:a[b]=QAF_MISTAKE;return a},statistics:function(){for(var a=this.getAnswerFlags(),b=0,c=0,d=0;d<a.length;d++)a[d]==QAF_RIGHT&&b++,a[d]==QAF_MISTAKE&&c++;this.rightNumber[0].innerText=Number(b).toString();
this.mistakeNumber[0].innerText=Number(c).toString()},showButton:function(){this.rightSmile.show();this.mistakeSmile.show();this.rightNumber.show();this.mistakeNumber.show();this.nextPage.show();this.prePage.show()},hideButton:function(){this.rightSmile.hide();this.mistakeSmile.hide();this.rightNumber.hide();this.mistakeNumber.hide();this.nextPage.hide();this.prePage.hide()},setCss:function(){this.title.css({position:"relative",margin:"auto",width:"570px",height:"25px","margin-top":"20px","text-align":"center",
"font-size":"20px","font-family":"-webkit-pictograph"});this.closeButton.asButton();this.closeButton.css({position:"absolute","background-image":"url("+uiBaseURL+"close_form.png)",width:"32px",height:"32px","z-index":"500",cursor:"pointer",right:"30px","margin-top":"24px"});this.dialog.css({position:"absolute",width:"760px",height:"550px",margin:"auto",left:"0",top:"0",right:"0",bottom:"0","z-index":"1001"});this.nextPage.css({background:"url("+uiBaseURL+"quiz.png) no-repeat -257px -16px",position:"absolute",
margin:"auto",right:"22px",top:"210px",width:"36px",height:"36px"});this.prePage.css({background:"url("+uiBaseURL+"quiz.png) no-repeat -310px -17px",position:"absolute",margin:"auto",left:"27px",top:"210px",width:"36px",height:"36px"});this.content.css({position:"absolute",background:"url("+uiBaseURL+"quiz.png) no-repeat -6px -148px","max-width":"722px","max-height":"502px",width:"100%",height:"100%",margin:"auto",left:"0",top:"0",right:"0",bottom:"0"})},onResize:function(){},show:function(){this._super();
this.topicItem[this.currentIndex].resetScroll();this.modalBackground.css("display","block")},hide:function(){this.modalBackground.css("display","none");this.dialog.css({transform:"scale(0)","-webkit-transform":"scale(0)","-moz-transform":"scale(0)","-ms-transform":"scale(0)","-o-transform":"scale(0)"});animateOnce(this.dialog,{},.6);this._super.delay(this,600)}}).extend("PageItemModalPopup");
Class("QuizTopicPanel",{create:function(a){this.config=a;this.content=$("<div></div>");this.deg=10;this.setCss();this.Animate()},getQuizTopicPanel:function(){return this.content},setCss:function(){this.content.css({transform:"rotateZ(10deg) rotateX(10deg)","-weblkit-transform":"rotateZ(10deg) rotateX(10deg)","-moz-transform":"rotateZ(10deg) rotateX(10deg)","-ms-transform":"rotateZ(10deg) rotateX(10deg)","-o-transform":"rotateZ(10deg) rotateX(10deg)","transform-origin":"50% 80%","-webkit-transform-origin":"50% 80%",
"-ms-transform-origin":"50% 80%","-moz-transform-origin":"50% 80%","-o-transform-origin":"50% 80%",position:"absolute",background:"white",margin:"auto","margin-top":"40px",left:0,right:0,width:"560px",height:"360px",border:"3px solid #b8d0da","border-radius":"14px"})},Animate:function(){this.show.animation(this,300)},show:function(a,b){var c=$.easing.easeOutCubic(null,a,10,-10,b);a=$.easing.easeOutCubic(null,a,45,-45,b);this.content.css("transform","rotateX("+a+"deg) rotateY("+a+"deg) rotateZ("+c+
"deg) ")}});
Class("SetQuestionPanel",{create:function(a,b,c){this.config=b;this.index=c;this.quizPanel=a;this.questionPanel=$("<div></div>");this.question=$("<span style='color:rgb(0,153,255);font-size:30px;font-weight:bold;font-family:Verdana;position:absolute;top:0;left:15px'>Q:</span>");this.initAnswer();this.questionTitle=$("<span class='stage' style='color:#0066CC;width:475px;height:70px;overflow:hidden;font-size:16px;position:absolute;top:0;left:70px'><div class='swiper' style='width:465px;position:absolute;top:0;left:0;'>"+this.config.title.replaceAll("  ",
"&ensp;")+"</div></span>");this.initScroll();a=this.fixRelativePath(this.config.media);bookConfig.useTheAliCloudChart&&(a=this.getOssUrl(a,280,220,"lfit"));this.mediaImg=$("<img src='"+a+"' style='max-width:270px;max-height:180px;position:absolute;bottom: 0px;top:0px;margin:auto;left:50px;'/>");this.noImgAnswerPanel=$("<div></div>");this.imgAnswerPanel=$("<div></div>");this.QuizTopicPanel=new QuizTopicPanel;this.QuizTopicPanel.getQuizTopicPanel().append(this.questionPanel.append(this.question).append(this.questionTitle).append(this.mediaImg));
""==this.config.media?(this.mediaImg.remove(),this.questionPanel.append(this.noImgAnswerPanel)):this.questionPanel.append(this.imgAnswerPanel);this.setCss();this.getRightAnswer();this.addTopicAnswer()},initAnswer:function(){this.Items=[];for(var a in this.config)a.startsWith("answer")&&this.Items.push(this.config[a])},getRightAnswer:function(){for(var a=0;a<this.Items.length;a++)"true"==this.Items[a].dataRight&&(this.dataRight=this.Items[a].value);return this.dataRight},addTopicAnswer:function(){for(var a=
0;a<this.Items.length;a++){var b=new TopicAnswer(this.quizPanel,this.Items[a],this.config,this.dataRight,this.index);""==this.config.media?(0==(a+1)%2&&b.answerPanel.css("margin-left","20px"),this.noImgAnswerPanel.append(b.answerPanel)):this.imgAnswerPanel.append(b.answerPanel)}},setCss:function(){this.imgAnswerPanel.css({width:"210PX",position:"absolute",right:"0px",top:"82px","overflow-x":"hidden",height:"250px"});this.noImgAnswerPanel.css({top:"125px",position:"absolute",width:"455px",left:"95px",
"overflow-x":"hidden",height:"230px"});this.questionPanel.css({position:"absolute",width:"560px",height:"350px",margin:"auto",right:0,left:0,top:0,bottom:0});this.config.alignCss&&(this.question.html(":Q"),this.question.css({right:"15px",left:"auto"}),this.questionTitle.css({left:"auto",right:"65px",direction:"rtl","text-align":"right"}))},initScroll:function(){this.progress=$("<div class='progress'></div>");this.progressBar=$("<div class='progressBar'></div>");this.progress.append(this.progressBar);
this.questionTitle.append(this.progress);this.initScrollCss()},resetScroll:function(){this.questionTitle.scroll({},Direction.top,"win10")},initScrollCss:function(){this.progress.css({display:"none",background:"#eee",width:"8px",height:"100%",position:"absolute",right:"0",cursor:"pointer"});this.progressBar.css({width:"8px",background:"rgba(11,11,11,0.55)",position:"absolute",top:"0",cursor:"pointer","border-radius":"4px"})},getOssUrl:function(a,b,c,d){return a=0<a.lastIndexOf("?")?a+("&x-oss-process=image/resize,m_"+
d+",w_"+parseInt(b)+",h_"+parseInt(c)):a+("?x-oss-process=image/resize,m_"+d+",w_"+parseInt(b)+",h_"+parseInt(c))},fixRelativePath:function(a){return a&&"string"===typeof a?1==bookConfig.isFlipPdf?a.startsWith("../")?a:a.startsWith("./")?"."+a:a.isUrl()?a:"../"+a:a:a}});
Class("TopicAnswer",{create:function(a,b,c,d,e){this.index=e;this.quizPanel=a;this.config=c;this.answer=b;this.dataRight=d;this.answerPanel=$("<div></div>");this.checkBox=$("<div class='check-box'><div>");this.answerValue=$("<div>"+this.answer.value+"</div>");this.answerPanel.append(this.checkBox);this.answerPanel.append(this.answerValue);this.initEvent();this.setCss()},initEvent:function(){this.checkBox.on("click",function(){this.quizPanel.topicAnswer[this.index]=this.answer.value;this.quizPanel.statistics();
this.answerResult=new TopicAnswerResult(this.quizPanel,this.config,this.answer,this.dataRight);this.quizPanel.content.append(this.answerResult.content)}.bind(this));this.checkBox.on("mouseover",function(){this.checkBox.css({width:"26px",height:"26px",cursor:"pointer",background:"url("+uiBaseURL+"quiz.png) no-repeat -630px -63px"})}.bind(this));this.checkBox.on("mouseleave",function(){this.checkBox.css({width:"20px",height:"20px",cursor:"pointer",background:"url("+uiBaseURL+"quiz.png) no-repeat -465px -67px"})}.bind(this))},
setCss:function(){this.answerValue.css({color:"#0f5177",position:"relative","margin-left":"30px","font-size":"15px",color:"#0f5177",width:"165px","font-family":"Verdana"});this.answerPanel.css({width:"200px","margin-top":"20px",position:"relative",display:"inline-block"});this.checkBox.css({position:"absolute",background:"url("+uiBaseURL+"quiz.png) no-repeat -465px -67px",top:"4px",width:"20px",height:"20px"});this.config.alignCss&&(this.answerPanel.css(this.config.alignCss),this.answerValue.css({"margin-left":"0",
"margin-right":"30px"}))}});
Class("SetAdvance",{create:function(a){this.config=a;a=this.fixRelativePath(this.config.guizURL);bookConfig.useTheAliCloudChart&&(a=this.getOssUrl(a,360,250,"lfit"));this.advanceImg=$("<img src='"+a+"'/>");this.start=$("<div></div>");this.QuizTopicPanel=new QuizTopicPanel;this.QuizTopicPanel.getQuizTopicPanel().append(this.advanceImg).append(this.start);this.QuizTopicPanel.Animate();this.start.css({background:"url("+uiBaseURL+"quiz.png) no-repeat -366px -20px",position:"absolute",width:"81px",height:"30px",
right:0,left:0,bottom:"35px",margin:"auto"});this.advanceImg.css({"max-width":"360px","max-height":"250px",position:"absolute",top:"20px",right:0,left:0,margin:"auto"});this.start.on("mouseover",function(){this.start.css({background:"url("+uiBaseURL+"quiz.png) no-repeat -366px -59px",cursor:"pointer"})}.bind(this));this.start.on("mouseout",function(){this.start.css("background","url("+uiBaseURL+"quiz.png) no-repeat -366px -20px")}.bind(this))},getOssUrl:function(a,b,c,d){return a=0<a.lastIndexOf("?")?
a+("&x-oss-process=image/resize,m_"+d+",w_"+parseInt(b)+",h_"+parseInt(c)):a+("?x-oss-process=image/resize,m_"+d+",w_"+parseInt(b)+",h_"+parseInt(c))},fixRelativePath:function(a){return a&&"string"===typeof a?1==bookConfig.isFlipPdf?a.startsWith("../")?a:a.startsWith("./")?"."+a:a.isUrl()?a:"../"+a:a:a}});
Class("TopicProgressBar",{create:function(a){this.quizLength=a;this.progressContainer=$("<div></div>");this.progressBar=$("<div></div>");this.progressContainer.append(this.progressBar);this.setCss();this.setProgress(1)},setCss:function(){this.progressContainer.css({position:"absolute",margin:"auto",right:"0",left:"0",bottom:"10px",width:"550px",border:"3px solid white",height:"18px","background-color":"rgb(229,233,236)","border-radius":"10px"});this.progressBar.css({background:"rgba(107,216,254,90)",
"float":"left",height:"18px","text-align":"center","line-height":"2","border-radius":"10px"})},setProgress:function(a){this.progressBar.css("width",100/(this.quizLength+1)*a+"%");this.progressBar.css("width").replace("px","")}});
Class("TopicAnswerResult",{create:function(a,b,c,d){this.quizPanel=a;this.dataRight=d;this.config=b;this.answer=c;this.content=$("<div></div>");this.nextQuestion=$("<div></div>");this.nextPage=$("<div></div>");this.nextText=$("<div>NEXT QUESTION</div>");this.answerOption=$("<span style='color:rgb(0,153,255);font-size:30px;font-weight:bold;font-family:Verdana;position:absolute;top:35px;left:35px'>A:</span>");this.answerResult=$("<span style='color:rgb(0,153,255);font-size:20px;position:absolute;top:35px;left:82px'></span>");
this.JudgeResult=$("<span></span>");this.content.append(this.nextQuestion.append(this.nextPage).append(this.nextText)).append(this.answerOption).append(this.answerResult).append(this.JudgeResult);this.setCss();this.initEvent();this.answerResult.text(this.dataRight);"true"==this.answer.dataRight?this.JudgeResult.text(this.config.rightTxt):this.JudgeResult.text(this.config.wrongTxt)},initEvent:function(){this.nextPage.on("click",this.quizPanel.OnNextPageClick);this.nextText.on("click",this.quizPanel.OnNextPageClick);
this.nextText.on("mouseover",function(){this.nextText.css({cursor:"pointer"})}.bind(this));this.nextPage.on("mouseover",function(){this.nextPage.css({background:"url("+uiBaseURL+"quiz.png) no-repeat -257px -61px",cursor:"pointer"})}.bind(this));this.nextPage.on("mouseout",function(){this.nextPage.css("background","url("+uiBaseURL+"quiz.png) no-repeat -257px -16px")}.bind(this))},setCss:function(){this.content.css({position:"absolute",margin:"auto","margin-top":"43px",left:0,right:0,width:"460px",
height:"280px",border:"3px solid rgb(184, 208, 218)",bottom:"50px",background:"white","border-radius":"14px"});this.nextText.css({color:"rgb(0,153,255)","font-size":"14px","font-weight":"bold",width:"85px",position:"absolute",right:"80px",bottom:"30px","font-family":"Verdana"});this.nextPage.css({background:"url("+uiBaseURL+"quiz.png) no-repeat -257px -16px",position:"absolute",bottom:"30px",right:"30px",width:"36px",height:"36px"});this.JudgeResult.css({position:"absolute",width:"460px","text-align":"center",
bottom:"140px",color:"black","font-family":"Verdana","font-size":"18px"});this.config.alignCss&&(this.content.css(this.config.alignCss),this.answerOption.css({right:"35px",left:"auto"}),this.answerResult.css({right:"82px"}))}});
Class("Onclusion",{create:function(a,b,c,d){this.quizPanel=a;this.mistakeNumber=d;this.config=b;this.rightNumber=c;this.percentageNumber=Math.floor(this.rightNumber/this.quizPanel.quiz.length*100);this.onclusionPanel=$("<div></div>");this.hint=$("<div>You haven't selected an answer,please select one</div>");this.clusion=$("<div>"+this.config.guizEndTxt+"</div>");this.Percentage=$("<div>"+getLanguage("TTActionQuiz_Ration","Your ration is")+" "+this.percentageNumber+"%</div>");this.scorePanel=$("<div></div>");
this.score=$("<div style='color: rgb(0, 152, 255);width: 315px;height: 45px;overflow-x: hidden'></div>");this.isAgain=$("<span>"+getLanguage("TTActionQuiz_PlayAgain","Do you wanna play it again?")+"</span>");this.button=$("<div></div>");this.yesButton=$("<div></div>");this.noButton=$("<div></div>");this.rightSmile=$("<div style='background:url("+uiBaseURL+"quiz.png) no-repeat -5px -14px;position:absolute;width:38px;height:50px'></div>");this.mistakeSmile=$("<div style='background:url("+uiBaseURL+
"quiz.png) no-repeat -5px -74px;position:absolute;width:38px;height:50px'></div>");this.byeBye=$("<div style='background:url("+uiBaseURL+"quiz.png) no-repeat -506px -66px;position:absolute;width:105px;height:20px;left:300px;top:230px'></div>");this.QuizTopicPanel=new QuizTopicPanel;this.QuizTopicPanel.content.append(this.onclusionPanel);0==this.mistakeNumber&&0==this.rightNumber?this.onclusionPanel.append(this.hint):this.onclusionPanel.append(this.clusion);this.onclusionPanel.append(this.Percentage).append(this.isAgain).append(this.scorePanel.append(this.score)).append(this.button.append(this.yesButton).append(this.noButton));
this.setCss();this.initEvent();0<=this.percentageNumber&&25>=this.percentageNumber&&this.score.text(this.config.score[3]);25<this.percentageNumber&&50>=this.percentageNumber&&this.score.text(this.config.score[2]);50<this.percentageNumber&&75>=this.percentageNumber&&this.score.text(this.config.score[1]);75<this.percentageNumber&&100>=this.percentageNumber&&(this.score.text(this.config.score[0]),100==this.percentageNumber&&this.score.css("color","#0098ff"))},initEvent:function(){this.yesButton.on("click",
function(){this.quizPanel.currentIndex=0;this.quizPanel.progressBar.setProgress(1);this.clearAllCount();this.quizPanel.statistics();this.quizPanel.setQuestionURL(this.quizPanel.topicItem[0].QuizTopicPanel.content);this.quizPanel.prePage.hide();this.quizPanel.nextPage.show()}.bind(this));this.noButton.on("click",function(){this.removeAllChild(this.quizPanel.content[0]);this.quizPanel.content.append(this.QuizTopicPanel.content);this.removeAllChild(this.QuizTopicPanel.content[0]);this.quizPanel.content.append(this.rightSmile).append(this.mistakeSmile).append(this.byeBye);
this.rightSmile.animate({left:"210px"},400,"easeOutElastic");this.mistakeSmile.animate({right:"220px"},400,"easeOutElastic");this.quizPanel.hide()}.bind(this));this.yesButton.on("mouseover",function(){this.yesButton.css({background:"url("+uiBaseURL+"quiz.png) no-repeat -71px -59px",cursor:"pointer"})}.bind(this));this.yesButton.on("mouseout",function(){this.yesButton.css("background","url("+uiBaseURL+"quiz.png) no-repeat -71px -20px")}.bind(this));this.noButton.on("mouseover",function(){this.noButton.css({background:"url("+
uiBaseURL+"quiz.png) no-repeat -161px -59px",cursor:"pointer"})}.bind(this));this.noButton.on("mouseout",function(){this.noButton.css("background","url("+uiBaseURL+"quiz.png) no-repeat -161px -20px")}.bind(this))},clearAllCount:function(){for(var a=this.quizPanel.quiz.length,b=0;b<a;b++)this.quizPanel.topicAnswer[b]=null},removeAllChild:function(a){for(;a.hasChildNodes();)a.removeChild(a.firstChild)},setCss:function(){this.rightSmile.css({margin:"auto",bottom:"0px",top:"0px",left:"45px",transform:"scale(3.5)",
"-webkit-transform":"scale(3.5)","-moz-transform":"scale(3.5)","-ms-transform":"scale(3.5)","-o-transform":"scale(3.5)"});this.mistakeSmile.css({margin:"auto",bottom:"0px",top:"0px",right:"50px",transform:"scale(3.5)","-webkit-transform":"scale(3.5)","-moz-transform":"scale(3.5)","-ms-transform":"scale(3.5)","-o-transform":"scale(3.5)"});this.scorePanel.css({position:"absolute",margin:"auto",right:"0px",left:"0px",top:"160px",color:"gray",width:"300px","text-align":"center",height:"45px",overflow:"hidden",
"font-size":"20px"});this.Percentage.css({"font-weight":"bold","font-size":"20px",position:"absolute",margin:"auto",top:"30%",left:"0px",right:"0px",width:"200px",height:"20px"});this.clusion.css({width:"560px","font-size":"24px",color:"#045DD0","text-align":"center","margin-top":"40px"});this.isAgain.css({color:"#00a5ff","font-size":"20px","font-weight":"bold",width:"250px",position:"absolute","text-align":"center",bottom:"90px",right:"0px",left:"0px",margin:"auto"});this.hint.css({width:"385px",
"font-size":"20px","font-weight":"bold",color:"#045DD0","text-align":"center","margin-left":"75px","margin-top":"35px"});this.onclusionPanel.css({position:"absolute","border-radius":"10px",background:_agent_.browser.prefix+"linear-gradient(90deg,#f4f4f5,#FFFFFF)",margin:"auto",bottom:"0px",right:"0px",left:"0px",top:"0px"});this.yesButton.css({width:"81px",height:"30px",cursor:"pointer",position:"absolute",background:"url("+uiBaseURL+"quiz.png) no-repeat -71px -20px"});this.noButton.css({width:"81px",
height:"30px",right:"0px",position:"absolute",cursor:"pointer",background:"url("+uiBaseURL+"quiz.png) no-repeat -161px -20px"});this.button.css({margin:"auto",bottom:"25px",right:"0px",left:"0px",width:"204px",height:"30px",position:"absolute"});"right"==this.config.languageLayout&&(this.isAgain.css({direction:"rtl"}),this.Percentage.css({direction:"rtl"}))}});
Class("QuizPanelMobile",{Package:"PageItem.Popup",create:function(a,b){this._super(a);this.config=b;this.quiz=this.config.action.quiz;this.quiz[0]||(this.quiz=[this.quiz.topic]);this.dialog=$("<div></div>");this.content=$("<div class='container-box'></div>");this.contentMiddle=$("<div></div>");this.contentBottom=$("<div></div>");this.closeButton=$("<div></div>");this.title=$("<div>"+this.config.action.guizTxt+"</div>");this.rightNumber=$("<div>0</div>");this.mistakeNumber=$("<div>0</div>");this.questionContent=
$("<div></div>");this.initQuiz();this.setCss();this.initTransform();this.initEvent();this.setSwipe();this.progressBar=new TopicProgressBarMobile(this.quiz.length,this.currentIndex);this.dialog.append(this.contentMiddle).append(this.contentBottom).append(this.closeButton).append(this.content.append(this.title).append(this.questionContent)).append(this.progressBar.progressContainer);""==this.config.action.guizURL?this.setQuestionURL(this.topicItem[0].questionPanel):(this.advance=new SetAdvanceMobile(this.config.action,
this),this.content.append(this.advance.advanceImg).append(this.advance.start),this.progressBar.progressContainer.hide(),this.advance.start.on("click",function(){this.setQuestionURL(this.topicItem[0].questionPanel);this.progressBar.progressContainer.show();this.advance.advanceImg.remove();this.advance.start.remove()}.bind(this)))},initEvent:function(){this.currentIndex=0;var a=this.topicItem.length;this.OnNextPageClick=function(){if(!(this.currentIndex>a))if(this.currentIndex+=1,this.progressBar.setProgress(this.currentIndex+
1,a+1),this.currentIndex<a)this.setQuestionURL(this.topicItem[this.currentIndex].questionPanel),this.topicItem[this.currentIndex].resetScroll();else{var b=new OnclusionMobile(this,this.config.action,this.rightNumber[0].innerText,this.mistakeNumber[0].innerText);this.setQuestionURL(b.onclusionPanel)}}.bind(this);this.closeButton.on("click",function(){this.hide()}.bind(this));$(window).resize(function(){}.bind(this))},setQuestionURL:function(a){this.questionContent.append(a)},initQuiz:function(){this.topicItem=
[];this.topicAnswer=[];for(var a=0;a<this.quiz.length;a++)"right"==this.config.action.languageLayout&&(this.quiz[a].alignCss={"text-align":"right",direction:"rtl"}),this.topic=new QuestionPanelMobile(this,this.quiz[a],a),this.topicItem.push(this.topic),this.topicAnswer[a]=null},getAnswerFlag:function(){for(var a=[],b=0;b<this.quiz.length;b++)null===this.topicAnswer?a[b]=QAF_UNKNOWN:this.topicAnswer[b]==this.topicItem[b].getRightAnswer()?a[b]=QAF_RIGHT:a[b]=QAF_MISTAKE;return a},flushCount:function(){for(var a=
this.getAnswerFlag(),b=0,c=0,d=0;d<a.length;d++)a[d]==QAF_RIGHT&&b++,a[d]==QAF_MISTAKE&&c++;this.rightNumber[0].innerText=Number(b);this.mistakeNumber[0].innerText=Number(c)},setSwipe:function(){this.currentIndex=0;var a=function(b,c){c=30*windowWidth/1600;if(!(Math.abs(b)<=c)){var d=this.topicItem.length;if(b<-c){if(this.currentIndex>d)return;this.progressBar.setProgress(this.currentIndex+1,d+1);this.currentIndex+=1;this.progressBar.setProgress(this.currentIndex+1,d+1);if(this.currentIndex<d)this.setQuestionURL(this.topicItem[this.currentIndex].questionPanel);
else{var e=new OnclusionMobile(this,this.config.action,this.rightNumber[0].innerText,this.mistakeNumber[0].innerText);this.setQuestionURL(e.onclusionPanel)}}if(b>c){if(0>this.currentIndex)return;--this.currentIndex;this.setQuestionURL(this.topicItem[this.currentIndex].questionPanel);this.progressBar.setProgress(this.currentIndex+1,d+1)}_agent_.browser.mise?event.cancelBubble=!0:event.stopPropagation()}}.bind(this);this.questionContent.speed(a)},show:function(){this._super();this.topicItem[this.currentIndex].resetScroll();
animateOnce(this.dialog,{transform:"translate(0,0)","-webkit-transform":"translate(0,0)","-moz-transform":"translate(0,0)","-o-transform":"translate(0,0)","-ms-transform":"translate(0,0)"},.3,function(){}.bind(this),"","ease")},hide:function(){this.dialog&&animateOnce(this.dialog,{transform:"translate(100%,0)","-webkit-transform":"translate(100%,0)","-moz-transform":"translate(100%,0)","-o-transform":"translate(100%,0)","-ms-transform":"translate(100%,0)"},.3,function(){this.dialog&&this.destroy()}.bind(this),
"","ease")},setCss:function(){this.questionContent.css({position:"absolute","margin-top":"30px",background:"white",width:windowWidth-70+"px",left:"0px",right:"0px",margin:"auto","overflow-x":"hidden",height:windowHeight-150+"px"});this.title.css({position:"relative",margin:"auto",width:windowWidth-50+"px",height:"22px","margin-top":"20px","text-align":"center","font-size":"20px","font-family":"-webkit-pictograph"});this.closeButton.css({background:"url("+uiBaseURL+"quiz.png) no-repeat -69px -100px",
width:"42px",height:"47px","z-index":"100",position:"absolute",right:"0px"});this.contentBottom.css({position:"absolute",border:"1px solid rgba(221,221,221,0.6)",top:"34px",left:"0px",right:"0px","background-color":"rgba(255,255,255,0.6)",width:windowWidth-90+"px",height:"50px",margin:"auto","border-radius":"5px"});this.contentMiddle.css({position:"absolute",border:"1px solid rgba(221,221,221,0.8)",top:"41px",left:"0px",right:"0px","background-color":"rgba(255,255,255,0.8)",width:windowWidth-70+"px",
height:"50px",margin:"auto","border-radius":"5px","z-index":"100"});this.dialog.css({position:"absolute","background-color":"#eeeeee",width:windowWidth+"px",height:windowHeight+"px","z-index":"100"});this.content.css({position:"absolute",border:"1px solid #dddddd",bottom:"50px",left:"0px",right:"0px",margin:"auto","background-color":"#FFFFFF",width:windowWidth-50+"px",height:windowHeight-100+"px","border-radius":"5px","z-index":"100"})},initTransform:function(){this.dialog.css({transform:"translate(100%,0)",
"-webkit-transform":"translate(100%,0)","-moz-transform":"translate(100%,0)","-o-transform":"translate(100%,0)","-ms-transform":"translate(100%,0)"})},onResize:function(){this.hide()}}).extend("PageItemNormalPopup");
Class("QuestionPanelMobile",{create:function(a,b,c){this.config=b;this.index=c;this.quizPanel=a;this.questionPanel=$("<div></div>");this.questionBox=$("<div style='position:relative;height:80px;'></div>");this.question=$("<span style='color:rgb(0,153,255);font-size:18px;font-weight:bold;font-family:Verdana;'>Q:</span>");this.initAnswer();this.questionTitle=$("<span style='color:rgb(0,153,255);font-size:15px;'>"+this.config.title+"</span>");this.questionTitle=$("<span class='stage' style='color:#0066CC;width:"+
(windowWidth-99)+"px;height:70px;overflow:hidden;font-size:16px;position:absolute;top:0;left:25px'><div class='swiper' style='width:"+(windowWidth-109)+"px;position:absolute;top:0;left:0;'>"+this.config.title+"</div></span>");this.initScroll();a=this.fixRelativePath(this.config.media);bookConfig.useTheAliCloudChart&&(a=this.getOssUrl(a,windowWidth-70,220,"lfit"));this.mediaImg=$("<img src='"+a+"' style='display:block;max-width:"+(windowWidth-74)+"px;max-height:220px;margin-top:20px'/>");this.config.media||
this.mediaImg.css({display:"none"});this.questionBox.append(this.question).append(this.questionTitle);this.questionPanel.append(this.questionBox).append(this.mediaImg);this.getRightAnswer();this.addTopicAnswer();this.questionPanel.css({width:windowWidth-69+"px","overflow-x":"hidden",position:"absolute","background-color":"white",height:windowHeight-170+"px"});this.config.alignCss&&(this.question.html(":Q"),this.question.css({position:"absolute",right:"10px"}),this.questionTitle.css({position:"absolute",
right:"35px",top:0,direction:"rtl","text-align":"right"}))},initScroll:function(){this.progress=$("<div class='progress'></div>");this.progressBar=$("<div class='progressBar'></div>");this.progress.append(this.progressBar);this.questionTitle.append(this.progress);this.initScrollCss()},resetScroll:function(){this.questionTitle.scroll({},Direction.top,"win10")},initScrollCss:function(){this.progress.css({background:"#eee",width:"8px",height:"100%",position:"absolute",right:"0",cursor:"pointer"});this.progressBar.css({width:"8px",
background:"rgba(11,11,11,0.55)",position:"absolute",top:"0",cursor:"pointer","border-radius":"4px"})},initAnswer:function(){this.Items=[];for(var a in this.config)a.startsWith("answer")&&this.Items.push(this.config[a])},getRightAnswer:function(){for(var a=0;a<this.Items.length;a++)if("true"==this.Items[a].dataRight)var b=this.Items[a].value;return b},addTopicAnswer:function(){for(var a=0;a<this.Items.length;a++){var b=new TopicAnswerMoblie(this.quizPanel,this.Items[a],this.config,this.getRightAnswer(),
this.index);this.questionPanel.append(b.answerPanel)}},getOssUrl:function(a,b,c,d){return a=0<a.lastIndexOf("?")?a+("&x-oss-process=image/resize,m_"+d+",w_"+parseInt(b)+",h_"+parseInt(c)):a+("?x-oss-process=image/resize,m_"+d+",w_"+parseInt(b)+",h_"+parseInt(c))},fixRelativePath:function(a){return a&&"string"===typeof a?1==bookConfig.isFlipPdf?a.startsWith("../")?a:a.startsWith("./")?"."+a:a.isUrl()?a:"../"+a:a:a}});
Class("TopicAnswerResultMobile",{create:function(a,b,c,d){this.quizPanel=a;this.dataRight=d;this.config=b;this.answer=c;this.container=$("<div></div>");this.content=$("<div></div>");this.nextQuestion=$("<div></div>");this.nextPage=$("<div></div>");this.nextText=$("<div>NEXT QUESTION</div>");this.answerOption=$("<span style='color:rgb(0,153,255);font-size:30px;font-weight:bold;font-family:Verdana;position:absolute;top:35px;left:35px'>A:</span>");this.answerResult=$("<span style='color:rgb(0,153,255);font-size:20px;position:absolute;top:35px;left:82px'></span>");
this.JudgeResult=$("<span></span>");this.content.append(this.nextQuestion.append(this.nextPage).append(this.nextText)).append(this.answerOption).append(this.answerResult).append(this.JudgeResult);this.container.append(this.content);this.setCss();this.initEvent();this.answerResult.text(this.dataRight);"true"==this.answer.dataRight?this.JudgeResult.text(this.config.rightTxt):(this.JudgeResult.text(this.config.wrongTxt),this.JudgeResult.css("color","red"))},initEvent:function(){this.nextPage.on("click",
this.quizPanel.OnNextPageClick);this.nextPage.on("click",function(){this.container.remove()}.bind(this));this.nextText.on("click",this.quizPanel.OnNextPageClick);this.nextText.on("click",function(){this.container.remove()}.bind(this))},setCss:function(){this.container.css({position:"absolute",margin:"auto",top:"0",left:0,right:0,bottom:"0",width:"100%",height:"100%",background:"transparent","z-index":1});this.content.css({position:"absolute",margin:"auto","margin-top":"43px",left:0,right:0,width:windowWidth-
70+"px",height:windowHeight-200+"px",border:"1px solid #dddddd",bottom:"50px",background:"white","border-radius":"4px","z-index":100});this.nextText.css({color:"rgb(0,153,255)","font-size":"14px","font-weight":"bold",width:"85px",position:"absolute",right:"72px",bottom:"30px","font-family":"Verdana"});this.nextPage.css({background:"url("+uiBaseURL+"quiz.png) no-repeat -257px -16px",position:"absolute",bottom:"30px",right:"30px",width:"36px",height:"36px"});this.JudgeResult.css({position:"absolute",
width:windowWidth-70+"px","text-align":"center",bottom:"140px",color:"green","font-family":"Verdana","font-size":"18px"});this.config.alignCss&&(this.content.css(this.config.alignCss),this.answerOption.css({right:"35px",left:"auto"}),this.answerResult.css({right:"82px",left:"auto"}))}});
Class("TopicAnswerMoblie",{create:function(a,b,c,d,e){this.quizPanel=a;this.config=c;this.answer=b;this.index=e;this.dataRight=d;this.answerPanel=$("<div></div>");this.checkBox=$("<div><div>");this.answerValue=$("<div>"+this.answer.value+"</div>");this.answerPanel.append(this.checkBox);this.answerPanel.append(this.answerValue);this.initEvent();this.setCss()},initEvent:function(){this.checkBox.on("click",function(){this.quizPanel.topicAnswer[this.index]=this.answer.value;this.quizPanel.flushCount();
this.answerResult=new TopicAnswerResultMobile(this.quizPanel,this.config,this.answer,this.dataRight);this.quizPanel.content.append(this.answerResult.container)}.bind(this))},setCss:function(){this.answerValue.css({color:"#0f5177",position:"relative","margin-left":"30px","font-size":"15px",color:"#0f5177",width:"165px","font-family":"Verdana"});this.answerPanel.css({"margin-top":"20px",position:"relative"});this.checkBox.css({top:"3px",position:"absolute",background:"url("+uiBaseURL+"quiz.png) no-repeat -465px -67px",
width:"20px",height:"20px"});this.config.alignCss&&(this.answerPanel.css(this.config.alignCss),this.answerValue.css({"margin-left":"0","margin-right":"30px"}))}});
Class("OnclusionMobile",{create:function(a,b,c,d){this.quizPanel=a;this.config=b;this.rightNumber=c;this.mistakeNumber=d;this.percentageNumber=Math.floor(this.rightNumber/this.quizPanel.quiz.length*100);this.onclusionPanel=$("<div></div>");this.hint=$("<div>You haven't selected an answer,please select one</div>");this.clusion=$("<div>"+this.config.guizEndTxt+"</div>");this.Percentage=$("<div>"+getLanguage("TTActionQuiz_Ration","Your ration is")+" "+this.percentageNumber+"%</div>");this.scorePanel=
$("<div></div>");this.score=$("<div style='color:#DCAB1B;width: "+(windowWidth-70)+"px;height: 45px;overflow-x: hidden'></div>");this.isAgain=$("<span>"+getLanguage("TTActionQuiz_PlayAgain","Do you wanna play it again?")+"</span>");this.button=$("<div></div>");this.yesButton=$("<div></div>");this.noButton=$("<div></div>");0==this.mistakeNumber&&0==this.rightNumber?this.onclusionPanel.append(this.hint):this.onclusionPanel.append(this.clusion);this.onclusionPanel.append(this.Percentage).append(this.isAgain).append(this.scorePanel.append(this.score)).append(this.button.append(this.yesButton).append(this.noButton));
this.setCss();this.initEvent();0<=this.percentageNumber&&25>=this.percentageNumber&&this.score.text(this.config.score[3]);25<this.percentageNumber&&50>=this.percentageNumber&&this.score.text(this.config.score[2]);50<this.percentageNumber&&75>=this.percentageNumber&&this.score.text(this.config.score[1]);75<this.percentageNumber&&100>=this.percentageNumber&&(this.score.text(this.config.score[0]),100==this.percentageNumber&&this.score.css("color","#0098ff"))},initEvent:function(){this.yesButton.on("click",
function(){this.quizPanel.currentIndex=0;this.clearFlushCount();this.quizPanel.flushCount();this.quizPanel.progressBar.setProgress(1,this.quizPanel.quiz.length+1);this.quizPanel.setQuestionURL(this.quizPanel.topicItem[0].questionPanel)}.bind(this));this.noButton.on("click",function(){this.quizPanel.hide()}.bind(this))},clearFlushCount:function(){for(var a=this.quizPanel.quiz.length,b=0;b<a;b++)this.quizPanel.topicAnswer[b]=null},setCss:function(){var a=(windowHeight-100-20)/2;this.scorePanel.css({position:"absolute",
margin:"auto",right:"0px",left:"0px",top:"160px",color:"gray",width:windowWidth-70+"px","text-align":"center",height:"45px",overflow:"hidden","font-size":"15px"});this.Percentage.css({"font-weight":"bold","font-size":"15px",position:"absolute",margin:"auto",bottom:a+"px",left:"0px",right:"0px",width:windowWidth-70+"px","text-align":"center",height:"20px"});this.clusion.css({width:windowWidth-70+"px","font-size":"17px",color:"#045DD0","text-align":"center","margin-top":"40px"});this.isAgain.css({color:"#00a5ff",
"font-size":"15px","font-weight":"bold",width:"250px",position:"absolute","text-align":"center",bottom:a-40+"px",right:"0px",left:"0px",margin:"auto"});this.hint.css({width:"250px","font-size":"15px","font-weight":"bold",color:"#045DD0","text-align":"center","margin-top":"35px"});this.onclusionPanel.css({position:"absolute",width:windowWidth-70+"px","border-radius":"10px",background:"white",margin:"auto",bottom:"0px",right:"0px",left:"0px",top:"0px"});this.yesButton.css({width:"81px",height:"30px",
position:"absolute",background:"url("+uiBaseURL+"quiz.png) no-repeat -71px -20px"});this.noButton.css({width:"81px",height:"30px",right:"0px",position:"absolute",background:"url("+uiBaseURL+"quiz.png) no-repeat -161px -20px"});this.button.css({margin:"auto",bottom:a-95+"px",right:"0px",left:"0px",width:"204px",height:"30px",position:"absolute"});"right"==this.config.languageLayout&&(this.isAgain.css({direction:"rtl"}),this.Percentage.css({direction:"rtl"}))}});
Class("SetAdvanceMobile",{create:function(a){this.config=a;a=this.fixRelativePath(this.config.guizURL);bookConfig.useTheAliCloudChart&&(a=this.getOssUrl(a,windowWidth-80,200,"lfit"));this.advanceImg=$("<img src='"+a+"'/>");this.start=$("<div></div>");this.start.css({background:"url("+uiBaseURL+"quiz.png) no-repeat -366px -20px",position:"absolute",width:"81px",height:"30px",right:0,left:0,bottom:"35px",margin:"auto"});this.advanceImg.css({"max-width":windowWidth-80+"px","max-height":"200px",position:"absolute",
top:0,right:0,left:0,bottom:0,margin:"auto"})},getOssUrl:function(a,b,c,d){return a=0<a.lastIndexOf("?")?a+("&x-oss-process=image/resize,m_"+d+",w_"+parseInt(b)+",h_"+parseInt(c)):a+("?x-oss-process=image/resize,m_"+d+",w_"+parseInt(b)+",h_"+parseInt(c))},fixRelativePath:function(a){return a&&"string"===typeof a?1==bookConfig.isFlipPdf?a.startsWith("../")?a:a.startsWith("./")?"."+a:a.isUrl()?a:"../"+a:a:a}});
Class("TopicProgressBarMobile",{create:function(a,b){this.quizLength=a;this.currentIndex=b;this.progressContainer=$("<div></div>");this.progressBar=$("<div></div>");this.progressContainer.append(this.progressBar);this.setCss();this.setProgress(1,this.quizLength+1)},setCss:function(){this.progressContainer.css({position:"absolute",margin:"auto",right:"0",left:"0",bottom:"10px",width:windowWidth-50+"px",height:"30px","background-color":"white","border-radius":"3px"});this.progressBar.css({height:"30px",
"padding-top":"4px","text-align":"center","border-radius":"10px","font-size":"20px"})},setProgress:function(a,b){if(a>b)return a-1;this.progressBar.text(a+"/"+b)}});
Class("ShowInformation",{Package:"PageItem.Popup",create:function(a,b){this._super(a);this.config=b;this.initConfig();this.initHtml();this.alignCss&&this.textTitle.css(this.alignCss);a=(new TextFormatAnalyzer(this.config.action.bodyText)).getHTML(this.alignCss);a.addClass("swiper");a.css({position:"absolute"});this.text.html(a);this.initCss();this.initScroll()},initScroll:function(){this.text.addClass("stage");this.progress=$("<div class='progress'></div>");this.progressBar=$("<div class='progressBar'></div>");
this.progress.append(this.progressBar);this.text.append(this.progress);this.initScrollCss()},initScrollCss:function(){this.progress.css({background:"#eee",width:"8px",height:"100%",position:"absolute",right:"0",cursor:"pointer"});this.progressBar.css({width:"8px",background:"rgba(11,11,11,0.55)",position:"absolute",top:"0",cursor:"pointer","border-radius":"4px"})},initConfig:function(){this.width=parseInt(this.config.action.width);this.height=parseInt(this.config.action.height);this.bgColor1=Color(this.config.action.bgColor1).toString();
this.bgColor2=Color(this.config.action.bgColor2).toString();this.buttonColor=Color(this.config.action.buttonColor).toString();this.buttonBgColor=Color(this.config.action.buttonBgColor).toString();this.bodyColor=Color(this.config.action.bodyColor).toString();this.titleAlign=this.config.action.titleAlign;this.titleColor=Color(this.config.action.titleColor).toString();this.link=this.config.action.link;this.linkLength=this.config.action.link.length;this.titleSize=this.config.action.titleSize;this.titleFont=
this.config.action.titleFont;"right"==this.config.action.languageLayout&&(this.alignCss={"text-align":"right",direction:"rtl"});var a=new TextFormatAnalyzer(this.config.action.bodyText);if(null==this.config.action.bodyFont){var b=a.getFontFamily().split(",");this.config.action.bodyFont=b[0];this.config.action.bodySize=a.getFontSize();this.config.action.bodyColor=a.getFontColor()}this.image=[this.fixRelativePath(this.config.action.imgURL)];bookConfig.useTheAliCloudChart&&(this.image[0]=this.getOssUrl(this.image[0],
160,290,"lfit"))},initHtml:function(){this.contentBox=$('<div id="cbox"></div>');this.enterContain=$("<div id=\"enterContain\" style='overflow:hidden;'></div>");this.closeButton=$('<div id="closebutton"></div>');this.textTitle=$("<div></div>");this.text=$("<div class='text'></div>");this.content=$("<div></div>");this.dialog=$('<div id="conb"></div>');this.imgBox=$("<div></div>");this.img=$("<img>");"http://"==this.link.substring(this.linkLength-7,this.linkLength)?this.button=$("<a href='javascript:void(0);' style='display:block' target='_Blank'>helfjawfjf</a>"):
this.button=$("<a href = '"+this.link+"' target='_Blank' font-family='"+this.config.action.bodyFont+"'></a>");this.contentBox.append(this.textTitle);this.content.append(this.enterContain);this.enterContain.append(this.contentBox);this.dialog.append(this.content);this.dialog.append(this.closeButton);this.textTitle.html(this.config.action.titleText.overflow(32));this.button.html(this.config.action.buttonName);this.config.action.buttonName||this.button.css({display:"none"});this.contentBox.append(this.text);
this.contentBox.append(this.button)},hasUrl:function(){var a=this.config.action.imgURL;return"null"!=a&&"./null"!=a&&"../null"!=a},initCss:function(){this.textTitle.css({"font-family":this.titleFont,"font-size":this.titleSize+"px"});this.hasOverflow(this.config.action.titleText,32)&&this.textTitle.attr("title",this.config.action.titleText);this.hasUrl()&&this.img.attr({src:this.image[0],align:"center"});this.setPcCss();this.hasUrl()&&(this.contentBox.css({position:"absolute",right:"25px","overflow-x":"hidden",
width:this.width-50+"px",height:this.height+"px"}),this.textTitle.css({"text-align":this.titleAlign,"font-size":this.config.action.titleSize,color:this.titleColor,"font-family":this.config.action.titleFont,"z-index":"2500",width:this.width-50+"px","margin-top":"10px"}),this.enterContain.css({width:this.width+"px",height:this.height+"px"}),this.text.css({width:this.width-50+"px","max-height":this.height-160+"px","z-index":"2500","margin-top":"10px",overflow:"hidden"}),this.text.find(".swiper").css({width:this.width-
62+"px"}));1==parseBool(this.config.action.imgBool)&&this.hasUrl()?(this.content.append(this.imgBox),this.imgBox.append(this.img),this.imgBox.css({width:"100%",height:"100%",position:"absolute","z-index":"3000","max-width":"160px","max-height":"290px",margin:"auto",top:"15px",right:"30px"}),this.enterContain.css({width:this.width+"px",height:this.height+"px"}),this.contentBox.css({position:"absolute",left:"40px",top:"25px","overflow-x":"hidden",width:this.width+"px",height:this.height+"px"}),this.setText(),
this.button.css({bottom:"0",left:"0"}),this.alignCss&&this.button.css({right:"0",left:"auto"})):0==parseBool(this.config.action.imgBool)&&this.hasUrl()&&(this.content.append(this.imgBox),this.imgBox.append(this.img),this.imgBox.css({width:"100%",height:"100%",position:"absolute","z-index":"3000","max-width":"160px","max-height":"290px",top:"15px",margin:"auto",left:"30px"}),this.enterContain.css({width:this.width+"px",height:this.height+"px"}),this.contentBox.css({position:"absolute",right:"40px",
top:"25px",width:this.width-240+"px","overflow-x":"hidden",height:this.height-10+"px"}),this.button.css({bottom:"0",left:"0"}),this.alignCss&&this.button.css({right:"0",left:"auto"}),this.setText());this.closeButton.asButton();this.closeButton.bind(_event._click,function(){this.hide()}.bind(this))},hasOverflow:function(a,b){var c=2;/[^\x00-\xff]/.test(a)&&(b=Math.floor(b/2),c=Math.floor(c/2));return a.length-b>c?!0:!1},setPcCss:function(){this.closeButton.css({width:"100%",height:"100%",position:"absolute",
"background-image":"url("+uiBaseURL+"close_form.png)","background-repeat":"no-repeat",cursor:"pointer","max-width":"32px","max-height":"32px","z-index":"3000",top:0,right:"6px"});this.button.css({position:"absolute",color:this.buttonColor,"border-radius":"5px",border:"1px solid #333",padding:"2px 4px","font-size":"14px","background-color":this.buttonBgColor,"text-decoration":"none","z-index":"2500",bottom:"15px",left:"15px"});this.img.css({"max-width":"160px","max-height":"290px",position:"absolute",
margin:"auto",left:"0",top:"0",bottom:"0",right:"0"});this.dialog.css({width:this.width+30+"px",height:this.height+30+"px",position:"absolute",margin:"auto",left:"0",top:"0",bottom:"0",right:"0","z-index":"3000"});this.enterContain.css({width:this.width+"px",height:this.height+"px"});this.content.css({"border-radius":"6px",width:"100%",height:"100%",position:"absolute",margin:"auto",left:"0",top:"0",bottom:"0",right:"0",padding:"15px","max-width":this.width,"max-height":this.height,"z-index":"1900",
"background-image":_agent_.browser.prefix+"repeating-linear-gradient("+this.config.action.bgAngle+"deg, "+this.bgColor2+", "+this.bgColor1+")"});this.text.css({position:"relative","font-size":this.config.action.bodySize+"px",color:this.bodyColor,"font-family":this.config.action.bodyFont,width:this.width+"px",height:this.height-140+"px",padding:"0px",outline:"medium",border:"0px","padding-right":"0","line-height":"2.0",background:"rgba(255,255,255,0)","z-index":"2500",overflow:"hidden"});this.text.find(".swiper").css({width:this.width-
15+"px"});this.textTitle.css({margin:"10px 0","font-weight":"bold","font-size":this.config.action.titleSize,color:this.titleColor,"text-align":this.titleAlign,"font-family":this.config.action.titleFont})},setText:function(){this.textTitle.css({"font-weight":"bold","font-size":this.config.action.titleSize,color:this.titleColor,"text-align":this.titleAlign,"font-family":this.config.action.titleFont,"z-index":"2500",width:this.width-240+"px",overflow:"hidden","text-overflow":"ellipsis"});this.text.css({"font-size":this.config.action.bodySize+
"px",color:this.bodyColor,"font-family":this.config.action.bodyFont,width:this.width-240+"px",height:this.height-165+"px",padding:"0px",outline:"medium",border:"0px","padding-right":"0","margin-top":"20px","line-height":"2.0",background:"rgba(255,255,255,0)","z-index":"2500",overflow:"hidden"});this.text.find(".swiper").css({width:this.width-250+"px"})},show:function(){this._super();this.hasUrl()?this.text.css({height:this.height-this.textTitle.height()-75+"px"}):this.text.css({height:this.height-
this.textTitle.height()-50+"px"});this.text.scroll({},Direction.top,"win10");this.modalBackground.css({display:"block"})},hide:function(){this._super.delay(this,500);animateOnce(this.dialog,{transform:"scale(0)","-webkit-transform":"scale(0)","-moz-transform":"scale(0)","-o-transform":"scale(0)","-ms-transform":"scale(0)"},.5,function(){this.modalBackground.empty();this.modalBackground.remove()}.bind(this),"","ease")}}).extend("PageItemModalPopup");
Class("ShowInformationMobile",{Package:"PageItem.Popup",create:function(a,b){this._super(a);this.windowWidth=windowWidth;this.windowHeight=windowHeight;this.config=b;this.initConfig();this.initHtml();this.imgUrl=this.fixRelativePath(this.config.action.imgURL);this.setPhoneCss();this.closeButton.bind("click",function(){this.hide()}.bind(this));a=this.config.action.imgURL?this.config.action.imgURL.toLowerCase().trim():"";"null"!=a&&""!=a&&"./null"!=a||this.img.remove();this.dialog.css({transform:"translate(100%,0)",
"-webkit-transform":"translate(100%,0)","-moz-transform":"translate(100%,0)","-o-transform":"translate(100%,0)","-ms-transform":"translate(100%,0)"})},initConfig:function(){this.bgColor1=Color(this.config.action.bgColor1).toString();this.bgColor2=Color(this.config.action.bgColor2).toString();this.buttonColor=Color(this.config.action.buttonColor).toString();this.buttonBgColor=Color(this.config.action.buttonBgColor).toString();this.fontColor=Color(this.config.action.titleColor).toString();this.bodyColor=
Color(this.config.action.bodyColor).toString();this.titleBgColor=this.config.action.titleBgColor?Color(this.config.action.titleBgColor).toString():"transparent";this.titleSize=this.config.action.titleSize;this.titleFont=this.config.action.titleFont;"right"==this.config.action.languageLayout&&(this.alignCss={"text-align":"right",direction:"rtl"});var a=new TextFormatAnalyzer(this.config.action.bodyText);if(null==this.config.action.bodyFont){var b=a.getFontFamily().split(",");this.config.action.bodyFont=
b[0];this.config.action.bodySize=a.getFontSize();this.config.action.bodyColor=a.getFontColor()}},initHtml:function(){this.link=this.config.action.link;this.linkLength=this.config.action.link.length;this.closeButton=$('<div id="closebutton"></div>');this.textTitle=$("<div></div>");this.text=$("<div></div>");this.content=$("<div></div>");this.dialog=$('<div id="conb"></div>');this.title=$("<div></div>");this.img=$("<img>");this.foot=$('<div style="width:100%;height:70px;position:relative;"></div>');
"http://"==this.link.substring(this.linkLength-7,this.linkLength)?this.button=$("<a href='javascript:void(0);' target='_Blank'></a>"):this.button=$("<a href = '"+this.link+"' target='_Blank' font-family='"+this.config.action.bodyFont+"'></a>");this.foot.append(this.button);this.textTitle.html(this.config.action.titleText);this.textTitle.text(this.textTitle.text());this.button.html(this.config.action.buttonName);this.dialog.append(this.title);this.title.append(this.closeButton);this.title.append(this.textTitle);
this.dialog.append(this.content);this.content.append(this.img);this.content.append(this.text);var a=(new TextFormatAnalyzer(this.config.action.bodyText)).getHTML(this.alignCss);this.text.html(a);this.content.append(this.foot)},setPhoneCss:function(){this.title.css({"font-family":this.titleFont,"font-size":this.titleSize+"px",position:"relative",width:"100%","background-color":"mintcream",border:"#CCCCCC 0.5px solid"});"null"!=this.config.action.imgURL&&"../null"!=this.config.action.imgURL&&(bookConfig.useTheAliCloudChart&&
(this.imgUrl=this.getOssUrl(this.imgUrl,windowWidth,200,"lfit")),this.img.attr({src:this.imgUrl,align:"center"}));this.button.css({position:"absolute",color:this.buttonColor,"padding-left":"8px","padding-right":"8px","background-color":this.buttonBgColor,"text-decoration":"none","z-index":"2500",right:"30px","border-radius":"6px",bottom:"30px"});this.img.css({position:"relative","max-width":"100%","max-height":"200px",margin:"15px auto",display:"block"});this.dialog.css({position:"absolute",width:"100%",
height:"100%","z-index":"3000","background-image":_agent_.browser.prefix+"repeating-linear-gradient("+this.config.action.bgAngle+"deg, "+this.bgColor2+","+this.bgColor1+")"});this.content.css({width:this.windowWidth+"px","overflow-x":"hidden",height:this.windowHeight-(this.textTitle.height()||55)+"px"});this.textTitle.css({background:this.titleBgColor,position:"relative",padding:"0 30px",margin:"auto",color:this.fontColor,"font-family":this.config.action.titleFont,"vertical-align":"middle","line-height":"1.8",
left:"0",top:"0",bottom:"0",right:"0","text-align":"center"});"right"==this.config.action.languageLayout&&this.textTitle.css({direction:"rtl"});this.text.css({width:this.windowWidth-30+"px","font-size":this.config.action.bodySize+"px",color:this.bodyColor,"font-family":this.config.action.bodyFont,"overflow-y":"hidden","margin-top":"15px","padding-left":"15px","line-height":"2.0","text-indent":"0"});this.closeButton.css({position:"absolute","z-index":"1",margin:"auto","background-image":"url("+uiBaseURL+
"background_prev.png)","background-repeat":"no-repeat",cursor:"pointer",width:"20px",height:"21px",left:"8px",bottom:"0",top:"0"})},onResize:function(a,b){this.windowWidth=a;this.windowHeight=b;this.dialog&&this.setPhoneCss()},show:function(){this.visible||(this._super(),this.content.css({height:this.windowHeight-this.textTitle.height()+"px"}),this.content.css({height:this.windowHeight-(this.textTitle.height()||55)+"px"}),function(){animateOnce(this.dialog,{transform:"translate(0,0)","-webkit-transform":"translate(0,0)",
"-moz-transform":"translate(0,0)","-o-transform":"translate(0,0)","-ms-transform":"translate(0,0)"},.3,function(){},"","ease")}.delay(this,100))},hide:function(){this.visible&&animateOnce(this.dialog,{transform:"translate(100%,0)","-webkit-transform":"translate(100%,0)","-moz-transform":"translate(100%,0)","-o-transform":"translate(100%,0)","-ms-transform":"translate(100%,0)"},.3,function(){this.visible=!1;this.destroy()}.bind(this),"","ease")}}).extend("PageItemNormalPopup");
Class("WindowHtml",{Package:"PageItem.Popup",create:function(a,b){this._super(a);this.parent=a;this.config=b;this.frameWidth=parseInt(this.config.windowWidth);this.frameHeight=parseInt(this.config.windowHeight);a=this.config.windowURL;if(a.endsWith(".doc")||a.endsWith(".ppt"))a=this.fixRelativePath(a);this.dialog=$("<div name='frame_border'></div>");this.title=$("<div></div>");this.config.caption&&this.title.html(this.config.caption);this.htmlFrame=$("<iframe class='flip-action' frameborder=0 src='"+
this.getUrl(a)+"' width='"+this.frameWidth+" ' height='100% frameborder='0' ></iframe>");this.closeButton=$("<img src='"+uiBaseURL+"close_form.png'/>");this.dialog.append(this.closeButton).append(this.title);this.dialog.append(this.htmlFrame);this.setCss();this.initEvent();this.onResize();this.resizeTimer=this.onResize.interval(this,500);this.visible=!0;this.show()},getUrl:function(a){if(a)return a=getRealURL(a)},destroy:function(){this._super();this.visible&&(this.visible=!1,this.htmlFrame.attr("src",
""),this.resizeTimer&&this.resizeTimer.stop())},initEvent:function(){this.modalBackground.bind(_event._down,function(a){this.hide();a.stopPropagation()}.bind(this));this.closeButton.asButton();this.closeButton.bind(_event._end,function(a){this.hide();a.stopPropagation()}.bind(this));this.dialog.bind(_event._down,function(a){a.stopPropagation();return!1}.bind(this))},setCss:function(){this.dialog.css({position:"absolute","z-index":"1001",scrolling:"no","background-color":"#F0F0F0","border-radius":"3px",
margin:"auto",width:this.frameWidth+"px",height:this.frameHeight+"px","-webkit-overflow-scrolling":"touch",overflow:"auto",left:"0",top:"0",bottom:"0",right:"0"});this.htmlFrame.css({"background-color":"#F0F0F0",position:"relative","margin-left":"5px","margin-top":"32px"});this.closeButton.css({position:"absolute","z-index":"1",width:"32px",height:"32px",cursor:"pointer",right:"5px",top:"0px"});this.title.css({position:"absolute",left:"5px",top:"5px","font-size":"16px"});"right"==this.config.languageLayout&&
(this.title.css({left:"auto",right:"5px","text-align":"right",direction:"rtl"}),this.closeButton.css({left:"5px",right:"auto"}))},onResize:function(){if(this.windowWidth!=windowWidth||this.windowHeight!=windowHeight){this.windowWidth=windowWidth;this.windowHeight=windowHeight;var a=windowWidth-10,b=windowHeight-10;isPhone()||(a=Math.min(this.frameWidth+10,a),b=Math.min(this.frameHeight+37,b));this.dialog.css({width:a+"px",height:b+"px"});b-=37;this.htmlFrame.attr("width",a-10+"px");this.htmlFrame.attr("height",
b+"px")}}}).extend("PageItemModalPopup");
Class("SwfSlide",{Package:"PageItem.Popup",create:function(a,b,c,d){this._super(a);b&&b.action&&(this.focus=!0,this.config=b,this.action=b.action,"string"==typeof this.action.swfURL&&""!=this.action.swfURL&&null!=this.action.swfURL&&void 0!=this.action.swfURL&&(this.action.swfURL=this.fixRelativePath(this.action.swfURL)),this.parent=a,this.elemConfig=b.elemConfig,this.element=this.elemConfig.element,"IMG"==this.element[0].tagName.toUpperCase()&&(this.element=this.element.panent()),this.windowWidth=
c,this.windowHeight=d,this.pageWidth=this.elemConfig.parentWidth,this.pageHeight=this.elemConfig.parentHeight,this.imgWidth=this.action.targetWidth,this.imgHeight=this.action.targetHeight,this.height=this.width=0,this.type=this.action.startType,this.initHtml(),this.imgLoad(),this.getPosition(),this.initEvent(),this.initCss())},initHtml:function(){this.dialog=$("<div style='display:none;opacity:0;'></div>");this.box=$("<div id='box'></div>");this.close=$("<img class='closeImg'/>");this.background=
$("<div class='BG'></div>");"SWF"==this.action.targetType&&(this.img=$("<img src='"+this.action.swfURL+"' />"),this.box.append(this.img));if("Text"==this.action.targetType){var a=new TextFormatAnalyzer(this.action.targetText);this.fontSize=a.getMinFontSize();this.action.languageLayout&&(this.alignCss={"text-align":"right",direction:"rtl"});this.text=a.getHTML(this.alignCss);this.box.append(this.text)}this.dialog.append(this.box);this.dialog.append(this.close);this.parent.append(this.dialog)},onResize:function(){var a=
this.elemConfig.elementParent.offset();this.elemConfig.offsetX=a.left;this.elemConfig.offsetY=a.top;this.pageWidth=this.elemConfig.elementParent.width();this.pageHeight=this.elemConfig.elementParent.height();this.sideWidth=BookInfo.getBook().getPageWidth();this.sideHeight=BookInfo.getBook().getPageHeight();this.getAttribute();this.getPosition();this.initCss();this.visible&&(this.dialog.css({opacity:0}),this.setPosition(this.startPosition))},imgLoad:function(){if("SWF"==this.action.targetType)this.img.on("load",
function(){this.onResize();this.isLoaded=!0}.bind(this));else this.onResize()},getAttribute:function(){if("Text"==this.action.targetType)this.width=120,this.height=200;else{this.width=this.elemConfig.parentWidth;this.height=this.elemConfig.parentHeight;var a=this.img[0].naturalWidth,b=this.img[0].naturalHeight;this.imgWidth=a;this.imgHeight=b;3==this.action.windowScale?(this.width=parseInt(this.action.windowWidth),this.height=parseInt(this.action.windowHeight),this.imgWidth=parseInt(this.action.targetWidth),
this.imgHeight=parseInt(this.action.targetHeight)):1==this.action.windowScale?(this.width=a>this.pageWidth?this.pageWidth/3*2:a,this.height=b>this.pageHeight?this.pageHeight/4*3:b):2==this.action.windowScale&&(3!=this.action.targetScale?(this.width=a,this.height=b,this.imgWidth=a,this.imgHeight=b):(this.width=parseInt(this.action.targetWidth),this.height=parseInt(this.action.targetHeight),this.imgWidth=parseInt(this.action.targetWidth),this.imgHeight=parseInt(this.action.targetHeight)));1==this.action.targetScale?
(a>b?(this.imgWidth=this.width,this.imgHeight=this.imgWidth/a*b):(this.imgHeight=this.height,this.imgWidth=this.imgHeight/b*a),1==this.action.windowScale&&(this.width=this.imgWidth>this.pageWidth?this.pageWidth/3*2:this.imgWidth,this.height=this.imgHeight>this.pageHeight?this.pageHeight/4*3:this.imgHeight)):4==this.action.targetScale?(this.imgWidth=this.width,this.imgHeight=this.height,1==this.action.windowScale&&(this.width=this.imgWidth>this.pageWidth?this.pageWidth/3*2:this.imgWidth,this.height=
this.imgHeight>this.pageHeight?this.pageHeight/4*3:this.imgHeight)):5==this.action.targetScale&&(a>b?(this.imgHeight=this.height,this.imgWidth=this.imgHeight/b*a):this.imgHeight=this.imgWidth/a*b,1==this.action.windowScale&&(this.width=this.imgWidth>this.pageWidth?this.pageWidth/3*2:this.imgWidth,this.height=this.imgHeight>this.pageHeight?this.pageHeight/4*3:this.imgHeight))}},initCss:function(){"SWF"==this.action.targetType&&(0==this.imgWidth||0==this.imgHeight?this.dialog.css({display:"none"}):
this.dialog.css({display:"block"}));"Text"==this.action.targetType&&(this.text?this.dialog.css({display:"block"}):this.dialog.css({display:"none"}));this.close.css({position:"absolute",top:"-20px",right:"-20px",width:"20px",height:"20px","border-radius":"50%",background:"#111",cursor:"pointer",display:"none"});form_icons&&form_icons.close?this.close.attr("src","data:image/png;base64,"+form_icons.close):this.close.attr("src",uiBaseURL+"close.png");"Text"==this.action.targetType&&this.textCss();"SWF"==
this.action.targetType&&this.imgCss();"left"==this.type||"right"==this.type?(this.dialog.css({top:this.top+"px"}),this.dialog.css("left",this.startPosition+"px").css("opacity","0")):(this.dialog.css("left",this.left+"px"),this.dialog.css(this.type,this.startPosition+"px").css("opacity","0"));"true"==this.action.winIsAlphaBoolean&&this.dialog.css({background:"rgba(255,255,255,0.8)",border:"none"});("BtnClick"==this.action.outType||isPhone()||isPad())&&this.close.css({display:"block"});(isPad()||isPhone())&&
this.close.css({top:"-20px",right:"0px"})},textCss:function(){this.box.css({position:"relative",width:this.width-20+"px",height:this.height-20+"px",overflow:"hidden","overflow-y":"auto"});this.dialog.css({position:"absolute",width:this.width-20+"px",height:this.height-20+"px",background:"rgba(255,255,255,0.8)","z-index":"1001",border:"10px solid rgba(255,255,255,0)"});if("1"==this.action.windowScale){var a=this.pageHeight-this.pageHeight*this.config.y-20;this.dialog.css({height:"auto","max-height":a+
"px"});this.box.css({height:"auto","max-height":a+"px"})}else"2"==this.action.windowScale?(this.box.css({width:"100px",height:"auto"}),this.dialog.css({position:"absolute",height:"auto"})):"3"==this.action.windowScale&&("0"!=this.action.windowWidth&&"0"!=this.action.windowHeight||this.dialog.css({display:"none"}),this.dialog.css({width:this.action.windowWidth-20+"px",height:this.action.windowHeight-20+"px"}),this.box.css({width:this.action.windowWidth-20+"px",height:this.action.windowHeight-20+"px"}))},
imgCss:function(){this.img.css({position:"absolute",width:this.imgWidth-20+"px",height:this.imgHeight-20+"px"});this.box.css({position:"absolute",width:this.width-20+"px",height:this.height-20+"px",overflow:"hidden"});this.dialog.css({position:"absolute",width:this.width-20+"px",height:this.height-20+"px",background:"rgba(255,255,255,0.8)","z-index":"1001",border:"10px solid rgba(255,255,255,0)"})},getPosition:function(){"left"==this.type?(this.startPosition=this.elemConfig.offsetX-this.width,this.endPosition=
this.elemConfig.offsetX):"right"==this.type?(this.startPosition=this.elemConfig.parentWidth+this.elemConfig.offsetX,this.endPosition=this.elemConfig.offsetX+this.config.x*this.elemConfig.parentWidth,this.config.x*this.elemConfig.parentWidth+this.width>this.elemConfig.parentWidth+this.elemConfig.offsetX-this.width&&(this.endPosition=this.elemConfig.parentWidth+this.elemConfig.offsetX-this.width),this.width>this.pageWidth&&(this.startPosition=this.windowWidth-this.width-this.elemConfig.offsetX-this.pageWidth,
this.endPosition=this.windowWidth-this.elemConfig.offsetX-this.pageWidth)):"bottom"==this.type?(this.startPosition=this.windowHeight-this.elemConfig.offsetY-this.elemConfig.parentHeight-this.height,this.endPosition=this.windowHeight-this.elemConfig.offsetY-this.elemConfig.parentHeight,this.height>this.windowHeight&&(this.startPosition=-this.height+this.elemConfig.offsetY,this.endPosition=this.elemConfig.offsetY)):(this.startPosition=this.elemConfig.offsetY-this.height,this.endPosition=this.elemConfig.offsetY);
this.width>this.sideWidth?this.left=(this.sideWidth-this.width-10)/2:(this.left=this.config.x*this.elemConfig.parentWidth+this.elemConfig.offsetX,this.config.x*this.elemConfig.parentWidth+this.width>this.sideWidth&&(this.left=this.sideWidth-this.width+this.elemConfig.offsetX-10));this.height>this.sideHeight?this.top=(this.sideHeight-this.height)/2:(this.top=this.config.y*this.elemConfig.parentHeight+this.elemConfig.offsetY,this.config.y*this.elemConfig.parentHeight+this.height>this.sideHeight&&(this.top=
this.sideHeight-this.height+this.elemConfig.offsetY))},initEvent:function(){isPhone()||isPad()?(this.close.css({display:"block",top:"-20px",right:"0px"}),this.clickEvent()):"Mouse Out"==this.action.outType?this.mouseOutEvent():"BtnClick"==this.action.outType&&this.clickEvent()},clickEvent:function(){this.close.bind(_event._up,function(a){a.stopPropagation();setTimeout(this.hide.bind(this),50)}.bind(this))},mouseOutEvent:function(){this.dialog.bind("mouseleave mouseout",function(){this.focus=!1;(function(){this.focus||
(this.hide(),function(){this.moving=!1}.delay(this,450))}).delay(this,50)}.bind(this));this.dialog.bind("mouseenter mouseover ",function(){this.focus=!0}.bind(this));this.element.bind("mouseenter mouseover ",function(){this.focus=!0}.bind(this));this.element.bind("mouseleave mouseout",function(){this.focus=!1;(function(){this.focus||(this.hide(),function(){this.moving=!1}.delay(this,450))}).delay(this,50)}.bind(this))},animateCase:function(a,b,c){void 0!=a&&null!=a&&(this.position=a,this.oldOpacity=
parseFloat(this.dialog.css("opacity")),this.newOpacity=b,this.getOldPosition(),this.animate&&this.animate.stopFlag&&this.animate.stop(),this.animate=function(d,e){if(d==e)this.dialog.css({opacity:this.newOpacity}),this.setPosition(this.position),c&&c();else{var f=this.start+(this.position-this.start)/e*d;this.dialog.css({opacity:this.oldOpacity+(this.newOpacity-this.oldOpacity)/e*d});this.setPosition(f)}}.animation(this,500))},getOldPosition:function(){switch(this.type){case "left":this.start=parseFloat(this.dialog.left());
break;case "right":this.start=parseFloat(this.dialog.left());break;case "top":this.start=parseFloat(this.dialog.top());break;case "bottom":this.start=parseFloat(this.dialog.bottom())}},setPosition:function(a){this.currentPosition=a;switch(this.type){case "left":this.dialog.css({left:this.currentPosition+"px"});break;case "right":this.dialog.css({left:this.currentPosition+"px"});break;case "top":this.dialog.css({top:this.currentPosition+"px"});break;case "bottom":this.dialog.css({bottom:this.currentPosition+
"px"})}},show:function(){"SWF"!=this.action.targetType||this.isLoaded?(this.dialog.css({"pointer-events":"auto"}),this.animateCase(this.endPosition,1,function(){this.visible=!0}.bind(this))):setTimeout(function(){this.show()}.bind(this),100)},hide:function(){this.animateCase(this.startPosition,0,function(){this.visible=!1}.bind(this));this.dialog.css({"pointer-events":"none"})}}).extend("PageItemNormalPopup");
Class("SlideShow",{Package:"PageItem.Popup",create:function(a,b,c,d){this._super(a);var e=b.photos;if(e){this.popUpImage=b.popUpImage;this.photos=$.extend([],e);this.dScale=1;this.photos.photo&&(this.photos=void 0==this.photos.photo[1]?[this.photos.photo]:this.photos.photo);if(!(this.photos instanceof Array)){if(void 0==this.photos.url&&void 0==this.photos.photo)return;this.photos.url&&(this.photos=[{url:this.photos.url,desc:""}]);this.photos.photo&&(this.photos=[this.photos.photo])}!this.popUpImage||
this.photos.length||this.photos.photo||this.photos.push({title:"",desc:"",url:b.url});this.parent=a;this.windowWidth=c;this.windowHeight=d;this.initHtml();this.initButton();this.initCss();this.initEvents();this.resizeTimer=this.onResize.interval(this,300);this.changeImage(0);this.show();this.descBox.scroll({},Direction.top,"win10")}},initHtml:function(){this.imgIndex=-1;this.imgWidth=200;this.imgHeight=300;this.boxWidth=200;this.boxHeight=300;this.loadingImageHeight=this.loadingImageWidth=32;this.dialog=
$("<div id='dialog'></div>");this.insetBox=$("<div></div>");this.leftBar=$("<div></div>");this.rightBar=$("<div></div>");this.img=$("<img style='position : absolute;' />");this.textBox=$("<div></div>");this.upIcon=$("<div><div></div></div>");this.titleBox=$("<div></div>");this.descBox=$("<div class='stage'></div>");this.descSwiper=$("<div class='swiper'></div>");this.descBox.append(this.descSwiper);this.textBox.append(this.titleBox).append(this.descBox).append(this.upIcon);this.initScroll();this.closeButton=
new button(this.parent,{buttonType:1,iconURL:uiBaseURL+"closecat.png"},!0);this.loadingImage=$("<div><img src='"+uiBaseURL+"progress.gif' style='position:absolute;'/></div>");this.insetBox.append(this.loadingImage);this.dialog.append(this.insetBox);this.dialog.append(this.textBox);this.parent.append(this.leftBar);this.parent.append(this.rightBar)},initScroll:function(){this.progress=$("<div class='progress'></div>");this.progressBar=$("<div class='progressBar'></div>");this.progress.append(this.progressBar);
this.descBox.append(this.progress);this.progress.css({background:"#eee",width:"8px",height:"100%",position:"absolute",right:"0",cursor:"pointer"});this.progressBar.css({width:"8px",background:"rgba(11,11,11,0.55)",position:"absolute",top:"0",cursor:"pointer","border-radius":"4px"})},initCss:function(){this.dialog.css({width:"100%",height:"100%",position:"absolute","z-index":"10001"});this.insetBox.css({position:"absolute",width:this.boxWidth+"px",height:this.boxHeight+"px",left:"0px",top:"0px","z-index":1,
"-webkit-transform":"scale(0)","-o-transform":"scale(0)","-ms-transform":"scale(0)","-moz-transform":"scale(0)",transform:"scale(0)"});this.loadingImage.css({position:"absolute","z-index":-1,left:(this.boxWidth-this.loadingImageWidth)/2+"px",top:(this.boxHeight-this.loadingImageHeight)/2+"px",width:this.loadingImageWidth+"px",height:this.loadingImageHeight+"px"});this.rightBar.css({"z-index":10002,width:"100px",height:"100px",right:"0px",top:(windowHeight-100)/2+"px",opacity:"0.6",position:"absolute"});
this.leftBar.css({"z-index":10002,width:"100px",height:"100px",left:"0px",top:(windowHeight-100)/2+"px",opacity:"0.6",position:"absolute"});this.closeButton.setCSS({"z-index":10002,display:"none"});this.closeButton.iconBox.css({opacity:"0.6"});this.textBox.css({transition:"bottom 0.3s","font-size":"14px","font-family":"Calibri",padding:"15px","z-index":"2",display:"block",background:"rgba(11,11,11,0.25)",color:"#fff",position:"absolute",bottom:"0",width:windowWidth-30+"px",height:"90px"});this.titleBox.css({overflow:"hidden",
"font-size":"16px",height:"20px",top:"26px",position:"absolute"});this.descBox.css({overflow:"hidden",width:windowWidth-30+"px",height:"60px",position:"absolute",top:"56px"});this.descSwiper.css({position:"absolute",width:windowWidth-40+"px"});this.upIcon.css({position:"absolute",right:"5px",top:"5px",width:"30px",height:"30px",cursor:"pointer"});this.upIcon.find("div").css({cursor:"pointer",width:"0",height:"0",position:"absolute",right:"10px",top:"10px","border-width":"8px 5px 0px","border-style":"solid",
"border-color":"rgb(255, 255, 255) transparent transparent"})},initButton:function(){1>=this.photos.length||(this.leftButton=new button(this.leftBar,{buttonType:1,iconURL:uiBaseURL+"previous_down.png"}),this.rightButton=new button(this.rightBar,{buttonType:1,iconURL:uiBaseURL+"next_down.png"}),this.leftButton.setButtonPosition(0,29,["left","top"]),this.leftButton.background.css({display:"none"}),this.rightButton.setButtonPosition(0,29,["right","top"]),this.hideButtons())},afterZoomOut:function(){this.closeButton.iconBox.css({display:"block"});
this.isZoom=!1},beforeZoomIn:function(){this.closeButton.iconBox.css({display:"none"});this.isZoom=!0},initEvents:function(){this.closeButton.onMouseDown(this,this.hide);this.modalBackground.unbind();this.insetBox.bind(_event._click,function(a){a.stopPropagation()}.bind(this));this.textBox.bind(_event._click,function(a){a.stopPropagation()}.bind(this));setTimeout(function(){this.dialog.bind(_event._click,this.hide.bind(this));if(this.leftButton)this.leftButton.onMouseDown(this,this.prePage);if(this.rightButton)this.rightButton.onMouseDown(this,
this.nextPage)}.bind(this),500);this.leftButton&&this.leftButton.mouseEnterJump();this.rightButton&&this.rightButton.mouseEnterJump();this.zoomMonitor=new ZoomMonitor;this.zoomMonitor.register({target:this.img,beforeZoomIn:this.beforeZoomIn.bind(this),afterZoomIn:this.afterZoomIn.bind(this),afterZoomOut:this.afterZoomOut.bind(this)});this.upIcon.bind(_event._click,function(){0<=this.textBox.bottom()?(this.textBox.css({bottom:"-90px"}),this.upIcon.find("div").css({top:"7px","border-width":"0px 5px 8px",
"border-color":"transparent transparent rgb(255, 255, 255)"})):(this.textBox.css({bottom:"0"}),this.upIcon.find("div").css({top:"12px","border-width":"8px 5px 0px","border-color":"rgb(255, 255, 255) transparent transparent"}))}.bind(this));this.mouseWheelEvent()},mouseWheelEvent:function(){var a;this.img.bind(_event._mousewheel,function(b){var c=b.originalEvent;c=Math.max(-1,Math.min(1,c.wheelDelta||-c.detail));if(!this.isZoom&&0<c)this.img.onDoubleTap(b);else{if(void 0!=a&&300>new Date-a)var d=!1;
else a=new Date,d=!0;if(!d)return!1;b={pointers:[{pageX:b.pageX,pageY:b.pageY},{pageX:b.pageX,pageY:b.pageY}]};0>c?this.zoomDown(b):this.zoomUp(b);stopEvent(b);return!1}}.bind(this))},setCSS:function(a){if(a){void 0!=a.width&&this.img.css("width",a.width+"px");void 0!=a.height&&this.img.css("height",a.height+"px");void 0!=a.left&&this.img.css("left",a.left+"px");void 0!=a.top&&this.img.css("top",a.top+"px");void 0!=a.display&&this.img.css("display",a.display);if(a.tran||void 0!=a.scale||a.origin){var b=
transformCSS(a);this.img.css(b)}this.img.registerPatamers&&this.img.registerParamers(a)}},changeZoomImg:function(){if(this.isZoom){var a=this.img,b=this.img.offset(),c=getTransform(this.img[0]),d=a.parameters.width/a.parameters.naturalWidth,e=this.getSizeConfig(),f=e.width;e=e.height;a.parameters.naturalWidth=f;a.parameters.naturalHeight=e;a.parameters.width=f;a.parameters.height=e;this.img.parameters.scale=d;a.parameters.tran={x:c.x,y:c.y};a.parameters.left=b.left-c.x;a.parameters.top=b.top-c.y;
this.afterZoomIn()}},afterZoomIn:function(){var a=this.img.offset().left,b=this.img.offset().top,c=this.img.parameters.scale,d={tran:{x:a-this.img.parameters.left,y:b-this.img.parameters.top},scale:1,origin:{x:0,y:0}};1!=c&&this.img.css({width:Math.round(this.img.parameters.width*c)+"px",height:Math.round(this.img.parameters.height*c)+"px"});this.img.parameters.zoomFlag||(d.tran={x:0,y:0},d.left=a-0,d.top=b-0);this.setCSS(d);this.img.parameters.tran=d.tran;this.img.parameters.scale=1;this.img.parameters.toScale=
1;this.img.parameters.width=$(this.img).width();this.img.parameters.height=$(this.img).height();this.img.parameters.origin={x:0,y:0};this.img.parameters.resize=!1},beforeStart:function(a){var b=this.img,c=b.parameters;this.img.offset();this.img.offset();c.origin=b.mathOrigin(b,a);c.tran=b.mathTran(b,a,c.origin);b.originObj(b,b.parameters.origin)},zoomUp:function(a){var b=this.img;b.scale=b.parameters.toScale;var c=Math.min(b.parameters.naturalWidth*b.maxScale/b.parameters.width,1.1*parseFloat(b.scale));
c!=b.scale&&(a||(a={pointers:[{pageX:windowWidth/2,pageY:windowHeight/2},{pageX:windowWidth/2,pageY:windowHeight/2}]}),b.parameters.origin=b.mathOrigin(b,a),b.originObj(b,b.parameters.origin),b.animateToScale(b,c,a))},zoomDown:function(a){if(!this.img.parameters.zoomOut&&this.img.parameters.naturalWidth){var b=this.img;a||(a={pointers:[{pageX:windowWidth/2,pageY:windowHeight/2},{pageX:windowWidth/2,pageY:windowHeight/2}]});b.scale=b.parameters.toScale;b.parameters.origin=b.mathOrigin(b,a);b.originObj(b,
b.parameters.origin);var c=b.parameters.naturalWidth/b.parameters.width,d=.9*parseFloat(b.scale);d<=c&&(b.parameters.zoomOut=!0);b.animateToScale(b,Math.max(c,d),a)}},hideButtons:function(){this.photos&&1>=this.photos.length&&(this.leftBar.css("display","none"),this.rightBar.css("display","none"))},nextPage:function(){if(!(1>=this.photos.length)){var a=this.imgIndex+1;this.leftButton.background.css({display:"block"});a>=this.photos.length-1&&(a=this.photos.length-1,this.rightButton.background.css({display:"none"}));
this.changeImage(a)}},prePage:function(){if(!(1>=this.photos.length)){var a=this.imgIndex-1;this.rightButton.background.css({display:"block"});0>=a&&(a=0,this.leftButton.background.css({display:"none"}));this.changeImage(a)}},changeImage:function(a){if(void 0!=a&&(this.dScale=1,this.setTrans(this.dScale),this.imgIndex!=a)){this.imgIndex=a;var b=this.photos[a].url;b=this.fixRelativePath(b);var c=this.photos[a].desc;a=this.photos[a].title;c&&"undefined"!=c||a&&"undefined"!=a?(this.titleBox.html(""),
this.descSwiper.html(""),this.textBox.css({display:"block",bottom:"0"}),this.upIcon.find("div").css({top:"12px","border-width":"8px 5px 0px","border-color":"rgb(255, 255, 255) transparent transparent"}),a&&"undefined"!=a&&this.titleBox.html(a),c&&"undefined"!=c&&this.descSwiper.html(c)):this.textBox.css({display:"none"});this.img.on("load",function(){this.imgWidth=this.img[0].naturalWidth;this.imgHeight=this.img[0].naturalHeight;this.changeZoomImg(this.img);this.resizeImage();this.loadingImage.css("display",
"none");c&&this.descBox.refreshData&&this.descBox.refreshData()}.bind(this));this.img.attr("src",b)}},getSizeConfig:function(){var a=this.windowWidth-20,b=this.windowHeight-20,c=this.imgWidth,d=this.imgHeight;c>a&&(d*=a/c,c=a);d>b&&(c*=b/d,d=b);return{width:c,height:d}},resizeImage:function(){var a=this.getSizeConfig(),b=a.width;a=a.height;this.img.css({width:b+"px",height:a+"px"});this.isZoom&&this.img.css({width:this.img.parameters.width*this.img.parameters.scale+"px",height:this.img.parameters.height*
this.img.parameters.scale+"px"});this.boxWidth!=b||this.boxHeight!=a?(this.insetBox.css({width:b+8+"px",height:a+8+"px"}),this.insetBox.append(this.img),this.loadingImage.css({left:(b+8-this.loadingImageWidth)/2,top:(a+8-this.loadingImageHeight)/2})):this.insetBox.append(this.img);this.boxWidth=b;this.boxHeight=a;this.img.css({left:"4px",top:"4px"});var c=(this.windowWidth-b)/2+b-25,d=(this.windowHeight-a)/2+5;this.insetBox.css({left:(windowWidth-(b+8))/2+"px",top:(windowHeight-(a+8))/2+"px"});this.closeButton.setButtonPosition(c,
d);this.closeButton.setCSS({display:"block"})},onResize:function(){!this.imgWidth||this.windowWidth==windowWidth&&this.windowHeight==windowHeight||(this.windowWidth=windowWidth,this.windowHeight=windowHeight,this.textBox.css({width:windowWidth-30+"px"}),this.resizeImage(),this.rightBar.css({top:(this.windowHeight-100)/2+"px"}),this.leftBar.css({top:(this.windowHeight-100)/2+"px"}),this.dScale=1,this.img.parameters.zoomFlag&&this.hide())},setTrans:function(a){a||(a=1);var b=(this.windowWidth-this.boxWidth*
a)/2+this.boxWidth*a-25,c=(this.windowHeight-this.boxHeight*a)/2+5;b>this.windowWidth-40&&(b=this.windowWidth-40);15>c&&(c=15);this.closeButton.setButtonPosition(b,c);this.insetBox.css({"-webkit-transform":"scale("+a+")","-o-transform":"scale("+a+")","-ms-transform":"scale("+a+")","-moz-transform":"scale("+a+")",transform:"scale("+a+")"})},hide:function(){animateOnce(this.insetBox,{"-webkit-transform":"scale(0)","-o-transform":"scale(0)","-ms-transform":"scale(0)","-moz-transform":"scale(0)",transform:"scale(0)"},
300,function(){this.closeButton.remove();this.leftBar.remove();this.rightBar.remove();this.destroy()}.bind(this));this.dScale=1;this.resizeTimer&&this.resizeTimer.stop()},onShow:function(){}}).extend("PageItemModalPopup");
Class("WindowZoomBox",{Package:"PageItem",create:function(a){this.parent=a;this.visible=!0;this.pageScale=1;this.initHtml();this.initCss();this.initEvent()},initHtml:function(){this.popZoom=$("<div class='popZoom'></div>");this.canvas=$("<canvas width='400' height='300'></canvas>");this.close=$("<img src='"+uiBaseURL+"photoGallery_close.png' />");this.popZoom.append(this.canvas).append(this.close);tmpContainer.append(this.popZoom)},initCss:function(){(isPhone()||isPad())&&this.close.css({display:"none"});
this.close.css({cursor:"pointer",position:"absolute",right:"0",top:"0","z-index":1002});this.popZoom.css({background:"rgba(0,0,0,0.5)",position:"absolute",display:"none","z-index":"1000",top:0,bottom:0,left:0,right:0});this.canvas.css({"transform-origin":"0 0","-o-transform-origin":"0 0","-ms-transform-origin":"0 0","-moz-transform-origin":"0 0","-webkit-transform-origin":"0 0",border:"1px solid #bbb","box-shadow":"0 0 3px #bbb","-ms-box-shadow":"0 0 3px #bbb","-moz-box-shadow":"0 0 3px #bbb","-webkit-box-shadow":"0 0 3px #bbb",
position:"absolute","z-index":"1001","background-color":"#fff",width:"400px",height:"300px",cursor:"url("+uiBaseURL+"catalog_zoomout.png),auto"})},onResize:function(){if(!this.visible){var a=this.getPos();a=this.getAnimatCss(a.x,a.y,this.getScale());this.canvas.css(a)}},drawBg:function(a,b,c,d){this.config=b;this.elemHeight=c.elemHeight;this.elemWidth=c.elemWidth;this.pageW=c.pageWidth;this.pageH=c.pageHeight;this.point=d;this.ctx=this.canvas[0].getContext("2d");fillImageAfterLoaded(a,"normal",this.setImage.bind(this))},
setImage:function(a,b,c,d){c=$("<img style='position:absolute;left:0;top:0;' src = '"+a+"' />");c.on("load",function(){this.afterLoadEvent(c[0],c[0].naturalWidth,c[0].naturalHeight,d)}.bind(this))},setPageScale:function(a){this.pageScale=a||1},initEvent:function(){this.close.onTap(function(a){this.hide()}.bind(this));this.popZoom.onTap(function(a){this.hide()}.bind(this))},getBgSize:function(a,b){var c=this.pageW/this.pageH,d=a/b,e=0,f=0;c<d?(e=this.pageW,f=b*this.pageW/a):c>=d&&(e=a*this.pageH/b,
f=this.pageH);return{width:e,height:f,wRadio:e/this.pageW,hRadio:f/this.pageH}},getShowSize:function(a,b){var c=this.getBgSize(a,b);a=parseFloat(this.config.x);b=parseFloat(this.config.y);var d=parseFloat(this.config.height),e=parseFloat(this.config.width),f=d,g=e;1==c.wRadio?(e=.5-c.hRadio/2,b<e&&(f-=e-b),b+d>1-e&&(f-=e-1+b+d),b=b>e&&b+d>1-e?1-f/(1-2*e):(b-e)/(1-2*e)):(d=.5-c.wRadio/2,a+e>1-d&&(g-=d-1+e+a),a<d&&(g-=d-a),a=a>d&&a+e>1-d?1-g/(1-2*d):(a-d)/(1-2*d));return{x:a,y:b}},afterLoadEvent:function(a,
b,c,d){var e=this.getBgSize(b,c),f=this.getShowSize(b,c);this.width=Math.ceil(b*this.config.width);this.height=Math.ceil(c*this.config.height);this.drawWidth=Math.ceil(b*this.config.width);this.drawHeight=Math.ceil(c*this.config.height);var g=b*this.config.x,h=c*this.config.y,k=b/c,l=this.pageW/this.pageH,m=this.elemWidth/this.elemHeight;this.ctx.beginPath();this.getScale();var n=this.elemWidth/this.width;this.pageScale&&(n*=this.pageScale);PageInfo.pageIsStrech(d)||(g=b*f.x,h=c*f.y,1==e.wRadio?this.drawHeight=
this.width/m:this.drawWidth=this.height*m);.01<=l-k?this.width=this.height*m:-.01>=l-k&&(this.height=this.width/m);this.canvas.css({width:this.width+"px",height:this.height+"px"});this.canvas[0].width=this.width;this.canvas[0].height=this.height;this.canvas.css(this.getAnimatCss(this.point.left,this.point.top,n));this.ctx.drawImage(a,g,h,this.drawWidth,this.drawHeight,0,0,this.width,this.height);this.ctx.closePath();this.show()},getPos:function(){var a=0,b=0,c=this.getScale();windowWidth>this.width*
c&&(a=(windowWidth-this.width*c)/2);windowHeight>this.height*c&&(b=(windowHeight-this.height*c)/2);return{x:a,y:b}},getScale:function(){var a=(this.width+2)/(this.height+2),b=windowWidth/windowHeight,c=1;a>b&&this.width+2>windowWidth&&(c=windowWidth/(this.width+2));a<b&&this.height+2>windowHeight&&(c=windowHeight/(this.height+2));return c},getAnimatCss:function(a,b,c){return{transform:"translate("+a+"px,"+b+"px) scale("+c+")","-webkit-transform":"translate("+a+"px,"+b+"px) scale("+c+")","-o-transform":"translate("+
a+"px,"+b+"px) scale("+c+")","-moz-transform":"translate("+a+"px,"+b+"px) scale("+c+")","-ms-transform":"translate("+a+"px,"+b+"px) scale("+c+")"}},show:function(){if(!this.timer){this.visible=!1;this.popZoom.css({display:"block"});var a=this.getPos(),b=this.getAnimatCss(a.x,a.y,this.getScale());setTimeout(function(){this.timer=!0;animateOnce(this.canvas,b,.2,function(){this.timer=!1}.bind(this))}.bind(this),100)}},hide:function(){if(!this.timer){this.visible=this.timer=!0;var a=this.getAnimatCss(this.point.left,
this.point.top,this.pageScale*this.elemWidth/this.width);animateOnce(this.canvas,a,.2,function(){this.timer=!1;this.popZoom.css({display:"none"})}.bind(this))}}});
Class("WindowZoom",{Package:"PageItem",create:function(a,b,c,d,e){this._super(a,b,c,d,e);this.parent=a;this.pageWidth=c;this.pageHeight=d;this.id=e;this.initConfig();this.initHtml();this.initCss();this.initEvent()},initHtml:function(){this.zoomDiv=$("<div class='zoomDiv flip-action'></div>");this.parent.append(this.zoomDiv)},initConfig:function(){this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight},
parseConfig:function(a){return{width:a.location.width,height:a.location.height,rotation:a.location.rotation,x:a.location.x,y:a.location.y,alpha:a.alpha||1,overAlpha:a.overAlpha||1,borderColor:a.borderColor,overColor:a.overColor,borderWidth:a.barderWidth}},initEvent:function(){this.zoomDiv.onTap(function(){BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),"WindowZoom",this.config.x,this.config.y,this.config.width,this.config.height]);global.popZoomBox.visible?(global.popZoomBox.drawBg(this.id,
this.config,{elemWidth:this.width,elemHeight:this.height,pageWidth:this.pageWidth,pageHeight:this.pageHeight},this.zoomDiv.offset()),global.popZoomBox.setPageScale(getTransformScale(this.parent[0])*BookInfo.scale())):global.popZoomBox.hide()}.bind(this));this.zoomDiv.bind(_event._enter,function(){this.zoomDiv.css({"background-color":Color(this.config.overColor).rgba(this.config.overAlpha)})}.bind(this));this.zoomDiv.bind(_event._leave,function(){this.zoomDiv.css({"background-color":"transparent"})}.bind(this))},
setPageBgImage:function(a,b,c){this.bgImageWidth=a;this.bgImageHeight=b;this.pageIsStrech=c},initCss:function(){this.zoomDiv.css({"z-index":"100","background-color":"transparent",opacity:this.config.alpha,position:"absolute",width:this.width+"px",height:this.height+"px",left:this.x+"px",top:this.y+"px",cursor:"url("+uiBaseURL+"catalog_zoomin.png),auto"})},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.initConfig();this.setPosition(this.x,this.y);this.zoomDiv.css({width:this.width+
"px",height:this.height+"px"})},setPosition:function(a,b){this.zoomDiv.css({left:a+"px",top:b+"px"})}}).extend("Item");
Class("PhoneVideoBox",{create:function(a){this.visible=!1;this.background=$("<div class='phoneVideoBox' style='width:100%;height:100%;z-index:101;position:absolute;top:0;'></div>");this.videoBac=$("<div style='width:100%;height:100%;background-color:rgba(0,0,0,0.9);'></div>");this.closeButton=$("<img width='20' height='20' alt='phoneVideoBoxClose' style='width:20px;height:20px;position:absolute;cursor:pointer;padding:5px;right:5px;top:5px;z-index: 1111;' src='"+phoneBaseURL+"close.png'/>");this.background.append(this.closeButton);
this.background.append(this.videoBac);a.append(this.background);this.background.css({display:"none"});this.initEvent()},initEvent:function(){this.videoBac.onTap(function(a){this.hide()}.bind(this));this.closeButton.onTap(function(a){this.hide()}.bind(this));this.stopPropagationEvent(this.closeButton);this.stopPropagationEvent(this.background);this.stopPropagationEvent(this.videoBac)},stopPropagationEvent:function(a){a.bind(_event._down,function(b){b.stopPropagation()}.bind(this));a.bind(_event._up,
function(b){b.stopPropagation()}.bind(this))},setCurrentVideo:function(a){a&&this.background.append(a)},onResize:function(a,b){this.videoFrame&&this.visible&&this.videoFrame.pauseBackgroundSound()},hide:function(){this.visible=!1;this.timer||(this.videoFrame.pause(),this.timer=setTimeout(function(){this.background.css({display:"none"});this.background.find("video").remove();clearTimeout(this.timer);this.timer=null}.bind(this),200))},popup:function(a,b){!this.timer&&b&&(this.timer=!0,this.videoFrame=
a,this.visible=!0,this.setCurrentVideo(b),setTimeout(function(){this.timer=null;this.background.css({display:"block"})}.bind(this),200))}});
Class("PhoneVideo",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b,c,d);this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.left=this.config.x*this.pageWidth;this.top=this.config.y*this.pageHeight;this.playCount=0;this.videoWidth=windowWidth;this.videoHeight=9*this.videoWidth/16;this.videoHeight=Math.min(this.videoHeight,windowHeight);this.videoLeft=(windowWidth-this.videoWidth)/2;this.videoTop=(windowHeight-this.videoHeight)/2;this.config.imgURL=
this.fixRelativePath(this.config.imgURL);bookConfig.useTheAliCloudChart&&this.config.imgURL&&(this.config.imgURL=this.getOssUrl(this.config.imgURL,this.width,this.height,"fixed"));this.config.videoURL=this.fixRelativePath(this.config.videoURL);this.videoImage=$("<div class='flip-action' style='position: absolute;cursor:pointer;opacity:"+this.config.alpha+"; left:"+this.left+"px; top:"+this.top+"px; width:"+this.width+"px;height:"+this.height+"px;'></div>");this.videoFrame=new Media($('<video src="'+
this.config.videoURL+'" x5-video-player-type="h5" x5-video-player-fullscreen="true" x-webkit-airplay="true" webkit-playsinline="true" playsinline="true" controls controlslist="nodownload"> </video>'),"video");this.videoFrame.setCss({position:"absolute",background:"#000",width:this.videoWidth+"px",height:this.videoHeight+"px",left:this.videoLeft+"px",top:this.videoTop+"px","object-fit":"contain","z-index":1E3});this.config.imgURL?(this.imageDiv=$('<img src="'+this.config.imgURL+'" style="position: absolute;width:100%;height:100%;border:1px solid #bbb;"/>'),
this.videoImage.append(this.imageDiv)):this.videoImage.css({"background-color":"#333",border:"2px solid #bbb"});b=Math.min(Math.min(48,.36*this.width),Math.min(48,.36*this.height));this.playImg=$("<img src='"+phoneBaseURL+"play.png' style='position:absolute;margin:auto;left:0px;top:0px;bottom:0px;right:0px;width:"+b+"px;height:"+b+"px;'/>");this.videoImage.append(this.playImg);this.setRotation(this.videoImage,this.config.rotation);a.append(this.videoImage);this.initEvent();this.config.videoURL||this.playImg.css({display:"none"});
global.phoneVideoBox||!isPad()&&!isPhone()||(global.phoneVideoBox=new PhoneVideoBox(tmpContainer))},parseConfig:function(a){var b={width:a.location.width,height:a.location.height,rotation:a.location.rotation,x:a.location.x,y:a.location.y,alpha:a.alpha,reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,previewSrc:a.previewURL,moviePlayTriggerEvt:a.moviePlayTriggerEvt,movieStopTriggerEvt:a.movieStopTriggerEvt,replayWhenPlayEventTrigger:a.replayWhenPlayEventTrigger,
animation:a.animation};a.H5PlaybackNumber&&(b.H5PlaybackNumber=parseInt(a.H5PlaybackNumber));a.H5Replay&&(b.H5Replay=parseBool(a.H5Replay));a.componentData?(b.videoURL=a.componentData.videoURL,b.imgURL=a.componentData.imgURL||a.componentData.previewURL,b.pageViewed=parseBool(a.componentData.pageViewed)):(b.videoURL=a.url||a.videoURL||"",b.imgURL=a.previewURL||a.previewUrl||"",b.pageViewed="EVT_PageViewed"==a.moviePlayTriggerEvt?!0:!1);return b},initEvent:function(){this.videoFrame.$media.bind("touchstart touchend",
function(b){b.stopPropagation()}.bind(this));this.videoImage.onTap(function(b){this.showOrHide()}.bind(this));0>this.config.H5PlaybackNumber&&this.videoFrame.$media.attr("loop","loop");0<this.config.H5PlaybackNumber&&this.videoFrame.$media.bind("ended",function(){this.playCount++;0<this.config.H5PlaybackNumber&&this.playCount<=this.config.H5PlaybackNumber&&this.play()}.bind(this));var a=(new Date).getTime();this.videoFrame.$media.bind("play",function(){a=(new Date).getTime();BookEvent.trigger("playMedia",
["play",BookInfo.getCurrentPageIndex(),this.videoFrame.$media[0].src,"Video",0]);this.playCount>this.config.H5PlaybackNumber&&(this.playCount=0)}.bind(this));this.videoFrame.$media.bind("pause",function(){BookEvent.trigger("playMedia",["pause",BookInfo.getCurrentPageIndex(),this.videoFrame.$media[0].src,"Video",(new Date).getTime()-a])}.bind(this))},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;
this.left=this.config.x*this.pageWidth;this.top=this.config.y*this.pageHeight;this.videoWidth=windowWidth;this.videoHeight=9*this.videoWidth/16;this.videoHeight=Math.min(this.videoHeight,windowHeight);this.videoLeft=(windowWidth-this.videoWidth)/2;this.videoTop=(windowHeight-this.videoHeight)/2;this.videoFrame.setCss({width:this.videoWidth+"px",height:this.videoHeight+"px",top:this.videoTop+"px",left:this.videoLeft+"px"});this.videoImage.css({width:this.pageWidth*this.config.width+"px",height:this.pageHeight*
this.config.height+"px"});this.setPosition(this.left,this.top)},setPosition:function(a,b){this.videoImage.css({top:b+"px",left:a+"px"})},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd();this.videoImage.css({animation:"flip 1s ease 0s 1 normal"});this.videoImage.one(a,function(){this.videoImage.css({animation:""})}.bind(this))}},getPlayEvt:function(){return this.config.moviePlayTriggerEvt},getStopEvt:function(){return this.config.movieStopTriggerEvt},
showOrHide:function(){global.phoneVideoBox&&0==global.phoneVideoBox.visible?this.popup():this.hideVideo()},setCurrentTime:function(a){this.videoFrame.setCurrentTime(a)},hideVideo:function(){this.videoFrame.$media.unbind(_event._click);global.phoneVideoBox&&global.phoneVideoBox.hide()},popup:function(){this.config.videoURL&&(global.phoneVideoBox&&global.phoneVideoBox.popup(this.videoFrame,this.videoFrame.$media),this.videoFrame.$media.bind(_event._click,function(a){a.stopPropagation()}.bind(this)),
this.playVideo())},playVideo:function(){this.videoFrame.play()},pauseVideo:function(){this.videoFrame.pause()},stopVideo:function(){this.pauseVideo()}}).extend("Item");
Class("HotSpots",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b,c,d);this.animateConfig();this.width=this.pageWidth*this.config.width;this.height=this.pageHeight*this.config.height;this.left=this.config.x*this.pageWidth;this.top=this.config.y*this.pageHeight;this.opacity=this.config.alpha;this.config.hotSpotsURL=this.fixRelativePath(this.config.hotSpotsURL);this.container=$("<div></div>");this.parent.append(this.container);this.setCss();this.initEvent();this.initLinkHint(this.container);
this.createHotspot();this.onResize(c,d)},setCss:function(){this.container.css({position:"absolute",opacity:this.opacity,"z-index":101,cursor:"hand"});this.setRotation(this.container,this.config.rotation)},createHotspot:function(){this.isSuportCanvas()?this.hotspot=new this.CanvasHotspotsContent(this.container,this.config.hotSpotsURL):this.hotspot=_agent_.browser.device==_agent_.browser.DEVICE_PC?new this.FlashHotspotsContent(this.container,this.config.hotSpotsURL):new this.HTMLHotspotsContent(this.container,
this.config.hotSpotsURL)},isSuportCanvas:function(){var a=this.getClass();if(void 0==a.suportCanvasFlag){var b=$("<canvas></canvas>");a.suportCanvasFlag=b[0]&&b[0].getContext?!0:!1}return a.suportCanvasFlag},parseConfig:function(a){return{width:a.location.width,height:a.location.height,rotation:a.location.rotation,x:a.location.x,y:a.location.y,hint:a.hint,alpha:a.alpha,hotSpotsURL:a.hotSpotsURL,hintColor:a.hint.hintShapeColor2,hintShapeAlpha:a.hint.hintShapeAlpha,hintShapeType:a.hint.hintShapeType,
text:a.hint.text,action:a.action,animation:a.animation}},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.pageWidth*this.config.width;this.height=this.pageHeight*this.config.height;this.left=this.config.x*this.pageWidth;this.top=this.config.y*this.pageHeight;this.container.css({width:this.width+"px",height:this.height+"px"});this.setPosition();this.hotspot.onResize();this.resizeHint()},setPosition:function(){this.container.css({left:this.left+"px",top:this.top+"px"})},initEvent:function(){this.container.onTap(function(a){BookEvent.trigger("clickPageItem",
[BookInfo.getCurrentPageIndex(),"HotSpots",this.config.x,this.config.y,this.config.width,this.config.height]);bookConfig.googleAnalyticsID&&gtag("event","click",{event_category:"hotspot",event_label:"Page"+BookInfo.getCurrentPages()[0]})}.bind(this));this.addActionEvent(this.container)},play:function(){this.hotspot&&this.hotspot.start()},pause:function(){this.hotspot&&this.hotspot.stop()},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;
this.container.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.container.one(a,function(){this.container.css({animation:""})}.bind(this))}},destroy:function(){this.hotspot.destroy()}}).extend(PageItem.Item);Class("HotspotsContent",{Package:"PageItem",create:function(a,b){this.container=a;this.src=b;this.init()},init:virtual_function,onResize:virtual_function,start:virtual_function,stop:virtual_function,destroy:virtual_function});
Class("HTMLHotspotsContent",{Package:"PageItem",init:function(){this.frameIndex=1;this.frameCount=60;this.center=$("<div></div>");this.ring=$("<div></div>");this.container.append(this.center);this.container.append(this.ring);this.initStyle(this.center);this.initStyle(this.ring);this.onResize()},initStyle:function(a){a.css({position:"absolute",cursor:"hand","pointer-events":"none",left:"0",top:"0",bottom:"0",right:"0",margin:"auto"})},onResize:function(){this.width=this.container.width();this.height=
this.container.height();this.spotWidth=Math.min(this.width,this.height);this.center.css({"background-color":"red",width:this.spotWidth/3+"px",height:this.spotWidth/3+"px","border-radius":this.spotWidth/6+"px"});this.borderWidth=this.spotWidth/20;this.ring.css({border:this.borderWidth+"px solid red",opacity:1});this.draw()},draw:function(){var a=this.spotWidth/3;a+=this.frameIndex/this.frameCount*(this.spotWidth-a-this.borderWidth);this.ring.css({width:a+"px",height:a+"px","border-radius":(a+this.borderWidth)/
2+"px",opacity:(this.frameCount-this.frameIndex)/this.frameCount})},start:function(){this.stop();this.timer=this.animate()},stop:function(){this.timer&&this.timer.stop()},animate:function(){return function(a,b){this.frameIndex=a;this.frameCount=b;this.draw();this.frameIndex==this.frameCount&&(this.timer=this.animate())}.animation(this,1E3)},destroy:function(){this.stop();this.center.remove();this.ring.remove()}}).extend("HotspotsContent");
Class("FlashHotspotsContent",{Package:"PageItem",init:function(){},onResize:function(){this.width=this.container.width();this.height=this.container.height();this.container.flash().remove();this.container.flash({swf:this.src,width:this.width+"px",height:this.height+"px",wmode:"transparent"})},draw:function(){},start:function(){},stop:function(){},animate:function(){},destroy:function(){this.container.flash().remove()}}).extend("HotspotsContent");
Class("CanvasHotspotsContent",{Package:"PageItem",init:function(){this.frameIndex=1;this.frameCount=60;this.canvas=$("<canvas></canvas>");this.container.append(this.canvas);this.initStyle(this.canvas);this.createDrawer();this.onResize()},initStyle:function(a){a.css({position:"absolute",cursor:"hand","pointer-events":"none",left:"0",top:"0",bottom:"0",right:"0",margin:"auto"})},isSWF:function(a){a=a.toLowerCase();var b=this.src.lastIndexOf("/");-1==b&&(b=this.src.lastIndexOf("\\"));var c=this.src.lastIndexOf(".");
return(b=this.src.substring(b+1,c))?(b=b.toLowerCase(),b==a):!1},createDrawer:function(){var a=this.canvas[0].getContext("2d");this.drawer=null;this.isSWF("Black Arrow Circle Hand")&&(this.drawer=new this.RotateHandHotSpotsDrawer(a,"black"));this.isSWF("Black Arrow Circle")&&(this.drawer=new this.RotateRingHotSpotsDrawer(a,"black"));this.isSWF("Black Circle Blinker")&&(this.drawer=new this.BlinkerHotSpotsDrawer(a,"black","#00F1FF"));this.isSWF("Black Circle")&&(this.drawer=new this.ShrinkHotSpotsDrawer(a,
"black"));this.isSWF("Black Glow")&&(this.drawer=new this.RoundHotSpotsDrawer(a,"black"));this.isSWF("Black Ripple with Pointer")&&(this.drawer=new this.MouseHotSpotsDrawer(a,"black"));this.isSWF("Black Ripple")&&(this.drawer=new this.RingHotSpotsDrawer(a,"black"));this.isSWF("Black Star in Circle")&&(this.drawer=new this.StarHotSpotsDrawer(a,"black"));this.isSWF("BlackTwo Ripples")&&(this.drawer=new this.RipplesHotSpotsDrawer(a,"black"));this.isSWF("Blue Arrow Circle Hand")&&(this.drawer=new this.RotateHandHotSpotsDrawer(a,
"#0033FF"));this.isSWF("Blue Arrow Circle")&&(this.drawer=new this.RotateRingHotSpotsDrawer(a,"#0033FF"));this.isSWF("Blue Circle Blinker")&&(this.drawer=new this.BlinkerHotSpotsDrawer(a,"#0033FF","#00F1FF"));this.isSWF("Blue Circle")&&(this.drawer=new this.ShrinkHotSpotsDrawer(a,"#05338E","#0561BC"));this.isSWF("Blue Glow")&&(this.drawer=new this.RoundHotSpotsDrawer(a,"#0033FF"));this.isSWF("Blue Ripple with Pointer")&&(this.drawer=new this.MouseHotSpotsDrawer(a,"#0033FF"));this.isSWF("Blue Ripple")&&
(this.drawer=new this.RingHotSpotsDrawer(a,"#0033FF"));this.isSWF("Blue Star in Circle")&&(this.drawer=new this.StarHotSpotsDrawer(a,"#0044EE"));this.isSWF("Blue Star")&&(this.drawer=new this.RectsHotSpotsDrawer(a,"#3364C5"));this.isSWF("Blue Two Ripples")&&(this.drawer=new this.RipplesHotSpotsDrawer(a,"#0033FF"));this.isSWF("Blue_doughnut")&&(this.drawer=new this.DoughnutHotSpotsDrawer(a,"#3B89FF"));this.isSWF("Default Animation")&&(this.drawer=new this.RectsHotSpotsDrawer(a,"#3364C5"));this.isSWF("Green Arrow Circle Hand")&&
(this.drawer=new this.RotateHandHotSpotsDrawer(a,"#009900"));this.isSWF("Green Arrow Circle")&&(this.drawer=new this.RotateRingHotSpotsDrawer(a,"#009900"));this.isSWF("Green Circle Blinker")&&(this.drawer=new this.BlinkerHotSpotsDrawer(a,"#039303","#03F503"));this.isSWF("Green Circle")&&(this.drawer=new this.ShrinkHotSpotsDrawer(a,"#009900"));this.isSWF("Green Glow")&&(this.drawer=new this.RoundHotSpotsDrawer(a,"green"));this.isSWF("Green Ripple with Pointer")&&(this.drawer=new this.MouseHotSpotsDrawer(a,
"#009900"));this.isSWF("Green Ripple")&&(this.drawer=new this.RingHotSpotsDrawer(a,"#009900"));this.isSWF("Green Star in Circle")&&(this.drawer=new this.StarHotSpotsDrawer(a,"#009900"));this.isSWF("Green Star")&&(this.drawer=new this.RectsHotSpotsDrawer(a,"#669900"));this.isSWF("Green Two Ripples")&&(this.drawer=new this.RipplesHotSpotsDrawer(a,"#009900"));this.isSWF("Green Doughnut")&&(this.drawer=new this.DoughnutHotSpotsDrawer(a,"#00DAB7"));this.isSWF("Orange Circle")&&(this.drawer=new this.ShrinkHotSpotsDrawer(a,
"#CA7000","#F98C00"));this.isSWF("Red Arrow Circle Hand")&&(this.drawer=new this.RotateHandHotSpotsDrawer(a,"red"));this.isSWF("Red Arrow Circle")&&(this.drawer=new this.RotateRingHotSpotsDrawer(a,"red"));this.isSWF("Red Circle Blinker")&&(this.drawer=new this.BlinkerHotSpotsDrawer(a,"red","yellow","#CA7000"));this.isSWF("Red Circle")&&(this.drawer=new this.ShrinkHotSpotsDrawer(a,"red"));this.isSWF("Red Doughnut")&&(this.drawer=new this.DoughnutHotSpotsDrawer(a,"#E58585"));this.isSWF("Red Glow")&&
(this.drawer=new this.RoundHotSpotsDrawer(a,"red","#FBBC00"));this.isSWF("Red Ripple with Pointer")&&(this.drawer=new this.MouseHotSpotsDrawer(a,"red"));this.isSWF("Red Ripple")&&(this.drawer=new this.RingHotSpotsDrawer(a,"red"));this.isSWF("Red Star in Circle")&&(this.drawer=new this.StarHotSpotsDrawer(a,"red"));this.isSWF("Red Star")&&(this.drawer=new this.RectsHotSpotsDrawer(a,"red"));this.isSWF("Red Two Ripples")&&(this.drawer=new this.RipplesHotSpotsDrawer(a,"red"));this.isSWF("Yellow Squre")&&
(this.drawer=new this.SquareHotSpotsDrawer(a,"red","#FBBC00"));this.isSWF("Yellow Start Blink")&&(this.drawer=new this.SquareStarHotSpotsDrawer(a,"#FBBC00","#FF9900","#DAE405"));this.isSWF("yellow_doughnut")&&(this.drawer=new this.DoughnutHotSpotsDrawer(a,"#FFD56B"));this.drawer||(this.drawer=new this.RingHotSpotsDrawer(a,"red"))},setContainerSize:function(a,b,c){b=getCoverSize(b,c,2*b,2*c);a[0]&&(a[0].width=b.width,a[0].height=b.height);this.drawer&&(this.drawer.resize(b.width,b.height),this.draw());
$(a).css({left:.075*this.container.width()+"px",top:.075*this.container.height()+"px",margin:"0","-webkit-transform-origin":"0 0","transform-origin":"0 0","-webkit-transform":"scale("+b.scale+")",transform:"scale("+b.scale+")"})},onResize:function(){this.width=.85*this.container.width();this.height=.85*this.container.height();isIphone()||isIpad()?this.setContainerSize(this.canvas,this.width,this.height):(this.canvas.attr("width",this.width),this.canvas.attr("height",this.height),this.drawer&&(this.drawer.resize(this.width,
this.height),this.draw()))},draw:function(){this.drawer&&this.drawer.draw(this.frameIndex,this.frameCount)},start:function(){this.stop();this.timer=this.animate()},animate:function(){return function(a,b){this.frameIndex=a;this.frameCount=b;this.draw();this.frameIndex==this.frameCount&&(this.timer=this.animate())}.animation(this,1E3)},stop:function(){this.timer&&this.timer.stop()},destroy:function(){this.stop();this.canvas.remove()}}).extend("HotspotsContent");
Class("HotSpotsDrawer",{Package:"PageItem",create:function(a,b){this.context=a;this.color=Color(b)},resize:function(a,b){this.width=a;this.height=b},rectInCenter:function(a,b){void 0==b&&(b=a);return{left:(this.width-a)/2,top:(this.height-b)/2,width:a,height:b}},draw:virtual_function,clear:function(){this.context.clearRect(0,0,this.width,this.height)},drawStar:function(a,b,c,d){var e=this.context;if(a){b||(b="#FFFF00");c||(c={width:0,color:"#FFFFFF"});void 0==d&&(d=0);var f=Math.min(a.width,a.height)/
2,g=.4*f,h=a.left;a=a.top;e.save();e.translate(h+f,a+f);e.rotate(d*Math.PI/180);e.beginPath();e.moveTo(Math.cos(.1*Math.PI)*f,-Math.sin(.1*Math.PI)*f);for(d=0;5>d;d++)e.lineTo(Math.cos((18+72*d)/180*Math.PI)*f,-Math.sin((18+72*d)/180*Math.PI)*f),e.lineTo(Math.cos((54+72*d)/180*Math.PI)*g,-Math.sin((54+72*d)/180*Math.PI)*g);e.closePath();e.fillStyle=b;e.fill();e.lineWidth=c.width;e.strokeStyle=c.color;0<c.width&&e.stroke();e.restore()}},drawTriangle:function(a,b,c){var d=this.context;a&&(b||(b="#000000"),
c||(c={width:0,color:"#FFFFFF"}),d.save(),d.translate(a.left,a.top),d.beginPath(),d.moveTo(a.width/2,0),d.lineTo(0,a.height),d.lineTo(a.width,a.height),d.closePath(),d.fillStyle=b,d.fill(),d.lineWidth=c.width,d.strokeStyle=c.color,0<c.width&&d.stroke(),d.restore())},drawArrow:function(a,b,c,d){var e=this.context;a&&(b||(b="#000000"),c||(c={width:0,color:"#FFFFFF"}),d=d?parseFloat(d):.2,e.save(),e.translate(a.left,a.top),e.beginPath(),e.moveTo(a.width/2,0),e.lineTo(0,a.height),e.lineTo(a.width/2,a.height*
(1-d)),e.lineTo(a.width,a.height),e.closePath(),e.fillStyle=b,e.fill(),e.lineWidth=c.width,e.strokeStyle=c.color,0<c.width&&e.stroke(),e.restore())},drawMouse:function(a,b,c){var d=this.context;if(a){b||(b="#FFFFBB");c||(c={width:1,color:"#000000"});var e=.6*a.height,f=a.width/2;d.save();d.translate(a.left+f,a.top);d.rotate(-15*Math.PI/180);d.shadowBlur=Math.ceil(.2*a.width);d.shadowColor="rgba(0, 0, 0, 0.3)";d.shadowOffsetX=Math.ceil(.1*a.width);d.shadowOffsetY=Math.ceil(.1*a.width);d.beginPath();
d.moveTo(a.width/2-f,0);d.lineTo(-f,e);d.lineTo(.38*a.width-f,.9*e);d.lineTo(.38*a.width-f,a.height);d.lineTo(.62*a.width-f,a.height);d.lineTo(.62*a.width-f,.9*e);d.lineTo(a.width-f,e);d.closePath();d.fillStyle=b;d.fill();d.lineWidth=c.width;d.strokeStyle=c.color;0<c.width&&d.stroke();d.restore()}},drawRound:function(a,b,c){var d=this.context;if(a){b||(b="#000000");c||(c={width:0,color:"#FFFFFF"});var e=Math.min(a.width,a.height)/2,f=a.left;a=a.top;d.save();d.beginPath();0>=e&&(e=1);d.arc(f+e,a+e,
e,0,2*Math.PI,!0);d.closePath();d.fillStyle=b.toString();d.fill();d.lineWidth=c.width;d.strokeStyle=c.color;0<c.width&&d.stroke();d.restore()}},drawRing:function(a,b){var c=b.width/2;this.drawRound({left:a.left+c,top:a.top+c,width:a.width-b.width,height:a.height-b.width},"transparent",b)},drawRect:function(a,b,c,d){var e=this.context;if(a){b||(b="#000000");c||(c={width:0,color:"#FFFFFF"});d||(d=0);var f=a.width/2,g=a.height/2,h=a.left+f,k=a.top+g;e.save();e.translate(h,k);e.rotate(d*Math.PI/180);
e.beginPath();e.rect(-f,-g,a.width,a.height);e.closePath();e.fillStyle=b;e.fill();e.lineWidth=c.width;e.strokeStyle=c.color;0<c.width&&e.stroke();e.restore()}},drawRoundRect:function(a,b,c,d,e){var f=this.context;if(a){c||(c="#000000");d||(d={width:0,color:"#FFFFFF"});e||(e=0);var g=a.width/2,h=a.height/2,k=a.left+g,l=a.top+h;f.save();f.translate(k,l);f.rotate(e*Math.PI/180);a=Math.min(b,Math.min(a.width,a.height)/2);f.beginPath();f.moveTo(-g+a,-h);f.arcTo(g,-h,g,h,a);f.arcTo(g,h,-g,h,a);f.arcTo(-g,
h,-g,-h,a);f.arcTo(-g,-h,g,-h,a);f.closePath();f.fillStyle=c;f.fill();f.lineWidth=d.width;f.strokeStyle=d.color;0<d.width&&f.stroke();f.restore()}},drawSquareStar:function(a,b,c){var d=this.context;if(a){b||(b="#000000");c||(c=0);var e=a.left+a.width/2,f=a.top+a.height/2,g=a.width,h=a.height,k=Math.PI/180,l=a.width*Math.cos(30*k),m=a.height*Math.cos(30*k);d.save();d.translate(e,f);d.rotate(c*Math.PI/180);d.beginPath();d.arc(0,-a.height/2-l,g,60*k,120*k,!1);d.arc(a.width/2+m,0,h,150*k,210*k,!1);d.arc(0,
a.height/2+l,g,240*k,300*k,!1);d.arc(-a.width/2-m,0,h,-30*k,30*k,!1);d.closePath();d.fillStyle=b;d.fill();d.restore()}}});
Class("HotSpotsHandImageData",{Package:"PageItem",create:function(a,b){this.dock=a;this.src=b;this.init()},init:function(){this.dock.hand||(this.dock.hand=$("<img></img>"),this.dock.hand.attr("src",this.src));this.data=this.dock.hand},getImage:function(){if(!this.data)return null;var a=this.data[0];return 0==a.naturalWidth?null:a},draw:function(a,b,c){if(a&&b){void 0==c&&(c=1);var d=this.getImage();if(d){var e=d.naturalWidth,f=d.naturalHeight;a.globalAlpha=c;a.drawImage(d,0,0,e,f,b.left,b.top,b.width,
b.height);a.globalAlpha=1}}}});Class("RingHotSpotsDrawer",{Package:"PageItem",draw:function(a,b){if(this.width&&this.height){this.clear();var c=Math.min(this.width,this.height),d=c/3,e=c/16,f=this.rectInCenter(d);this.drawRound(f,this.color);e={width:e,color:this.color.rgba((b-a)/b)};a=this.rectInCenter(d+(c-d)*a/b);this.drawRing(a,e)}}}).extend("HotSpotsDrawer");
Class("StarHotSpotsDrawer",{Package:"PageItem",draw:function(a,b){if(this.width&&this.height){this.clear();this._super(a,b);var c=this.rectInCenter(Math.min(this.width,this.height)/3);this.drawStar(c,"#FFFF00",null,Math.ceil(a/b*360))}}}).extend("RingHotSpotsDrawer");
Class("MouseHotSpotsDrawer",{Package:"PageItem",draw:function(a,b){this.width&&this.height&&(this.clear(),this._super(a,b),a=Math.min(this.width,this.height),b=a/4,this.drawMouse({left:(this.width-b)/2,top:this.height/2,width:b,height:2*a/5}))}}).extend("RingHotSpotsDrawer");
Class("RoundHotSpotsDrawer",{Package:"PageItem",create:function(a,b,c){this.context=a;this.color=Color(b);this.centerColor=c?Color(c):this.color.add(70)},draw:function(a,b){if(this.width&&this.height){this.clear();var c=Math.min(this.width,this.height),d=c/3;c=this.rectInCenter(d+(c-d)*a/b);a=this.color.rgba((b-a)/b);this.drawRound(c,a);c=this.rectInCenter(d);this.drawRound(c,this.centerColor.toString())}}}).extend("HotSpotsDrawer");
Class("RotateHotSpotsDrawer",{Package:"PageItem",draw:function(a,b){if(this.width&&this.height){this.clear();var c=Math.min(this.width,this.height),d={width:c/8,color:this.color.toString()},e=this.rectInCenter(7*c/8);this.drawRing(e,d);d=c/4;e=c/4;var f=(this.height-e)/2;c={left:0,top:f,width:d,height:e};d={left:0,top:f-Math.ceil(.1*e),width:d,height:Math.floor(1.1*e)};a=Math.ceil(360*a/b);this.context.save();this.context.translate(this.width/2,this.height/2);this.context.rotate(a*Math.PI/180);c.left-=
this.width/2;c.top-=this.height/2;d.left-=this.width/2;d.top-=this.height/2;this.drawTriangle(d,"#FFFFFF");this.drawTriangle(c,this.color.toString());this.drawTriangle();this.context.restore()}}}).extend("HotSpotsDrawer");Class("RotateRingHotSpotsDrawer",{Package:"PageItem",draw:function(a,b){this.width&&this.height&&(this.clear(),this._super(a,b),a=this.rectInCenter(Math.min(this.width,this.height)/3),this.drawRound(a,this.color.toString()))}}).extend("RotateHotSpotsDrawer");
Class("RotateHandHotSpotsDrawer",{Package:"PageItem",create:function(a,b){this._super(a,b);this.initHand()},initHand:function(){this.imageData=new this.HotSpotsHandImageData(this.getClass(),uiBaseURL+"hotspot_hand.png")},draw:function(a,b){this.width&&this.height&&(this.clear(),this._super(a,b),a=Math.min(this.width,this.height),a=this.rectInCenter(a/3,a/2),this.imageData.draw(this.context,a))}}).extend("RotateHotSpotsDrawer");
Class("BlinkerHotSpotsDrawer",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b);this.lightColor=c?Color(c):Color(this.color.add(70));this.ringColor=d?Color(d):this.color;this.colorDiff=this.color.difference(this.lightColor);this.frameColorDiff={}},draw:function(a,b){if(this.width&&this.height){this.clear();var c=Math.min(this.width,this.height);b=Math.ceil(b/2);a<b?(a/=b,this.frameColorDiff.r=Math.ceil(this.colorDiff.r*a),this.frameColorDiff.g=Math.ceil(this.colorDiff.g*a),this.frameColorDiff.b=
Math.ceil(this.colorDiff.b*a)):(a=(a-b)/b,this.frameColorDiff.r=this.colorDiff.r-Math.ceil(this.colorDiff.r*a),this.frameColorDiff.g=this.colorDiff.g-Math.ceil(this.colorDiff.g*a),this.frameColorDiff.b=this.colorDiff.b-Math.ceil(this.colorDiff.b*a));a=this.color.add(this.frameColorDiff);b=this.rectInCenter(c/2);this.drawRound(b,a);a=this.rectInCenter(c);this.drawRing(a,{width:c/8,color:this.ringColor.toString()})}}}).extend("HotSpotsDrawer");
Class("ShrinkHotSpotsDrawer",{Package:"PageItem",create:function(a,b,c){this._super(a,b);this.innerColor=c?Color(c):Color(this.color.add(70))},draw:function(a,b){if(this.width&&this.height){this.clear();var c=Math.min(this.width,this.height),d=7*c/8,e=c/4;if(a<b/2){var f=a,g=b/2;e+=(c-e)*f/g;d=this.rectInCenter((d-0)*f/g);e=this.rectInCenter(e);this.drawRound(d,this.innerColor.toString());this.drawRing(e,{width:c/8,color:this.color.toString()})}else g=b/4,f=a%g,a<3*b/4?(f=1-f/g,d=this.rectInCenter((d-
0)*f),e=this.rectInCenter(c),this.drawRound(d,this.innerColor.rgba(f)),this.drawRing(e,{width:c/8,color:this.color.toString()})):(f=1-f/g,e=this.rectInCenter(e+(c-e)*f),this.drawRing(e,{width:c/8,color:this.color.rgba(f)}))}}}).extend("HotSpotsDrawer");
Class("RipplesHotSpotsDrawer",{Package:"PageItem",create:function(a,b){this._super(a,b)},draw:function(a,b){if(this.width&&this.height){this.clear();var c=Math.min(this.width,this.height),d=b/2,e=a%d,f=e/d;if(a<b/2){var g=c/5;a=c;b=Math.ceil(c/50);c=Math.ceil(c/16);b+=(c-b)*e/d;d=this.rectInCenter(g+(a-g)*e/d);a=this.rectInCenter(a);this.drawRing(d,{width:b,color:this.color.toString()});this.drawRing(a,{width:c,color:this.color.rgba(f)})}else{g=c/5;a=c;var h=(a-g)*e/d;b=Math.ceil(c/50);c=Math.ceil(c/
16);e=(c-b)*e/d;d=this.rectInCenter(g+h);a=this.rectInCenter(a-h);this.drawRing(d,{width:b+e,color:this.color.rgba(1-f)});this.drawRing(a,{width:c-e,color:this.color.toString()})}}}}).extend("HotSpotsDrawer");
Class("RectsHotSpotsDrawer",{Package:"PageItem",draw:function(a,b){if(this.width&&this.height){this.clear();var c=Math.min(this.width,this.height);a=Math.ceil(360*a/b);for(b=0;3>b;b++){var d=120*b+a,e=this.rectInCenter(c/6,5*c/6);this.drawRect(e,this.color.rgba(.4),null,d)}for(b=0;3>b;b++)d=120*b-a,e=this.rectInCenter(c/7,2*c/3),this.drawRect(e,this.color.toString(),null,d)}}}).extend("HotSpotsDrawer");
Class("SquareHotSpotsDrawer",{Package:"PageItem",create:function(a,b,c){this._super(a,b);this.centerColor=c?Color(c):Color(this.color.add(70))},draw:function(a,b){if(this.width&&this.height){this.clear();var c=Math.min(this.width,this.height),d=c/2,e=c/25,f=this.rectInCenter(d);this.drawRoundRect(f,e,this.centerColor.toString(),{width:e,color:this.color.toString()});f=1-a/b;a=this.rectInCenter(d+(c-e-d)*a/b);this.drawRoundRect(a,e,"transparent",{width:e,color:this.color.rgba(f)})}}}).extend("HotSpotsDrawer");
Class("SquareStarHotSpotsDrawer",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b);this.borderColor=c?Color(c):Color(this.color.reduce(70));this.backgroundColor=d?Color(d):this.color},draw:function(a,b){if(this.width&&this.height){this.clear();var c=b/2,d=a%c,e=Math.min(this.width,this.height),f=e/12,g=e/4,h=Math.sqrt(this.width*this.width/4+this.height*this.height/4),k=(e-g)*d/c;c=(h-g)*d/c;a<b/2?(a=this.rectInCenter(g+k),b=this.rectInCenter(h-c),f=this.rectInCenter(h-c-2*f)):(a=this.rectInCenter(e-
k),b=this.rectInCenter(g+c),f=this.rectInCenter(g+c-2*f));this.drawSquareStar(a,this.backgroundColor.toString());this.drawSquareStar(b,this.borderColor.toString(),45);this.drawSquareStar(f,this.color.toString(),45)}}}).extend("HotSpotsDrawer");
Class("DoughnutHotSpotsDrawer",{Package:"PageItem",create:function(a,b){this._super(a,b);this.initHand()},initHand:function(){this.imageData=new this.HotSpotsHandImageData(this.getClass(),uiBaseURL+"hotspot_hand2.png")},draw:function(a,b){if(this.width&&this.height){this.clear();var c=Math.min(this.width,this.height),d=this.rectInCenter(c/3),e=b/2;e=a%e/e;a>=b/2&&(e=1-e);this.imageData.draw(this.context,d,e);a=c/6;b=c/12;d=c/48;e=this.rectInCenter(c);var f=this.rectInCenter(11*c/12);c=this.rectInCenter(41*
c/48);var g=Color("white");this.drawRing(e,{width:a,color:this.color.toString()});this.drawRing(f,{width:b,color:g.rgba(.1)});this.drawRing(c,{width:d,color:g.rgba(.2)})}}}).extend("HotSpotsDrawer");function forceFloat(a){a=Number(a).toString();-1==a.indexOf(".")&&(a+=".00");return a}
Class("ShoppingCart",{Package:"PageItem",create:function(a,b,c,d){this.config=this.parseConfig(b);this.animateConfig();this.pageWidth=c;this.pageHeight=d;this.bgColor=Color(this.config.bgColor).toString();this.width=Number(this.pageWidth*this.config.width);this.height=Number(this.pageHeight*this.config.height);this.config.imgUrl=this.config.imgUrl;this.config.url=this.config.url;bookConfig.isFlipPdf&&(this.config.imgUrl.startsWith("./")?this.config.imgUrl="."+this.config.imgUrl:this.config.imgUrl.isUrl()||
(this.config.imgUrl="../"+this.config.imgUrl));this.background=$("<div class='cart_background'></div>");this.img=$("<div></div/>");a.append(this.background);this.background.append(this.img);this.linkOrCart(b,a);this.setLinkCss();this.setPosition();this.initEvent()},parseConfig:function(a){return{annotype:a.annotype,x:a.location.x,y:a.location.y,rotation:a.location.rotation,width:a.location.width,height:a.location.height,bgColor:a.bgColor,bgAlpha:a.bgAlpha,alpha:a.alpha,cartType:a.cartType,imgUrl:a.imgUrl,
titleStr:a.titleStr,url:a.url,Detailed:a.Detailed,animation:a.animation}},destroy:function(){this.background.empty();this.background.remove();this.shop&&this.shop.destroy()},linkOrCart:function(a,b){var c="";this.config.url&&(c=this.config.url);!c||c.startsWith("http://")||c.startsWith("https://")||(c="http://"+c);"link"==this.config.cartType?(isTouchDevice()?(this.background=$("<div></div>"),c&&this.background.bind(_event._end,function(){window.location.href=c}.bind(this))):(this.background=$("<a ><div></div></a>"),
c&&(this.background.attr("href",c),this.background.attr("target","_blank"))),b.append(this.background),this.background.append(this.img)):isPhone()||isPad()?this.shop=new PageItem.MobileProductDetailsPanel(a,pageEditor.setting,b):this.shop=new PageItem.PCProductDetailsPanel(a,pageEditor.setting,b)},setLinkCss:function(){this.background.css({position:"absolute","background-position":"center",width:this.width+"px",height:this.height+"px","background-color":Color(this.bgColor).rgba(this.config.bgAlpha),
opacity:this.config.alpha,"text-decoration":"none",cursor:"default",transform:"rotate("+this.config.rotation+"deg)","-webkit-transform":"rotate("+this.config.rotation+"deg)","-ms-transform":"rotate("+this.config.rotation+"deg)","-o-transform":"rotate("+this.config.rotation+"deg)","-moz-transform":"rotate("+this.config.rotation+"deg)","transform-origin":"50% 50%","-webkit-transform-origin":"50% 50%","-ms-transform-origin":"50% 50%","-o-transform-origin":"50% 50%","-moz-transform-origin":"50% 50%"});
bookConfig.useTheAliCloudChart&&(this.config.imgUrl=this.getOssUrl(this.config.imgUrl,2*this.width/3,2*this.height/3,"lfit"));this.img.css({background:"url("+this.config.imgUrl+") center center no-repeat","background-size":"contain",position:"absolute",cursor:"pointer",width:2*this.width/3+"px",height:2*this.height/3+"px",margin:"auto",left:"0",right:"0",top:"0",bottom:"0"})},initEvent:function(){if(!isTouchDevice()){var a=new divHint;this.background.bind(_event._move,function(b){if(isTouchDevice()){var c=
b.originalEvent.touches[0];void 0==c&&(c=b.touches[0])}else c=b;$(c.target);b=c.pageX+10;c=c.pageY+10;a.setStyle("hintBackground");a.instance.css({"font-size":"12px",overflow:"hidden"});"link"==this.config.cartType?""!=this.config.titleStr?(this.showtitle=!0,a.setText(this.config.titleStr.overflow(16))):this.config.url&&(this.showtitle=!0,a.setText(this.config.url.overflow(16))):""!=this.config.titleStr?(this.showtitle=!0,a.setText(this.config.titleStr.overflow(16))):this.config.Detailed.title&&(this.showtitle=
!0,a.setText(this.config.Detailed.title.overflow(16)));this.showtitle&&(a.moveto(b,c),a.show())}.bind(this));this.background.bind(_event._leave,function(){a.hide();this.showtitle=!1}.bind(this))}this.background.bind(_event._down,function(b){b.stopPropagation();bookConfig.googleAnalyticsID&&gtag("event","click",{event_category:"Shopping",event_label:"Page"+BookInfo.getCurrentPages()[0]+" showProductDetail"})});this.background.onTap(function(){BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),
"ShoppingCart",this.config.x,this.config.y,this.config.width,this.config.height]);this.shop&&this.shop.show()}.bind(this))},show:function(){this.background.css("display","block")},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.config.width*a;this.height=this.config.height*b;this.background.css({width:this.width+"px",height:this.height+"px"});this.setLinkCss();this.setPosition();if(this.shop)this.shop.onResize(a,b);if(isIphone()||isIpad())this.setContainerSize(this.img,2*
this.width/3,2*this.height/3,2048/3,2048/3),this.img.css({transform:"scale(1)","-webkit-transform":"scale(1)"}),this.setContainerSize(this.background,this.width,this.height)},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.background.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.background.one(a,function(){this.background.css({animation:""})}.bind(this))}},setPosition:function(){this.x=
this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.background.css({left:this.x+"px",top:this.y+"px"})}}).extend(PageItem.Item);
var ShoppingCartUtil={setProductsToStorage:function(a){try{if(window.localStorage){var b=Instance.JSON(a);window.localStorage.setItem("shopping_cart_products",b)}}catch(c){}},getProductsFromStorage:function(){try{if(!window.localStorage)return[];var a=window.localStorage.getItem("shopping_cart_products");return Instance.parse(a,[])}catch(b){return[]}},removeProduct:function(a){for(var b=this.getProductsFromStorage(),c=0;c<b.length;c++)if(b[c].title==a.title){b.remove(c);break}this.setProductsToStorage(b)},
addProduct:function(a){for(var b=this.getProductsFromStorage(),c=!0,d=0;d<b.length;d++){var e=b[d];if(e.title==a.title){e.number=a.number+e.number;c=!1;break}}c&&b.push(a);this.setProductsToStorage(b);return b},saveProducts:function(a,b){a||(a=[]);b=[];for(var c=0;c<a.length;c++)b.push(a[c].product);this.setProductsToStorage(b)}};
Class("ProductDetailsPanel",{Package:"PageItem",create:function(a,b,c){this.config=this.parseConfig(a);this.setting=b;this.parent=c;this.initUI();this.initEvent()},parseConfig:function(a){return a},destroy:virtual_function,getMailtoInformation:function(a,b,c){var d=c.shoppingCartOptinon.body;a=parseInt(a);var e=forceFloat(b.Detailed.proce);a=1==parseBool(pageEditor.setting.shoppingCartOptinon.showPrice)?String.format("%0D%0A%0D%0A%0D%0A%s(N1, %d * %s%s = %s%s);%0D%0A%s%s%0D%0A-type in your contacts here-%0D%0A%0D%0A%0D%0A%0D%0A",
b.Detailed.title,a,e,b.Detailed.sing,forceFloat(e*a),b.Detailed.sing,forceFloat(e*a),b.Detailed.sing):String.format("%0D%0A%0D%0A%0D%0A%s(N1, %d);%0D%0A%0D%0A-type in your contacts here-%0D%0A%0D%0A%0D%0A%0D%0A",b.Detailed.title,a);-1<d.indexOf("${shopping}")&&(d=d.replaceAll("${shopping}",a,!0));return String.format("mailto:%s?subject=%s&body=%s",c.shoppingCartOptinon.address,c.shoppingCartOptinon.theme,d)},getPaypalInformation:function(a,b,c){var d="";if("$"==b.Detailed.sing||"U.S.$"==b.Detailed.sing)d=
"USD";"\uffe5"==b.Detailed.sing&&(d="CNY");"\u20ac"==b.Detailed.sing&&(d="EUR");"\uffe1"==b.Detailed.sing&&(d="GBP");"J.\uffe5"==b.Detailed.sing&&(d="JPY");"$A."==b.Detailed.sing&&(d="AUD");"$NZ."==b.Detailed.sing&&(d="NZD");"SFR."==b.Detailed.sing&&(d="CHF");"HK$"==b.Detailed.sing&&(d="HKD");"S.$"==b.Detailed.sing&&(d="SGD");"S.Kr."==b.Detailed.sing&&(d="SEK");"D.Kr."==b.Detailed.sing&&(d="DKK");"z\u0142"==b.Detailed.sing&&(d="PLZ");"N.Kr."==b.Detailed.sing&&(d="NOK");"FT."==b.Detailed.sing&&(d=
"HUF");"Cz.Kr."==b.Detailed.sing&&(d="CSK");"Mex.$"==b.Detailed.sing&&(d="MXP");"\u20aa"==b.Detailed.sing&&(d="ILS");"Gr.$"==b.Detailed.sing&&(d="BRC");"Mal.$"==b.Detailed.sing&&(d="MYR");"NT"==b.Detailed.sing&&(d="NTD");"\u0e3f"==b.Detailed.sing&&(d="THP");"Ykr"==b.Detailed.sing&&(d="TRL");return"http://www.paypal.com/cgi-bin/webscr?cmd=_xclick&business="+c.shoppingCartOptinon.paypal+"&item_name="+b.Detailed.title+"&amount="+b.Detailed.proce+"&currency_code="+d+"&quantity="+a},doCheckout:function(){if(0!=
this.canCheckout){var a=this.input.val();a="Email"==this.setting.shoppingCartOptinon.type?this.getMailtoInformation(a,this.config,this.setting):this.getPaypalInformation(a,this.config,this.setting);window.open(a)}}});
Class("ShoppingCartPanel",{Package:"PageItem",getMailtoInformation:function(a,b){if(!this.shoppingItems)return"";a="%0D%0A";b=pageEditor.setting.shoppingCartOptinon.body;for(var c=0,d=parseBool(pageEditor.setting.shoppingCartOptinon.showPrice),e=0;e<this.shoppingItems.length;e++){var f=this.shoppingItems[e];if(void 0==f.isSelected||f.isSelected()){var g=forceFloat(f.product.price);a=1==d?a+String.format("%0D%0A%s(N"+(e+1)+", %d * %s%s = %s%s);%0D%0A",f.product.title,parseInt(f.product.number),g,f.product.sing,
forceFloat(g*parseInt(f.product.number)),f.product.sing):a+String.format("%0D%0A%s(N"+(e+1)+", %d);%0D%0A",f.product.title,parseInt(f.product.number));f=parseFloat(f.product.price*f.cartInput.val());c+=f}}1==d&&(a+=String.format("%0D%0A(Total price : %f%s);%0D%0A%0D%0A",c,this.config.Detailed.sing));a+="-type in your contacts here-%0D%0A%0D%0A%0D%0A%0D%0A";-1<b.indexOf("${shopping}")&&(b=b.replaceAll("${shopping}",a,!0));return String.format("mailto:%s?subject=%s&body=%s",pageEditor.setting.shoppingCartOptinon.address,
pageEditor.setting.shoppingCartOptinon.theme,b)},getPaypalInformation:function(a,b){if(!this.shoppingItems)return"";for(var c="",d="",e=0,f=0;f<this.shoppingItems.length;f++){var g=this.shoppingItems[f];if(void 0==g.isSelected||g.isSelected()){if("$"==a.Detailed.sing||"U.S.$"==a.Detailed.sing)c="USD";"\uffe5"==a.Detailed.sing&&(c="CNY");"\u20ac"==a.Detailed.sing&&(c="EUR");"\uffe1"==a.Detailed.sing&&(c="GBP");"J.\uffe5"==a.Detailed.sing&&(c="JPY");"$A."==a.Detailed.sing&&(c="AUD");"$NZ."==a.Detailed.sing&&
(c="NZD");"SFR."==a.Detailed.sing&&(c="CHF");"HK$"==a.Detailed.sing&&(c="HKD");"S.$"==a.Detailed.sing&&(c="SGD");"S.Kr."==a.Detailed.sing&&(c="SEK");"D.Kr."==a.Detailed.sing&&(c="DKK");"z\u0142"==a.Detailed.sing&&(c="PLZ");"N.Kr."==a.Detailed.sing&&(c="NOK");"FT."==a.Detailed.sing&&(c="HUF");"Cz.Kr."==a.Detailed.sing&&(c="CSK");"Mex.$"==a.Detailed.sing&&(c="MXP");"\u20aa"==a.Detailed.sing&&(c="ILS");"Gr.$"==a.Detailed.sing&&(c="BRC");"Mal.$"==a.Detailed.sing&&(c="MYR");"NT"==a.Detailed.sing&&(c="NTD");
"\u0e3f"==a.Detailed.sing&&(c="THP");"Ykr"==a.Detailed.sing&&(c="TRL");e++;d+=String.format("&item_name_"+e+"=%s&amount_"+e+"=%f&quantity_"+e+"=%d",g.product.title,parseFloat(g.product.price),parseInt(g.product.number))}}d+=String.format("&business=%s&currency_code=%s",b.shoppingCartOptinon.paypal,c);return"http://www.paypal.com/cgi-bin/webscr?cmd=_cart&upload=1"+d},doCheckout:function(){if(0!=this.canCheckout){var a="Email"==this.setting.shoppingCartOptinon.type?this.getMailtoInformation(this.config,
this.setting):this.getPaypalInformation(this.config,this.setting);window.open(a)}},refreshTotalValue:function(){this.shoppingItems||(this.shoppingItems=[]);this.canCheckout=!0;var a=0;if(0<this.shoppingItems.length){for(var b=0;b<this.shoppingItems.length;b++){var c=this.shoppingItems[b];var d=c.product;if(void 0==c.isSelected||c.isSelected())c=parseFloat(d.price*d.number),a+=c,d.number>d.quantity&&(this.canCheckout=!1)}this.total.text(getLanguage("ShappingCart_Total","Total")+" : "+d.sing+a.toFixed(2))}else this.total.text(getLanguage("ShappingCart_Total",
"Total")+" : 0.00");this.item.text(getLanguage("ShappingCart_Item","Item")+" : "+this.shoppingItems.length)},refreshInputValue:function(){for(var a=ShoppingCartUtil.getProductsFromStorage(),b=0,c=0;c<a.length;c++)b+=a[c].number;return b},removeItem:function(a){ShoppingCartUtil.removeProduct(a.product);a.singleShop.remove();for(var b=0;b<this.shoppingItems.length;b++)if(this.shoppingItems[b]==a){this.shoppingItems.remove(b);break}}});Class("ShoppingCartItem",{});
Class("ShoppingAdvancedProperty",{Package:"PageItem",create:function(a){this.config=a;(this.advanced=this.config.Detailed.advanced)&&!this.advanced[0]&&(this.advanced=[this.advanced.list]);this.advanceLength=this.advanced.length;this.shopAdvanced1=$("<div style='width:300px; position:relative; height:25px;margin-top:5px'></div>");this.shopAdvanced2=$("<div style='width:300px; position:relative; height:30px;margin-top:5px'></div>");this.shopAdvanced3=$("<div style='width:300px; position:relative; height:30px;margin-top:5px'></div>");
for(a=0;a<this.advanceLength;a++)"list"==this.advanced[a].type&&(this.advanceListValue=this.advanced[a].defaultValue);this.initAdvanced();this.setAdvanceEvent()},initAdvanced:function(){var a=0,b=0,c=0;this.shopSelect=[];for(var d=0;d<this.advanceLength;d++)if(this.shopSelect[d]=[],"boolean"==this.advanced[d].type&&(a+=1,this.shopTypeName=$("<div style='position:absolute;overflow:auto;margin-left:20px;width:auto; top:"+20*(a-1)+"px; height:20px;font-family:Arial; font-size:12px;line-height:20px'>"+
this.advanced[d].name+"</div>"),this.checkBox=$("<input type=checkbox  style='position:absolute;margin:0;top:"+(4+20*(a-1))+"px;'/>"),"true"==this.advanced[d].defaultValue&&this.checkBox.attr("checked","checked"),this.shopAdvanced1.append(this.checkBox).append(this.shopTypeName),this.shopAdvanced1.css({height:20*a+"px"})),"text"==this.advanced[d].type&&(b+=1,this.shopTypeName=$("<div style='width:55px;overflow:auto; top:"+(5+30*(b-1))+"px; height:20px;line-height:20px;font-family:Arial;font-size:12px;position:absolute'>"+
this.advanced[d].name+":</div>"),this.shopValue=$("<input style='width:200px;position:absolute; top:"+(4+30*(b-1))+"px; left:50px; height:18px;font-family:Arial; font-size:12px;outline:medium' value='"+this.advanced[d].value+"'/>"),this.shopAdvanced2.append(this.shopTypeName).append(this.shopValue),this.shopAdvanced2.css({height:30*b+"px"})),"list"==this.advanced[d].type){var e=this.advanced[d].value.split(";");var f=0;c+=1;this.shopTypeName=$("<div style='position:absolute;overflow:auto;width:55px; top:5px; height:20px;line-height:20px;font-family:Arial; font-size:12px'>"+
this.advanced[d].name+" :</div>");this.shopAdvanced3.append(this.shopTypeName);for(var g=0;g<e.length;g++)0<g&&0==g%5&&(this.shopAdvanced3.append("<br/><br/>"),top+=30,c+=1,f=0),this.shopTypeName.css({top:3+30*(c-1)+"px"}),f+=40,this.shopSelect[d][g]=$("<div class=borderStyle name="+this.advanced[d].name+" style='overflow:auto;height:20px;min-width:25px;cursor:pointer;font-family:Arial; font-size:12px;border:1px solid black;left:"+f+"px; top:"+(3+30*(c-1))+"px; position:absolute;text-align:center;line-height:20px;padding-left:4px;padding-right:4px'>"+
e[g]+"</div>"),this.advanced[d].defaultValue==e[g]&&this.shopSelect[d][g].css("border","2px solid rgb(255,0,0)"),this.shopAdvanced3.append(this.shopSelect[d][g]);this.shopAdvanced3.css({height:30*c+"px"})}},setAdvanceEvent:function(){for(var a=0;a<this.shopSelect.length;a++)for(var b=this.shopSelect[a],c=b.length,d=this,e=0;e<c;e++)b[e].onTap(function(){for(var f=0;f<d.shopSelect.length;f++)for(j=0;j<d.shopSelect[f].length;j++)d.shopSelect[f][j].attr("name")==$(this).attr("name")&&d.shopSelect[f][j].css("border",
"1px solid rgb(0,0,0)"),d.shopSelect[f][j][0]==this&&(d.advanced[f].defaultValue=d.shopSelect[f][j][0].innerText,d.shopSelect[f][j].css("border","2px solid rgb(255,0,0)"))})},isCheckBoxSelected:function(){return this.checkBox[0].checked},setShoppingCartAdvanced:function(){var a="";if(0!=this.advanceLength)for(var b=0;b<this.advanceLength;b++)"text"==this.advanced[b].type&&(this.advanced[b].defaultValue=this.shopValue.val()),"list"==this.advanced[b].type&&(this.advanced[b].defaultValue=this.advanced[b].defaultValue),
"boolean"==this.advanced[b].type&&this.isCheckBoxSelected()&&(this.advanced[b].defaultValue=this.isCheckBoxSelected().toString()),a+=" "+this.advanced[b].name+":"+this.advanced[b].defaultValue+" ";return a}});
Class("MobileProductDetailsPanel",{Package:"PageItem",create:function(a,b,c){this.advancedObj=new PageItem.ShoppingAdvancedProperty(a);this._super(a,b,c);this.shoppingCart||(this.shoppingCart=new PageItem.MobileShoppingCartPanel(a,b),window.shoppingCart=this.shoppingCart);toolBar.getButton("ShoppingCart").setNumber(this.shoppingCart.refreshInputValue());this.canCheckout=!0;this.visible=!1},parseConfig:function(a){return{annotype:a.annotype,x:a.location.x,y:a.location.y,width:a.location.width,height:a.location.height,
bgColor:a.bgColor,bgAlpha:a.bgAlpha,cartType:a.cartType,imgUrl:a.imgUrl,titleStr:a.titleStr,url:a.url,languageLayout:a.languageLayout,Detailed:a.Detailed}},destroy:function(){this.phoneContainer.empty();this.phoneContainer.remove()},initUI:function(){"right"==this.config.languageLayout&&(this.alignCss={"text-align":"right",direction:"rtl"});this.phoneContainer=$("<div class=phoneContainer></div>");this.toolBar=$("<div></div>");this.closeButton=$("<div></div>");this.textTitle=$("<div>Product Details</div>");
this.phoneImg=$("<img/>");this.title=$("<div>"+this.config.Detailed.title+"</div>");this.title.text(this.title.text().overflow(30));this.phoneImgBox=$("<div></div>");this.contentText=$("<div></div>");this.shopDescribe=$("<div>"+this.config.Detailed.about+"</div>");this.price=$("<div>"+getLanguage("TStuffCart_DetailedPrice","Price")+" : "+this.config.Detailed.sing+this.config.Detailed.proce+"</div>");this.mNumber=$("<div><span style='position:absolute;'>"+getLanguage("TStuffCart_DetailedQuantity",
"Quantity")+" : </span></div>");this.input=$("<input type='text' value='1' style='float:left;width:40px;text-align:center;height:20px;outline:medium;border:1px solid rgb(255,255,255)'/>");this.input.allowNumberOnly();this.mAdd=$("<img src='"+uiBaseURL+"cartAdd.png' style='float:left;cursor:pointer;width:25px ;height:25px;background-color:#DDDDDA' />");this.mLow=$("<img src='"+uiBaseURL+"cartLow.png' style='float:left;cursor:pointer;width:25px ;height:25px;position:absolute;background-color:#DDDDDA'/>");
this.transitTime=this.alignCss?$("<div>"+this.config.Detailed.time+this.config.Detailed.time+getLanguage("TStuffCart_DetailedDay","day(s)")+" : "+getLanguage("TStuffCart_DetailedTime","Delivery time")+"</div>"):$("<div>"+getLanguage("TStuffCart_DetailedTime","Delivery time")+" : "+this.config.Detailed.time+getLanguage("TStuffCart_DetailedDay","day(s)")+"</div>");this.allQuantity=$("<div> "+this.config.Detailed.quantity+getLanguage("TStuffCart_DetailedQuantity","In Stock")+" </div>");this.mAddToCart=
$("<span>"+getLanguage("ShappingCart_AddCart","Add to cart")+"</span>");this.mCheckOut=$("<span>"+getLanguage("ShappingCart_CheckOut","Checkout")+"</span>");this.mailto=$("<a style='text-decoration: none'></a>");this.inputChangRed=$("<span style='position:absolute;top:35px;margin-left:30px;color:red;font-size:10px;width:115px;height:15px;right:30px'>"+getLanguage("ShappingCart_NotStock","Not enough in stock")+"</span>");this.content=$("<div></div>");this.addlow=$("<div></div>");tmpContainer.append(this.phoneContainer);
this.phoneContainer.append(this.toolBar);this.phoneContainer.append(this.content);this.phoneContainer.append(this.contentText);this.toolBar.append(this.closeButton);this.toolBar.append(this.textTitle);this.phoneImgBox.append(this.phoneImg);this.contentText.append(this.title);this.contentText.append(this.shopDescribe);this.contentText.append(this.price);if(""!=this.advancedObj.advanced)for(var a=0;a<this.advancedObj.advanceLength;a++)"boolean"==this.advancedObj.advanced[a].type&&(this.contentText.append(this.advancedObj.shopAdvanced1),
this.advancedObj.shopAdvanced1.css({"margin-left":"15px","margin-top":"10px"})),"text"==this.advancedObj.advanced[a].type&&(this.contentText.append(this.advancedObj.shopAdvanced2),this.advancedObj.shopAdvanced2.css({"margin-left":"15px","margin-top":"10px"})),"list"==this.advancedObj.advanced[a].type&&(this.contentText.append(this.advancedObj.shopAdvanced3),this.advancedObj.shopAdvanced3.css({"margin-left":"15px","margin-top":"10px"}));this.contentText.append(this.mNumber).append(this.allQuantity).append(this.transitTime);
this.content.append(this.phoneImgBox).append(this.contentText);this.mailto.append(this.mCheckOut);this.phoneContainer.append(this.mAddToCart);this.phoneContainer.append(this.mailto);this.mNumber.append(this.addlow);this.addlow.append(this.mAdd).append(this.input).append(this.mLow);(this.imgs=this.config.Detailed.imgs)&&!this.imgs[0]&&(this.imgs=[this.imgs.img]);this.imgsCount=this.imgs.length;this.imgs||(this.imgs=[this.config.imgUrl]);!1===this.setting.shoppingCartOptinon.showPrice&&this.price.css({display:"none"});
!1===this.setting.shoppingCartOptinon.showTime&&this.transitTime.css({display:"none"});this.initCss();this.initImgs();this.initButton()},initButton:function(){1>=this.imageItems.length||(this.btnBox=$("<div style='position:absolute;left:0;top:50%;width:100%;height:38px;'></div>"),this.leftBtn=$("<div style='position:absolute;left:0;top:-50%;width:32px;height:38px;opacity:0.7;'><img style='width:32px;height:38px;' src='"+uiBaseURL+"photo_prev.png' /></div>"),this.rightBtn=$("<div style='position:absolute;right:0;top:-50%;width:32px;height:38px;opacity:0.7;'><img style='width:32px;height:38px;' src='"+
uiBaseURL+"photo_next.png' /></div>"),this.btnBox.append(this.leftBtn).append(this.rightBtn),this.phoneImgBox.append(this.btnBox),this.leftBtn.onTap(function(a){this.currentIndex=Math.abs(this.currentIndex-1)%this.imageItems.length;this.setImgs(this.imageItems[this.currentIndex])}.bind(this)),this.rightBtn.onTap(function(a){this.currentIndex=(this.currentIndex+1)%this.imageItems.length;this.setImgs(this.imageItems[this.currentIndex])}.bind(this)))},initImgs:function(){this.imageItems=[];for(var a=
0;a<this.imgs.length;a++)this.imageItems[a]=this.imgs[a],bookConfig.isFlipPdf&&(this.imageItems[a].startsWith("./")?this.imageItems[a]="."+this.imageItems[a]:this.imageItems[a].isUrl()||(this.imageItems[a]="../"+this.imageItems[a]));1<this.imgsCount&&(this.setSwipe(),this.imageURL=this.imageItems[0]);this.setImgs(this.imageItems[0])},setImgs:function(a){this.phoneImg.attr({src:a})},setSwipe:function(){this.currentIndex=0;var a=function(b,c){c=30*windowWidth/1600;if(!(Math.abs(b)<=c)){var d=this.imageItems.length;
b<-c?this.currentIndex=(this.currentIndex+1)%d:b>c&&(0==this.currentIndex&&(this.currentIndex+=d),this.currentIndex=(this.currentIndex-1)%d);this.imageURL=this.imageItems[this.currentIndex];this.setImgs(this.imageURL);_agent_.browser.mise?event.cancelBubble=!0:event.stopPropagation()}}.bind(this);this.phoneImgBox.speed(a)},changeLanguage:function(){this.price.html(getLanguage("TStuffCart_DetailedPrice","Price")+" : "+this.config.Detailed.sing+this.config.Detailed.proce);this.mNumber.html(getLanguage("TStuffCart_DetailedQuantity",
"Quantity"));this.alignCss?this.transitTime.html(this.config.Detailed.time+this.config.Detailed.time+getLanguage("TStuffCart_DetailedDay","day(s)")+" : "+getLanguage("TStuffCart_DetailedTime","Delivery time")):this.transitTime.html(getLanguage("TStuffCart_DetailedTime","Delivery time")+" : "+this.config.Detailed.time+getLanguage("TStuffCart_DetailedDay","day(s)"));this.allQuantity.html(this.config.Detailed.quantity+getLanguage("TStuffCart_DetailedQuantity","In Stock"));this.mAddToCart.html(getLanguage("ShappingCart_AddCart",
"Add to cart"));this.mCheckOut.html(getLanguage("ShappingCart_CheckOut","Checkout"))},initCss:function(){this.phoneContainer.css({width:windowWidth+"px",display:"none",height:"100%",position:"absolute",transform:"translate("+windowWidth+"px,0)","-webkit-transform":"translate("+windowWidth+"px,0)","-moz-transform":"translate("+windowWidth+"px,0)","-o-transform":"translate("+windowWidth+"px,0)","-ms-transform":"translate("+windowWidth+"px,0)","background-color":"#f7f7f7","z-index":"3000"});this.setMobileShopCss()},
setMobileShopCss:function(){this.addlow.css({position:"absolute",width:"100px",height:"25px",left:"65px"});this.content.css({position:"relative",width:windowWidth+15+"px",height:windowHeight-90+"px","overflow-x":"hidden"});this.mCheckOut.css({position:"absolute","background-color":"#ff4400",width:windowWidth/2+"px",height:"40px","text-align":"center","line-height":"2.5","font-family":"Arial",right:"0",bottom:"0",cursor:"pointer",color:"white"});this.mAddToCart.css({position:"absolute","background-color":"#ffa800",
width:windowWidth/2+"px",height:"40px","text-align":"center","line-height":"2.5","font-family":"Arial","margin-left":"0",bottom:"0",cursor:"pointer",color:"white"});this.allQuantity.css({height:"14px","margin-top":"10px","font-size":"10px",color:Color(44849).toString(),"font-family":"Tahoma"});this.transitTime.css({height:"14px","margin-top":"10px",color:"black","font-size":"10px","font-family":"Tahoma"});this.contentText.css({position:"relative",padding:"0 15px",width:windowWidth-30+"px"});this.mNumber.css({position:"relative",
height:"25px","line-height":"25px","margin-top":"10px",color:"black","font-size":"10px","font-family":"Tahoma"});this.price.css({position:"relative",height:"20px","margin-top":"10px","font-size":"18px",color:Color(12845056).toString(),"font-family":"Tahoma"});this.title.css({height:"32px","line-height":"26px","font-size":"26px",color:"black","font-family":"Tahoma","margin-top":"7px"});this.shopDescribe.css({"line-height":"1.6","font-size":"13px",color:"black","margin-top":"10px","font-family":"Tahoma"});
this.textTitle.css({position:"absolute",width:windowWidth/2+5,margin:"auto","font-size":"18px","font-family":"Tahoma",color:"rgb(140,140,140)","vertical-align":"middle","line-height":"2.2",left:"0",top:"0",bottom:"0",right:"0","text-align":"center"});this.toolBar.css({position:"relative",width:windowWidth+"px","background-color":"white",border:"rgb(239,232,232) 1px solid",height:"40px"});this.closeButton.css({position:"absolute",margin:"auto","background-image":"url("+uiBaseURL+"background_prev.png)",
"background-repeat":"no-repeat","background-position":"4px 4px",cursor:"pointer",width:"28px",height:"28px",left:"10px",bottom:"0",top:"0"});this.phoneImg.css({position:"absolute","max-width":windowWidth-30+"px","max-height":.3*windowHeight+"px",margin:"auto",left:"0",bottom:"0",top:"0",right:"0"});this.phoneImgBox.css({position:"relative",width:windowWidth+"px",height:.35*windowHeight+"px","z-index":"3000"});this.alignCss&&(this.contentText.css(this.alignCss),this.addlow.css({left:"auto",right:"75px"}),
this.input.css({"float":"right"}),this.mAdd.css({"float":"right"}),this.mLow.css({"float":"right"}))},initEvent:function(){var a=function(b,c){c=30*windowWidth/1600;Math.abs(b)<=c||b>c&&this.hide()}.bind(this);this.phoneContainer.speed(a);this.mailto.onTap(function(){bookConfig.googleAnalyticsID&&gtag("event","click",{event_category:"CheckOut",event_label:"doCheckout"});this.doCheckout}.bind(this));this.input.bind("blur",function(){parseInt(this.input.val())>this.config.Detailed.quantity?(this.mNumber.append(this.inputChangRed),
this.input.css({"border-color":"red"}),this.canCheckout=!1):(this.inputChangRed.remove(),this.input.css({"border-color":"rgb(255,255,255)"}),this.canCheckout=!0)}.bind(this));this.closeButton.onTap(function(){this.hide()}.bind(this));this.mAdd.onTap(function(){var b=parseInt(this.input.val())+1;this.input.val(b);b>this.config.Detailed.quantity?(this.mNumber.append(this.inputChangRed),this.input.css({"border-color":"red"}),this.canCheckout=!1):this.canCheckout=!0}.bind(this));this.mLow.onTap(function(){var b=
parseInt(this.input.val());1!=b&&(--b,this.input.val(b),b<=this.config.Detailed.quantity&&(this.inputChangRed.remove(),this.input.css({"border-color":"rgb(255,255,255)"}),this.canCheckout=!0),this.input.val(b))}.bind(this));this.mAddToCart.onTap(function(){tmpContainer.append(this.shoppingCart.mCart);this.shoppingCart.showCart();var b={};b.image=1>=this.imgsCount?this.imageItems[0]:this.imageURL;b.advancedName=this.advancedObj.setShoppingCartAdvanced().toString();b.title=this.config.Detailed.title;
b.sing=this.config.Detailed.sing;b.price=this.config.Detailed.proce;b.number=parseInt(this.input.val());b.quantity=this.config.Detailed.quantity;this.shoppingCart.addProduct(b);toolBar.getButton("ShoppingCart").setNumber(this.shoppingCart.refreshInputValue())}.bind(this))},show:function(){this.visible=!0;this.changeLanguage();this.textTitle.css({display:"block"});this.contentText.css({display:"block"});this.mAddToCart.css({display:"block"});this.mCheckOut.css({display:"block"});this.phoneContainer.css({display:"block"});
animateOnce.delay(this,10,[this.phoneContainer,{transform:"translate(0,0)","-webkit-transform":"translate(0,0)","-moz-transform":"translate(0,0)","-o-transform":"translate(0,0)","-ms-transform":"translate(0,0)"},.5,null,"","ease"])},hide:function(){animateOnce(this.phoneContainer,{transform:"translate("+windowWidth+"px,0)","-webkit-transform":"translate("+windowWidth+"px,0)","-moz-transform":"translate("+windowWidth+"px,0)","-o-transform":"translate("+windowWidth+"px,0)","-ms-transform":"translate("+
windowWidth+"px,0)"},.3,function(){this.phoneContainer.css({display:"none"})}.bind(this),"","ease");this.visible=!1},informationHide:function(){this.mAddToCart.css({display:"none"});this.mCheckOut.css({display:"none"});this.textTitle.css({display:"none"});this.contentText.css({display:"none"})},onResize:function(a,b){this.phoneContainer.css({width:windowWidth+"px",height:"100%"});this.visible||this.phoneContainer.css({transform:"translate("+windowWidth+"px,0)","-webkit-transform":"translate("+windowWidth+
"px,0)","-moz-transform":"translate("+windowWidth+"px,0)","-o-transform":"translate("+windowWidth+"px,0)","-ms-transform":"translate("+windowWidth+"px,0)"});this.setMobileShopCss();if(this.shoppingCart)this.shoppingCart.onResize()}}).extend(PageItem.ProductDetailsPanel);
Class("MobileShoppingCartPanel",{Package:"PageItem",create:function(a,b){this.config=a;this.setting=b;this.mCart=$("<div></div>");this.cToolBar=$("<div></div>");this.cClose=$("<div></div>");this.cTitle=$("<div>"+getLanguage("TStuffCart_DetailedCost","Shopping Cart")+"</div>");this.deletes=$("<span>Delete</span>");this.total=$("<span style='font-size:10px'>("+getLanguage("ShappingCart_Total","Total")+":$0.00)</span>");this.mCartCheck=$("<div>"+getLanguage("ShappingCart_CheckOut","Checkout")+"</div>");
this.cartMailto=$("<a style='text-decoration: none'></a>");this.item=$("<span style='position: absolute;bottom: 40px;left: 20px;font-size:12px;font-family:Tahoma;font-weight:bold'></span>");this.mCart.append(this.cartMailto);this.cartMailto.append(this.mCartCheck);this.mCartCheck.append(this.total);this.shop=$("<div></div>");this.mCart.append(this.cToolBar).append(this.deletes).append(this.shop);this.cToolBar.append(this.cClose).append(this.cTitle);this.initCss();this.initEvent();this.canCheckout=
!1},changeLanguage:function(){this.cTitle.html(getLanguage("TStuffCart_TypeCart","Shopping Cart"));this.deletes.html(getLanguage("lblDelete","Delete"));this.total.html(getLanguage("ShappingCart_Total","Total")+":$0.00)");this.mCartCheck.html(getLanguage("ShappingCart_CheckOut","Checkout"))},addProduct:function(a){a=ShoppingCartUtil.addProduct(a);this.shop.empty();this.shoppingItems=[];for(var b=0;b<a.length;b++){var c=new PageItem.MobileShoppingCartItem(this,a[b]);this.shop.append(c.singleShop);this.shoppingItems.push(c)}this.refreshTotalValue()},
initEvent:function(){this.cartMailto.onTap(function(){bookConfig.googleAnalyticsID&&gtag("event","click",{event_category:"ShoppingCart",event_label:"CheckOutAll"});this.doCheckout()}.bind(this));this.cClose.onTap(function(){this.hideCart()}.bind(this));var a=function(b,c){c=30*windowWidth/1600;Math.abs(b)<=c||b>c&&this.hideCart()}.bind(this);this.mCart.speed(a);this.deletes.onTap(function(){for(var b=0;b<this.shoppingItems.length;){var c=this.shoppingItems[b];c.isSelected()?(this.removeItem(c),this.refreshTotalValue(),
toolBar.getButton("ShoppingCart").setNumber(this.refreshInputValue())):b++}}.bind(this))},initCss:function(){this.mCart.css({display:"none",width:windowWidth+"px",height:windowHeight+"px",position:"absolute",transform:"translate(100%,0)","-webkit-transform":"translate(100%,0)","-moz-transform":"translate(100%,0)","-o-transform":"translate(100%,0)","-ms-transform":"translate(100%,0)","background-color":"#f4f4f4","z-index":"3000"});this.setCartCss()},setCartCss:function(){this.shop.css({width:windowWidth-
20+"px",height:.78*windowHeight+"px",position:"absolute",margin:"auto",top:"0px",left:"0px",bottom:"0px",right:"0px","overflow-x":"hidden"});this.mCartCheck.css({position:"absolute","background-color":"#ff4400",width:2/3*windowWidth+"px",height:"40px","text-align":"center","line-height":"2.5","font-family":"Arial",right:"0",bottom:"0",cursor:"pointer",color:"white"});this.deletes.css({position:"absolute","background-color":"#666666",width:windowWidth/3+"px",height:"40px","text-align":"center","line-height":"2.5",
"font-family":"Arial","margin-left":"0",bottom:"0",cursor:"pointer",color:"white"});this.cTitle.css({position:"absolute",width:windowWidth/2,margin:"auto","font-size":"18px","font-family":"Tahoma",color:"rgb(140,140,140)","vertical-align":"middle","line-height":"2.5",left:"0",top:"0",bottom:"0",right:"0","text-align":"center"});this.cToolBar.css({position:"relative",width:windowWidth+"px","background-color":"white",border:"rgb(239,232,232) 1px solid",height:"40px"});this.cClose.css({position:"absolute",
margin:"auto","background-image":"url("+uiBaseURL+"background_prev.png)","background-repeat":"no-repeat","background-position":"4px 4px",cursor:"pointer",width:"28px",height:"28px",left:"10px",bottom:"0",top:"0"})},getCartProducts:function(){var a=ShoppingCartUtil.getProductsFromStorage();this.shop.empty();this.shoppingItems=[];for(var b=0;b<a.length;b++){var c=new PageItem.MobileShoppingCartItem(this,a[b]);this.shop.append(c.singleShop);this.shoppingItems.push(c)}this.refreshTotalValue()},onResize:function(a,
b){this.mCart.css({width:windowWidth+"px",height:windowHeight+"px"});this.setCartCss()},showCart:function(){this.getCartProducts();this.changeLanguage();tmpContainer.append(this.mCart);this.mCart.css({display:"block"});animateOnce.delay(this,10,[this.mCart,{transform:"translate(0,0)","-webkit-transform":"translate(0,0)","-moz-transform":"translate(0,0)","-o-transform":"translate(0,0)","-ms-transform":"translate(0,0)"},.5,null,"","ease"])},hideCart:function(){animateOnce(this.mCart,{transform:"translate(100%,0)",
"-webkit-transform":"translate(100%,0)","-moz-transform":"translate(100%,0)","-o-transform":"translate(100%,0)","-ms-transform":"translate(100%,0)"},.3,function(){this.mCart.css({display:"none"})}.bind(this),"","ease")}}).extend(PageItem.ShoppingCartPanel);
Class("MobileShoppingCartItem",{Package:"PageItem",create:function(a,b){this.initHtml(a,b);null==this.product.advancedName||""==this.product.advancedName?(this.carttitle.text(this.carttitle.text().overflow(18)),this.carttitle.text(this.product.title)):this.carttitle.text(this.product.title+"("+this.product.advancedName+")");this.cartPrice.text(this.product.sing+forceFloat(this.product.price));this.shoppingImage.attr("src",this.product.image);this.singleShop.append(this.checkBox).append(this.shoppingImage).append(this.carttitle).append(this.cartPrice).append(this.addlow).append(this.cartadd).append(this.cartInput).append(this.cartlow).append($("<hr style='position:absolute;margin:auto;margin-top:85px;width:100%'/>"));
parseInt(this.cartInput.val())>parseInt(b.quantity)&&(this.addlow.append(this.cartNot),this.cartInput.css({"border-color":"red"}),this.canCheckout=!1);this.setOneShop();this.initEvent()},initHtml:function(a,b){this.mobileShop=a;this.product=b;this.addlow=$("<div></div>");this.singleShop=$("<div></div>");this.checkBox=$("<input type='checkbox' name='checkbox1' style='position:relative;top:46px;' />");this.checkBox[0].product=b;this.shoppingImage=$("<img/>");this.cartNot=$("<span style='position:absolute;color:red;font-size:10px;width:120px;right:0;height:10px'>Not enough in stock</span>");
_agent_.browser.safari&&_agent_.system.name==_agent_.system.IOS?(this.cartInput=$("<input type='text' value='"+this.product.number+"' style='width:36px;margin-top:70px;text-align:center;height:21px;outline:medium;right:26px;position:absolute;border:1px solid rgb(255,255,255)'/>"),this.cartInput.allowNumberOnly(),this.cartadd=$("<img src='"+uiBaseURL+"cartAdd.png' style='cursor:pointer;margin-top:70px;width:25px ;height:25px;right:70px;position:absolute;background-color:#DDDDDA' />"),this.cartlow=
$("<img src='"+uiBaseURL+"cartLow.png' style='cursor:pointer;margin-top:70px;width:25px ;height:25px;right:1px;position:absolute;background-color:#DDDDDA'/>")):(this.cartInput=$("<input type='text' value='"+this.product.number+"' style='width:36px;margin-top:70px;text-align:center;height:21px;outline:medium;right:31px;position:absolute;border:1px solid rgb(255,255,255)'/>"),this.cartInput.allowNumberOnly(),this.cartadd=$("<img src='"+uiBaseURL+"cartAdd.png' style='cursor:pointer;margin-top:70px;width:25px ;height:25px;right:70px;position:absolute;background-color:#DDDDDA' />"),
this.cartlow=$("<img src='"+uiBaseURL+"cartLow.png' style='cursor:pointer;margin-top:70px;width:25px ;height:25px;right:5px;position:absolute;background-color:#DDDDDA'/>"));this.carttitle=$("<span style='width:220px;height:45px;position:absolute;overflow:auto;margin-top: 20px;left:115px;font-family:Tahoma;font-size:12px'></span>");this.cartPrice=$("<span></span>")},initEvent:function(){this.checkBox.bind("change",function(){(function(){this.mobileShop.refreshTotalValue();toolBar.getButton("ShoppingCart").setNumber(this.mobileShop.refreshInputValue())}).delay(this,
20)}.bind(this));this.cartInput.bind("blur",function(){var a=parseInt(this.cartInput.val());a>this.product.quantity?(this.addlow.append(this.cartNot),this.cartInput.css({"border-color":"red"}),this.canCheckout=!1):(this.cartNot.remove(),this.cartInput.css({"border-color":"rgb(255,255,255)"}),this.canCheckout=!0);this.product.number=a;this.mobileShop.refreshTotalValue();ShoppingCartUtil.saveProducts(this.mobileShop.shoppingItems,this.mobileShop.setting);toolBar.getButton("ShoppingCart").setNumber(this.mobileShop.refreshInputValue())}.bind(this));
this.cartadd.onTap(function(){var a=parseInt(this.cartInput.val());a+=1;this.cartInput.val(a);this.product.number=a;this.mobileShop.refreshTotalValue();a>this.product.quantity?(this.addlow.append(this.cartNot),this.cartInput.css({"border-color":"red"}),this.canCheckout=!1):this.canCheckout=!0;ShoppingCartUtil.saveProducts(this.mobileShop.shoppingItems,this.mobileShop.setting);toolBar.getButton("ShoppingCart").setNumber(this.mobileShop.refreshInputValue())}.bind(this));this.cartlow.onTap(function(){var a=
parseInt(this.cartInput.val());a=1>a-1?1:a-1;0>a||(this.cartInput.val(a),this.product.number=a,this.mobileShop.refreshTotalValue(),this.mobileShop.refreshInputValue(),a<=this.product.quantity?(this.cartNot.remove(),this.cartInput.css({"border-color":"rgb(255,255,255)"}),this.canCheckout=!0):this.canCheckout=!1,ShoppingCartUtil.saveProducts(this.mobileShop.shoppingItems,this.mobileShop.setting),toolBar.getButton("ShoppingCart").setNumber(this.mobileShop.refreshInputValue()))}.bind(this))},isSelected:function(){return this.checkBox[0].checked},
setOneShop:function(){this.cartPrice.css({position:"absolute",width:"170px",height:"20px",lineHeight:"20px","font-size":"15px",color:"rgb(250,11,11)","margin-top":"75px","font-family":"Tahoma",left:"115px"});this.addlow.css({width:"115px",height:"20px",position:"absolute",right:"0px","margin-top":"28px"});this.shoppingImage.css({position:"absolute",width:"70px",height:"70px","margin-top":"20px","margin-left":"10px"});this.singleShop.css({width:windowWidth+"px",height:"120px"})}}).extend(ShoppingCartItem);
global.shoppingCountHTML=$("<span class='shoppingCount'>0</span>");
Class("PCProductDetailsPanel",{Package:"PageItem",create:function(a,b,c){this.advancedObj=new PageItem.ShoppingAdvancedProperty(a);this._super(a,b,c);this.shoppingCart||(this.shoppingCart=new PageItem.PCShoppingCartPanel(a,b),window.shoppingCart=this.shoppingCart);this.shoppingCart.onClose=this.shoppingCartClose.bind(this);shoppingCountHTML.html(this.shoppingCart.refreshInputValue());this.canCheckout=!0;this.visible=!1},parseConfig:function(a){return{annotype:a.annotype,x:a.location.x,y:a.location.y,
width:a.location.width,height:a.location.height,bgColor:a.bgColor,bgAlpha:a.bgAlpha,cartType:a.cartType,imgUrl:a.imgUrl,titleStr:a.titleStr,url:a.url,languageLayout:a.languageLayout,Detailed:a.Detailed}},destroy:function(){this.container.empty();this.container.remove()},initUI:function(){this.initHtml();this.setShopCss();tmpContainer.append(this.bgImage);tmpContainer.append(this.container);this.container.append(this.content);this.container.append(this.closeButton);this.content.append(this.imgBox);
this.imgBox.append(this.shopImg);this.contentText.append(this.shopTitle);this.contentText.append(this.shopPrice);this.initAdvanced();this.quantityBox.append(this.number);this.inputBox.append(this.add);this.inputBox.append(this.input);this.inputBox.append(this.low);this.quantityBox.append(this.inputBox);this.contentText.append(this.quantityBox);this.contentText.append(this.allQuantity);this.contentText.append(this.time);this.contentText.append(this.about);this.contentText.append(this.addToCart);this.content.append(this.contentText);
this.shopTitle.html(this.config.Detailed.title);this.shopTitle.text(this.shopTitle.text().overflow(14));this.shopTitle.attr("title",this.config.Detailed.title);this.mailto=$("<a></a>");this.mailto.append(this.checkout);this.contentText.append(this.mailto);this.contentText.append(this.close);!1===this.setting.shoppingCartOptinon.showPrice&&this.shopPrice.css({display:"none"});!1===this.setting.shoppingCartOptinon.showTime&&this.time.css({display:"none"});this.initImgs();$(window).resize(this.onResize.bind(this));
this.hide()},initHtml:function(){"right"==this.config.languageLayout&&(this.alignCss={"text-align":"right",direction:"rtl"});(this.imgs=this.config.Detailed.imgs)&&!this.imgs[0]&&(this.imgs=[this.imgs.img]);this.imgs||(this.imgs=[this.config.imgUrl]);this.imgBox=$("<div></div>");this.shopImg=$("<img/>");this.background=$("<div></div>");this.container=$("<div id='ShoppingCart' ></div>");this.closeButton=$("<div></div>");this.content=$("<div></div>");this.contentText=$("<div></div>");this.innerContent=
$("<div></div>");this.shopTitle=$("<div></div>");this.allQuantity=$("<div> "+this.config.Detailed.quantity+" In Stock</div>");this.bgImage=$("<div style='display:none'></div>");this.alignCss?(this.shopPrice=$("<div>"+this.config.Detailed.sing+this.config.Detailed.proce+" : Price</div>"),this.time=$("<div>"+this.config.Detailed.time+" day(s) : Delivery time</div>"),bookConfig.isFlipPdf&&(this.shopPrice.html(this.config.Detailed.sing+this.config.Detailed.proce+" : \u4ef7\u683c"),this.time.html(this.config.Detailed.time+
" \u5929\u6570(s) : \u4ea4\u8d27\u65f6\u95f4"))):(this.shopPrice=$("<div>Price :  "+this.config.Detailed.sing+this.config.Detailed.proce+"</div>"),this.time=$("<div>Delivery time : "+this.config.Detailed.time+" day(s)</div>"),bookConfig.isFlipPdf&&(this.shopPrice.html("\u4ef7\u683c :  "+this.config.Detailed.sing+this.config.Detailed.proce),this.time.html("\u4ea4\u8d27\u65f6\u95f4 : "+this.config.Detailed.time+" \u5929\u6570(s)")));this.about=$("<div>"+this.config.Detailed.about+"</div>");this.number=
$("<div style='position:relative;'>Quantity : </div>");this.addToCart=$("<span>Add to cart</span>");this.checkout=$("<div>"+this.config.Detailed.checkOutBtnName+"</div>");this.close=$("<span>"+this.config.Detailed.closeBtnName+"</span>");this.quantityBox=$("<div style='position:relative;'></div>");this.inputBox=$("<div class='inputBox' style='position:absolute;top:0;left:60px;'></div>");this.input=$("<input type='text' value='1' style='float:left;width : 70px;height:14px;line-height:14px;outline:medium;background:transparent;border:1px solid rgb(150,150,150);text-align:center'/>");
this.input.allowNumberOnly();this.add=$("<img src='"+uiBaseURL+"cartAdd.png' style='float:left;cursor:pointer;width:18px ;height:18px;background:#ddd;' />");this.low=$("<img src='"+uiBaseURL+"cartLow.png' style='float:left;cursor:pointer;width:18px ;height:18px;background:#ddd;'/>");this.not=$("<span style='position:absolute;color:red;font-size:10px;width:115px;line-height:18px;height:18px;right:0'>Not enough in stock</span>")},changeLanguage:function(){this.allQuantity.html(this.config.Detailed.quantity+
" "+getLanguage("ShappingCart_InStock","In Stock"));this.number.html(getLanguage("TStuffCart_DetailedQuantity","Quantity")+" :");this.not.html(getLanguage("ShappingCart_NotStock","Not enough in stock"));this.addToCart.html(getLanguage("ShappingCart_AddCart","Add to cart"));this.alignCss?(this.shopPrice.html(this.config.Detailed.sing+this.config.Detailed.proce+" : "+getLanguage("TStuffCart_DetailedPrice","Price")),this.time.html(this.config.Detailed.time+getLanguage("TStuffCart_DetailedDay","day(s)")+
" : "+getLanguage("TStuffCart_DetailedTime","Delivery time"))):(this.shopPrice.html(getLanguage("TStuffCart_DetailedPrice","Price")+" : "+this.config.Detailed.sing+this.config.Detailed.proce),this.time.html(getLanguage("TStuffCart_DetailedTime","Delivery time")+" : "+this.config.Detailed.time+getLanguage("TStuffCart_DetailedDay","day(s)")))},initAdvanced:function(){if(""!=this.advancedObj.advanced)for(var a=0,b=0;b<this.advancedObj.advanceLength;b++)a+=30,"boolean"==this.advancedObj.advanced[b].type&&
this.contentText.append(this.advancedObj.shopAdvanced1),"text"==this.advancedObj.advanced[b].type&&this.contentText.append(this.advancedObj.shopAdvanced2),"list"==this.advancedObj.advanced[b].type&&(a+=20*parseInt(this.advancedObj.advanced[b].value.split(";").length/5),this.contentText.append(this.advancedObj.shopAdvanced3)),this.about.css({width:"300px",height:150-a+"px","margin-top":"10px","font-size":"10px","font-family":"Arial","overflow-x":"hidden"})},initImgs:function(){if(this.imgs&&this.imgs.length){this.imageItems=
[];for(var a=0;a<this.imgs.length;a++)this.imageItems.push(this.imgs[a]),bookConfig.isFlipPdf&&this.imageItems[a]&&(this.imageItems[a].startsWith("./")?this.imageItems[a]="."+this.imageItems[a]:this.imageItems[a].isUrl()||(this.imageItems[a]="../"+this.imageItems[a]));1<this.imgs.length&&(this.imageURL=this.imageItems[0],this.initButton());this.setImgs(this.imageItems[0])}},setImgs:function(a){this.shopImg.attr("src",a)},initButton:function(){this.leftButton=$('<img src="'+uiBaseURL+'photo_prev.png" style="position:absolute;z-index:1000;cursor:pointer;opacity:0.8;"></img>');
this.rightButton=$('<img src="'+uiBaseURL+'photo_next.png" style="position:absolute;z-index:1000;cursor:pointer;opacity:0.8;"></img>');this.setButtonPosition();this.currentIndex=0;var a=this.imageItems.length;this.leftButton.bind(_event._click,function(){this.busy=!0;0==this.currentIndex&&(this.currentIndex+=a);this.currentIndex=(this.currentIndex-1)%a;this.imageURL=this.imageItems[this.currentIndex];this.setImgs(this.imageURL)}.bind(this));this.rightButton.bind(_event._click,function(){this.busy=
!0;this.currentIndex=(this.currentIndex+1)%a;this.imageURL=this.imageItems[this.currentIndex];this.setImgs(this.imageURL)}.bind(this));this.imgBox.append(this.leftButton).append(this.rightButton)},setButtonPosition:function(){this.leftButton.css({left:"17px",top:"143.5px"});this.rightButton.css({right:"17px",top:"143.5px"})},setShopCss:function(){this.bgImage.css({position:"absolute",width:windowWidth+"px",height:windowHeight+"px",opacity:"0.5",top:0,"background-color":"black","z-index":"100"});var a=
"translate(0, "+-((windowHeight-430)/2+430)+"px)";this.container.css({position:"absolute",width:"730px",height:"430px",margin:"auto",left:"0",top:"0",bottom:"0",right:"0",transform:a,"-webkit-transform":a,"-moz-transform":a,"-o-transform":a,"-ms-transform":a,"z-index":"2000"});this.content.css({position:"absolute",width:"700",height:"400",margin:"auto",left:"0",top:"0",bottom:"0",right:"0","background-color":"white","z-index":"2000"});this.closeButton.css({position:"absolute",width:"20px",height:"20px",
right:"0","background-image":"url("+uiBaseURL+"closecat.png)","background-repeat":"no-repeat",cursor:"pointer"});this.imgBox.css({"background-color":"#f4f4f4",position:"absolute",width:"330px",height:"330px",margin:"auto",left:"20px",top:"0",bottom:"20px"});this.shopImg.css({"max-width":"300px","max-height":"300px",position:"absolute",margin:"auto",left:"0",top:"0",bottom:"0",right:"0"});this.contentText.css({position:"absolute",width:"304px",height:"355px",margin:"auto","margin-top":"30px",right:"20px",
"overflow-x":"hidden","-webkit-user-select":"initial","-moz-user-select":"initial","-ms-user-select":"initial","user-select":"initial"});this.shopTitle.css({height:"30px","font-size":"30px",color:"black","font-family":"Arial"});this.about.css({height:"148px","margin-top":"10px","font-size":"10px","font-family":"Arial","overflow-x":"hidden"});this.quantityBox.css({height:"20px","line-height":"17px","margin-top":"10px",color:"black","font-size":"10px","font-family":"Arial"});this.number.css({});this.time.css({height:"14px",
"margin-top":"10px",color:"black","font-size":"10px","font-family":"Arial"});this.allQuantity.css({height:"14px","margin-top":"8px","font-size":"10px",color:Color(44849).toString(),"font-family":"Arial"});this.shopPrice.css({height:"18px","margin-top":"10px","font-size":"16px",color:Color(12845056).toString(),"font-family":"Arial"});this.addToCart.css({background:"rgb(80, 80, 80)","text-align":"center","line-height":"2.0","font-size":"10px","font-family":"Arial","float":"left",padding:"0 5px","margin-top":"25px",
"margin-left":"0",cursor:"pointer",color:"white"});this.checkout.css({background:"rgb(80, 80, 80)","text-align":"center","line-height":"2.0","font-size":"10px","font-family":"Arial","float":"left",padding:"0 5px",margin:"25px 10px 0",cursor:"pointer",color:"white","text-decoration":"none"});this.close.css({background:"rgb(80, 80, 80)","text-align":"center","line-height":"2.0","font-size":"10px","font-family":"Arial","float":"left",padding:"0 5px","margin-top":"25px",cursor:"pointer",color:"white"});
this.alignCss&&(this.contentText.css(this.alignCss),this.inputBox.css({left:"auto",right:"60px"}),this.input.css({"float":"right"}),this.add.css({"float":"right"}),this.low.css({"float":"right"}),this.checkout.css({left:"158px",right:"auto"}),this.close.css({left:"100px",right:"auto"}))},initEvent:function(){this.input.bind("blur",function(){parseInt(this.input.val())>this.config.Detailed.quantity?(this.number.append(this.not),this.input.css({"border-color":"red"}),this.canCheckout=!1):(this.not.remove(),
this.input.css({"border-color":"rgb(150,150,150)"}),this.canCheckout=!0)}.bind(this));this.add.bind(_event._click,function(){var a=this.input.val();a=parseInt(a)+1;this.input.val(a);a>this.config.Detailed.quantity?(this.number.append(this.not),this.input.css({"border-color":"red"}),this.canCheckout=!1):this.canCheckout=!0;ShoppingCartUtil.saveProducts(this.shoppingItems,this.setting)}.bind(this));this.low.bind(_event._click,function(){var a=parseInt(this.input.val());0!=a&&(a=1>a-1?1:a-1,a<=this.config.Detailed.quantity&&
(this.not.remove(),this.input.css({"border-color":"rgb(150,150,150)"}),this.canCheckout=!0),this.input.val(a))}.bind(this));this.mailto.bind(_event._click,function(){bookConfig.googleAnalyticsID&&gtag("event","click",{event_category:"mailtoCheckOut",event_label:"doCheckOut"});this.doCheckout()}.bind(this));this.bgImage.bind(_event._click,function(){this.hide();this.shoppingCart.cart.css({display:"none"})}.bind(this));this.closeButton.bind(_event._click,this.hide.bind(this));this.close.bind(_event._click,
this.hide.bind(this));this.addToCart.bind(_event._click,function(){bookContainer.append(this.cart);this.bgImage.css({display:"none"});this.hide();this.shoppingCart.showCart();var a={};a.image=this.imageItems&&1>=this.imageItems.length?this.imageItems[0]:this.imageURL;a.advancedName=this.advancedObj.setShoppingCartAdvanced().toString();a.title=this.config.Detailed.title;a.sing=this.config.Detailed.sing;a.price=parseInt(this.config.Detailed.proce);a.number=parseInt(this.input.val());a.quantity=parseInt(this.config.Detailed.quantity);
this.shoppingCart.addProduct(a);shoppingCountHTML.html(this.shoppingCart.refreshInputValue())}.bind(this))},shoppingCartClose:function(){this.bgImage.css({display:"none"})},onResize:function(){var a=this.container.css("width"),b=this.container.css("height");this.height=parseInt(b.replace("px",""));this.width=parseInt(a.replace("px",""));this.container.css({"margin-left":(windowWidth-this.width)/2+"px","margin-top":(windowHeight-this.height)/2+"px"});this.bgImage.css({width:windowWidth+"px",height:windowHeight+
"px"})},skipHeid:function(){var a=this.container.css("height");this.height=parseInt(a.replace("px",""));a="translate(0, "+-((windowHeight-this.height)/2+this.height)+"px)";a={transform:a,"-webkit-transform":a,"-moz-transform":a,"-o-transform":a,"-ms-transform":a};this.bgImage.css({display:"none"});animateOnce(this.container,a,.5,null,"","ease-in-out")},hide:function(){if(!this.running){this.running=!0;var a=this.container.css("height");this.height=parseInt(a.replace("px",""));a="translate(0, "+-((windowHeight-
this.height)/2+this.height)+"px)";a={transform:a,"-webkit-transform":a,"-moz-transform":a,"-o-transform":a,"-ms-transform":a};(function(){this.container.css({display:"none"});this.content.css("display","none");this.bgImage.css({display:"none"});this.running=!1}).delay(this,500);animateOnce(this.container,a,.5,null,"","ease-in-out")}},show:function(){this.running||(this.running=!0,this.bgImage.css({display:"block"}),this.changeLanguage(),this.content.css("display","block"),this.container.css({display:"block"}),
animateOnce.delay(this,10,[this.container,{transform:"translate(0px,0px)","-webkit-transform":"translate(0px,0px)","-moz-transform":"translate(0px,0px)","-o-transform":"translate(0px,0px)","-ms-transform":"translate(0px,0px)"},.5,function(){this.running=!1}.bind(this),"","ease-in-out"]))}}).extend(PageItem.ProductDetailsPanel);
Class("PCShoppingCartPanel",{Package:"PageItem",create:function(a,b){this.config=a;this.setting=b;this.cart=$("<div></div>");this.cartTitles=$("<span>Shopping Cart</span>");this.cartprices=$("<span style='position:absolute;font-size:12px;font-weight:bold;margin-top:50px;right:80px;font-family:Tahoma;color:black'>Price</span>");this.cartqu=$("<span style='position:absolute;font-size:12px;font-weight:bold;margin-top:50px;right:180px;font-family:Tahoma;color:black'>Quantity</span>");this.shopping=$("<div id='shopPrice'></div>");
this.item=$("<span class=itemss style='position: absolute;bottom: 40px;left: 10px;font-size:12px;font-family:Tahoma;font-weight:bold'></span>");this.total=$("<span></span>");this.cartCheckout=$("<span>Checkout</span>");this.cartClose=$("<span>Close</span>");this.cartAllDelete=$("<span>DeleteAll</span>");this.deleteBox=$('<div> <span class=\'deleteDetial\'>Delete All Goods? </span><br/><span class="yes">Yes</span><span class="no">No</span></div>');this.cartMailto=$("<a></a>");this.cart.append(this.cartTitles);
this.cart.append(this.cartqu);this.cart.append(this.cartprices);this.cart.append(this.shopping);this.cart.append(this.item);this.cart.append(this.total);this.bgImage=$("<div></div>");this.cartMailto.append(this.cartCheckout);this.cart.append(this.cartAllDelete);this.cart.append(this.cartMailto);this.cart.append(this.cartClose);this.cart.append(this.deleteBox);tmpContainer.append(this.bgImage);tmpContainer.append(this.cart);this.promptBox=$("<div></div>");this.setCartCss();this.hideCart();this.initEvent();
this.canCheckout=!1},initFlipPdfCase:function(){this.cartTitles=$("<span>\u8d2d\u7269\u8f66</span>");this.cartprices.html("\u4ef7\u683c");this.cartqu.html("\u6570\u91cf");this.cartCheckout=$("<span>\u4ed8\u6b3e</span>");this.cartClose=$("<span>\u5173\u95ed</span>");this.cartAllDelete=$("<span>\u5220\u9664\u6240\u6709</span>");this.deleteBox=$('<div>\u786e\u5b9a\u5220\u9664\u6240\u6709\u5546\u54c1\u5417? <br/><span class="yes">\u662f</span><span class="no">\u5426</span></div>')},initEvent:function(){this.bgImage.bind(_event._end,
function(){this.cart.css({display:"none"});this.bgImage.css({display:"none"})}.bind(this));this.deleteBox.find(".yes").bind(_event._click,function(){this.deleteAll();this.deleteBox.hide(300)}.bind(this));this.deleteBox.find(".no").bind(_event._click,function(){this.deleteBox.hide(300)}.bind(this));this.cartAllDelete.bind(_event._click,function(){this.deleteBox.show(300)}.bind(this));this.cartMailto.bind(_event._click,function(){bookConfig.googleAnalyticsID&&gtag("event","click",{event_category:"ShoppingCart",
event_label:"CheckOutAll"});this.doCheckout()}.bind(this));this.cartClose.bind(_event._click,function(){this.hideCart();if(this.onClose)this.onClose();ShoppingCartUtil.saveProducts(this.shoppingItems,this.setting)}.bind(this));$(window).resize(function(){this.bgImage.css({width:windowWidth+"px",height:windowHeight+"px"})}.bind(this))},deleteAll:function(){for(ShoppingCartUtil.setProductsToStorage([]);0<this.shoppingItems.length;)this.removeItem(this.shoppingItems[0]),this.refreshTotalValue()},changeLanguage:function(){this.cartTitles.html(getLanguage("TStuffCart_TypeCart",
"Shopping Cart"));this.cartprices.html(getLanguage("TStuffCart_DetailedPrice","Price"));this.cartqu.html(getLanguage("TStuffCart_DetailedQuantity","Quantity"));this.cartCheckout.html(getLanguage("ShappingCart_CheckOut","Checkout"));this.cartClose.html(getLanguage("ShappingCart_Close","Close"));this.cartAllDelete.html(getLanguage("lblRemoveAll","Remove All"));this.deleteBox.find(".deleteDetial").html(getLanguage("lblRemoveAll","Remove All")+" "+getLanguage("ShappingCart_Item","Items")+"?");this.deleteBox.find(".yes").html(getLanguage("lblDelete",
"Delete"));this.deleteBox.find(".no").html(getLanguage("lblCancel","Cancel"));this.shoppingItems},addProduct:function(a){a=ShoppingCartUtil.addProduct(a);this.shopping.empty();this.shoppingItems=[];for(var b=0;b<a.length;b++){var c=new PageItem.PCShoppingCartItem(this,a[b]);this.shopping.append(c.singleShop);this.shoppingItems.push(c)}this.refreshTotalValue();this.refreshInputValue()},showCart:function(){this.cart.css("display","block");this.bgImage.css("display","block");this.changeLanguage()},hideCart:function(){this.cart.css("display",
"none");this.bgImage.css("display","none")},setCartCss:function(){this.deleteBox.css({"font-family":"Tahoma",display:"none",position:"absolute",width:"300px","padding-top":"20px","text-align":"center",height:"140px",margin:"auto",left:"50%",top:"50%","box-shadow":"0 0 5px #666",background:"#eee",transform:"translate(-50%,-50%)","-webkit-transform":"translate(-50%,-50%)","-moz-transform":"translate(-50%,-50%)","-o-transform":"translate(-50%,-50%)","-ms-transform":"translate(-50%,-50%)","z-index":"3000"});
this.deleteBox.find(".yes").css({position:"absolute",color:"#fff",background:"#33cc33",left:"80px",bottom:"35px",width:"60px",height:"25px","line-height":"25px",cursor:"pointer"});this.deleteBox.find(".no").css({position:"absolute",color:"#fff",background:"rgb(80, 80, 80)",right:"80px",bottom:"35px",width:"60px",height:"25px","line-height":"25px",cursor:"pointer"});this.bgImage.css({position:"absolute",width:windowWidth+"px",height:windowHeight+"px",opacity:"0.5",top:0,"background-color":"black",
"z-index":"100"});this.shopping.css({width:"515px",height:"190px",position:"absolute",margin:"auto",top:"10px",left:"0px",bottom:"0px",right:"0px","overflow-x":"hidden"});this.total.css({position:"absolute",bottom:"40px",right:"20px","font-size":"12px","font-family":"Tahoma","font-weight":"bold",color:"red"});this.cartClose.css({position:"absolute",background:"rgb(80, 80, 80)",width:"40px","text-align":"center","line-height":"2.0","font-size":"10px","font-family":"Arial",bottom:"10px",right:"20px",
cursor:"pointer",color:"white"});this.cartAllDelete.css({position:"absolute",background:"rgb(80, 80, 80)",color:"white",width:"70px","text-align":"center","line-height":"2.0","font-size":"10px","font-family":"Arial",bottom:"10px",left:"10px",cursor:"pointer"});this.cartCheckout.css({position:"absolute",background:"rgb(80, 80, 80)",width:"60px","text-align":"center","line-height":"2.0","font-size":"10px","font-family":"Arial",bottom:"10px",right:"70px",cursor:"pointer",color:"white","text-decoration":"none"});
this.cartTitles.css({position:"absolute",padding:"0 10px",width:"490px","border-bottom":"1px solid white",height:"40px","line-height":"40px","font-size":"14px","font-family":"Tahoma",color:"white","background-color":"rgb(152,152,152)"});this.cart.css({position:"absolute",border:"1px solid white","line-height":"2.5",margin:"auto",left:"0",top:"0",bottom:"0",right:"0",width:"500px",height:"350px","background-color":"rgb(218,218,218)","overflow-x":"hidden","z-index":"3000"});"right"==this.config.languageLayout&&
this.cartTitles.css({direction:"rtl","text-align":"right"})}}).extend(PageItem.ShoppingCartPanel);
Class("PCShoppingCartItem",{Package:"PageItem",create:function(a,b){this.initHtml(a,b);!1===pageEditor.setting.shoppingCartOptinon.showPrice&&this.cartPrice.css({display:"none"});null==this.product.advancedName||""==this.product.advancedName?(this.carttitle.text(this.carttitle.text().overflow(16)),this.carttitle.text(this.product.title),this.carttitle.attr("title",this.product.title)):(25<this.product.advancedName.length&&this.carttitle.attr("title",this.product.title+"("+this.product.advancedName+
")"),this.carttitle.html(this.product.title+"("+this.product.advancedName+")"));this.cartPrice.text(this.product.sing+forceFloat(this.product.price));this.singleShop.append($("<hr style='position:absolute; margin-left:10px;margin-top:85px;width:475px'/>"));parseInt(this.cartInput.val())>parseInt(b.quantity)&&(this.addlow.append(this.cartNot),this.cartInput.css({"border-color":"red"}),this.shop.canCheckout=!1);this.initEvent();this.setCartCSS()},initHtml:function(a,b){this.shop=a;this.product=b;this.cartPrice=
$("<span></span>");this.addlow=$("<div></div>");this.singleShop=$("<div style='width:480px;height:80px'></div>");this.cartInput=$("<input id='cartinput' type='text' value='"+this.product.number+"'/>");this.cartInput.allowNumberOnly();this.shoppingImage=$("<img/>");this.carttitle=$("<span style='width:150px;line-height:35px;height:35px;position:absolute;margin-top: 28px;left:80px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-family:Tahoma;font-size:12px'></span>");this.dustbin=$("<img src='"+
uiBaseURL+"cartDelete.png' style='cursor:pointer;position:absolute;right: 25px;margin-top:35px'/>");this.cartadd=$("<img src='"+uiBaseURL+"cartAdd.png' style='cursor:pointer;width:18px ;height:18px;position:absolute;border:1px solid #bbb;left:25px;background:#eee;' />");this.cartlow=$("<img src='"+uiBaseURL+"cartLow.png' style='cursor:pointer;width:18px ;height:18px;margin-left:97px;position:absolute;border:1px solid #bbb;background:#eee;'/>");this.cartNot=$("<span style='position:absolute;color:red;font-size:10px;width:126px;height:20px;margin-top:15px;text-align:center;left:8px'>"+
getLanguage("ShappingCart_NotStock","Not enough in stock")+"</span>");this.singleShop.append(this.shoppingImage);this.singleShop.append(this.carttitle);this.singleShop.append(this.addlow);this.singleShop.append(this.cartPrice);this.singleShop.append(this.dustbin);this.addlow.append(this.cartadd);this.addlow.append(this.cartlow);this.addlow.append(this.cartInput);this.setImg(this.product.image)},setImg:function(a){this.shoppingImage.attr("src",a)},initEvent:function(){this.cartInput.bind("keyup",function(){var a=
parseInt(this.cartInput.val());""==a&&(a=this.cartInput.val());a>this.product.quantity?(this.addlow.append(this.cartNot),this.cartInput.css({"border-color":"red"}),this.canCheckout=!1):(this.cartNot.remove(),this.cartInput.css({"border-color":"rgb(150,150,150)"}),this.canCheckout=!0);this.product.number=a;this.shop.refreshTotalValue();ShoppingCartUtil.saveProducts(this.shop.shoppingItems,this.shop.setting);shoppingCountHTML.html(this.shop.refreshInputValue())}.bind(this));this.dustbin.bind(_event._click,
function(){this.shop.removeItem(this);this.shop.refreshTotalValue();shoppingCountHTML.html(this.shop.refreshInputValue())}.bind(this));this.cartadd.bind(_event._click,function(){var a=this.cartInput.val();a=parseInt(a)+1;this.cartInput.val(a);this.product.number=a;a>this.product.quantity&&(this.addlow.append(this.cartNot),this.cartInput.css({"border-color":"red"}));this.shop.refreshTotalValue();ShoppingCartUtil.saveProducts(this.shop.shoppingItems,this.shop.setting);shoppingCountHTML.html(this.shop.refreshInputValue())}.bind(this));
this.cartlow.bind(_event._click,function(){var a=this.cartInput.val();0!=parseInt(a)&&(a=1>parseInt(a)-1?1:parseInt(a)-1,this.cartInput.val(a),this.product.number=a,a<=this.product.quantity&&(this.cartNot.remove(),this.cartInput.css({"border-color":"rgb(150,150,150)"})),this.shop.refreshTotalValue(),ShoppingCartUtil.saveProducts(this.shop.shoppingItems,this.shop.setting),shoppingCountHTML.html(this.shop.refreshInputValue()))}.bind(this))},setCartCSS:function(){this.cartPrice.css({position:"absolute",
width:"70px",height:"20px","font-size":"12px",color:"black","margin-top":"30px","font-family":"Tahoma",right:"65px"});this.cartInput.css({"text-align":"center",width:"40px",height:"16px",outline:"medium","margin-left":"50px",position:"absolute",background:"#fff",border:"1px solid rgb(150,150,150)"});this.addlow.css({width:"120px",height:"40px",right:"170px",position:"absolute","margin-top":"35px"});this.shoppingImage.css({position:"absolute",width:"52px",height:"35px","margin-top":"28px",left:"10px",
"-moz-box-shadow":"0 0 5px #fff","-o-box-shadow":"0 0 5px #fff","-webkit-box-shadow":"0 0 5px #fff","box-shadow":"0 0 5px #fff"})}}).extend(PageItem.ShoppingCartItem);
Class("Pentagon",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b,c,d);this.animateConfig();this.color=Color(this.config.color).toString();this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.colorA=Color(this.config.colorA).toString();this.colorB=Color(this.config.colorB).toString();this.pentagon=$("<canvas width='"+this.width+"' height='"+this.height+"'></canvas>");this.pentagon.css({position:"absolute",
opacity:this.config.alpha,left:this.x+"px",top:this.y+"px"});this.setRotation(this.pentagon,this.config.rotation);this.parent.append(this.pentagon);this.draw();this.initEvent();this.imageReflection(this.pentagon)},parseConfig:function(a){return{x:a.location.x,y:a.location.y,width:a.location.width,height:a.location.height,rotation:a.location.rotation,alpha:a.alpha,fillStyle:a.fillStyle,color:a.color,colorA:a.gradientColorA,colorB:a.gradientColorB,angle:a.angle,spalpha:a.spalpha,reflection:a.location.reflection,
reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,borderWidth:a.borderWidth,borderColor:a.borderColor,borderAlpha:a.borderAlpha,sh:parseBool(a.shadow.hasDropShadow),sa:a.shadow.shadowAngle,sx:a.shadow.shadowBlurX,sy:a.shadow.shadowBlurY,se:a.shadow.shadowDistance,sr:a.shadow.shadowColor,action:a.action,animation:a.animation}},draw:function(){var a=this.pentagon[0],b=a.getContext("2d");b.clearRect(0,0,a.width,a.height);this.width-=this.config.borderWidth;this.height-=
this.config.borderWidth;b.beginPath();b.lineCap="round";b.lineJoin="round";b.strokeStyle=Color(this.config.borderColor).toString();b.lineWidth=this.config.borderWidth;b.globalAlpha=this.config.spalpha;b.moveTo(this.config.borderWidth,3*this.height/8);b.lineTo(this.width/6,this.height);b.lineTo(5*this.width/6,this.height);b.lineTo(this.width,3*this.height/8);b.lineTo(this.width/2,this.config.borderWidth);this.config.sh&&this.setShapeShadow(b);if("gradient"==this.config.fillStyle){a=this.config.angle*
Math.PI/180;var c=(Number(this.config.angle)+180)*Math.PI/180;a=b.createLinearGradient(this.width/2+this.width/2*Math.cos(c),this.height/2+this.height/2*Math.sin(c),this.width/2+this.width/2*Math.cos(a),this.height/2+this.height/2*Math.sin(a));a.addColorStop(0,this.colorA);a.addColorStop(1,this.colorB);b.fillStyle=a;b.fill()}"Pure"==this.config.fillStyle&&(b.fillStyle=this.color,b.fill());b.closePath();0!=this.config.borderWidth&&b.stroke()},initEvent:function(){this.linkURL="";null!=this.config.action&&
(null!=this.config.action.length&&(this.config.action=this.config.action[0]),this.linkURL=this.config.action.url,null!=this.linkURL&&"www"==this.linkURL.substr(0,3).toLowerCase()&&(this.linkURL="http://"+this.linkURL));this.pentagon.onTap(function(a){BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),"Pentagon",this.config.x,this.config.y,this.config.width,this.config.height]);bookConfig.googleAnalyticsID&&gtag("event","click",{event_category:"Pentagon",event_label:"Page"+BookInfo.getCurrentPages()[0]})}.bind(this));
this.addActionEvent(this.pentagon)},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.pageWidth*this.config.width;this.height=this.pageHeight*this.config.height;this.pentagon[0].width=this.width;this.pentagon[0].height=this.height;this.draw();this.setPosition()},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.pentagon.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+
" "+b.direction});this.pentagon.one(a,function(){this.pentagon.css({animation:""})}.bind(this))}},setPosition:function(){this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.pentagon.css({left:this.x+"px",top:this.y+"px"})}}).extend(PageItem.Item);
Class("Dovetailed",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b,c,d);this.animateConfig();this.color=Color(this.config.color).toString();this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.pageHeights=this.config.pageHeight;this.width=Number(this.config.width*this.pageWidth);this.height=Number(this.config.height*this.pageHeight);this.colorA=Color(this.config.colorA).toString();this.colorB=Color(this.config.colorB).toString();this.dovetailed=$("<canvas width='"+
this.width+"' height='"+this.height+"'></canvas>");this.dovetailed.css({position:"absolute",opacity:this.config.alpha,left:this.x+"px",top:this.y+"px"});this.setRotation(this.dovetailed,this.config.rotation);this.parent.append(this.dovetailed);this.draw(this.pageWidth);this.initEvent();parseBool(this.config.reflection)&&this.imageReflection(this.dovetailed)},parseConfig:function(a){return{x:a.location.x,y:a.location.y,rotation:a.location.rotation,width:a.location.width,height:a.location.height,pageWidth:a.location.pageWidth,
pageHeight:a.location.pageHeight,alpha:a.alpha,fillStyle:a.fillStyle,color:a.color,colorA:a.gradientColorA,colorB:a.gradientColorB,angle:a.angle,spalpha:a.spalpha,arrowWidth:a.arrowWidth,borderWidth:a.borderWidth,borderColor:a.borderColor,borderAlpha:a.borderAlpha,reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,sh:parseBool(a.shadow.hasDropShadow),sa:a.shadow.shadowAngle,sx:a.shadow.shadowBlurX,sy:a.shadow.shadowBlurY,se:a.shadow.shadowDistance,
sr:a.shadow.shadowColor,action:a.action,animation:a.animation}},draw:function(a){var b=this.dovetailed[0],c=b.getContext("2d");this.config.borderWidth=Number(this.config.borderWidth);c.clearRect(0,0,b.width,b.height);this.width-=this.config.borderWidth;this.height-=this.config.borderWidth;this.config.pageWidth||(this.config.pageWidth=bookConfig.largePageWidth);this.arrowWidth=this.config.arrowWidth/this.config.pageWidth*a;this.arrowWidth>2*this.width/3&&(this.arrowWidth=this.width-2*this.width/3);
0==this.arrowWidth&&(this.arrowWidth=10);this.dovetailWidth=this.width-this.arrowWidth;c.beginPath();c.lineCap="round";c.lineJoin="round";c.strokeStyle=Color(this.config.borderColor).toString();c.lineWidth=this.config.borderWidth;c.globalAlpha=this.config.spalpha;c.moveTo(this.config.borderWidth,this.config.borderWidth);c.lineTo(this.arrowWidth,(this.height+this.config.borderWidth)/2);c.lineTo(this.config.borderWidth,this.height);c.lineTo(this.dovetailWidth,this.height);c.lineTo(this.width,(this.height+
this.config.borderWidth)/2);c.lineTo(this.dovetailWidth,this.config.borderWidth);this.config.sh&&this.setShapeShadow(c);"gradient"==this.config.fillStyle&&(a=this.config.angle*Math.PI/180,b=(Number(this.config.angle)+180)*Math.PI/180,a=c.createLinearGradient(this.width/2+this.width/2*Math.cos(b),this.height/2+this.height/2*Math.sin(b),this.width/2+this.width/2*Math.cos(a),this.height/2+this.height/2*Math.sin(a)),a.addColorStop(0,this.colorA),a.addColorStop(1,this.colorB),c.fillStyle=a,c.fill());"Pure"==
this.config.fillStyle&&(c.fillStyle=this.color,c.fill());c.closePath();0!=this.config.borderWidth&&c.stroke()},initEvent:function(){this.flag=0;this.linkURL="";null!=this.config.action&&(null!=this.config.action.length&&(this.config.action=this.config.action[0]),this.linkURL=this.config.action.url,null!=this.linkURL&&"www"==this.linkURL.substr(0,3).toLowerCase()&&(this.linkURL="http://"+this.linkURL));this.dovetailed.onTap(function(a){BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),
"Dovetailed",this.config.x,this.config.y,this.config.width,this.config.height]);bookConfig.googleAnalyticsID&&gtag("event","click",{event_category:"Dovetailed",event_label:"Page"+BookInfo.getCurrentPages()[0]})}.bind(this));this.addActionEvent(this.dovetailed)},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.pageWidth*this.config.width;this.height=this.pageHeight*this.config.height;this.dovetailed[0].width=this.width;this.dovetailed[0].height=this.height;this.draw(this.pageWidth);
this.setPosition()},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.dovetailed.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.dovetailed.one(a,function(){this.dovetailed.css({animation:""})}.bind(this))}},setPosition:function(){this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.dovetailed.css({left:this.x+"px",top:this.y+"px"})}}).extend(PageItem.Item);
Class("Parallelogram",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b,c,d);this.animateConfig();this.color=Color(this.config.color).toString();this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.colorA=Color(this.config.colorA).toString();this.colorB=Color(this.config.colorB).toString();this.parallelogram=$("<canvas width='"+this.width+"' height='"+this.height+"' id='prismatic'></canvas>");
this.parallelogram.css({position:"absolute",opacity:this.config.alpha,left:this.x+"px",top:this.y+"px"});this.setRotation(this.parallelogram,this.config.rotation);this.parent.append(this.parallelogram);this.draw();this.initEvent();this.imageReflection(this.parallelogram)},parseConfig:function(a){return{x:a.location.x,y:a.location.y,width:a.location.width,height:a.location.height,rotation:a.location.rotation,alpha:a.alpha,fillStyle:a.fillStyle,color:a.color,colorA:a.gradientColorA,colorB:a.gradientColorB,
angle:a.angle,spalpha:a.spalpha,reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,borderWidth:a.borderWidth,borderColor:a.borderColor,borderAlpha:a.borderAlpha,sh:parseBool(a.shadow.hasDropShadow),sa:a.shadow.shadowAngle,sx:a.shadow.shadowBlurX,sy:a.shadow.shadowBlurY,se:a.shadow.shadowDistance,sr:a.shadow.shadowColor,action:a.action,animation:a.animation}},draw:function(){var a=this.parallelogram[0],b=a.getContext("2d");b.clearRect(0,
0,a.width,a.height);this.width-=this.config.borderWidth;this.height-=this.config.borderWidth;b.beginPath();b.lineCap="round";b.lineJoin="round";b.strokeStyle=Color(this.config.borderColor).toString();b.lineWidth=this.config.borderWidth;b.globalAlpha=this.config.spalpha;b.moveTo(this.width/4,this.config.borderWidth);b.lineTo(this.config.borderWidth,this.height);b.lineTo(3*this.width/4+2,this.height);b.lineTo(this.width,this.config.borderWidth);parseBool(this.config.sh)&&this.setShapeShadow(b);if("gradient"==
this.config.fillStyle){a=this.config.angle*Math.PI/180;var c=(Number(this.config.angle)+180)*Math.PI/180;a=b.createLinearGradient(this.width/2+this.width/2*Math.cos(c),this.height/2+this.height/2*Math.sin(c),this.width/2+this.width/2*Math.cos(a),this.height/2+this.height/2*Math.sin(a));a.addColorStop(0,this.colorA);a.addColorStop(1,this.colorB);b.fillStyle=a;b.fill()}"Pure"==this.config.fillStyle&&(b.fillStyle=this.color,b.fill());b.closePath();0!=this.config.borderWidth&&b.stroke()},initEvent:function(){this.linkURL=
"";null!=this.config.action&&(null!=this.config.action.length&&(this.config.action=this.config.action[0]),this.linkURL=this.config.action.url,null!=this.linkURL&&"www"==this.linkURL.substr(0,3).toLowerCase()&&(this.linkURL="http://"+this.linkURL));this.parallelogram.onTap(function(a){BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),"Parallelogram",this.config.x,this.config.y,this.config.width,this.config.height]);bookConfig.googleAnalyticsID&&gtag("event","click",{event_category:"Parallelogram",
event_label:"Page"+BookInfo.getCurrentPages()[0]})}.bind(this));this.addActionEvent(this.parallelogram)},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.pageWidth*this.config.width;this.height=this.pageHeight*this.config.height;this.parallelogram[0].width=this.width;this.parallelogram[0].height=this.height;this.draw();this.setPosition()},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.parallelogram.css({animation:b.name+
" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.parallelogram.one(a,function(){this.parallelogram.css({animation:""})}.bind(this))}},setPosition:function(){this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.parallelogram.css({left:this.x+"px",top:this.y+"px"})}}).extend(PageItem.Item);
Class("Hexagon",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b,c,d);this.animateConfig();this.color=Color(this.config.color).toString();this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.colorA=Color(this.config.colorA).toString();this.colorB=Color(this.config.colorB).toString();this.hexagon=$("<canvas width='"+this.width+"' height='"+this.height+"'></canvas>");this.hexagon.css({position:"absolute",
opacity:this.config.alpha,left:this.x+"px",top:this.y+"px"});this.setRotation(this.hexagon,this.config.rotation);this.parent.append(this.hexagon);this.draw();this.initEvent();parseBool(this.config.reflection)&&this.imageReflection(this.hexagon)},parseConfig:function(a){return{x:a.location.x,y:a.location.y,rotation:a.location.rotation,width:a.location.width,height:a.location.height,alpha:a.alpha,fillStyle:a.fillStyle,color:a.color,colorA:a.gradientColorA,colorB:a.gradientColorB,angle:a.angle,spalpha:a.spalpha,
reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,borderWidth:a.borderWidth,borderColor:a.borderColor,borderAlpha:a.borderAlpha,sh:parseBool(a.shadow.hasDropShadow),sa:a.shadow.shadowAngle,sx:a.shadow.shadowBlurX,sy:a.shadow.shadowBlurY,se:a.shadow.shadowDistance,sr:a.shadow.shadowColor,action:a.action,animation:a.animation}},draw:function(){var a=this.hexagon[0],b=a.getContext("2d");b.clearRect(0,0,a.width,a.height);this.width-=this.config.borderWidth;
this.height-=this.config.borderWidth;b.beginPath();b.lineCap="round";b.lineJoin="round";b.strokeStyle=Color(this.config.borderColor).toString();b.lineWidth=this.config.borderWidth;b.globalAlpha=this.config.spalpha;b.moveTo(this.width/4,this.config.borderWidth);b.lineTo(this.config.borderWidth,this.height/2);b.lineTo(this.width/4,this.height);b.lineTo(3*this.width/4,this.height);b.lineTo(this.width,this.height/2);b.lineTo(3*this.width/4,this.config.borderWidth);this.config.sh&&this.setShapeShadow(b);
if("gradient"==this.config.fillStyle){a=this.config.angle*Math.PI/180;var c=(Number(this.config.angle)+180)*Math.PI/180;a=b.createLinearGradient(this.width/2+this.width/2*Math.cos(c),this.height/2+this.height/2*Math.sin(c),this.width/2+this.width/2*Math.cos(a),this.height/2+this.height/2*Math.sin(a));a.addColorStop(0,this.colorA);a.addColorStop(1,this.colorB);b.fillStyle=a;b.fill()}"Pure"==this.config.fillStyle&&(b.fillStyle=this.color,b.fill());b.closePath();0!=this.config.borderWidth&&b.stroke()},
onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.pageWidth*this.config.width;this.height=this.pageHeight*this.config.height;this.hexagon[0].width=this.width;this.hexagon[0].height=this.height;this.draw();this.setPosition()},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.hexagon.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.hexagon.one(a,
function(){this.hexagon.css({animation:""})}.bind(this))}},setPosition:function(){this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.hexagon.css({left:this.x+"px",top:this.y+"px"})},initEvent:function(){this.linkURL="";null!=this.config.action&&(void 0!=this.config.action.length&&(this.config.action=this.config.action[0]),this.linkURL=this.config.action.url,null!=this.linkURL&&"www"==this.linkURL.substr(1,3).toLowerCase()&&(this.linkURL="http://"+this.linkURL));this.hexagon.onTap(function(a){BookEvent.trigger("clickPageItem",
[BookInfo.getCurrentPageIndex(),"Hexagon",this.config.x,this.config.y,this.config.width,this.config.height]);bookConfig.googleAnalyticsID&&gtag("event","click",{event_category:"Hexagon",event_label:"Page"+BookInfo.getCurrentPages()[0]})}.bind(this));this.addActionEvent(this.hexagon)}}).extend(PageItem.Item);
Class("FlowChart",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b,c,d);this.animateConfig();this.color=Color(this.config.color).toString();this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.colorA=Color(this.config.colorA).toString();this.colorB=Color(this.config.colorB).toString();this.flowChart=$("<canvas width='"+this.width+"' height='"+this.height+"'></canvas>");this.flowChart.css({opacity:this.config.alpha,
position:"absolute",left:this.x+"px",top:this.y+"px"});this.setRotation(this.flowChart,this.config.rotation);this.parent.append(this.flowChart);this.draw();this.initEvent();parseBool(this.config.reflection)&&this.imageReflection(this.flowChart)},parseConfig:function(a){return{x:a.location.x,y:a.location.y,rotation:a.location.rotation,width:a.location.width,height:a.location.height,alpha:a.alpha,fillStyle:a.fillStyle,color:a.color,colorA:a.gradientColorA,colorB:a.gradientColorB,angle:a.angle,spalpha:a.spalpha,
reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,borderWidth:a.borderWidth,borderColor:a.borderColor,borderAlpha:a.borderAlpha,sh:parseBool(a.shadow.hasDropShadow),sa:a.shadow.shadowAngle,sx:a.shadow.shadowBlurX,sy:a.shadow.shadowBlurY,se:a.shadow.shadowDistance,sr:a.shadow.shadowColor,action:a.action,animation:a.animation}},draw:function(){var a=this.flowChart[0],b=a.getContext("2d");b.clearRect(0,0,a.width,a.height);this.width-=
this.config.borderWidth;this.height-=this.config.borderWidth;b.beginPath();b.lineCap="round";b.lineJoin="round";b.strokeStyle=Color(this.config.borderColor).toString();b.lineWidth=this.config.borderWidth;b.globalAlpha=this.config.spalpha;b.moveTo(this.config.borderWidth,this.config.borderWidth);b.lineTo(this.config.borderWidth,this.height);b.lineTo(this.width,this.height);b.lineTo(this.width,this.config.borderWidth);parseBool(this.config.sh)&&this.setShapeShadow(b);if("gradient"==this.config.fillStyle){a=
this.config.angle*Math.PI/180;var c=(Number(this.config.angle)+180)*Math.PI/180;a=b.createLinearGradient(this.width/2+this.width/2*Math.cos(c),this.height/2+this.height/2*Math.sin(c),this.width/2+this.width/2*Math.cos(a),this.height/2+this.height/2*Math.sin(a));a.addColorStop(0,this.colorA);a.addColorStop(1,this.colorB);b.fillStyle=a;b.fill()}"Pure"==this.config.fillStyle&&(b.fillStyle=this.color,b.fill());b.closePath();b.stroke();b.beginPath();b.moveTo(this.width/8+this.config.borderWidth,this.config.borderWidth);
b.lineTo(this.width/8+this.config.borderWidth,this.height);b.closePath();b.stroke();b.beginPath();b.moveTo(7*this.width/8,this.config.borderWidth);b.lineTo(7*this.width/8,this.height);b.closePath();0!=this.config.borderWidth&&b.stroke()},initEvent:function(){this.linkURL="";null!=this.config.action&&(null!=this.config.action.length&&(this.config.action=this.config.action[0]),this.linkURL=this.config.action.url,null!=this.linkURL&&"www"==this.linkURL.substr(0,3).toLowerCase()&&(this.linkURL="http://"+
this.linkURL));this.addActionEvent(this.flowChart)},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.pageWidth*this.config.width;this.height=this.pageHeight*this.config.height;this.flowChart[0].width=this.width;this.flowChart[0].height=this.height;this.draw();this.setPosition()},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.flowChart.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+
b.delay+"s "+b.count+" "+b.direction});this.flowChart.one(a,function(){this.flowChart.css({animation:""})}.bind(this))}},setPosition:function(){this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.flowChart.css({left:this.x+"px",top:this.y+"px"})}}).extend(PageItem.Item);
Class("Cylinder",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b,c,d);this.animateConfig();this.color=Color(this.config.color).toString();this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.colorA=Color(this.config.colorA).toString();this.colorB=Color(this.config.colorB).toString();this.cylinder=$("<canvas width='"+this.width+"' height='"+this.height+"'></canvas>");this.cylinder.css({position:"absolute",
opacity:this.config.alpha,left:this.x+"px",top:this.y+"px"});this.setRotation(this.cylinder,this.config.rotation);this.parent.append(this.cylinder);this.draw();this.initEvent();parseBool(this.config.reflection)&&this.imageReflection(this.cylinder)},parseConfig:function(a){return{x:a.location.x,y:a.location.y,rotation:a.location.rotation,width:a.location.width,height:a.location.height,alpha:a.alpha,fillStyle:a.fillStyle,color:a.color,colorA:a.gradientColorA,colorB:a.gradientColorB,angle:a.angle,spalpha:a.spalpha,
reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,cylinderRadius:a.cylinderRadius,borderWidth:a.borderWidth,borderColor:a.borderColor,borderAlpha:a.borderAlpha,sh:parseBool(a.shadow.hasDropShadow),sa:a.shadow.shadowAngle,sx:a.shadow.shadowBlurX,sy:a.shadow.shadowBlurY,se:a.shadow.shadowDistance,sr:a.shadow.shadowColor,action:a.action,animation:a.animation}},fillColor:function(a){if("gradient"==this.config.fillStyle){var b=this.config.angle*
Math.PI/180,c=(Number(this.config.angle)+180)*Math.PI/180;b=a.createLinearGradient(this.width/2+this.width/2*Math.cos(c),this.height/2+this.height/2*Math.sin(c),this.width/2+this.width/2*Math.cos(b),this.height/2+this.height/2*Math.sin(b));b.addColorStop(0,this.colorA);b.addColorStop(1,this.colorB);a.fillStyle=b;this.config.sh&&this.setShapeShadow(a);a.fill()}"Pure"==this.config.fillStyle&&(a.fillStyle=this.color,this.config.sh&&this.setShapeShadow(a),a.fill())},draw:function(){var a=this.cylinder[0],
b=a.getContext("2d");b.clearRect(0,0,a.width,a.height);this.cylinderRadius=this.config.cylinderRadius;b.lineCap="round";b.lineJoin="round";b.strokeStyle=Color(this.config.borderColor).toString();b.lineWidth=this.config.borderWidth;b.globalAlpha=this.config.spalpha;0==this.cylinderRadius&&(this.cylinderRadius=10);this.cylinderRadius>this.height/2&&(this.cylinderRadius=this.height/2);a=this.width/2-this.config.borderWidth;var c=this.cylinderRadius/2-this.config.borderWidth,d=this.width/2,e=this.cylinderRadius/
2,f=a>c?a:c,g=a/f;c/=f;b.save();b.beginPath();b.scale(g,c);b.moveTo((d+a)/g,e/c);b.arc(d/g,e/c,f,0,2*Math.PI);b.restore();this.fillColor(b);"none"!=this.config.fillStyle&&b.fillRect(this.config.borderWidth,this.cylinderRadius/2,this.width-2*this.config.borderWidth,this.height-this.cylinderRadius);b.closePath();b.stroke();b.moveTo(this.config.borderWidth,this.cylinderRadius/2);b.lineTo(this.config.borderWidth,this.height-this.cylinderRadius/2);b.moveTo(this.width-this.config.borderWidth,this.cylinderRadius/
2);b.lineTo(this.width-this.config.borderWidth,this.height-this.cylinderRadius/2);b.save();b.scale(g,c);b.moveTo((d+a)/g,(this.height-e)/c);b.arc(d/g,(this.height-e)/c,f,0,Math.PI);b.restore();this.fillColor(b);b.stroke();b.closePath()},initEvent:function(){this.flag=0;this.linkURL="";null!=this.config.action&&(null!=this.config.action.length&&(this.config.action=this.config.action[0]),this.linkURL=this.config.action.url,null!=this.linkURL&&"www"==this.linkURL.substr(0,3).toLowerCase()&&(this.linkURL=
"http://"+this.linkURL));this.cylinder.onTap(function(a){BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),"Cylinder",this.config.x,this.config.y,this.config.width,this.config.height]);bookConfig.googleAnalyticsID&&gtag("event","click",{event_category:"Cylinder",event_label:"Page"+BookInfo.getCurrentPages()[0]})}.bind(this));this.addActionEvent(this.cylinder)},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.pageWidth*this.config.width;this.height=this.pageHeight*
this.config.height;this.cylinder[0].width=this.width;this.cylinder[0].height=this.height;this.draw();this.setPosition()},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.cylinder.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.cylinder.one(a,function(){this.cylinder.css({animation:""})}.bind(this))}},setPosition:function(){this.x=this.config.x*this.pageWidth;this.y=
this.config.y*this.pageHeight;this.cylinder.css({left:this.x+"px",top:this.y+"px"})}}).extend(PageItem.Item);
Class("Trapezoid",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b,c,d);this.animateConfig();this.color=Color(this.config.color).toString();this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.width=Number(this.config.width*this.pageWidth);this.height=Number(this.config.height*this.pageHeight);this.colorA=Color(this.config.colorA).toString();this.colorB=Color(this.config.colorB).toString();this.trapezoid=$("<canvas width='"+this.width+"' height='"+this.height+
"'></canvas>");this.trapezoid.css({position:"absolute",opacity:this.config.alpha,left:this.x+"px",top:this.y+"px"});this.setRotation(this.trapezoid,this.config.rotation);this.parent.append(this.trapezoid);this.draw(this.pageWidth);this.initEvent();parseBool(this.config.reflection)&&this.imageReflection(this.trapezoid)},parseConfig:function(a){return{x:a.location.x,y:a.location.y,rotation:a.location.rotation,width:a.location.width,height:a.location.height,pageWidth:a.location.pageWidth,pageHeight:a.location.pageHeight,
alpha:a.alpha,fillStyle:a.fillStyle,color:a.color,colorA:a.gradientColorA,colorB:a.gradientColorB,angle:a.angle,spalpha:a.spalpha,bottomLength:a.bottomLength,reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,borderWidth:a.borderWidth,borderColor:a.borderColor,borderAlpha:a.borderAlpha,sh:parseBool(a.shadow.hasDropShadow),sa:a.shadow.shadowAngle,sx:a.shadow.shadowBlurX,sy:a.shadow.shadowBlurY,se:a.shadow.shadowDistance,sr:a.shadow.shadowColor,
action:a.action,animation:a.animation}},draw:function(a){var b=this.trapezoid[0],c=b.getContext("2d");c.clearRect(0,0,b.width,b.height);this.width-=this.config.borderWidth;this.height-=this.config.borderWidth;this.config.pageWidth||(this.config.pageWidth=bookConfig.largePageWidth);this.bottomLength=Number(this.config.bottomLength)/this.config.pageWidth*a;this.bottomLength=0==this.bottomLength||this.config.bottomLength>2*this.width/3?this.width-2*this.width/3:this.bottomLength;c.beginPath();c.lineCap=
"round";c.lineJoin="round";c.strokeStyle=Color(this.config.borderColor).toString();c.lineWidth=this.config.borderWidth;c.globalAlpha=this.config.spalpha;c.moveTo((this.width-this.bottomLength)/2,this.config.borderWidth);c.lineTo(this.config.borderWidth,this.height);c.lineTo(this.width,this.height);c.lineTo((this.width-this.bottomLength)/2+this.bottomLength,this.config.borderWidth);this.config.sh&&this.setShapeShadow(c);"gradient"==this.config.fillStyle&&(a=this.config.angle*Math.PI/180,b=(Number(this.config.angle)+
180)*Math.PI/180,a=c.createLinearGradient(this.width/2+this.width/2*Math.cos(b),this.height/2+this.height/2*Math.sin(b),this.width/2+this.width/2*Math.cos(a),this.height/2+this.height/2*Math.sin(a)),a.addColorStop(0,this.colorA),a.addColorStop(1,this.colorB),c.fillStyle=a,c.fill());"Pure"==this.config.fillStyle&&(c.fillStyle=this.color,c.fill());c.closePath();0!=this.config.borderWidth&&c.stroke()},initEvent:function(){this.flag=0;this.linkURL="";null!=this.config.action&&(null!=this.config.action.length&&
(this.config.action=this.config.action[0]),this.linkURL=this.config.action.url,null!=this.linkURL&&"www"==this.linkURL.substr(0,3).toLowerCase()&&(this.linkURL="http://"+this.linkURL));this.trapezoid.onTap(function(a){BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),"Trapezoid",this.config.x,this.config.y,this.config.width,this.config.height]);bookConfig.googleAnalyticsID&&gtag("event","click",{event_category:"Trapezoid",event_label:"Page"+BookInfo.getCurrentPages()[0]})}.bind(this));
this.addActionEvent(this.trapezoid)},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.pageWidth*this.config.width;this.height=this.pageHeight*this.config.height;this.trapezoid[0].width=this.width;this.trapezoid[0].height=this.height;this.draw(this.pageWidth);this.setPosition()},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.trapezoid.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+
"s "+b.count+" "+b.direction});this.trapezoid.one(a,function(){this.trapezoid.css({animation:""})}.bind(this))}},setPosition:function(){this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.trapezoid.css({left:this.x+"px",top:this.y+"px"})}}).extend(PageItem.Item);
Class("RightArrow",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b,c,d);this.animateConfig();this.color=Color(this.config.color).toString();this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.colorA=Color(this.config.colorA).toString();this.colorB=Color(this.config.colorB).toString();this.rightArrow=$("<canvas width='"+this.width+"' height='"+this.height+"'></canvas>");
this.rightArrow.css({position:"absolute",opacity:this.config.alpha,left:this.x+"px",top:this.y+"px"});this.setRotation(this.rightArrow,this.config.rotation);this.parent.append(this.rightArrow);this.draw(this.pageWidth,this.pageHeight);this.initEvent();parseBool(this.config.reflection)&&this.imageReflection(this.rightArrow)},parseConfig:function(a){return{x:a.location.x,y:a.location.y,width:a.location.width,height:a.location.height,rotation:a.location.rotation,pageWidth:a.location.pageWidth,pageHeight:a.location.pageHeight,
alpha:a.alpha,fillStyle:a.fillStyle,color:a.color,colorA:a.gradientColorA,colorB:a.gradientColorB,angle:a.angle,spalpha:a.spalpha,arrowWidth:a.arrowWidth,arrowTailHeight:a.arrowTailHeight,arrowType:a.arrowType,reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,borderWidth:a.borderWidth,borderColor:a.borderColor,borderAlpha:a.borderAlpha,sh:parseBool(a.shadow.hasDropShadow),sa:a.shadow.shadowAngle,sx:a.shadow.shadowBlurX,sy:a.shadow.shadowBlurY,
se:a.shadow.shadowDistance,sr:a.shadow.shadowColor,action:a.action,animation:a.animation}},draw:function(a,b){var c=this.rightArrow[0],d=c.getContext("2d");d.clearRect(0,0,c.width,c.height);this.width-=this.config.borderWidth;this.height-=this.config.borderWidth;this.config.pageWidth||(this.config.pageWidth=bookConfig.largePageWidth);this.config.pageHeight||(this.config.pageHeight=bookConfig.largePageHeight);this.arrowWidth=Number(this.config.arrowWidth)/this.config.pageWidth*a;this.arrowTailHeight=
Number(this.config.arrowTailHeight)/this.config.pageHeight*b;0==this.arrowWidth&&(this.arrowWidth=10);0<this.arrowWidth&&this.arrowWidth<3*this.width/4&&(this.arrowWidth=this.arrowWidth);1==parseBool(this.config.arrowType)?2*this.arrowWidth>this.width-1*this.width/4&&(this.arrowWidth=(this.width-1*this.width/4)/2):this.arrowWidth>3*this.width/4&&(this.arrowWidth=3*this.width/4);this.arrowTailHeight=this.arrowTailHeight>this.height/2?this.height/4:0==this.arrowTailHeight?this.height/2-5:(this.height-
this.arrowTailHeight)/2;d.beginPath();d.lineCap="round";d.lineJoin="round";d.strokeStyle=Color(this.config.borderColor).toString();d.lineWidth=this.config.borderWidth;d.globalAlpha=this.config.spalpha;0==parseBool(this.config.arrowType)?(d.moveTo(this.config.borderWidth,this.arrowTailHeight),d.lineTo(this.width-this.arrowWidth,this.arrowTailHeight),d.lineTo(this.width-this.arrowWidth,this.config.borderWidth),d.lineTo(this.width,this.height/2),d.lineTo(this.width-this.arrowWidth,this.height),d.lineTo(this.width-
this.arrowWidth,this.height-this.arrowTailHeight),d.lineTo(this.config.borderWidth,this.height-this.arrowTailHeight)):(d.moveTo(this.config.borderWidth,this.height/2),d.lineTo(this.arrowWidth,this.config.borderWidth),d.lineTo(this.arrowWidth,this.arrowTailHeight),d.lineTo(this.width-this.arrowWidth,this.arrowTailHeight),d.lineTo(this.width-this.arrowWidth,this.config.borderWidth),d.lineTo(this.width,this.height/2),d.lineTo(this.width-this.arrowWidth,this.height),d.lineTo(this.width-this.arrowWidth,
this.height-this.arrowTailHeight),d.lineTo(this.arrowWidth,this.height-this.arrowTailHeight),d.lineTo(this.arrowWidth,this.height));this.config.sh&&this.setShapeShadow(d);"gradient"==this.config.fillStyle&&(a=this.config.angle*Math.PI/180,b=(Number(this.config.angle)+180)*Math.PI/180,a=d.createLinearGradient(this.width/2+this.width/2*Math.cos(b),this.height/2+this.height/2*Math.sin(b),this.width/2+this.width/2*Math.cos(a),this.height/2+this.height/2*Math.sin(a)),a.addColorStop(0,this.colorA),a.addColorStop(1,
this.colorB),d.fillStyle=a,d.fill());"Pure"==this.config.fillStyle&&(d.fillStyle=this.color,d.fill());d.closePath();0!=this.config.borderWidth&&d.stroke()},initEvent:function(){this.linkURL="";null!=this.config.action&&(null!=this.config.action.length&&(this.config.action=this.config.action[0]),this.linkURL=this.config.action.url,null!=this.linkURL&&"www"==this.linkURL.substr(0,3).toLowerCase()&&(this.linkURL="http://"+this.linkURL));this.rightArrow.onTap(function(a){BookEvent.trigger("clickPageItem",
[BookInfo.getCurrentPageIndex(),"RightArrow",this.config.x,this.config.y,this.config.width,this.config.height]);bookConfig.googleAnalyticsID&&gtag("event","click",{event_category:"RightArrow",event_label:"Page"+BookInfo.getCurrentPages()[0]})}.bind(this));this.addActionEvent(this.rightArrow)},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.pageWidth*this.config.width;this.height=this.pageHeight*this.config.height;this.rightArrow[0].width=this.width;this.rightArrow[0].height=
this.height;this.draw(this.pageWidth,this.pageHeight);this.setPosition()},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.rightArrow.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.rightArrow.one(a,function(){this.rightArrow.css({animation:""})}.bind(this))}},setPosition:function(){this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.rightArrow.css({left:this.x+
"px",top:this.y+"px"})}}).extend(PageItem.Item);
Class("VirtualEnd",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b,c,d);this.animateConfig();this.color=Color(this.config.color).toString();this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.width=Number(this.config.width*this.pageWidth);this.height=Number(this.config.height*this.pageHeight);this.colorA=Color(this.config.colorA).toString();this.colorB=Color(this.config.colorB).toString();this.borderColor=Color(this.config.borderColor).toString();this.virtualEnd=
$("<canvas width='"+this.width+"' height='"+this.height+"' id='myCanvas'></canvas>");this.virtualEnd.css({position:"absolute",opacity:this.config.alpha,left:this.x+"px",top:this.y+"px"});this.setRotation(this.virtualEnd,this.config.rotation);this.parent.append(this.virtualEnd);this.draw(this.pageWidth,this.pageHeight);this.initEvent();parseBool(this.config.reflection)&&this.imageReflection(this.virtualEnd)},parseConfig:function(a){return{x:a.location.x,y:a.location.y,rotation:a.location.rotation,
pageWidth:a.location.pageWidth,pageHeight:a.location.pageHeight,width:a.location.width,height:a.location.height,alpha:a.alpha,fillStyle:a.fillStyle,color:a.color,colorA:a.gradientColorA,colorB:a.gradientColorB,angle:a.angle,spalpha:a.spalpha,reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,arrowWidth:a.arrowWidth,arrowTailHeight:a.arrowTailHeight,borderWidth:a.borderWidth,borderColor:a.borderColor,borderAlpha:a.borderAlpha,sh:parseBool(a.shadow.hasDropShadow),
sa:a.shadow.shadowAngle,sx:a.shadow.shadowBlurX,sy:a.shadow.shadowBlurY,se:a.shadow.shadowDistance,sr:a.shadow.shadowColor,action:a.action,animation:a.animation}},fillColor:function(a){if("gradient"==this.config.fillStyle){var b=this.config.angle*Math.PI/180,c=(Number(this.config.angle)+180)*Math.PI/180;b=a.createLinearGradient(this.width/2+this.width/2*Math.cos(c),this.height/2+this.height/2*Math.sin(c),this.width/2+this.width/2*Math.cos(b),this.height/2+this.height/2*Math.sin(b));b.addColorStop(0,
this.colorA);b.addColorStop(1,this.colorB);a.fillStyle=b;a.fill()}"Pure"==this.config.fillStyle&&(a.fillStyle=this.color,a.fill());0!=this.config.borderWidth&&a.stroke()},draw:function(a,b){var c=this.virtualEnd[0],d=c.getContext("2d");d.clearRect(0,0,c.width,c.height);this.width-=this.config.borderWidth;this.height-=this.config.borderWidth;this.config.pageWidth||(this.config.pageWidth=bookConfig.largePageWidth);this.config.pageHeight||(this.config.pageHeight=bookConfig.largePageHeight);this.arrowWidth=
Number(this.config.arrowWidth)/this.config.pageWidth*a;this.arrowTailHeight=Number(this.config.arrowTailHeight)/this.config.pageHeight*b;this.arrowTailHeight>this.height&&(this.arrowTailHeight=this.height);this.arrowWidth>this.width/2&&(this.arrowWidth=this.width/2);0==this.arrowTailHeight&&(this.arrowTailHeight=10);0==this.arrowWidth&&(this.arrowWidth=10);this.rightArrowWidth=this.width-this.arrowWidth;this.rightArrowHeight=(this.height-this.arrowTailHeight)/2;d.strokeStyle=Color(this.config.borderColor).toString();
d.lineWidth=this.config.borderWidth;d.globalAlpha=this.config.spalpha;d.lineCap="round";d.lineJoin="round";d.beginPath();d.rect(this.config.borderWidth,(this.height-this.arrowTailHeight)/2,this.width/24,this.arrowTailHeight);d.strokeStyle=Color(this.config.borderColor).toString();d.lineWidth=this.config.borderWidth;this.fillColor(d);d.closePath();d.beginPath();d.rect(this.width/12,(this.height-this.arrowTailHeight)/2,this.width/12,this.arrowTailHeight);d.strokeStyle=Color(this.config.borderColor).toString();
d.lineWidth=this.config.borderWidth;this.fillColor(d);d.closePath();d.beginPath();d.moveTo(this.width/5,this.rightArrowHeight);d.lineTo(this.rightArrowWidth,this.rightArrowHeight);d.lineTo(this.rightArrowWidth,this.config.borderWidth);d.lineTo(this.width,this.height/2);d.lineTo(this.rightArrowWidth,this.height);d.lineTo(this.rightArrowWidth,this.height-this.rightArrowHeight);d.lineTo(this.width/5,this.height-this.rightArrowHeight);d.closePath();1==parseBool(this.config.sh)&&this.setShapeShadow(d);
this.fillColor(d)},initEvent:function(){this.linkURL="";null!=this.config.action&&(void 0!=this.config.action.length&&(this.config.action=this.config.action[0]),this.linkURL=this.config.action.url,null!=this.linkURL&&"www"==this.linkURL.substr(1,3).toLowerCase()&&(this.linkURL="http://"+this.linkURL));this.virtualEnd.onTap(function(a){BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),"VirtualEnd",this.config.x,this.config.y,this.config.width,this.config.height]);bookConfig.googleAnalyticsID&&
gtag("event","click",{event_category:"VirtualEnd",event_label:"Page"+BookInfo.getCurrentPages()[0]})}.bind(this));this.addActionEvent(this.virtualEnd)},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.virtualEnd[0].width=this.width;this.virtualEnd[0].height=this.height;this.draw(this.pageWidth,this.pageHeight);this.setPosition()},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=
getAnimationEnd(),b=this.config.animation;this.virtualEnd.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.virtualEnd.one(a,function(){this.virtualEnd.css({animation:""})}.bind(this))}},setPosition:function(){this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.virtualEnd.css({left:this.x+"px",top:this.y+"px"})}}).extend(PageItem.Item);
Class("Cross",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b,c,d);this.animateConfig();this.color=Color(this.config.color).toString();this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.colorA=Color(this.config.colorA).toString();this.colorB=Color(this.config.colorB).toString();this.cross=$("<canvas width='"+this.width+"' height='"+this.height+"'></canvas>");this.cross.css({position:"absolute",
opacity:this.config.alpha,left:this.x+"px",top:this.y+"px"});this.setRotation(this.cross,this.config.rotation);this.parent.append(this.cross);this.draw();this.initEvent();parseBool(this.config.reflection)&&this.imageReflection(this.cross)},parseConfig:function(a){return{x:a.location.x,y:a.location.y,rotation:a.location.rotation,width:a.location.width,height:a.location.height,pageWidth:a.location.pageWidth,pageHeight:a.location.pageHeight,alpha:a.alpha,fillStyle:a.fillStyle,color:a.color,colorA:a.gradientColorA,
colorB:a.gradientColorB,angle:a.angle,spalpha:a.spalpha,reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,crossWidht:a.crossWidht,crossType:a.crossType,borderWidth:a.borderWidth,borderColor:a.borderColor,borderAlpha:a.borderAlpha,sh:parseBool(a.shadow.hasDropShadow),sa:a.shadow.shadowAngle,sx:a.shadow.shadowBlurX,sy:a.shadow.shadowBlurY,se:a.shadow.shadowDistance,sr:a.shadow.shadowColor,action:a.action,animation:a.animation}},draw:function(){var a=
this.cross[0],b=a.getContext("2d");b.clearRect(0,0,a.width,a.height);this.config.borderWidth=Number(this.config.borderWidth);this.width-=this.config.borderWidth;this.height-=this.config.borderWidth;this.config.pageWidth||(this.config.pageWidth=bookConfig.largePageWidth);this.crossWidth=Number(this.config.crossWidht)/this.config.pageWidth*this.pageWidth;this.width>this.height?this.crossWidth>2*this.height/3&&(this.crossWidth=this.height-1*this.height/3):this.crossWidth>2*this.width/3&&(this.crossWidth=
this.width-1*this.width/3);0==this.crossWidth&&(this.crossWidth=10);this.positionWidth=(this.width-this.crossWidth)/2;this.positionHeight=(this.height-this.crossWidth)/2;b.lineCap="round";b.lineJoin="round";b.strokeStyle=Color(this.config.borderColor).toString();b.lineWidth=this.config.borderWidth;b.globalAlpha=this.config.spalpha;b.beginPath();!0===parseBool(this.config.crossType)?(b.moveTo(this.config.borderWidth,this.height/2),b.lineTo(this.positionWidth/2,this.positionHeight-this.crossWidth/3),
b.lineTo(this.positionWidth/2,this.positionHeight),b.lineTo(this.positionWidth,this.positionHeight),b.lineTo(this.positionWidth,this.positionHeight/2),b.lineTo(this.positionWidth-this.crossWidth/3,this.positionHeight/2),b.lineTo(this.width/2,this.config.borderWidth),b.lineTo(this.width-this.positionWidth+this.crossWidth/3,this.positionHeight/2),b.lineTo(this.width-this.positionWidth,this.positionHeight/2),b.lineTo(this.width-this.positionWidth,this.positionHeight),b.lineTo(this.width-this.positionWidth/
2,this.positionHeight),b.lineTo(this.width-this.positionWidth/2,this.positionHeight-this.crossWidth/3),b.lineTo(this.width,this.height/2),b.lineTo(this.width-this.positionWidth/2,this.height-this.positionHeight+this.crossWidth/3),b.lineTo(this.width-this.positionWidth/2,this.height-this.positionHeight),b.lineTo(this.width-this.positionWidth,this.height-this.positionHeight),b.lineTo(this.width-this.positionWidth,this.height-this.positionHeight/2),b.lineTo(this.width-this.positionWidth+this.crossWidth/
3,this.height-this.positionHeight/2),b.lineTo(this.width/2,this.height),b.lineTo(this.positionWidth-this.crossWidth/3,this.height-this.positionHeight/2),b.lineTo(this.positionWidth,this.height-this.positionHeight/2),b.lineTo(this.positionWidth,this.height-this.positionHeight),b.lineTo(this.positionWidth/2,this.height-this.positionHeight),b.lineTo(this.positionWidth/2,this.height-this.positionHeight+this.crossWidth/3)):(b.moveTo(this.config.borderWidth,this.positionHeight),b.lineTo(this.positionWidth,
this.positionHeight),b.lineTo(this.positionWidth,this.config.borderWidth),b.lineTo(this.positionWidth+this.crossWidth,this.config.borderWidth),b.lineTo(this.positionWidth+this.crossWidth,this.positionHeight),b.lineTo(this.width-this.config.borderWidth,this.positionHeight),b.lineTo(this.width-this.config.borderWidth,this.positionHeight+this.crossWidth),b.lineTo(this.positionWidth+this.crossWidth,this.positionHeight+this.crossWidth),b.lineTo(this.positionWidth+this.crossWidth,this.height),b.lineTo(this.positionWidth,
this.height),b.lineTo(this.positionWidth,this.positionHeight+this.crossWidth),b.lineTo(this.config.borderWidth,this.positionHeight+this.crossWidth));parseBool(this.config.sh)&&this.setShapeShadow(b);if("gradient"==this.config.fillStyle){a=this.config.angle*Math.PI/180;var c=(Number(this.config.angle)+180)*Math.PI/180;a=b.createLinearGradient(this.width/2+this.width/2*Math.cos(c),this.height/2+this.height/2*Math.sin(c),this.width/2+this.width/2*Math.cos(a),this.height/2+this.height/2*Math.sin(a));
a.addColorStop(0,this.colorA);a.addColorStop(1,this.colorB);b.fillStyle=a;b.fill()}"Pure"==this.config.fillStyle&&(b.fillStyle=this.color,b.fill());b.closePath();0!=this.config.borderWidth&&b.stroke()},initEvent:function(){this.flag=0;this.linkURL="";null!=this.config.action&&(null!=this.config.action.length&&(this.config.action=this.config.action[0]),this.linkURL=this.config.action.url,null!=this.linkURL&&"www"==this.linkURL.substr(0,3).toLowerCase()&&(this.linkURL="http://"+this.linkURL));this.cross.onTap(function(a){BookEvent.trigger("clickPageItem",
[BookInfo.getCurrentPageIndex(),"Cross",this.config.x,this.config.y,this.config.width,this.config.height]);bookConfig.googleAnalyticsID&&gtag("event","click",{event_category:"Cross",event_label:"Page"+BookInfo.getCurrentPages()[0]})}.bind(this));this.addActionEvent(this.cross)},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.pageWidth*this.config.width;this.height=this.pageHeight*this.config.height;this.cross[0].width=this.width;this.cross[0].height=this.height;this.draw();
this.setPosition()},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.cross.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.cross.one(a,function(){this.cross.css({animation:""})}.bind(this))}},setPosition:function(){this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.cross.css({left:this.x+"px",top:this.y+"px"})}}).extend(PageItem.Item);
Class("PopUpVideoItem",{Package:"PageItem",create:function(a,b,c,d){this._super(a,b,c,d);this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.left=this.config.x*this.pageWidth;this.top=this.config.y*this.pageHeight;this.playCount=0;this.videoWidth=Math.min(574,windowWidth-4);this.videoHeight=Math.min(460,windowHeight-4);this.videoLeft=(windowWidth-this.videoWidth-4)/2;this.videoTop=(windowHeight-this.videoHeight-4)/2;this.background=$("<div style='width:100%;height:100%;z-index:1001;position:absolute;top:0;'></div>");
this.videoBac=$("<div style='width:100%;height:100%;background-color:rgba(0,0,0,0.5);'></div>");this.config.imgURL=this.fixRelativePath(this.config.imgURL);bookConfig.useTheAliCloudChart&&this.config.imgURL&&(this.config.imgURL=this.getOssUrl(this.config.imgURL,this.width,this.height,"fixed"));this.config.videoURL=this.fixRelativePath(this.config.videoURL);this.videoImage=$("<div class='flip-action' style='border:1px solid #bbb;position: absolute;cursor:pointer;opacity:"+this.config.alpha+"; left:"+
this.left+"px; top:"+this.top+"px; width:"+this.width+"px;height:"+this.height+"px;'></div>");this.closeButton=$("<img style='width:20px;height:20px;z-index:1001;position:absolute;cursor:pointer;right:5px;top:"+(0>this.videoTop-18?0:this.videoTop-18)+"px;' src='"+uiBaseURL+"close.png'/>");this.videoFrame=new Media($("<video src='"+this.config.videoURL+"' webkit-playsinline='true' playsinline='true' controls='controls' controlslist='nodownload'></video>"),"video");this.videoFrame.setCss({position:"absolute",
background:"#000",border:"2px solid #bbb",width:this.videoWidth+"px",height:this.videoHeight+"px",left:this.videoLeft+"px",top:this.videoTop+"px","object-fit":"contain","z-index":1E3});this.config.imgURL?(this.imageDiv=$("<img src='"+this.config.imgURL+"' style='position: absolute;width:100%;height:100%'/>"),this.videoImage.append(this.imageDiv)):this.videoImage.css("background-color","rgba(255,255,255,1)");this.playImg=$("<img src='"+uiBaseURL+"play.png' style='position:absolute;margin:auto;left:0px;top:0px;bottom:0px;right:0px;width:56px;height:56px'/>");
this.videoImage.append(this.playImg);this.setRotation(this.videoImage,this.config.rotation);this.background.append(this.videoFrame.$media);tmpContainer.append(this.background);this.background.append(this.videoBac);this.background.append(this.closeButton);a.append(this.videoImage);this.config.shadow&&this.addShadow(this.videoImage);this.hide();this.initEvent()},parseConfig:function(a){var b={width:a.location.width,height:a.location.height,rotation:a.location.rotation,x:a.location.x,y:a.location.y,
alpha:a.alpha,reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,previewSrc:a.previewURL,moviePlayTriggerEvt:a.moviePlayTriggerEvt,movieStopTriggerEvt:a.movieStopTriggerEvt,replayWhenPlayEventTrigger:a.replayWhenPlayEventTrigger,shadow:a.shadow,animation:a.animation};a.H5PlaybackNumber&&(b.H5PlaybackNumber=parseInt(a.H5PlaybackNumber));a.H5Replay&&(b.H5Replay=parseBool(a.H5Replay));a.componentData?(b.videoURL=a.componentData.videoURL,
b.imgURL=a.componentData.imgURL||a.componentData.previewURL,b.pageViewed=parseBool(a.componentData.pageViewed)):(b.videoURL=a.url||a.videoURL||"",b.imgURL=a.previewURL||a.previewUrl||"",b.pageViewed="EVT_PageViewed"==a.moviePlayTriggerEvt?!0:!1);parseBool(a.shadow.hasDropShadow)&&(b.hasShadow=!0);return b},initEvent:function(){this.videoFrame.$media.bind(_event._click,function(b){b.stopPropagation()}.bind(this));this.background.bind("click touchstart",function(b){b.stopPropagation()}.bind(this));
this.background.bind(_event._down,function(b){b.stopPropagation()}.bind(this));this.background.bind(_event._click,function(b){b.stopPropagation();this.hide();this.setCurrentTime(0);this.videoFrame.pause()}.bind(this));this.videoImage.bind(_event._click,function(b){b.stopPropagation();this.showOrHide()}.bind(this));this.closeButton.bind("mouseenter",function(){this.closeButton.css({opacity:"0.7"})}.bind(this));this.closeButton.bind("mouseleave",function(){this.closeButton.css({opacity:"1"})}.bind(this));
0>this.config.H5PlaybackNumber&&this.videoFrame.$media.attr("loop","loop");0<this.config.H5PlaybackNumber&&this.videoFrame.$media.bind("ended",function(){this.playCount++;0<this.config.H5PlaybackNumber&&this.playCount<=this.config.H5PlaybackNumber&&this.videoFrame.play()}.bind(this));var a=(new Date).getTime();this.videoFrame.$media.bind("play",function(){a=(new Date).getTime();BookEvent.trigger("playMedia",["play",BookInfo.getCurrentPageIndex(),this.videoFrame.$media[0].src,"Video",0]);this.playCount>
this.config.H5PlaybackNumber&&(this.playCount=0)}.bind(this));this.videoFrame.$media.bind("pause",function(){BookEvent.trigger("playMedia",["pause",BookInfo.getCurrentPageIndex(),this.videoFrame.$media[0].src,"Video",(new Date).getTime()-a])}.bind(this))},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.left=this.config.x*this.pageWidth;this.top=this.config.y*this.pageHeight;this.videoWidth=Math.min(480,
windowWidth)-4;this.videoHeight=9*this.videoWidth/16;this.videoHeight=Math.min(this.videoHeight,windowHeight);this.videoLeft=(windowWidth-this.videoWidth)/2-2;this.videoTop=(windowHeight-this.videoHeight)/2-2;this.videoFrame.setCss({width:this.videoWidth+"px",height:this.videoHeight+"px",top:this.videoTop+"px",left:this.videoLeft+"px"});this.videoImage.css({width:this.pageWidth*this.config.width+"px",height:this.pageHeight*this.config.height+"px"});this.setPosition(this.left,this.top);this.setClosePos()},
setPosition:function(a,b){this.videoImage.css({top:b+"px",left:a+"px"})},setClosePos:function(){var a=this.videoWidth+this.videoLeft+2,b=this.videoTop;(windowWidth-this.videoWidth)/2<this.closeButton.width()&&(b>this.closeButton.height()?(a=this.videoLeft+this.videoWidth+4-this.closeButton.width(),b=this.videoTop-this.closeButton.height()):b<this.closeButton.height()&&(a=this.videoLeft+this.videoWidth+4-this.closeButton.width(),b=this.videoTop));this.closeButton.css({left:a+"px",top:b+"px"})},showAnimate:function(){if(this.config.animation&&
this.config.animation.name){var a=getAnimationEnd();this.videoImage.css({animation:"flip 1s ease 0s 1 normal"});this.videoImage.one(a,function(){this.videoImage.css({animation:""})}.bind(this))}},getPlayEvt:function(){return this.config.moviePlayTriggerEvt},getStopEvt:function(){return this.config.movieStopTriggerEvt},showOrHide:function(){!1===this.visible?this.popup():this.hide()},setCurrentTime:function(a){this.videoFrame.setCurrentTime(a)},hide:function(){this.visible=!1;this.background.css({display:"none"})},
popup:function(){this.visible=!0;this.videoFrame.play();this.background.css({display:"block"})},play:function(){this.videoFrame.play()},pause:function(){this.videoFrame.pause()},stop:function(){this.pause();this.videoFrame.setCurrentTime(0)}}).extend("Item");
Class("LoopControlVideo",{Package:"PageItem",create:function(a,b,c,d){this.config=this.parseConfig(b);this.animateConfig();this.playCount=0;this.parent=a;this.pageWidth=c;this.pageHeight=d;this.width=this.config.width*this.pageWidth;this.height=this.config.height*this.pageHeight;this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.cvsWidth=.54*this.width;this.cvsHeight=this.height;this.content=$("<div class='flip-action' style='overflow:hidden;'></div>");this.control=$("<div class='video-circle-controls'></div>");
this.playBtn=$("<div class='video-circle-play'></div>");this.volume=$("<div class='video-circle-volume-button'></div>");this.fullscreen=$("<div class='video-circle-player-fullscreen' style='display:none'></div>");this.loopControl=$("<canvas class='loopControl' width='80' height='80' style='cursor:pointer;position:absolute;margin:auto;top:0;left:0;bottom:0;right:0;'>64%</canvas>");this.canvasDiv=$("<div></div>");"string"==typeof this.config.previewSrc&&""!=this.config.previewSrc&&null!=this.config.previewSrc&&
void 0!=this.config.previewSrc&&(this.config.previewSrc=this.fixRelativePath(this.config.previewSrc),bookConfig.useTheAliCloudChart&&(this.config.previewSrc=this.getOssUrl(this.config.previewSrc,this.width,this.height,"fixed")));a=typeof this.config.src;b=this.config.src.substr(this.config.src.length-4,4).toLowerCase();if("string"==a){if(null==this.config.src||".mp4"!=b&&".flv"!=b&&".f4v"!=b)return}else if(this.config.src=={})return;this.config.src=this.fixRelativePath(this.config.src);this.video=
new Media($('<video src="'+this.config.src+'" webkit-playsinline="true" playsinline="true" ></video>'),"video");this.config.previewSrc&&this.video.$media.attr("poster",this.config.previewSrc);this.parent.append(this.content);this.content.append(this.video.$media);this.content.append(this.control);this.control.append(this.canvasDiv);this.canvasDiv.append(this.loopControl);this.control.append(this.playBtn);this.control.append(this.volume);this.control.append(this.time);this.control.append(this.fullscreen);
this.canvasDiv.append(this.time);this.setCss();this.config.shadow&&this.addShadow(this.content);parseBool(this.config.reflection)&&this.imageReflection(this.content,this.width,this.height);this.initEvent();this.resizeCss()},parseConfig:function(a){var b={width:a.location.width,height:a.location.height,rotation:a.location.rotation,x:a.location.x,y:a.location.y,alpha:a.alpha,reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,previewSrc:a.previewURL,
moviePlayTriggerEvt:a.moviePlayTriggerEvt?a.moviePlayTriggerEvt:a.PlayTriggerEvt,movieStopTriggerEvt:a.StopTriggerEvt,replayWhenPlayEventTrigger:a.replayWhenPlayEventTrigger,shadow:a.shadow,animation:a.animation};a.H5PlaybackNumber&&(b.H5PlaybackNumber=parseInt(a.H5PlaybackNumber));a.H5Replay&&(b.H5Replay=parseBool(a.H5Replay));void 0!=a.videoURL&&(b.src=a.videoURL);void 0!=a.url&&(b.src=a.url);a.componentData&&(b.src=a.componentData.videoURL,b.previewSrc=a.componentData.imgURL);parseBool(a.shadow.hasDropShadow)&&
(b.hasShadow=!0);return b},onPlayClick:function(){0==this.video.$media[0].paused?this.pauseVideo():this.playVideo();_agent_.browser.device!=_agent_.browser.DEVICE_PC&&function(){this.control.css("opacity","0")}.delay(this,5E3);return!1},onResize:function(a,b){this.width=this.config.width*a;this.height=this.config.height*b;this.pageWidth=a;this.pageHeight=b;this.cvsWidth=this.cvsHeight=80<this.height?80:this.height;this.resizeCss()},resizeCss:function(){.54*this.width<=this.height&&(this.cvsWidth=
this.cvsHeight=80<.54*this.width?80:.54*this.width);this.loopControl[0].width=this.cvsWidth;this.loopControl[0].height=this.cvsHeight;this.content.css({width:this.width+"px",height:this.height+"px"});this.control.css({width:this.width+"px",height:this.height+"px"});this.content.css({"background-size":this.width+"px "+this.height+"px"});this.setPosition()},setPosition:function(){this.x=this.pageWidth*this.config.x;this.y=this.pageHeight*this.config.y;this.content.css({left:this.x+"px",top:this.y+"px"})},
Loop:function(a){var b=this.loopControl[0].getContext("2d");b.clearRect(0,0,this.cvsWidth,this.cvsHeight);this.drawRound(b,this.cvsWidth/2,360,"#555555");this.drawRound(b,this.cvsWidth/2,a,"#FFFFFF");this.drawRound(b,this.cvsWidth/2*.85,360,"#000000")},drawRound:function(a,b,c,d){var e=Math.PI/180;a.beginPath();a.moveTo(this.cvsWidth/2,this.cvsWidth/2);a.arc(this.cvsWidth/2,this.cvsWidth/2,b,0,c*e,!1);a.closePath();a.fillStyle=d;a.fill()},muteVolume:function(){1==this.video.$media[0].muted?(this.video.$media[0].muted=
!1,this.volume.removeClass("video-circle-volume-mute")):(this.video.$media[0].muted=!0,this.volume.addClass("video-circle-volume-mute"));return!1},fullScreen:function(){fullScreenApi.supportsFullScreen?fullScreenApi.isFullScreen()?fullScreenApi.cancelFullScreen():_agent_.browser.safari?this.initSafariFullscreen(this.video.$media[0]):fullScreenApi.requestFullScreen(this.video.$media[0]):this.video.$media[0].webkitSupportsFullscreen?this.video.$media[0].webkitEnterFullscreen():alert(getLanguage("proFullScreenWarn",
"Current browser does not support full-screen,Please use Chrome for best results"));return!1},initSafariFullscreen:function(a){this.appendDomToDocument('<video controlslist="nodownload" preload="auto" webkit-playsinline="true" playsinline="true" class="safari-fullscreen-video" controls></video>',"safari-fullscreen-video");!window.playBackgroundSound&&window.currentMedia&&(window.currentMedia.pauseMedia(),window.currentMedia=null);var b=document.getElementsByClassName("safari-fullscreen-video");b[0].webkitRequestFullscreen();
b[0].src=a.src;b[0].load();b[0].volume=a.volume;b[0].addEventListener("canplay",function e(d){b[0].play();b[0].addEventListener("play",function h(g){b[0].currentTime=a.currentTime;b[0].removeEventListener(g.type,h)});b[0].removeEventListener(d.type,e)});this.safariFullscreenEvent(b[0],a)},appendDomToDocument:function(a,b){0===document.getElementsByClassName(b).length&&(a=document.createRange().createContextualFragment(a),document.body.appendChild(a))},safariFullscreenEvent:function(a,b){var c=!1;
a.addEventListener("enterpictureinpicture",function f(e){c=!0;b.currentTime=a.currentTime;b.volume=a.volume;a.paused?b.play():b.pause();a.removeEventListener(e.type,f)});a.addEventListener("leavepictureinpicture",function g(f){c=!1;b.currentTime=a.currentTime;b.volume=a.volume;a.paused?b.pause():b.play();a.removeEventListener(f.type,g);a.remove()});document.addEventListener("webkitfullscreenchange",function h(g){!a||document.webkitIsFullScreen||c||(b.currentTime=a.currentTime,b.volume=a.volume,a.paused?
b.pause():b.play(),a.remove(),document.removeEventListener(g.type,h))})},initEvent:function(){this.fullscreen.onTap(this.fullScreen.bind(this));this.control.bind(fullScreenApi.fullScreenEventName,function(){fullScreenApi.isFullScreen()?this.fullscreen.addClass("video-circle-exit-fullscreen"):this.fullscreen.removeClass("video-circle-exit-fullscreen")}.bind(this));this.video.$media.onTap(this.onPlayClick.bind(this));this.playBtn.onTap(this.onPlayClick.bind(this));this.volume.onTap(this.muteVolume.bind(this));
var a=(new Date).getTime();this.video.$media.bind("play",function(){a=(new Date).getTime();BookEvent.trigger("playMedia",["play",BookInfo.getCurrentPageIndex(),this.config.src,"Video",0]);this.fullscreen.css({display:"block"});this.playBtn.removeClass("video-play-button").addClass("video-paused-button")}.bind(this));this.video.$media.bind("pause",function(){BookEvent.trigger("playMedia",["pause",BookInfo.getCurrentPageIndex(),this.config.src,"Video",(new Date).getTime()-a]);this.fullscreen.css({display:"none"});
this.playBtn.removeClass("video-paused-button").addClass("video-play-button")}.bind(this));this.video.$media.bind("end",function(){this.fullscreen.css({display:"none"});this.playBtn.removeClass("video-paused-button").addClass("video-play-button")}.bind(this));this.video.$media.bind("timeupdate",function(){this.totalTime=this.video.$media[0].duration;this.currentTime=this.video.$media[0].currentTime;this.Loop(this.currentTime/this.totalTime*360)}.bind(this));this.control.on("mouseenter",function(){this.control.css("opacity",
"1")}.bind(this));this.control.on("mouseleave",function(){this.control.css("opacity","0")}.bind(this));_agent_.browser.device!=_agent_.browser.DEVICE_PC&&(this.control.bind(_event._down,function(){this.control.css("opacity","1")}.bind(this)),this.control.bind(_event._up,function(){(function(){this.control.css("opacity","0")}).delay(this,3E3)}.bind(this)));this.video.$media.bind("click mousedown mouseup mousewheel DOMMouseScroll",function(b){b.stopPropagation()}.bind(this));this.initLoopEvent()},initLoopEvent:function(){0>
this.config.H5PlaybackNumber&&this.video.$media.attr("loop","loop");0<this.config.H5PlaybackNumber&&this.video.$media.bind("ended",function(){this.playCount++;0<this.config.H5PlaybackNumber&&this.playCount<=this.config.H5PlaybackNumber&&this.playVideo()}.bind(this));this.video.$media.bind("play",function(){this.playCount>this.config.H5PlaybackNumber&&(this.playCount=0)}.bind(this))},setCss:function(){this.canvasDiv.css({position:"absolute",width:"54%",height:"100%",margin:"auto",top:"0",bottom:"0",
left:"0",right:"0",transform:"rotate(270deg)","-webkit-transform":"rotate(270deg)","-ms-transform":"rotate(270deg)","-o-transform":"rotate(270deg)","-moz-transform":"rotate(270deg)"});this.control.css({position:"absolute",width:this.width+"px",opacity:"1",height:this.height+"px"});this.content.css({position:"absolute",left:this.x+"px",top:this.y+"px",width:this.width+"px",height:this.height+"px",opacity:this.config.alpha,"background-color":"black"});this.setRotation(this.content,this.config.rotation);
this.video.setCss({position:"absolute","z-index":1,left:"0px",top:"0px",width:"100%",height:"100%"})},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.content.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.content.one(a,function(){this.content.css({animation:""})}.bind(this))}},backTime:function(){this.playCount=0;this.video&&this.video.setCurrentTime(0)},isReplay:function(){return this.config.H5Replay},
getPlayEvt:function(){return this.config.moviePlayTriggerEvt},getStopEvt:function(){return this.config.movieStopTriggerEvt},playVideo:function(){this.video&&(this.video.play(),this.playBtn.removeClass("video-play-button").addClass("video-paused-button"))},pauseVideo:function(){this.video&&(this.video.pause(),this.playBtn.removeClass("video-paused-button").addClass("video-play-button"))},stopVideo:function(){player&&(this.pauseVideo(),this.video.setCurrentTime(0))}}).extend("Item");
Class("RollerText",{Package:"PageItem",create:function(a,b,c,d,e){this._super(a,b,c,d);this.animateConfig();this.bgColor=Color(this.config.bgcolor).toString();this.originWidth=this.config.pageW;this.originHeight=this.config.pageH;this.id="text"+e;this.initText();this.initEvents();parseBool(this.config.reflection)&&this.imageReflection(this.rollerText)},initText:function(){this.textli="";this.container=$("<div id="+this.id+" content='width=device-width' class='textContainer' style='position:absolute;'></div>");
this.rollerText=$("<div content='width=device-width'></div>");this.enterText=$("<div class='flip-action' content='width=device-width'></div>");this.textDown=$("<img/>");this.textUp=$("<img/>");this.alignCss="";"right"==this.config.languageLayout&&(this.alignCss={"text-align":"right",direction:"rtl"});this.config.textStr||(this.config.textStr=this.config.formats.defaultFormat.htmlText);var a=new TextFormatAnalyzer(this.config.textStr);this.fontSize=a.getMinFontSize();this.text=a.getHTML(this.alignCss);
this.adjustFontSize=_agent_.browser.chrome?Math.max(1,12/this.fontSize):1;this.width=this.config.width*this.originWidth*this.adjustFontSize;this.height=this.config.height*this.originHeight*this.adjustFontSize;this.scrollWidth=40<=.05*this.width?40:.05*this.width;!0===parseBool(this.config.fillBg)?this.rollerText.css({"background-color":Color(this.config.bgcolor).rgba(this.config.bgalpha)}):this.rollerText.css({background:""});this.addShadow(this.rollerText);!0===parseBool(this.config.selectable)&&
this.rollerText.css({"-webkit-user-select":"text","-moz-user-select":"text","-ms-user-select":"text","user-select":"text"});this.rollerText.css({"-webkit-text-size-adjust":"100%",display:"inline-block","word-wrap":"break-word",overflow:"hidden",position:"absolute",width:this.width+"px",height:this.height+"px"});this.enterText.css({"-webkit-text-size-adjust":"100%",display:"inline-block",position:"absolute",width:this.width-this.scrollWidth+"px",left:"0",top:"0"});this.rollerText.css({opacity:this.config.alpha});
this.enterText.append(this.text);this.rollerText.append(this.enterText);this.container.append(this.rollerText);this.parent.append(this.container);this.enterText.height()>this.height&&this.initScroll()},initScroll:function(){this.scroll=$("<div class='flip-action'></div>");this.scrollBar=$("<div class='flip-action'></div>");this.topPoint=$("<p class='flip-action'></p>");this.bottomPoint=$("<p class='flip-action'></p>");this.topIcon=$("<span></span>");this.bottomIcon=$("<span></span>");this.topPoint.append(this.topIcon);
this.bottomPoint.append(this.bottomIcon);this.scroll.append(this.scrollBar).append(this.topPoint).append(this.bottomPoint);this.rollerText.append(this.scroll);this.initScrollCss();this.initScrollEvent()},initScrollEvent:function(){for(var a=[this.enterText,this.scroll],b=0;b<a.length;b++)a[b].bind("mousewheel DOMMouseScroll",function(c){c.stopPropagation();this.distance||(this.distance=this.enterText.height()-this.height+this.scrollWidth/2);this.barHeight||(this.barHeight=(this.height-2*this.scrollWidth)*
(this.height-2*this.scrollWidth)/this.enterText.height());this.barDistance||(this.barDistance=this.height-this.barHeight-this.scrollWidth);c=c.originalEvent.wheelDelta&&(0<c.originalEvent.wheelDelta?1:-1)||c.originalEvent.detail&&(0<c.originalEvent.detail?-1:1);0<c?this.scrollTop():0>c&&this.scrollBottom()}.bind(this));this.parent.bind("mouseup",function(c){this.focus=!1;this.starty=void 0}.bind(this));this.enterText.bind("mouseup",function(c){this.focus=!1;this.starty=void 0}.bind(this));this.rollerText.bind("mouseup",
function(c){this.focus=!1;this.starty=void 0}.bind(this));this.scroll.bind("mouseup mousewheel",function(c){this.focus=!1}.bind(this));isTouchDevice()&&(this.enterText.bind(_event._down,function(c){this.touchText=this.focus=!0}.bind(this)),this.enterText.bind(_event._up,function(c){this.touchText=this.focus=!1;this.starty=void 0}.bind(this)));this.scrollBar.bind(_event._down,function(c){c.stopPropagation();c.preventDefault();this.starty=c.pageY;this.focus=!0}.bind(this));this.parent.bind(_event._up,
function(c){this.focus=!1;this.starty=void 0}.bind(this));this.scrollBar.bind(_event._up,function(c){c.stopPropagation();c.preventDefault();this.focus=!1;this.starty=void 0}.bind(this));a=[this.scroll,this.rollerText,this.parent];isTouchDevice()&&(a=[this.scroll,this.enterText]);for(b=0;b<a.length;b++)a[b].bind(_event._move,function(c){c.stopPropagation();if(this.focus){pageY=isPhone()||isPad()?c.originalEvent.targetTouches[0].pageY:c.pageY;var d=this.touchText?-pageY+this.starty:pageY-this.starty;
c=-d/this.barDistance;d=this.scrollBar.top()+d/this.fScale;c=this.enterText.top()+this.distance*c*1.1/this.fScale;d<=this.scrollWidth&&(d=this.scrollWidth);d>=this.barDistance&&(d=this.barDistance);0<=c&&(c=0);c<=-this.distance&&(c=-this.distance);this.scrollBar.css({top:d+"px"});this.enterText.css({top:c+"px"});this.starty=pageY}}.bind(this));this.bottomPoint.bind(_event._up,function(c){c.stopPropagation();this.focus=this.bottomDown=!1;this.bottomDownTimer&&(clearInterval(this.bottomDownTimer),this.bottomDownTimer=
null)}.bind(this));this.bottomPoint.bind(_event._down,function(c){c.stopPropagation();this.bottomDown=this.focus=!0;this.scrollBottom();this.bottomDown&&(this.bottomDownTimer=setInterval(this.scrollBottom.bind(this),100))}.bind(this));this.topPoint.bind(_event._down,function(c){c.stopPropagation();this.focus=this.topDown=!0;this.scrollTop();this.topDown&&(this.topDownTimer=setInterval(this.scrollTop.bind(this),100))}.bind(this));this.topPoint.bind(_event._up,function(c){c.stopPropagation();this.focus=
this.topDown=!1;this.topDownTimer&&(clearInterval(this.topDownTimer),this.topDownTimer=null)}.bind(this))},scrollBottom:function(){this.textTop=this.enterText.top();this.barTop=this.scrollBar.top();this.textTop-=.1*this.distance;this.barTop+=.1*this.barDistance;this.textTop<=-this.distance&&(this.textTop=-this.distance);this.barTop>=this.barDistance&&(this.barTop=this.barDistance);this.enterText.css({top:this.textTop+"px"});this.scrollBar.css({top:this.barTop+"px"})},scrollTop:function(){this.textTop=
this.enterText.top();this.barTop=this.scrollBar.top();this.textTop+=.1*this.distance;this.barTop-=.1*this.barDistance;0<=this.textTop&&(this.textTop=0);this.barTop<=this.scrollWidth&&(this.barTop=this.scrollWidth);this.enterText.css({top:this.textTop+"px"});this.scrollBar.css({top:this.barTop+"px"})},initScrollCss:function(){this.scroll.css({position:"absolute",width:this.scrollWidth+"px",right:0,top:"0",height:this.height+"px",background:"#F1F1F1"});this.scrollBar.css({width:.7*this.scrollWidth+
"px",background:"#AAAAAB",height:this.barHeight,cursor:"pointer",left:.15*this.scrollWidth+"px",top:this.scrollWidth+"px",position:"absolute"});this.topPoint.css({cursor:"pointer",width:this.scrollWidth+"px",height:this.scrollWidth+"px",background:"#F1F1F1",position:"absolute",top:0});this.bottomPoint.css({cursor:"pointer",width:this.scrollWidth+"px",height:this.scrollWidth+"px",background:"#F1F1F1",position:"absolute",bottom:0});this.topIcon.css({position:"absolute",left:.18*this.scrollWidth+"px",
top:.3*this.scrollWidth+"px","border-left":.3*this.scrollWidth+"px solid transparent","border-right":.3*this.scrollWidth+"px solid transparent","border-bottom":.3*this.scrollWidth+"px solid #A3A3A3"});this.bottomIcon.css({position:"absolute",left:.18*this.scrollWidth+"px",bottom:.3*this.scrollWidth+"px","border-left":.3*this.scrollWidth+"px solid transparent","border-right":.3*this.scrollWidth+"px solid transparent","border-top":.3*this.scrollWidth+"px solid #A3A3A3"});this.setBarType()},parseConfig:function(a){return{x:a.location.x,
y:a.location.y,width:a.location.width,height:a.location.height,reflection:a.location.reflection,reflectionType:a.location.reflectionType,reflectionAlpha:a.location.reflectionAlpha,alpha:a.alpha,rotation:a.location.rotation,textStr:a.textStr?a.textStr:a.formats.defaultFormat.htmlText,selectable:a.selectable,highlightsBool:a.highlightsBool,highlightsURL:a.highlightsURL,highlightsLabel:a.highlightsLabel,pageH:a.formats.defaultFormat.pageH,pageW:a.formats.defaultFormat.pageW,barType:a.barType,bgalpha:a.background.alpha,
fillBg:a.background.fillBg,bgcolor:a.background.color,action:a.action,hasShadow:parseBool(a.shadow.hasDropShadow),shadow:a.shadow,languageLayout:a.languageLayout,animation:a.animation}},initEvents:function(){function a(c){c.stopPropagation&&c.stopPropagation()}this.textDown.click(function(){var c=this.text.scrollTop();this.text.animate({scrollTop:c+50},100)}.bind(this));this.textUp.click(function(){var c=this.text.scrollTop();this.text.animate({scrollTop:c-50},100)}.bind(this));var b=_agent_.browser.mozilla?
"DOMMouseScroll":"mousewheel";this.enterText.bind(b,a);this.rollerText.bind(b,a);this.rollerText.bind(_event._down,a);this.rollerText.bind(_event._up,a);this.addActionEvent(this.container);this.container.onTap(function(c){BookEvent.trigger("clickPageItem",[BookInfo.getCurrentPageIndex(),"RollerText",this.config.x,this.config.y,this.config.width,this.config.height])}.bind(this))},setBarType:function(){this.scroll.css({background:"transparent"});this.scrollBar.css({display:"none"});this.topPoint.css({background:"#ddd",
position:"absolute",bottom:"5px",right:this.scrollWidth+2+"px",top:"auto"});this.bottomPoint.css({background:"#ddd",position:"absolute",bottom:"5px"})},onResize:function(a,b){this.pageWidth=a;this.pageHeight=b;this.fScale=this.pageHeight/this.originHeight/this.adjustFontSize;this.setPosition();this.resizeText(this.pageHeight);this.enterText.height()>this.height&&(this.scroll||this.initScroll(),this.distance=this.enterText.height()-this.height+this.scrollWidth/2,this.barHeight=(this.height-2*this.scrollWidth)*
(this.height-2*this.scrollWidth)/this.enterText.height(),this.barDistance=this.height-this.barHeight-this.scrollWidth,this.initScrollCss(),this.barTop=-this.enterText.top()/this.distance*this.barDistance,this.barTop<=this.scrollWidth&&(this.barTop=this.scrollWidth),this.barTop>=this.barDistance&&(this.barTop=this.barDistance),this.scrollBar.css({top:this.barTop+"px"}))},setPosition:function(){this.x=this.config.x*this.pageWidth;this.y=this.config.y*this.pageHeight;this.container.css({left:this.x+
"px",top:this.y+"px"})},showAnimate:function(){if(this.config.animation&&this.config.animation.name){var a=getAnimationEnd(),b=this.config.animation;this.container.css({animation:b.name+" "+b.duration+"s "+b.timeFun+" "+b.delay+"s "+b.count+" "+b.direction});this.container.one(a,function(){this.container.css({animation:""})}.bind(this))}},resizeText:function(a){this.fScale=a=a/this.originHeight/this.adjustFontSize;this.rollerText.css({"-webkit-transform-origin":"0% 0%","-moz-transform-origin":"0% 0%",
"-ms-transform-origin":"0% 0%","-o-transform-origin":"0% 0%","transform-origin":"0% 0%","-webkit-transform":"scale("+a+")","-moz-transform":"scale("+a+")","-ms-transform":"scale("+a+")","-o-transform":"scale("+a+")",transform:"scale("+a+")"});this.container.css({width:this.width*a,height:this.height*a})}}).extend(PageItem.Item);
var PageEditor={AnnoType:{ANNO_LINK:"com.mobiano.flipbook.pageeditor.TAnnoLink",ANNO_YOUTUBE:"com.mobiano.flipbook.pageeditor.TAnnoYouTube",ANNO_YOUTUBE1:"com.mobiano.flipbook.pageeditor::TAnnoYoutubePlayer",ANNO_YOUTUBE2:"com.mobiano.flipbook.pageeditor.player::TAnnoYoutubePlayer02",ANNO_YOUTUBE3:"com.mobiano.flipbook.pageeditor.player::TAnnoYoutubePlayer03",ANNO_YOUTUBE4:"com.mobiano.flipbook.pageeditor.player::TAnnoYoutubePlayer04",ANNO_YOUTUBE5:"com.mobiano.flipbook.pageeditor.player::TAnnoYoutubePlayer05",
ANNO_YOUTUBE6:"com.mobiano.flipbook.pageeditor.player::TAnnoYoutubePlayer06",ANNO_YOUTUBE7:"com.mobiano.flipbook.pageeditor.player::TAnnoYoutubePlayer07",ANNO_YOUTUBE8:"com.mobiano.flipbook.pageeditor.player::TAnnoYoutubePlayer08",ANNO_VIDEO1:"com.mobiano.flipbook.pageeditor::TAnnoVideoPlayer",ANNO_VIDEO2:"com.mobiano.flipbook.pageeditor.player::TAnnoSimpleVideoPlayer",ANNO_AUDIO1:"com.mobiano.flipbook.sound.TAnnoAdvancedSound",ANNO_AUDIO2:"com.mobiano.flipbook.sound.TAnnoWavemusicPlayer",ANNO_AUDIO3:"com.mobiano.flipbook.pageeditor::TAnnoPlugIn",
ANNO_AUDIO4:"com.mobiano.flipbook.sound.TAnnoBackgroundSound",ANNO_AUDIO5:"",ANNO_AUDIO6:"",ANNO_AUDIO7:"",ANNO_AUDIO8:"",ANNO_AUDIO9:"",ANNO_VIMEO:"com.mobiano.flipbook.pageeditor.vimeoPlayer::TAnnoVimeoPlayer",ANNO_VIMEO2:"com.mobiano.flipbook.pageeditor.vimeoPlayer.TAnnoVimeoPopUpPlayer",ANNOHTML_VIDEO:"com.mobiano.flipbook.pageeditor::TAnnoHTMLMovie",ANNO_VIDEO:"com.mobiano.flipbook.pageeditor.TAnnoMovie",ANNO_AUDIO:"com.mobiano.flipbook.pageeditor.TAnnoSound",ANNO_IMAGE:"com.mobiano.flipbook.pageeditor.TAnnoImage",
ANNO_BUTTON:"com.mobiano.flipbook.pageeditor.TAnnoButton",ANNO_DYNAMICBUTTON:"com.mobiano.flipbook.pageeditor::TAnnoDynamicButton",ANNO_NEW_AUDIO:"com.mobiano.flipbook.sound.TAnnoSound",ANNO_LINE:"com.mobiano.flipbook.pageeditor.shapes::TAnnoLine",ANNO_ARROW:"com.mobiano.flipbook.pageeditor.shapes::TAnnoArrow",ANNO_ROUND:"com.mobiano.flipbook.pageeditor.shapes::TAnnoEllipse",ANNO_RECTANGLE:"com.mobiano.flipbook.pageeditor.shapes::TAnnoRectangle",ANNO_TRIANGLE:"com.mobiano.flipbook.pageeditor.shapes::TAnnoTriangle",
ANNO_PRISMATIC:"com.mobiano.flipbook.pageeditor.shapes::TAnnoPrismatic",ANNO_PARALLELOGRAM:"com.mobiano.flipbook.pageeditor.shapes::TAnnoParallelogram",ANNO_PENTAGON:"com.mobiano.flipbook.pageeditor.shapes::TAnnoPentagon",ANNO_HEXAGON:"com.mobiano.flipbook.pageeditor.shapes::TAnnoHexagon",ANNO_PENTAGON:"com.mobiano.flipbook.pageeditor.shapes::TAnnoPentagon",ANNO_DOVETAILED:"com.mobiano.flipbook.pageeditor.shapes::TAnnoDovetailed",ANNO_FLOWCHART:"com.mobiano.flipbook.pageeditor.shapes::TAnnoFlowChart",
ANNO_CYLINDER:"com.mobiano.flipbook.pageeditor.shapes::TAnnoCylinder",ANNO_TRAPEZOID:"com.mobiano.flipbook.pageeditor.shapes::TAnnoTrapezoid",ANNO_RIGHTARROW:"com.mobiano.flipbook.pageeditor.shapes::TAnnoRightArrow",ANNO_VIRTUALEND:"com.mobiano.flipbook.pageeditor.shapes::TAnnoVirtualEnd",ANNO_CROSS:"com.mobiano.flipbook.pageeditor.shapes::TAnnoCross",ANNO_AREA:"com.mobiano.flipbook.pageeditor::TAnnoHighLightArea",ANNO_FLASHSHOW:"com.mobiano.flipbook.pageeditor.TAnnoSWF1",ANNO_PRINT:"com.mobiano.flipbook.pageeditor::TAnnoPrint",
ANNO_ZOOM:"com.mobiano.flipbook.pageeditor::TAnnoZoom",ANNO_TEXT:"com.mobiano.flipbook.pageeditor::TAnnoText",ANNO_ATEXT:"com.mobiano.flipbook.pageeditor::TAnnoDynamicText",ANNO_ROLLERTEXT:"com.mobiano.flipbook.pageeditor::TAnnoRollerText",ANNO_STARTEXT:"com.mobiano.flipbook.pageeditor::TAnnoStarwarsText",ANNO_TEXTANIM:"com.mobiano.flipbook.pageeditor.textAnim::TAnnoTextAnim",ANNO_EFFECTTEXT:"com.mobiano.flipbook.pageeditor.TAnnoEffectText",ANNO_CALLOUT:"com.mobiano.flipbook.pageeditor.shapes::TAnnoCallout",
ANNO_ADVANCEDSOUND:"com.mobiano.flipbook.pageeditor::TAnnoAdvancedSound1",ANNO_ALPHATRANSITIONBANNER:"com.mobiano.flipbook.pageeditor.TAnnoAlphaTransitionBanner",ANNO_EMBEDDEDSLIDESHOW:"com.mobiano.flipbook.pageeditor.TAnnoEmbeddedSlideshow",ANNO_ATIMAGE:"com.mobiano.flipbook.pageeditor.TAnnoClipart",ANNO_BANNER:"com.mobiano.flipbook.pageeditor::TAnnoBanner",ANNO_CAROUSEL:"com.mobiano.flipbook.pageeditor.TAnnoCarouselViewer",ANNO_DYNSHOW:"com.mobiano.flipbook.pageeditor::TAnnoDynamicShowPhoto",ANNO_FLIPJUMP:"com.mobiano.flipbook.pageeditor.TAnnoDynamicTurnPhoto",
ANNO_PLUGIN:"com.mobiano.flipbook.pageeditor::TAnnoPlugIn",ANNO_SWF:"com.mobiano.flipbook.pageeditor.TAnnoSWF",ANNO_CART:"com.mobiano.flipbook.pageeditor.TAnnoCart",ANNO_HOTSPOTS:"com.mobiano.flipbook.pageeditor.TAnnoHotSpots"},PlayEvt:{EVT_PLAY:"EVT_PageViewed",EVT_STOP:"EVT_PageOffView"},TriggerEventType:{MouseDown:"mouseDown",MouseOver:"mouseOver",MouseOut:"mouseOut",MouseUp:"mouseUp",MouseMove:"mouseMove",MouseLeave:"mouseLeave"},MouseOverType:{Zoom:"1",AddBorder:"2"},ActionType:{GOTO_PAGE:"com.mobiano.flipbook.pageeditor.TAnnoActionGotoPage",
OPEN_URL:"com.mobiano.flipbook.pageeditor.TAnnoActionOpenURL",OPEN_WINDOW:"com.mobiano.flipbook.pageeditor.TAnnoActionOpenWindow",SLIDE_SHOW:"com.mobiano.flipbook.pageeditor.TAnnoActionPhotoSlide",ACTION_JS:"com.mobiano.flipbook.pageeditor.TAnnoActionJavascript",PLAY_AUDIO:"com.mobiano.flipbook.pageeditor.TAnnoActionPlayAudio",WINDOW_HTML:"com.mobiano.flipbook.pageeditor.TAnnoActionWindowHtml",PLAY_VIDEO:"com.mobiano.flipbook.pageeditor.TAnnoActionPlayVideo",SHOW_INFORMATION:"com.mobiano.flipbook.pageeditor.TAnnoActionShowInformation",
QUIZ:"com.mobiano.flipbook.pageeditor.TAnnoActionQuiz",PLAYVIDEO:"com.mobiano.flipbook.Action.TAnnoActionPlayVideo",SWF_SLIDE:"com.mobiano.flipbook.pageeditor.TAnnoActionSwfSlide",SHOW_ARTICLE:"com.mobiano.flipbook.pageeditor.TAnnoActionShowArticle"},WindowType:{OPEN_YOUTUBE:"TYPE_YOUTUBE",OPEN_VIMEO:"TYPE_VIMEO",OPEN_DAILYMOTION:"TYPE_DAILYMOTION",OPEN_TYPE_WISTIA:"TYPE_WISTIA",OPEN_TYPE_YOUKU:"TYPE_YOUKU",OPEN_TYPE_QQ:"TYPE_QQ",OPEN_VIDEO:"0",OPEN_FLASH:"1",OPEN_SHOW_TEXT:"4"},PlayerType:{SKIN_1:"Skin 1",
SKIN_2:"Skin 2",SKIN_3:"Skin 3"},AudioPlayer:{GLASS:"GlassAudioPlayer",SIMPLE:"SimpleAudioPlayer",STANDARD1:"StandardAudioPlayer",STANDARD2:"StandardAudioPlayer02",STANDARD3:"StandardAudioPlayer03",STANDARD4:"StandardAudioPlayer04",STANDARD5:"StandardAudioPlayer05",STANDARD6:"StandardAudioPlayer06"},Effect:{FADEIN:"com.mobiano.flipbook.pageeditor.effect::TFadeInEffect",CUTTING:"com.mobiano.flipbook.pageeditor.effect::TCuttingEffect",FLY_IN:"com.mobiano.flipbook.pageeditor.effect::TFlyEffect",INDENTATION:"com.mobiano.flipbook.pageeditor.effect::TIndentationEffect"},
HighLight:{GREENBOXSTOP:"Animated Green Box Stop",GREENBOX:"Animated Green Box",ORIGINCIRCLE:"Animated Orange Circle",REDBOX:"Animated Red Box",REDCIRCLE:"Animated Red Circle",BLUESQUARE:"blue_squarelight",GREENCIRCLEROTATE:"Green Circle Rotating",GREENLINELTOR:"Green Line Left to Right",GREENLINERTOL:"Green Line Right to Left",GREENSQUARE:"green_squarelight",LINESQUARE:"lines_square",ORANGEHIGHLIGHT:"Orange highlighter",ORANGECIRCLELIGHT:"orange_circlelight",PUSHSQUARE:"push_square",REDHIGHLIGHT:"Red highlighter",
REDBOXBLINK:"Red Box Blink",REDLINEBLINK:"Red Line Blink",REDLINELTOR:"Red Line Left to Right",REDLINERTOL:"Red Line right to left",SPINSQUARE:"spin_square"}};
Class("PageItemFactory",{createItem:function(a,b,c,d,e,f){if(!b)return null;var g=b.annotype,h=null;if(!this.browserSupport(g))return null;f=e+"-"+f;g==PageEditor.AnnoType.ANNO_LINK&&(h=new PageItem.Link(a,b,c,d));if(g==PageEditor.AnnoType.ANNO_YOUTUBE||g==PageEditor.AnnoType.ANNO_YOUTUBE1||g==PageEditor.AnnoType.ANNO_YOUTUBE2||g==PageEditor.AnnoType.ANNO_YOUTUBE3||g==PageEditor.AnnoType.ANNO_YOUTUBE4||g==PageEditor.AnnoType.ANNO_YOUTUBE6||g==PageEditor.AnnoType.ANNO_YOUTUBE7||g==PageEditor.AnnoType.ANNO_YOUTUBE8)h=
isPhone()||isPad()?new PageItem.PopUpVimeo(a,b,c,d,"youtube"):new PageItem.Youtube(a,b,c,d);g==PageEditor.AnnoType.ANNO_YOUTUBE5&&(h=new PageItem.PopUpVimeo(a,b,c,d,"youtube"));g==PageEditor.AnnoType.ANNO_VIMEO&&(h=isPhone()||isPad()?new PageItem.PopUpVimeo(a,b,c,d,"vimeo"):new PageItem.Vimeo(a,b,c,d));g==PageEditor.AnnoType.ANNO_VIMEO2&&(h=new PageItem.PopUpVimeo(a,b,c,d,"vimeo"));g!=PageEditor.AnnoType.ANNO_AUDIO&&g!=PageEditor.AnnoType.ANNO_NEW_AUDIO||b.playerType!=PageEditor.PlayerType.SKIN_3||
(h=new PageItem.Audio(a,b,c,d,"default"));g!=PageEditor.AnnoType.ANNO_AUDIO&&g!=PageEditor.AnnoType.ANNO_NEW_AUDIO||b.playerType!=PageEditor.PlayerType.SKIN_1||(h=new PageItem.Audio(a,b,c,d,"skin1"));g!=PageEditor.AnnoType.ANNO_AUDIO&&g!=PageEditor.AnnoType.ANNO_NEW_AUDIO||b.playerType!=PageEditor.PlayerType.SKIN_2||(h=new PageItem.Audio(a,b,c,d,"skin2"));g==PageEditor.AnnoType.ANNO_AUDIO1&&(h=new PageItem.Audio(a,b,c,d,"advanced"));g==PageEditor.AnnoType.ANNO_AUDIO2&&(h=new PageItem.Audio(a,b,c,
d,"wave"));g==PageEditor.AnnoType.ANNO_AUDIO4&&(h=new PageItem.Audio(a,b,c,d,"background"));if(g==PageEditor.AnnoType.ANNO_PLUGIN&&b.className in audioThemeNames){h=void 0;var k=b.className;k==PageEditor.AudioPlayer.GLASS&&(h="glass");k==PageEditor.AudioPlayer.SIMPLE&&(h="simple");k==PageEditor.AudioPlayer.STANDARD1&&(h="enjoy");k==PageEditor.AudioPlayer.STANDARD2&&(h="decent");k==PageEditor.AudioPlayer.STANDARD3&&(h="tree");k==PageEditor.AudioPlayer.STANDARD4&&(h="christmas");k==PageEditor.AudioPlayer.STANDARD5&&
(h="turnonoff");k==PageEditor.AudioPlayer.STANDARD6&&(h="fade");h=new PageItem.Audio(a,b,c,d,h)}g==PageEditor.AnnoType.ANNO_IMAGE&&(b.imgOriginalProportions||(b.imgOriginalProportions="false"),h=new PageItem.Image(a,b,c,d));g==PageEditor.AnnoType.ANNO_BUTTON&&(h=new PageItem.Button(a,b,c,d,f));g==PageEditor.AnnoType.ANNO_DYNAMICBUTTON&&(h=new PageItem.DynamicButton(a,b,c,d,f));g==PageEditor.AnnoType.ANNO_FLASHSHOW&&(h=new PageItem.FlashShow(a,b,c,d));g==PageEditor.AnnoType.ANNO_HOTSPOTS&&(h=new PageItem.HotSpots(a,
b,c,d));g==PageEditor.AnnoType.ANNO_LINE&&(h=new PageItem.Line(a,b,c,d,f));g==PageEditor.AnnoType.ANNO_ARROW&&(h=new PageItem.Arrow(a,b,c,d));g==PageEditor.AnnoType.ANNO_TRIANGLE&&(h=new PageItem.Triangle(a,b,c,d));g==PageEditor.AnnoType.ANNO_PRISMATIC&&(h=new PageItem.Prismatic(a,b,c,d));g==PageEditor.AnnoType.ANNO_CROSS&&(h=new PageItem.Cross(a,b,c,d));g==PageEditor.AnnoType.ANNO_VIRTUALEND&&(h=new PageItem.VirtualEnd(a,b,c,d));g==PageEditor.AnnoType.ANNO_RIGHTARROW&&(h=new PageItem.RightArrow(a,
b,c,d));g==PageEditor.AnnoType.ANNO_TRAPEZOID&&(h=new PageItem.Trapezoid(a,b,c,d));g==PageEditor.AnnoType.ANNO_DOVETAILED&&(h=new PageItem.Dovetailed(a,b,c,d));g==PageEditor.AnnoType.ANNO_FLOWCHART&&(h=new PageItem.FlowChart(a,b,c,d));g==PageEditor.AnnoType.ANNO_CYLINDER&&(h=new PageItem.Cylinder(a,b,c,d));g==PageEditor.AnnoType.ANNO_PENTAGON&&(h=new PageItem.Pentagon(a,b,c,d));g==PageEditor.AnnoType.ANNO_HEXAGON&&(h=new PageItem.Hexagon(a,b,c,d));g==PageEditor.AnnoType.ANNO_PARALLELOGRAM&&(h=new PageItem.Parallelogram(a,
b,c,d));g==PageEditor.AnnoType.ANNO_ROUND&&(h=new PageItem.Round(a,b,c,d,f));g==PageEditor.AnnoType.ANNO_RECTANGLE&&(h=new PageItem.Rectangle(a,b,c,d,f));g==PageEditor.AnnoType.ANNO_TEXT&&(h=new PageItem.Text(a,b,c,d,f));g==PageEditor.AnnoType.ANNO_ROLLERTEXT&&(h=new PageItem.RollerText(a,b,c,d,f));g==PageEditor.AnnoType.ANNO_AREA&&(h=new PageItem.Area(a,b,c,d,f));g==PageEditor.AnnoType.ANNO_CALLOUT&&(h=new PageItem.Callout(a,b,c,d));g==PageEditor.AnnoType.ANNO_ATEXT&&(h=new PageItem.AText(a,b,c,
d,f));g==PageEditor.AnnoType.ANNO_STARTEXT&&(h=new PageItem.StarText(a,b,c,d,f));g==PageEditor.AnnoType.ANNO_TEXTANIM&&(h=new PageItem.TextAmin(a,b,c,d,f));g==PageEditor.AnnoType.ANNO_ATIMAGE&&(h=new PageItem.PngImage(a,b,c,d));g==PageEditor.AnnoType.ANNO_EFFECTTEXT&&(h=new PageItem.EffectText(a,b,c,d,f));g==PageEditor.AnnoType.ANNO_ADVANCEDSOUND&&(h=new PageItem.Sound(a,b,c,d,f));g==PageEditor.AnnoType.ANNO_CAROUSEL&&(h=new PageItem.Carousel(a,b,c,d,f));g==PageEditor.AnnoType.ANNO_DYNSHOW&&(h=new PageItem.DynamicShow(a,
b,c,d,f));g==PageEditor.AnnoType.ANNO_BANNER&&(h=new PageItem.Banner(a,b,c,d,f));g==PageEditor.AnnoType.ANNO_FLIPJUMP&&(h=new PageItem.FlipJump(a,b,c,d,f));g==PageEditor.AnnoType.ANNO_PLUGIN&&b.className==PLUGIN_MAGNETICS&&(h=new PageItem.FocusJump(a,b,c,d,f));g==PageEditor.AnnoType.ANNO_PLUGIN&&b.className==PLUGIN_ROTATE3D&&(h=new PageItem.Rotate3D(a,b,c,d,f));g==PageEditor.AnnoType.ANNO_VIDEO1&&(h=isPhone()||isPad()?new PageItem.PhoneVideo(a,b,c,d):new PageItem.Video(a,b,c,d,"smallblack"));g==PageEditor.AnnoType.ANNO_VIDEO2&&
(h=isPhone()||isPad()?new PageItem.PhoneVideo(a,b,c,d):new PageItem.LoopControlVideo(a,b,c,d));g==PageEditor.AnnoType.ANNO_PLUGIN&&b.className==PLUGIN_VIDEO1&&(h=isPhone()||isPad()?new PageItem.PhoneVideo(a,b,c,d):new PageItem.Video(a,b,c,d,"classic"));g==PageEditor.AnnoType.ANNO_PLUGIN&&b.className==PLUGIN_VIDEO2&&(h=isPhone()||isPad()?new PageItem.PhoneVideo(a,b,c,d):new PageItem.PopUpVideoItem(a,b,c,d));g==PageEditor.AnnoType.ANNO_VIDEO&&(h=isPhone()||isPad()?new PageItem.PhoneVideo(a,b,c,d):new PageItem.Video(a,
b,c,d,"round"));g==PageEditor.AnnoType.ANNOHTML_VIDEO&&(h=isPhone()||isPad()?new PageItem.PhoneHtmlVideo(a,b,c,d):new PageItem.HtmlVideo(a,b,c,d));g==PageEditor.AnnoType.ANNO_ALPHATRANSITIONBANNER&&(h=new PageItem.AlphaTransitionBanner(a,b,c,d));g==PageEditor.AnnoType.ANNO_EMBEDDEDSLIDESHOW&&(h=new PageItem.EmbeddedSlideshow(a,b,c,d));g==PageEditor.AnnoType.ANNO_PRINT&&(h=new PageItem.Print(a,b,c,d,e));g==PageEditor.AnnoType.ANNO_ZOOM&&(global.popZoomBox||(global.popZoomBox=new PageItem.WindowZoomBox(tmpContainer)),
h=new PageItem.WindowZoom(a,b,c,d,e));g==PageEditor.AnnoType.ANNO_CART&&(h=new PageItem.ShoppingCart(a,b,c,d));return h},browserSupport:function(a){return isBelowIE9()?a==PageEditor.AnnoType.ANNO_LINK||a==PageEditor.AnnoType.ANNO_IMAGE||a==PageEditor.AnnoType.ANNO_TEXT||a==PageEditor.AnnoType.ANNO_ALPHATRANSITIONBANNER?!0:!1:!0}});
Class("PageEditorParser",{create:function(a,b,c){this.container=a;this.containerWidth=b;this.containerHeight=c},createItemsForPage:function(a){var b=new ObjectPool;if(!this.hasProfessional())return b;var c=this.getPageAnnos();if(0>=a||c.length<a||0==c[a-1].length)return b;var d=new PageItemFactory;c=c[a-1];for(var e=0;e<c.length;e++){var f=c[e];f&&(f=d.createItem(this.container,f,this.containerWidth,this.containerHeight,a,e+1))&&b.add(f)}return b},hasProfessional:function(){if(!global.pageEditor&&
!this.hasInverseEditor())return!1;var a=this.getPageAnnos();if(!a||0==a.length)return!1;for(var b=0;b<a.length;b++){var c=a[b];if(c&&0<c.length)return!0}return!1},hasInverseEditor:function(){return!window.readerConfig&&window.inverseEditor&&window.inverseEditor.length},getPageAnnos:function(){var a=global.pageEditor;a||(a=[]);a instanceof Array||(a=a.pageAnnos);if(this.hasInverseEditor()){var b=a;a.length<inverseEditor.length&&(b=inverseEditor);for(var c=0;c<b.length;c++){a[c]||(a[c]=[]);inverseEditor[c]||
(inverseEditor[c]=[]);var d=inverseEditor[c];d&&d.length&&(window.isHasPageEditor=!0,d=d.map(function(e){return getInverseItem(e,this.containerWidth,this.containerHeight)}.bind(this)));a[c]=a[c].concat(d);inverseEditor[c]=[]}}global.pageEditor||(global.pageEditor=a);return a}});
